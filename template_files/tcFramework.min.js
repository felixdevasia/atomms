
var Inq=(function(siteFcnStr,rulesEngineDataStr,loadedMbuRuleDataFuns){eval(siteFcnStr);var site=initSiteData();var JSLoggingDisabled=site.JSLoggingDisabled;var dataReady=false;var custID=null;var persistentCustomerID=null;var custIP=null;var win=self.parent;var doc=win.document;var domObserver;var initRule={};var KEY_ENGAGEMENT_ID_STRING="engagementID";var KEY_CUSTOMER_ID_STRING="customerID";resetObserver();if(!document.querySelectorAll){document.querySelectorAll=function(selectors){var style=document.createElement('style'),elements=[],element;document.documentElement.firstChild.appendChild(style);document._qsa=[];style.styleSheet.cssText=selectors+'{x-qsa:expression(document._qsa && document._qsa.push(this))}';window.scrollBy(0,0);style.parentNode.removeChild(style);while(document._qsa.length){element=document._qsa.shift();element.style.removeAttribute('x-qsa');elements.push(element);}
document._qsa=null;return elements;};}
if(!document.querySelector){document.querySelector=function(selectors){var elements=document.querySelectorAll(selectors);return(elements.length)?elements[0]:null;};}
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};if(this.prototype){fNOP.prototype=this.prototype;}
fBound.prototype=new fNOP();return fBound;};}
function log(s,severity){if(!JSLoggingDisabled){if(typeof console!="undefined"){if(typeof severity!="string")severity="log";if(console[severity]){console[severity](s);}else if(console.log){console.log(severity.toUpperCase()+": "+s);}}}}
function isC2PActive(siteC2P){if(isNullOrUndefined(siteC2P)){throw new Error("siteC2P parameter missing");}
var chatData=CHM.getChatData().getChatData();if(!!chatData&&!isNullOrUndefined(chatData['c2cToPersistent'])){return chatData['c2cToPersistent'];}
return siteC2P;}
function fireCustomEvent(eventName,data,rule){try{EVM.fireCustomEvent(eventName,rule,data);}catch(err){logErrorToTagServer("External custom event("+eventName+") fire failure (siteID="+siteID+"): "+err);}}
function logErrorToTagServer(errMsg){logMessageToTagServer(errMsg,LOG_LEVELS.ERROR);}
function logMessageToTagServer(msg,logLevel){log(msg,logLevel);if(!JSLoggingDisabled){ROM.post(urls.logJsPostURL,{level:logLevel,line:msg});}}
var LOG_LEVELS={FATAL:"FATAL",ERROR:"ERROR",WARN:"WARN",INFO:"INFO",DEBUG:"DEBUG"};var JS_LOG_LEVELS={FATAL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1};function isValidLogLevel(value){for(var logLevel in LOG_LEVELS)
if(LOG_LEVELS[logLevel]==value)return true;return false;}
function sendMessageToTagServer(msg,msgLogLevel,svrLogLevel){log(msg);if(!JSLoggingDisabled){if(isNullOrUndefined(msgLogLevel)||!isValidLogLevel(msgLogLevel)){msgLogLevel=LOG_LEVELS.INFO;}
if(isNullOrUndefined(svrLogLevel)||!isValidLogLevel(svrLogLevel)){svrLogLevel=msgLogLevel;}
if(JS_LOG_LEVELS[msgLogLevel]>=JS_LOG_LEVELS[getConstant("JS_LOG_LEVEL")]){ROM.post(urls.loggingURL,{level:svrLogLevel,line:msg});}}}
function logActionErr(e,rule,msg){if(!JSLoggingDisabled){var errMsg=catchFormatter(e);var errStr="Error in "+rule+(isNullOrUndefined(msg)?".":(" msg="+msg));log(errStr+" ChatID = "+CHM.getChatID()+". CustomerID = "+getCustID());logErrorToTagServer(errStr+" \n"+errMsg);}}
function toJsString(val,quote){var value=val;value=value.split("\\").join("\\\\");value=value.split("\"").join("\\\"");value=value.split("\'").join("\\\'");value=value.split("\n").join("\\n");value=value.split("\r").join("\\r");value=value.split("\t").join("\\t");if(quote)
value=quote+value+quote;return value;}
function isPersistentWindow(){try{return window.parent.name=="_inqPersistentChat";}catch(err){return false;}}
function rand(low,high,roundToNearestIntegerFlag){if(high<low){throw("Incorrect bounds for random generator: low = "+low+", high = "+high);}
var delta=high-low;var res=(!!roundToNearestIntegerFlag)?(Math.floor(Math.random()*(delta+1))+low):(Math.random()*delta+low);return res;}
function typeOf(value){var s=typeof value;if(s==='object'){if(value){if(typeof value.length==='number'&&!(value.propertyIsEnumerable('length'))&&typeof value.splice==='function'){s='array';}}else{s='null';}}
return s;}
function getElementsByClassName(classname,node,winCtxt){if(!node){winCtxt=!!winCtxt?winCtxt:win;node=winCtxt.document.getElementsByTagName("body")[0];}
var a;if(node.getElementsByClassName){a=node.getElementsByClassName(classname);}else{a=[];var re=new RegExp('\\b'+classname+'\\b');var els=node.getElementsByTagName("*");for(var i=0,j=els.length;i<j;i++){if(re.test(els[i].className)){a.push(els[i]);}}}
return a;}
function exists(o,dfltOnError,logOnError){try{var val=o;if(typeof o=="function"){val=o();}
return((typeof val!="undefined")&&(val!=null));}catch(err){if(!!logOnError){logActionErr(err,rule,"JS eval error on expression "+o.toString());}
return dfltOnError;}}
function isNullOrUndefined(val){return val==null||typeof(val)=="undefined";}
function isIE(){return window.navigator.appName=="Microsoft Internet Explorer"||window.navigator.userAgent.indexOf("Trident")>=0;}
function isFF(){return window.navigator.userAgent.indexOf("Firefox")>=0;}
function isIOS(){return/(iPad|iPhone|iPod)/g.test(window.navigator.userAgent);}
function isIOS9(){return/(iPad|iPhone|iPod).*OS 9/i.test(window.navigator.userAgent);}
function isOpera(){return window.navigator.userAgent.indexOf("Opera")>=0;}
function isChrome(){return(window.navigator.userAgent.indexOf("Chrome")>=0||window.navigator.userAgent.indexOf("CriOS")>=0)&&!isAndroidWebView()&&(!isEdge());}
function isAndroidWebView(){var pattern=new RegExp("Android.*?(wv|Version\\/[.0-9]+).*?Chrome\\/[0-9]{2}","i");return pattern.test(window.navigator.userAgent);}
function isSafari(){return window.navigator.userAgent.indexOf("Safari")>=0&&(!isChrome())&&(!isEdge());}
function isEdge(){return window.navigator.userAgent.indexOf("Edge")>=0;}
function getClientBrowserType(){if(isIE()){return"IE";}else if(isEdge()){return"EDGE";}else if(isFF()){return"FF";}else if(isChrome()){return"CHROME";}else if(isOpera()){return"OPERA";}else if(isSafari()){return"SAFARI";}else{return"OTHER";}}
function getBrowserTypeAndVersion(){var nvg=window.navigator.appName;var userAgt=window.navigator.userAgent;var temp;var matches=userAgt.match(/android(?!.*chrome)/i);if(matches&&(temp=userAgt.match(/version\/([\.\d]+)/i))!=null){matches=["Android Browser",temp[1]];}else{matches=userAgt.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);if(matches&&(temp=userAgt.match(/version\/([\.\d]+)/i))!=null){matches[2]=temp[1];}
if(userAgt.indexOf("Chrome")>=0&&(temp=userAgt.match(/(edge)\/?\s*(\.?\d+(\.\d+)*)/i))){matches[1]=temp[1];matches[2]=temp[2];}
matches=matches?[matches[1],matches[2]]:[nvg,window.navigator.appVersion,'-?'];}
return matches;}
function getClientBrowserVersion(){var browserTypeAndVersion=getBrowserTypeAndVersion();var ua=window.navigator.userAgent;if(ua.indexOf("Trident")>=0){var matches=ua.match(/(trident)\/?\s*(\.?\d+(\.\d+)*)/i);var tridentVersion=new Number(matches[2]);if(tridentVersion>=4){return(tridentVersion+4)+".0";}}
return browserTypeAndVersion[1];}
function compareVersions(a,b){var v1=a.split('.');var v2=b.split('.');for(var i=0;i<Math.min(v1.length,v2.length);i++){var res=v1[i]-v2[i];if(res!=0)
return res;}
return 0;}
function getOSType(){var os="Unknown";var platform=window.navigator.platform;var ua=window.navigator.userAgent;if(/Android/.test(ua)){os="Android";}else if(/iPhone/.test(ua)||/iPad/.test(ua)||/iPod/.test(ua)){os="iOS";}else if(/Win/.test(platform)){os="Windows";}else if(/Linux/.test(platform)){os="Linux";}else if(/Mac/.test(platform)){os="Mac OS";}
return os;}
function getBrowserMajorVer(compatibilityOnly){var ver=0;if(isIE()){var ua=window.navigator.userAgent;var tridentInd=ua.indexOf("Trident");if(tridentInd>=0){ver=parseInt(ua.substring(tridentInd+8))+4;}else{var ind=ua.indexOf("MSIE ");ver=parseInt(ua.substring(ind+5));}
if(compatibilityOnly){if(document.documentMode&&document.documentMode<ver){ver=document.documentMode;}}}
return ver;}
var COOKIE_SIZE_LIMITS={"IE8":5118,"IE9":5118,"IE10":5118,"IE11":5118,"FF":4097,"SAFARI":4093,"CHROME":4095};var COOKIE_TOTAL_SIZE_LIMITS={"IE8":10236,"IE9":10236,"IE10":10236,"IE11":10236,"FF":614550,"SAFARI":4093,"SAFARI_NEW":8186,"CHROME":732280};function getCookieSizeLimit(){var browserType=getClientBrowserType();var limit=COOKIE_SIZE_LIMITS[browserType];if(isNullOrUndefined(limit)){limit=COOKIE_SIZE_LIMITS[browserType+getBrowserMajorVer()];}
return limit;}
function getCookieTotalSizeLimit(){var browserType=getClientBrowserType();var limit=COOKIE_TOTAL_SIZE_LIMITS[browserType];if(isNullOrUndefined(limit)){limit=COOKIE_TOTAL_SIZE_LIMITS[browserType+getBrowserMajorVer()];}
if(isSafari()&&getBrowserMajorVer()>6){limit=COOKIE_TOTAL_SIZE_LIMITS["SAFARI_NEW"];}
return limit;}
function getStackTrace(err){try{var callstack=[];if(arguments&&arguments.callee&&arguments.callee.caller){var fnctn=arguments.callee.caller.caller;while(fnctn){if(callstack.length>32)
break;var fn=""+fnctn.toString();var fnameIx=fn.indexOf("function ")+9;var fnameEnd=fn.indexOf('(',fnameIx);var fname=fn.substring(fnameIx,fnameEnd)||'anonymous function';var args="";if(fnctn.arguments.length){for(var ix=0;ix<fnctn.arguments.length;ix++){var arg=fnctn.arguments[ix];args+=((args.length!=0)?",":"")+formatArgument(arg);}}
callstack.push(fname+"("+args+")");fnctn=fnctn.caller;}
return"stack trace:\n\t\t"+callstack.join("\n\t\t");}
return"";}catch(e){return"";}}
function prepareLoggingContext(msg){var result=msg;if(!result)result="";var o={};try{o["chatID"]=""+CHM.getChatID();}catch(e){}
try{o["custID"]=Inq.custID;}catch(e){}
try{o["custIP"]=Inq.custIP;}catch(e){}
try{o["siteID"]=Inq.siteID;}catch(e){}
try{o["pageID"]=LDM.getPageID();}catch(e){}
for(var itm in o){try{result+=itm+": "+(""+o[itm])+"; ";}catch(e){result+=itm+": "+formatArgument(o[itm])+"; ";}}
return result;}
function catchFormatter(err){try{var desc="\t";if(err&&err.message){desc+=err.message+". ";}else{desc+="Throw while processing. ";}
desc+=prepareLoggingContext();desc+="\n\t"+getStackTrace(err);return encodeURIComponent(desc);}catch(e){return"";}}
function parseUrl(str){var m=str.match(/^(https?):\/\/([^\/:]+)(:?(\d*))/);var host=m[2];var domain=(host.indexOf('.')>=0&&host.split('.').length>=3)?host.split('.').slice(1).join('.'):host;return{origin:m[1]+"://"+m[2],href:str,protocol:m[1],domain:domain,host:host,port:(m[4]?m[4]:80)};}
function safe(id,dflt,sendErrorToTagServer){if(id){try{var o=win.eval(id);if(isNullOrUndefined(o)){return o;}else if(typeOf(o)=="array"){return Array.clone(o);}else if(o.getTime){if(!o.equals){MI8.prepare(o).im13(DateMixIn);}}else if(o.toExponential){if(!o.inRange){MI8.prepare(o).im13(NumberMixIn);}}
return o;}catch(err){if(sendErrorToTagServer){logErrorToTagServer(catchFormatter(err));}}}
return dflt;}
function processReceivedExternalDataThrows(id,dflt){return safe(id,dflt,true);}
function isEmptyObject(obj){for(var i in obj){return false;}
return true;}
function rte(url){var URL_REGEXP_IS_CONTAINS_PROTOCOL=new RegExp("^[0-9A-z\\.\\+\\-]*:|^//");if(url==null||url.length==0){return url;}else if(url.match(URL_REGEXP_IS_CONTAINS_PROTOCOL)){return url.replace(/^HTTPS?:/i,win.location.protocol);}else{return win.location.protocol+"//"+url;}}
function secureHTTP(httpURL){return httpURL?httpURL.replace(/^http:/i,"https:"):httpURL;}
function objectAsLogString(obj,encodingRequired){if(!obj){return null;}
var string="";for(var a in obj){if(!isNullOrUndefined(obj[a])&&obj[a]!==""){var encodedPair=encodingRequired?encodeURIComponent(a)+","+encodeURIComponent(obj[a]):a+","+obj[a];string+=!!string?";"+encodedPair:encodedPair;}}
return string;}
function productionFilter(hostedFileList,_productionFilter){if(_productionFilter){var filters=_productionFilter.split(",");var listItems=hostedFileList.split(",");var filteredListItems=[];var regexProduction=new RegExp(filters[0],"i");var production=regexProduction.test(inqFrame.parent.location.href);if(production){for(var i=0;i<listItems.length;i++){var item=listItems[i];if(regexProduction.test(item)){filteredListItems.push(item);}}
return filteredListItems.join(",");}else if(filters.length>1){var walledGarden;var filter;for(i=1;i<filters.length;i++){filter=filters[i];walledGarden=filter.indexOf("-")==0;var regexSilo=new RegExp((walledGarden)?filter.substr(1):filter,"i");var silo=regexSilo.test(inqFrame.parent.location.href);if(silo){for(i=0;i<listItems.length;i++){var item=listItems[i];if(regexSilo.test(item)||(!walledGarden&&regexProduction.test(item))){filteredListItems.push(item);}}
return filteredListItems.join(",");}}}}
return hostedFileList;}
function attachListener(target,type,listener,useCapture){if(!useCapture){useCapture=false;}
if(target.addEventListener){target.addEventListener(type,listener,useCapture);}else if(target.attachEvent){target.attachEvent("on"+type,listener);}}
function detachListener(target,type,listener,useCapture){if(!useCapture){useCapture=false;}
if(target.removeEventListener){target.removeEventListener(type,listener,useCapture);}else if(target.attachEvent){target.detachEvent("on"+type,listener);}}
function firstExisting(method){for(var i=1;i<arguments.length;i++){var obj=arguments[i];if(obj&&obj[method]){return obj[method].call(obj);}}
return null;}
function getDefaultValueIfNull(val,def){return isNullOrUndefined(val)?def:val;}
var urls={siteHostedFileURL:productionFilter(site.psHosturlList||"",site.productionFilter),baseURL:rte(site.vanityDomainName+"/tagserver"),vanityURL:rte(site.vanityDomainName),chatRouterVanityDomain:rte("https://"+site.chatRouterVanityDomain),pageUnloadURL:"https://"+site.chatRouterVanityDomain+"/chatrouter/chat/pageUnload",initFrameworkURL:rte(site.vanityDomainName+"/tagserver/init/initFramework"),getSiteTzOffsetURL:rte(site.vanityDomainName+"/tagserver/init/getSiteTzOffset"),cookieGetURL:rte(site.vanityDomainName+"/tagserver/cookie/getServerCookie"),cookieSetURL:rte(site.vanityDomainName+"/tagserver/cookie/setDelta"),cookieClearAllURL:rte(site.vanityDomainName+"/tagserver/cookie/clearAllServerCookies"),cookieClearOneURL:rte(site.vanityDomainName+"/tagserver/cookie/clearOneServerCookie"),requestC2CImageURL:rte(site.vanityDomainName+"/tagserver/launch/requestC2CImage"),requestChatLaunchURL:rte(site.vanityDomainName+"/tagserver/launch/requestChatLaunch"),agentsAvailabilityCheckURL:rte(site.vanityDomainName+"/tagserver/launch/agentAvailability"),loggingURL:rte(site.vanityDomainName+"/tagserver/logging/logline"),logDataURL:rte(site.vanityDomainName+"/tagserver/logging/logdata"),logJsURL:rte("https://"+site.clusterEnvironment+"tslogging.touchcommerce.com/tagserver/logging/log4js"),logJsPostURL:rte(site.vanityDomainName+"/tagserver/logging/log4js"),mediaRootURL:rte(site.mediaServer),mediaBaseURL:rte(site.mediaServer+"/media"),mediaSiteURL:rte(site.mediaServer+"/media/sites/"+site.siteID),skinURL:rte(site.vanityDomainName+"/chatskins/sites/"+site.siteID+"/flash/"),cobrowseURL:rte(site.cobrowseURL),xFormsDomain:rte(site.xformsVanityDomain)};function getLocalizedMessage(key){var result=site.messages[key];if(!result){result="no translation for the key ["+key+"]";}
return result;}
(function(){if(typeof window.XMLHttpRequestFacade!="undefined")
return;if(typeof window.XMLHttpRequestOriginal!="undefined")
return;if(!!window["XMLHttpRequest"]){if("FACADE"in window.XMLHttpRequest){if("console"in window)console.error("XF: ERROR: Inconsistent xform window state detected");}else{window.XMLHttpRequestOriginal=XMLHttpRequest;}}
window.XMLHttpRequestLegacy=function(){this.onabort=null;this.onerror=null;this.onload=null;this.onloadend=null;this.onloadstart=null;this.onprogress=null;this.onreadystatechange=null;this.readyState=0;this.response="";this.responseText="";this.responseType="";this.responseXML=null;this.status=0;this.timeout=0;this.withCredentials=false;this.statusText=0;this._impl=null;this._requestHeaders=[];this._responseHeaders=[];this._methodString="GET";this._methodUrl="";this._asyncFlag=true;this._userString="";this._userPassword="";this._id="";this._toJsString=function(val){if(val==null)return null;var value=val;value=value.split("\\").join("\\\\");value=value.split("\"").join("\\\"");value=value.split("'").join("\\'");value=value.split("\n").join("\\n");value=value.split("\r").join("\\r");value=value.split("\t").join("\\t");value="\""+value+"\"";return value;};this._jsonString=function(){var ix;var json="{";json+="requestHeaders:[";for(ix=0;ix<this._requestHeaders.length;ix++){if(ix>0)json+=",";json+="["+this._requestHeaders[ix][0]+","
+this._requestHeaders[ix][1]+"]";}
json+="]";json+=",methodString:"+this._toJsString(this._methodString);json+=",methodUrl:"+this._toJsString(this._methodUrl);json+=",asyncFlag:"+this._asyncFlag;json+=",userString:"+this._toJsString(this._userString);json+=",userPassword:"+this._toJsString(this._userPassword);json+=",timeout:"+this.timeout;json+=",withCredentials:"+this.withCredentials;json+=",data:"+this._toJsString(this._data);json+=",_id:"+this._toJsString(this._id);json+=",_callBack:"+this._toJsString(self.location.href.split("?")[0]);json+=",onabort:"+(this.onabort!=null);json+=",onerror:"+(this.onerror!=null);json+=",onload:"+(this.onload!=null);json+=",onloadend:"+(this.onloadend!=null);json+=",onloadstart:"+(this.onloadstart!=null);json+=",onprogress:"+(this.onprogress!=null);json+=",onreadystatechange:"+(this.onreadystatechange!=null);json+="}";return json;};this.getAllResponseHeaders=function(){var ix,headers="";for(ix=0;ix<this._responseHeaders.length;ix++){if(ix!=0)headers+='\r';headers+=this._responseHeaders[ix][0]+": "+this._responseHeaders[ix][1];}};this.getResponseHeader=function(key){var ix;for(ix=0;ix<this._responseHeaders.length;ix++){if(key==this._responseHeaders[ix][0]){return this._responseHeaders[ix][1];}}
return null;};this.abort=function(){XMLHttpRequestLegacy._RemoveIframe(this._id);};this.setRequestHeader=function(headerString,valueString){this._requestHeaders.push([this._toJsString(headerString),this._toJsString(""+valueString)]);};this.setOnLoad=function(handler){this.onload=handler;};this.setOnError=function(handler){this.onerror=handler;};this.open=function(methodString,methodUrl,asyncFlag,userString,userPassword){if(asyncFlag==null)asyncFlag=true;this._methodString=methodString;this._methodUrl=methodUrl;this._asyncFlag=asyncFlag;this._userString=userString;this._userPassword=userPassword;};this.overrideMimeType=function(mimeString){this.debug("override: "+mimeString);if("overrideMimeType"in this._impl)
return this._impl.overrideMimeType(mimeString);};this.send=function(data){this._data=(data)?data:null;if(this._isCrossDomain()){var id="XHR"+Math.floor(Math.random()*1000001);while(null!=document.getElementById(id)){id="XHR"+Math.floor(Math.random()*1000001);}
this._id=id;var jsonString=this._jsonString();var frameSrc='"'+this._getProto()+window.XMLHttpRequestLegacy.getFrameSource(this._getDomain())+'"';var divTemp=document.createElement("DIV");divTemp.innerHTML="<IFRAME "
+"ID="+id+" "
+"STYLE=\"overflow: hidden; position: absolute; display: block; border: none; top:0px;left:0px;width: 1px; height: 1px;\" "
+"NAME=\""+encodeURIComponent(jsonString)+"\" "
+"SRC="+frameSrc+">\n</IFRAME>";var iframe=divTemp.firstChild;iframe["_xmlRequest"]=this;document.body.appendChild(iframe);}
else{this._sendInDomain();}};this._sendInDomain=function(){if(this._impl)this._impl=null;if(typeof window.XMLHttpRequestOriginal!="undefined")
this._impl=new XMLHttpRequestOriginal();if(this._impl==null&&"ActiveXObject"in window)
try{this._impl=new ActiveXObject("Msxml2.XMLHTTP.6.0");}catch(e){}
if(this._impl==null&&"ActiveXObject"in window)
try{this._impl=new ActiveXObject("Msxml2.XMLHTTP.3.0");}catch(e){}
if(this._impl==null&&"ActiveXObject"in window)
try{this._impl=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){}
if(this._impl==null)return;try{this._impl.open(this._methodString,this._methodUrl,this._asyncFlag,this._userString,this._userPassword);this._impl.onabort=(this.onabort!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onabort");}):null;this._impl.onerror=(this.onerror!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onerror");}):null;this._impl.onload=(this.onload!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onload");}):null;this._impl.onloadend=(this.onloadend!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onloadend");}):null;this._impl.onloadstart=(this.onloadstart!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onloadstart");}):null;this._impl.onprogress=(this.onprogress!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onprogress");}):null;this._impl.onreadystatechange=(this.onreadystatechange!=null)?XMLHttpRequestLegacy._MethodClosure(this,function(){return this._fireEvent("onreadystatechange");}):null;this._impl.timeout=this.timeout;for(var ix=0;ix<this._requestHeaders.length;ix++){this._impl.setRequestHeader(this._requestHeaders[ix][0],this._requestHeaders[ix][1]);}
if(null==this._data)
this._impl.send();else
this._impl.send(this._data);}catch(e){this.error("XHR send error",e);}};this._onRemoteEvent=function(remoteObject){var b=false;var eventName=remoteObject._eventName;try{if(eventName=="onreadystatechange"&&this.readyState>remoteObject.readyState){return;}}catch(e){this.error("Event error in onRemoteEvent",e);}
this.readyState=remoteObject.readyState;this.response=remoteObject.responseText;this.responseText=remoteObject.responseText;this.responseType=remoteObject.responseType;try{this.status=remoteObject.status;}catch(X){}
try{this.statusText=remoteObject.statusText;}catch(X){}
try{var func=this[eventName];if(func!=null){b=this[eventName]();}}catch(e){this.error("Event error, could not fire "+eventName,e);}
switch(eventName){case"onload":case"onerror":case"onabort":{setTimeout("XMLHttpRequestLegacy._RemoveIframe("+this._toJsString(this._id)+");",1000);}}
return true;};this._fireEvent=function(eventHandlerName,event){var b=false;var func=null;this.readyState=this._impl.readyState;this.response=this._impl.response;try{this.responseText=this._impl.responseText;}catch(X){}
try{this.responseBody=this._impl.responseBody;}catch(X){}
this.responseType=this._impl.responseType;try{this.responseXML=this._impl.responseXML;}catch(X){}
try{this.status=this._impl.status;}catch(X){}
try{this.statusText=this._impl.statusText;}catch(X){}
try{func=this[eventHandlerName];if(func!=null)
b=this[eventHandlerName]();}catch(e){this.error("Event error, could not fire "+eventHandlerName,e);}
return b;};this._isCrossDomain=function(){return window.location.host!=this._getDomain();};this._getDomain=function(){var rx=new RegExp('((http://|https://|//|/|#){0,1}[^"]*)','i');var parts=rx.exec(this._methodUrl);var url="";switch(parts[2]){case"http://":case"https://":case"//":{url=parts[1];}break;case"#":case"/":default:{return window.location.host;}break;}
parts=url.split("/");return parts[2];};this._getProto=function(){var rx=new RegExp('((http://|https://|//|/|#){0,1}[^"]*)','i');var parts=rx.exec(this._methodUrl);var proto=window.location.protocol;switch(parts[2]){case"http://":case"https://":{proto=parts[2].slice(0,-2);}break;default:{proto=window.location.protocol;}break;}
return proto;};};XMLHttpRequestLegacy._MethodClosure=function(obj,method){var _method=method;var _obj=obj;var _func=function(){return _method.apply(_obj,arguments);};_func.scope=_obj;_func.method=_method;return _func;};XMLHttpRequestLegacy._RemoveIframe=function(iframeId){try{var iframe=document.getElementById(iframeId);if(iframe){var par=iframe.parentNode;if(par){par.removeChild(iframe);}}}catch(e){this.error("Garbage Collection error in XMLHttpRequestLegacy._RemoveIframe",e);}};XMLHttpRequestLegacy.Return=function(jsonString){var xfrObj=eval("("+jsonString+")");var id=xfrObj._id;var iframe=document.getElementById(id);if(iframe){var xhr=iframe["_xmlRequest"];if(xhr)
(xhr._subclass._impl)._onRemoteEvent(xfrObj);}};window.XMLHttpRequestFacade=function(){this._impl=XMLHttpRequestFacade._factory();this._impl._subclass=this;this.log=function(s){if("console"in window)console.log("XHRF: "+s);};this.error=function(s,ex){if("console"in window)console.log("XHRF: "+s,ex);};this.debug=function(s,ex){if("console"in window&&this._debug)console.log("XHRF: "+s,ex);};this.onabort=null;this.onerror=null;this.onload=null;this.onloadend=null;this.onloadstart=null;this.onprogress=null;this.onreadystatechange=null;this._debug=false;this.readyState=0;this.response="";this.responseText="";this.responseBody="";this.responseType="";this.responseXML=null;this.status=0;this.statusText=0;this._impl.onabort=function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onabort){this._subclass.onabort(event);}};this._impl.setOnError(function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onerror){this._subclass.onerror(event);}});this._impl.setOnLoad(function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onload){this._subclass.onload(event);}});this._impl.onloadend=function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onloadend){this._subclass.onloadend(event);}};this._impl.onloadstart=function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onloadstart){this._subclass.onloadstart(event);}};this._impl.onprogress=function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onprogress){this._subclass.onprogress(event);}};this._impl.onreadystatechange=function(event){(this._subclass)._syncupFromImpl();if(null!=this._subclass.onreadystatechange){this._subclass.onreadystatechange(event);}};this.addEventListener=function(type,listener,useCapture){this.debug("addEventListener: "+type);if(!useCapture)useCapture=false;if("addEventListener"in this._impl)
this._impl.addEventListener(type,listener,useCapture);};this.removeEventListener=function(type,listener){if("removeEventListener"in this._impl)
this._impl.removeEventListener(type,listener,useCapture);};this.abort=function(){if("abort"in this._impl){this._impl.abort();}else{this.error("abort: Not implemented");}};this.getAllResponseHeaders=function(){if("getAllResponseHeaders"in this._impl)
return this._impl.getAllResponseHeaders();};this.getResponseHeader=function(headerString){if("getResponseHeader"in this._impl)
return this._impl.getResponseHeader(headerString);};this.open=function(methodString,methodUrl,asyncFlag,userString,userPassword){if(asyncFlag==null)asyncFlag=true;var domain=this.constructor.defaultServerDomain;var proto=this.constructor.defaultServerProtocol;if(domain==null)domain="";if(proto==null)proto="";if(proto.length>0){if(proto.indexOf(":")==-1)proto+=":";}
var rx=new RegExp('((http://|https://|//|/|#){0,1}[^"]*)','i');var parts=rx.exec(methodUrl);var url="";switch(parts[2]){case"http://":case"https://":case"#":{url=parts[1];}break;case"//":{url=proto+parts[1];}break;case"/":{url=proto+"//"+domain+parts[1];}break;default:{url=path+"/"+parts[1];}break;}
methodUrl=url;var jsessionid=this.constructor.jsessionid;if(jsessionid!=null&&jsessionid.length>0){parts=methodUrl.split("?");parts[0]+=";jsessionid="+jsessionid;methodUrl=parts.join("?");}
if(arguments.length<4){this._impl.open(methodString,methodUrl,asyncFlag);}else if(arguments.length<5){this._impl.open(methodString,methodUrl,asyncFlag,userString);}else{this._impl.open(methodString,methodUrl,asyncFlag,userString,userPassword);}};this.overrideMimeType=function(mimeString){this.debug("override: "+mimeString);if("overrideMimeType"in this._impl)
return this._impl.overrideMimeType(mimeString);};this.send=function(data){this.debug("send");if("send"in this._impl){if(!!data){return this._impl.send(data);}else{return this._impl.send();}}};this.setRequestHeader=function(headerString,valueString){this.debug("setRequestHeader: "+headerString+": "+valueString);try{if("setRequestHeader"in this._impl)
return this._impl.setRequestHeader(headerString,valueString);}catch(e){this.error("setRequestHeader: Error",e);}};this._syncupFromImpl=function(){this.debug("sync readyState");this.readyState=this._impl.readyState;this.response=this._impl.response;this.responseText=this._impl.responseText;try{this.responseBody=this._impl.responseBody;}catch(X){}
this.responseType=this._impl.responseType;try{this.responseXML=this._impl.responseXML;}catch(X){}
try{this.status=this._impl.status;}catch(X){}
try{this.statusText=this._impl.statusText;}catch(X){}};return this;};XMLHttpRequestFacade._factory=function(){if(typeof window.XMLHttpRequestOriginal!="undefined"){var impl=new XMLHttpRequestOriginal();if("withCredentials"in impl){impl.setOnLoad=function(handler){this.onload=handler;};impl.setOnError=function(handler){this.onerror=handler;};}
else{impl=new XMLHttpRequestLegacy();}}else{impl=new XMLHttpRequestLegacy();}
return impl;};try{window.XMLHttpRequestFacade.name="XMLHttpRequest";}catch(e){}
window.XMLHttpRequestFacade.DONE=4;window.XMLHttpRequestFacade.LOADING=3;window.XMLHttpRequestFacade.HEADERS_RECEIVED=2;window.XMLHttpRequestFacade.OPENED=1;window.XMLHttpRequestFacade.UNSENT=0;window.XMLHttpRequestFacade.defaultServerDomain=null;window.XMLHttpRequestFacade.defaultServerProtocol="";window.XMLHttpRequestFacade.jsessionid="";window.XMLHttpRequestFacade.FACADE=true;window.XMLHttpRequestLegacy.serverMap={};window.XMLHttpRequestLegacy.serverMap["forms.inq.com"]="//forms.inq.com/xhr/xhrProxy.html";window.XMLHttpRequestLegacy.serverMap["formsv3.inq.com"]="//formsv3.inq.com/xhr/xhrProxy.html";window.XMLHttpRequestLegacy.DEFAULT_SERVER="/xhr/xhrProxy.html";window.XMLHttpRequestLegacy.getFrameSource=function(domain){var frameSrc=window.XMLHttpRequestLegacy.serverMap[domain];if(frameSrc==null){frameSrc="//"+domain+window.XMLHttpRequestLegacy.DEFAULT_SERVER;}
return frameSrc;};window.XMLHttpRequest=window.XMLHttpRequestFacade;})();var isLog4TcSupported=true;var log4tc=(function(){if(!Array.prototype.push){Array.prototype.push=function(){for(var i=0,len=arguments.length;i<len;i++){this[this.length]=arguments[i];}
return this.length;};}
if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var firstItem=this[0];for(var i=0,len=this.length-1;i<len;i++){this[i]=this[i+1];}
this.length=this.length-1;return firstItem;}};}
if(!Array.prototype.splice){Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount);var itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;var argumentsArray=[];for(var i=0,len=arguments.length;i<len;i++){argumentsArray[i]=arguments[i];}
var itemsToAppend=(argumentsArray.length>2)?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len=itemsToAppend.length;i<len;i++){this.push(itemsToAppend[i]);}
return itemsDeleted;};}
var log4javascript=(function(){function isUndefined(obj){return typeof obj=="undefined";}
function EventSupport(){}
EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(eventTypesParam){if(eventTypesParam instanceof Array){this.eventTypes=eventTypesParam;this.eventListeners={};for(var i=0,len=this.eventTypes.length;i<len;i++){this.eventListeners[this.eventTypes[i]]=[];}}else{handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array");}},addEventListener:function(eventType,listener){if(typeof listener=="function"){if(!array_contains(this.eventTypes,eventType)){handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+eventType+"'");}
this.eventListeners[eventType].push(listener);}else{handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function");}},removeEventListener:function(eventType,listener){if(typeof listener=="function"){if(!array_contains(this.eventTypes,eventType)){handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+eventType+"'");}
array_remove(this.eventListeners[eventType],listener);}else{handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function");}},dispatchEvent:function(eventType,eventArgs){if(array_contains(this.eventTypes,eventType)){var listeners=this.eventListeners[eventType];for(var i=0,len=listeners.length;i<len;i++){listeners[i](this,eventType,eventArgs);}}else{handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+eventType+"'");}}};var applicationStartDate=new Date();var uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+
Math.floor(Math.random()*100000000);var emptyFunction=function(){};var newLine="\r\n";var pageLoaded=false;function Log4JavaScript(){}
Log4JavaScript.prototype=new EventSupport();log4javascript=new Log4JavaScript();log4javascript.version="1.4.6";log4javascript.edition="log4javascript_production";function toStr(obj){if(obj&&obj.toString){return obj.toString();}else{return String(obj);}}
function getExceptionMessage(ex){if(ex.message){return ex.message;}else if(ex.description){return ex.description;}else{return toStr(ex);}}
function getUrlFileName(url){var lastSlashIndex=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));return url.substr(lastSlashIndex+1);}
function getExceptionStringRep(ex){if(ex){var exStr="Exception: "+getExceptionMessage(ex);try{if(ex.lineNumber){exStr+=" on line number "+ex.lineNumber;}
if(ex.fileName){exStr+=" in file "+getUrlFileName(ex.fileName);}}catch(localEx){logLog.warn("Unable to obtain file and line information for error");}
if(showStackTraces&&ex.stack){exStr+=newLine+"Stack trace:"+newLine+ex.stack;}
return exStr;}
return null;}
function bool(obj){return Boolean(obj);}
function trim(str){return str.replace(/^\s+/,"").replace(/\s+$/,"");}
function splitIntoLines(text){var text2=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return text2.split("\n");}
var urlEncode=(typeof window.encodeURIComponent!="undefined")?function(str){return encodeURIComponent(str);}:function(str){return escape(str).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D");};var urlDecode=(typeof window.decodeURIComponent!="undefined")?function(str){return decodeURIComponent(str);}:function(str){return unescape(str).replace(/%2B/g,"+").replace(/%22/g,"\"").replace(/%27/g,"'").replace(/%2F/g,"/").replace(/%3D/g,"=");};function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break;}}
if(index>=0){arr.splice(index,1);return true;}else{return false;}}
function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true;}}
return false;}
function extractBooleanFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue;}else{return bool(param);}}
function extractStringFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue;}else{return String(param);}}
function extractIntFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue;}else{try{var value=parseInt(param,10);return isNaN(value)?defaultValue:value;}catch(ex){logLog.warn("Invalid int param "+param,ex);return defaultValue;}}}
function extractFunctionFromParam(param,defaultValue){if(typeof param=="function"){return param;}else{return defaultValue;}}
function isError(err){return(err instanceof Error);}
if(!Function.prototype.apply){Function.prototype.apply=function(obj,args){var methodName="__apply__";if(typeof obj[methodName]!="undefined"){methodName+=String(Math.random()).substr(2);}
obj[methodName]=this;var argsStrings=[];for(var i=0,len=args.length;i<len;i++){argsStrings[i]="args["+i+"]";}
var script="obj."+methodName+"("+argsStrings.join(",")+")";var returnValue=eval(script);delete obj[methodName];return returnValue;};}
if(!Function.prototype.call){Function.prototype.call=function(obj){var args=[];for(var i=1,len=arguments.length;i<len;i++){args[i-1]=arguments[i];}
return this.apply(obj,args);};}
function getListenersPropertyName(eventName){return"__log4javascript_listeners__"+eventName;}
function addEvent(node,eventName,listener,useCapture,win){win=win?win:window;if(node.addEventListener){node.addEventListener(eventName,listener,useCapture);}else if(node.attachEvent){node.attachEvent("on"+eventName,listener);}else{var propertyName=getListenersPropertyName(eventName);if(!node[propertyName]){node[propertyName]=[];node["on"+eventName]=function(evt){evt=getEvent(evt,win);var listenersPropertyName=getListenersPropertyName(eventName);var listeners=this[listenersPropertyName].concat([]);var currentListener;while((currentListener=listeners.shift())){currentListener.call(this,evt);}};}
node[propertyName].push(listener);}}
function removeEvent(node,eventName,listener,useCapture){if(node.removeEventListener){node.removeEventListener(eventName,listener,useCapture);}else if(node.detachEvent){node.detachEvent("on"+eventName,listener);}else{var propertyName=getListenersPropertyName(eventName);if(node[propertyName]){array_remove(node[propertyName],listener);}}}
function getEvent(evt,win){win=win?win:window;return evt?evt:win.event;}
function stopEventPropagation(evt){if(evt.stopPropagation){evt.stopPropagation();}else if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true;}
evt.returnValue=false;}
var logLog={quietMode:false,debugMessages:[],setQuietMode:function(quietMode){this.quietMode=bool(quietMode);},numberOfErrors:0,alertAllErrors:false,setAlertAllErrors:function(alertAllErrors){this.alertAllErrors=alertAllErrors;},debug:function(message){this.debugMessages.push(message);},displayDebug:function(){alert(this.debugMessages.join(newLine));},warn:function(message,exception){},error:function(message,exception){}};log4javascript.logLog=logLog;log4javascript.setEventTypes(["load","error"]);function handleError(message,exception){logLog.error(message,exception);log4javascript.dispatchEvent("error",{"message":message,"exception":exception});}
log4javascript.handleError=handleError;var enabled=!((typeof log4javascript_disabled!="undefined")&&log4javascript_disabled);log4javascript.setEnabled=function(enable){enabled=bool(enable);};log4javascript.isEnabled=function(){return enabled;};var useTimeStampsInMilliseconds=true;log4javascript.setTimeStampsInMilliseconds=function(timeStampsInMilliseconds){useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds);};log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds;};log4javascript.evalInScope=function(expr){return eval(expr);};var showStackTraces=false;log4javascript.setShowStackTraces=function(show){showStackTraces=bool(show);};var Level=function(level,name){this.level=level;this.name=name;};Level.prototype={toString:function(){return this.name;},equals:function(level){return this.level==level.level;},isGreaterOrEqual:function(level){return this.level>=level.level;}};Level.ALL=new Level(Number.MIN_VALUE,"ALL");Level.TRACE=new Level(10000,"TRACE");Level.DEBUG=new Level(20000,"DEBUG");Level.INFO=new Level(30000,"INFO");Level.WARN=new Level(40000,"WARN");Level.ERROR=new Level(50000,"ERROR");Level.FATAL=new Level(60000,"FATAL");Level.OFF=new Level(Number.MAX_VALUE,"OFF");log4javascript.Level=Level;function Timer(name,level){this.name=name;this.level=isUndefined(level)?Level.INFO:level;this.start=new Date();}
Timer.prototype.getElapsedTime=function(){return new Date().getTime()-this.start.getTime();};var anonymousLoggerName="[anonymous]";var defaultLoggerName="[default]";var nullLoggerName="[null]";var rootLoggerName="root";function Logger(name){this.name=name;this.parent=null;this.children=[];var appenders=[];var loggerLevel=null;var isRoot=(this.name===rootLoggerName);var isNull=(this.name===nullLoggerName);var appenderCache=null;var appenderCacheInvalidated=false;this.addChild=function(childLogger){this.children.push(childLogger);childLogger.parent=this;childLogger.invalidateAppenderCache();};var additive=true;this.getAdditivity=function(){return additive;};this.setAdditivity=function(additivity){var valueChanged=(additive!=additivity);additive=additivity;if(valueChanged){this.invalidateAppenderCache();}};this.addAppender=function(appender){if(isNull){handleError("Logger.addAppender: you may not add an appender to the null logger");}else{if(appender instanceof log4javascript.Appender){if(!array_contains(appenders,appender)){appenders.push(appender);appender.setAddedToLogger(this);this.invalidateAppenderCache();}}else{handleError("Logger.addAppender: appender supplied ('"+
toStr(appender)+"') is not a subclass of Appender");}}};this.removeAppender=function(appender){array_remove(appenders,appender);appender.setRemovedFromLogger(this);this.invalidateAppenderCache();};this.removeAllAppenders=function(){var appenderCount=appenders.length;if(appenderCount>0){for(var i=0;i<appenderCount;i++){appenders[i].setRemovedFromLogger(this);}
appenders.length=0;this.invalidateAppenderCache();}};this.getEffectiveAppenders=function(){if(appenderCache===null||appenderCacheInvalidated){var parentEffectiveAppenders=(isRoot||!this.getAdditivity())?[]:this.parent.getEffectiveAppenders();appenderCache=parentEffectiveAppenders.concat(appenders);appenderCacheInvalidated=false;}
return appenderCache;};this.invalidateAppenderCache=function(){appenderCacheInvalidated=true;for(var i=0,len=this.children.length;i<len;i++){this.children[i].invalidateAppenderCache();}};this.log=function(level,params){if(enabled&&level.isGreaterOrEqual(this.getEffectiveLevel())){var exception;var finalParamIndex=params.length-1;var lastParam=params[finalParamIndex];if(params.length>1&&isError(lastParam)){exception=lastParam;finalParamIndex--;}
var messages=[];for(var i=0;i<=finalParamIndex;i++){messages[i]=params[i];}
var loggingEvent=new LoggingEvent(this,new Date(),level,messages,exception);this.callAppenders(loggingEvent);}};this.callAppenders=function(loggingEvent){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].doAppend(loggingEvent);}};this.setLevel=function(level){if(isRoot&&level===null){handleError("Logger.setLevel: you cannot set the level of the root logger to null");}else if(level instanceof Level){loggerLevel=level;}else{handleError("Logger.setLevel: level supplied to logger "+
this.name+" is not an instance of log4javascript.Level");}};this.getLevel=function(){return loggerLevel;};this.getEffectiveLevel=function(){for(var logger=this;logger!==null;logger=logger.parent){var level=logger.getLevel();if(level!==null){return level;}}};this.group=function(name,initiallyExpanded){if(enabled){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].group(name,initiallyExpanded);}}};this.groupEnd=function(){if(enabled){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].groupEnd();}}};var timers={};this.time=function(name,level){if(enabled){if(isUndefined(name)){handleError("Logger.time: a name for the timer must be supplied");}else if(level&&!(level instanceof Level)){handleError("Logger.time: level supplied to timer "+
name+" is not an instance of log4javascript.Level");}else{timers[name]=new Timer(name,level);}}};this.timeEnd=function(name){if(enabled){if(isUndefined(name)){handleError("Logger.timeEnd: a name for the timer must be supplied");}else if(timers[name]){var timer=timers[name];var milliseconds=timer.getElapsedTime();this.log(timer.level,["Timer "+toStr(name)+" completed in "+milliseconds+"ms"]);delete timers[name];}else{logLog.warn("Logger.timeEnd: no timer found with name "+name);}}};this.assert=function(expr){if(enabled&&!expr){var args=[];for(var i=1,len=arguments.length;i<len;i++){args.push(arguments[i]);}
args=(args.length>0)?args:["Assertion Failure"];args.push(newLine);args.push(expr);this.log(Level.ERROR,args);}};this.toString=function(){return"Logger["+this.name+"]";};}
Logger.prototype={trace:function(){this.log(Level.TRACE,arguments);},debug:function(){this.log(Level.DEBUG,arguments);},info:function(){this.log(Level.INFO,arguments);},warn:function(){this.log(Level.WARN,arguments);},error:function(){this.log(Level.ERROR,arguments);},fatal:function(){this.log(Level.FATAL,arguments);},isEnabledFor:function(level){return level.isGreaterOrEqual(this.getEffectiveLevel());},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE);},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG);},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO);},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN);},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR);},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL);}};Logger.prototype.trace.isEntryPoint=true;Logger.prototype.debug.isEntryPoint=true;Logger.prototype.info.isEntryPoint=true;Logger.prototype.warn.isEntryPoint=true;Logger.prototype.error.isEntryPoint=true;Logger.prototype.fatal.isEntryPoint=true;var loggers={};var loggerNames=[];var ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG;var rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL);log4javascript.getRootLogger=function(){return rootLogger;};log4javascript.getLogger=function(loggerName){if(!(typeof loggerName=="string")){loggerName=anonymousLoggerName;logLog.warn("log4javascript.getLogger: non-string logger name "+
toStr(loggerName)+" supplied, returning anonymous logger");}
if(loggerName==rootLoggerName){handleError("log4javascript.getLogger: root logger may not be obtained by name");}
if(!loggers[loggerName]){var logger=new Logger(loggerName);loggers[loggerName]=logger;loggerNames.push(loggerName);var lastDotIndex=loggerName.lastIndexOf(".");var parentLogger;if(lastDotIndex>-1){var parentLoggerName=loggerName.substring(0,lastDotIndex);parentLogger=log4javascript.getLogger(parentLoggerName);}else{parentLogger=rootLogger;}
parentLogger.addChild(logger);}
return loggers[loggerName];};var defaultLogger=null;log4javascript.getDefaultLogger=function(){if(!defaultLogger){defaultLogger=log4javascript.getLogger(defaultLoggerName);var a=new log4javascript.PopUpAppender();defaultLogger.addAppender(a);}
return defaultLogger;};var nullLogger=null;log4javascript.getNullLogger=function(){if(!nullLogger){nullLogger=new Logger(nullLoggerName);nullLogger.setLevel(Level.OFF);}
return nullLogger;};log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL);loggers={};};var LoggingEvent=function(logger,timeStamp,level,messages,exception){this.logger=logger;this.timeStamp=timeStamp;this.timeStampInMilliseconds=timeStamp.getTime();this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1000);this.milliseconds=this.timeStamp.getMilliseconds();this.level=level;this.messages=messages;this.exception=exception;};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):"";},getCombinedMessages:function(){return(this.messages.length==1)?this.messages[0]:this.messages.join(newLine);},toString:function(){return"LoggingEvent["+this.level+"]";}};log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:false,overrideTimeStampsSetting:false,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method");},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method");},getContentType:function(){return"text/plain";},allowBatching:function(){return true;},setTimeStampsInMilliseconds:function(timeStampsInMilliseconds){this.overrideTimeStampsSetting=true;this.useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds);},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds;},getTimeStampValue:function(loggingEvent){return this.isTimeStampsInMilliseconds()?loggingEvent.timeStampInMilliseconds:loggingEvent.timeStampInSeconds;},getDataValues:function(loggingEvent,combineMessages){var dataValues=[[this.loggerKey,loggingEvent.logger.name],[this.timeStampKey,this.getTimeStampValue(loggingEvent)],[this.levelKey,loggingEvent.level.name],[this.urlKey,window.location.href],[this.messageKey,combineMessages?loggingEvent.getCombinedMessages():loggingEvent.messages]];if(!this.isTimeStampsInMilliseconds()){dataValues.push([this.millisecondsKey,loggingEvent.milliseconds]);}
if(loggingEvent.exception){dataValues.push([this.exceptionKey,getExceptionStringRep(loggingEvent.exception)]);}
if(this.hasCustomFields()){for(var i=0,len=this.customFields.length;i<len;i++){var val=this.customFields[i].value;if(typeof val==="function"){val=val(this,loggingEvent);}
dataValues.push([this.customFields[i].name,val]);}}
return dataValues;},setKeys:function(loggerKey,timeStampKey,levelKey,messageKey,exceptionKey,urlKey,millisecondsKey){this.loggerKey=extractStringFromParam(loggerKey,this.defaults.loggerKey);this.timeStampKey=extractStringFromParam(timeStampKey,this.defaults.timeStampKey);this.levelKey=extractStringFromParam(levelKey,this.defaults.levelKey);this.messageKey=extractStringFromParam(messageKey,this.defaults.messageKey);this.exceptionKey=extractStringFromParam(exceptionKey,this.defaults.exceptionKey);this.urlKey=extractStringFromParam(urlKey,this.defaults.urlKey);this.millisecondsKey=extractStringFromParam(millisecondsKey,this.defaults.millisecondsKey);},setCustomField:function(name,value){var fieldUpdated=false;for(var i=0,len=this.customFields.length;i<len;i++){if(this.customFields[i].name===name){this.customFields[i].value=value;fieldUpdated=true;}}
if(!fieldUpdated){this.customFields.push({"name":name,"value":value});}},hasCustomFields:function(){return(this.customFields.length>0);},toString:function(){handleError("Layout.toString: all layouts must override this method");}};log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport();Appender.prototype.layout=new PatternLayout();Appender.prototype.threshold=Level.ALL;Appender.prototype.loggers=[];Appender.prototype.doAppend=function(loggingEvent){if(enabled&&loggingEvent.level.level>=this.threshold.level){this.append(loggingEvent);}};Appender.prototype.append=function(loggingEvent){};Appender.prototype.setLayout=function(layout){if(layout instanceof Layout){this.layout=layout;}else{handleError("Appender.setLayout: layout supplied to "+
this.toString()+" is not a subclass of Layout");}};Appender.prototype.getLayout=function(){return this.layout;};Appender.prototype.setThreshold=function(threshold){if(threshold instanceof Level){this.threshold=threshold;}else{handleError("Appender.setThreshold: threshold supplied to "+
this.toString()+" is not a subclass of Level");}};Appender.prototype.getThreshold=function(){return this.threshold;};Appender.prototype.setAddedToLogger=function(logger){this.loggers.push(logger);};Appender.prototype.setRemovedFromLogger=function(logger){array_remove(this.loggers,logger);};Appender.prototype.group=emptyFunction;Appender.prototype.groupEnd=emptyFunction;Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method");};log4javascript.Appender=Appender;function SimpleLayout(){this.customFields=[];}
SimpleLayout.prototype=new Layout();SimpleLayout.prototype.format=function(loggingEvent){return loggingEvent.level.name+" - "+loggingEvent.getCombinedMessages();};SimpleLayout.prototype.ignoresThrowable=function(){return true;};SimpleLayout.prototype.toString=function(){return"SimpleLayout";};log4javascript.SimpleLayout=SimpleLayout;function NullLayout(){this.customFields=[];}
NullLayout.prototype=new Layout();NullLayout.prototype.format=function(loggingEvent){return loggingEvent.messages;};NullLayout.prototype.ignoresThrowable=function(){return true;};NullLayout.prototype.toString=function(){return"NullLayout";};log4javascript.NullLayout=NullLayout;function XmlLayout(combineMessages){this.combineMessages=extractBooleanFromParam(combineMessages,true);this.customFields=[];}
XmlLayout.prototype=new Layout();XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages;};XmlLayout.prototype.getContentType=function(){return"text/xml";};XmlLayout.prototype.escapeCdata=function(str){return str.replace(/\]\]>/,"]]>]]&gt;<![CDATA[");};XmlLayout.prototype.format=function(loggingEvent){var layout=this;var i,len;function formatMessage(message){message=(typeof message==="string")?message:toStr(message);return"<log4javascript:message><![CDATA["+
layout.escapeCdata(message)+"]]></log4javascript:message>";}
var str="<log4javascript:event logger=\""+loggingEvent.logger.name+"\" timestamp=\""+this.getTimeStampValue(loggingEvent)+"\"";if(!this.isTimeStampsInMilliseconds()){str+=" milliseconds=\""+loggingEvent.milliseconds+"\"";}
str+=" level=\""+loggingEvent.level.name+"\">"+newLine;if(this.combineMessages){str+=formatMessage(loggingEvent.getCombinedMessages());}else{str+="<log4javascript:messages>"+newLine;for(i=0,len=loggingEvent.messages.length;i<len;i++){str+=formatMessage(loggingEvent.messages[i])+newLine;}
str+="</log4javascript:messages>"+newLine;}
if(this.hasCustomFields()){for(i=0,len=this.customFields.length;i<len;i++){str+="<log4javascript:customfield name=\""+
this.customFields[i].name+"\"><![CDATA["+
this.customFields[i].value.toString()+"]]></log4javascript:customfield>"+newLine;}}
if(loggingEvent.exception){str+="<log4javascript:exception><![CDATA["+
getExceptionStringRep(loggingEvent.exception)+"]]></log4javascript:exception>"+newLine;}
str+="</log4javascript:event>"+newLine+newLine;return str;};XmlLayout.prototype.ignoresThrowable=function(){return false;};XmlLayout.prototype.toString=function(){return"XmlLayout";};log4javascript.XmlLayout=XmlLayout;function escapeNewLines(str){return str.replace(/\r\n|\r|\n/g,"\\r\\n");}
function JsonLayout(readable,combineMessages){this.readable=extractBooleanFromParam(readable,false);this.combineMessages=extractBooleanFromParam(combineMessages,true);this.batchHeader=this.readable?"["+newLine:"[";this.batchFooter=this.readable?"]"+newLine:"]";this.batchSeparator=this.readable?","+newLine:",";this.setKeys();this.colon=this.readable?": ":":";this.tab=this.readable?"\t":"";this.lineBreak=this.readable?newLine:"";this.customFields=[];}
JsonLayout.prototype=new Layout();JsonLayout.prototype.isReadable=function(){return this.readable;};JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages;};JsonLayout.prototype.format=function(loggingEvent){var layout=this;var dataValues=this.getDataValues(loggingEvent,this.combineMessages);var str="{"+this.lineBreak;var i,len;function formatValue(val,prefix,expand){var formattedValue;var valType=typeof val;if(val instanceof Date){formattedValue=String(val.getTime());}else if(expand&&(val instanceof Array)){formattedValue="["+layout.lineBreak;for(var i=0,len=val.length;i<len;i++){var childPrefix=prefix+layout.tab;formattedValue+=childPrefix+formatValue(val[i],childPrefix,false);if(i<val.length-1){formattedValue+=",";}
formattedValue+=layout.lineBreak;}
formattedValue+=prefix+"]";}else if(valType!=="number"&&valType!=="boolean"){formattedValue="\""+escapeNewLines(toStr(val).replace(/\"/g,"\\\""))+"\"";}else{formattedValue=val;}
return formattedValue;}
for(i=0,len=dataValues.length-1;i<=len;i++){str+=this.tab+"\""+dataValues[i][0]+"\""+this.colon+formatValue(dataValues[i][1],this.tab,true);if(i<len){str+=",";}
str+=this.lineBreak;}
str+="}"+this.lineBreak;return str;};JsonLayout.prototype.ignoresThrowable=function(){return false;};JsonLayout.prototype.toString=function(){return"JsonLayout";};JsonLayout.prototype.getContentType=function(){return"application/json";};log4javascript.JsonLayout=JsonLayout;function HttpPostDataLayout(){this.setKeys();this.customFields=[];this.returnsPostData=true;}
HttpPostDataLayout.prototype=new Layout();HttpPostDataLayout.prototype.allowBatching=function(){return false;};HttpPostDataLayout.prototype.format=function(loggingEvent){var dataValues=this.getDataValues(loggingEvent);var queryBits=[];for(var i=0,len=dataValues.length;i<len;i++){var val=(dataValues[i][1]instanceof Date)?String(dataValues[i][1].getTime()):dataValues[i][1];queryBits.push(urlEncode(dataValues[i][0])+"="+urlEncode(val));}
return queryBits.join("&");};HttpPostDataLayout.prototype.ignoresThrowable=function(loggingEvent){return false;};HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout";};log4javascript.HttpPostDataLayout=HttpPostDataLayout;function formatObjectExpansion(obj,depth,indentation){var objectsExpanded=[];function doFormat(obj,depth,indentation){var i,j,len,childDepth,childIndentation,childLines,expansion,childExpansion;if(!indentation){indentation="";}
function formatString(text){var lines=splitIntoLines(text);for(var j=1,jLen=lines.length;j<jLen;j++){lines[j]=indentation+lines[j];}
return lines.join(newLine);}
if(obj===null){return"null";}else if(typeof obj=="undefined"){return"undefined";}else if(typeof obj=="string"){return formatString(obj);}else if(typeof obj=="object"&&array_contains(objectsExpanded,obj)){try{expansion=toStr(obj);}catch(ex){expansion="Error formatting property. Details: "+getExceptionStringRep(ex);}
return expansion+" [already expanded]";}else if((obj instanceof Array)&&depth>0){objectsExpanded.push(obj);expansion="["+newLine;childDepth=depth-1;childIndentation=indentation+"  ";childLines=[];for(i=0,len=obj.length;i<len;i++){try{childExpansion=doFormat(obj[i],childDepth,childIndentation);childLines.push(childIndentation+childExpansion);}catch(ex){childLines.push(childIndentation+"Error formatting array member. Details: "+
getExceptionStringRep(ex)+"");}}
expansion+=childLines.join(","+newLine)+newLine+indentation+"]";return expansion;}else if(Object.prototype.toString.call(obj)=="[object Date]"){return obj.toString();}else if(typeof obj=="object"&&depth>0){objectsExpanded.push(obj);expansion="{"+newLine;childDepth=depth-1;childIndentation=indentation+"  ";childLines=[];for(i in obj){try{childExpansion=doFormat(obj[i],childDepth,childIndentation);childLines.push(childIndentation+i+": "+childExpansion);}catch(ex){childLines.push(childIndentation+i+": Error formatting property. Details: "+
getExceptionStringRep(ex));}}
expansion+=childLines.join(","+newLine)+newLine+indentation+"}";return expansion;}else{return formatString(toStr(obj));}}
return doFormat(obj,depth,indentation);}
var SimpleDateFormat;(function(){var regex=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/;var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var TEXT2=0,TEXT3=1,NUMBER=2,YEAR=3,MONTH=4,TIMEZONE=5;var types={G:TEXT2,y:YEAR,M:MONTH,w:NUMBER,W:NUMBER,D:NUMBER,d:NUMBER,F:NUMBER,E:TEXT3,a:TEXT2,H:NUMBER,k:NUMBER,K:NUMBER,h:NUMBER,m:NUMBER,s:NUMBER,S:NUMBER,Z:TIMEZONE};var ONE_DAY=24*60*60*1000;var ONE_WEEK=7*ONE_DAY;var DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK=1;var newDateAtMidnight=function(year,month,day){var d=new Date(year,month,day,0,0,0);d.setMilliseconds(0);return d;};Date.prototype.getDifference=function(date){return this.getTime()-date.getTime();};Date.prototype.isBefore=function(d){return this.getTime()<d.getTime();};Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());};Date.prototype.getTimeSince=function(d){return this.getUTCTime()-d.getUTCTime();};Date.prototype.getPreviousSunday=function(){var midday=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0);var previousSunday=new Date(midday.getTime()-this.getDay()*ONE_DAY);return newDateAtMidnight(previousSunday.getFullYear(),previousSunday.getMonth(),previousSunday.getDate());};Date.prototype.getWeekInYear=function(minimalDaysInFirstWeek){if(isUndefined(this.minimalDaysInFirstWeek)){minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK;}
var previousSunday=this.getPreviousSunday();var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);var numberOfSundays=previousSunday.isBefore(startOfYear)?0:1+Math.floor(previousSunday.getTimeSince(startOfYear)/ONE_WEEK);var numberOfDaysInFirstWeek=7-startOfYear.getDay();var weekInYear=numberOfSundays;if(numberOfDaysInFirstWeek<minimalDaysInFirstWeek){weekInYear--;}
return weekInYear;};Date.prototype.getWeekInMonth=function(minimalDaysInFirstWeek){if(isUndefined(this.minimalDaysInFirstWeek)){minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK;}
var previousSunday=this.getPreviousSunday();var startOfMonth=newDateAtMidnight(this.getFullYear(),this.getMonth(),1);var numberOfSundays=previousSunday.isBefore(startOfMonth)?0:1+Math.floor(previousSunday.getTimeSince(startOfMonth)/ONE_WEEK);var numberOfDaysInFirstWeek=7-startOfMonth.getDay();var weekInMonth=numberOfSundays;if(numberOfDaysInFirstWeek>=minimalDaysInFirstWeek){weekInMonth++;}
return weekInMonth;};Date.prototype.getDayInYear=function(){var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(startOfYear)/ONE_DAY);};SimpleDateFormat=function(formatString){this.formatString=formatString;};SimpleDateFormat.prototype.setMinimalDaysInFirstWeek=function(days){this.minimalDaysInFirstWeek=days;};SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK:this.minimalDaysInFirstWeek;};var padWithZeroes=function(str,len){while(str.length<len){str="0"+str;}
return str;};var formatText=function(data,numberOfLetters,minLength){return(numberOfLetters>=4)?data:data.substr(0,Math.max(minLength,numberOfLetters));};var formatNumber=function(data,numberOfLetters){var dataString=""+data;return padWithZeroes(dataString,numberOfLetters);};SimpleDateFormat.prototype.format=function(date){var formattedString="";var result;var searchString=this.formatString;while((result=regex.exec(searchString))){var quotedString=result[1];var patternLetters=result[2];var otherLetters=result[3];var otherCharacters=result[4];if(quotedString){if(quotedString=="''"){formattedString+="'";}else{formattedString+=quotedString.substring(1,quotedString.length-1);}}else if(otherLetters){}else if(otherCharacters){formattedString+=otherCharacters;}else if(patternLetters){var patternLetter=patternLetters.charAt(0);var numberOfLetters=patternLetters.length;var rawData="";switch(patternLetter){case"G":rawData="AD";break;case"y":rawData=date.getFullYear();break;case"M":rawData=date.getMonth();break;case"w":rawData=date.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":rawData=date.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":rawData=date.getDayInYear();break;case"d":rawData=date.getDate();break;case"F":rawData=1+Math.floor((date.getDate()-1)/7);break;case"E":rawData=dayNames[date.getDay()];break;case"a":rawData=(date.getHours()>=12)?"PM":"AM";break;case"H":rawData=date.getHours();break;case"k":rawData=date.getHours()||24;break;case"K":rawData=date.getHours()%12;break;case"h":rawData=(date.getHours()%12)||12;break;case"m":rawData=date.getMinutes();break;case"s":rawData=date.getSeconds();break;case"S":rawData=date.getMilliseconds();break;case"Z":rawData=date.getTimezoneOffset();break;}
switch(types[patternLetter]){case TEXT2:formattedString+=formatText(rawData,numberOfLetters,2);break;case TEXT3:formattedString+=formatText(rawData,numberOfLetters,3);break;case NUMBER:formattedString+=formatNumber(rawData,numberOfLetters);break;case YEAR:if(numberOfLetters<=3){var dataString=""+rawData;formattedString+=dataString.substr(2,2);}else{formattedString+=formatNumber(rawData,numberOfLetters);}
break;case MONTH:if(numberOfLetters>=3){formattedString+=formatText(monthNames[rawData],numberOfLetters,numberOfLetters);}else{formattedString+=formatNumber(rawData+1,numberOfLetters);}
break;case TIMEZONE:var isPositive=(rawData>0);var prefix=isPositive?"-":"+";var absData=Math.abs(rawData);var hours=""+Math.floor(absData/60);hours=padWithZeroes(hours,2);var minutes=""+(absData%60);minutes=padWithZeroes(minutes,2);formattedString+=prefix+hours+minutes;break;}}
searchString=searchString.substr(result.index+result[0].length);}
return formattedString;};})();log4javascript.SimpleDateFormat=SimpleDateFormat;function PatternLayout(pattern){if(pattern){this.pattern=pattern;}else{this.pattern=PatternLayout.DEFAULT_CONVERSION_PATTERN;}
this.customFields=[];}
PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n";PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n";PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS";PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS";PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS";PatternLayout.prototype=new Layout();PatternLayout.prototype.format=function(loggingEvent){var regex=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/;var formattedString="";var result;var searchString=this.pattern;while((result=regex.exec(searchString))){var matchedString=result[0];var padding=result[1];var truncation=result[2];var conversionCharacter=result[3];var specifier=result[5];var text=result[6];if(text){formattedString+=""+text;}else{var replacement="";switch(conversionCharacter){case"a":case"m":var depth=0;if(specifier){depth=parseInt(specifier,10);if(isNaN(depth)){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character '"+conversionCharacter+"' - should be a number");depth=0;}}
var messages=(conversionCharacter==="a")?loggingEvent.messages[0]:loggingEvent.messages;for(var i=0,len=messages.length;i<len;i++){if(i>0&&(replacement.charAt(replacement.length-1)!==" ")){replacement+=" ";}
if(depth===0){replacement+=messages[i];}else{replacement+=formatObjectExpansion(messages[i],depth);}}
break;case"c":var loggerName=loggingEvent.logger.name;if(specifier){var precision=parseInt(specifier,10);var loggerNameBits=loggingEvent.logger.name.split(".");if(precision>=loggerNameBits.length){replacement=loggerName;}else{replacement=loggerNameBits.slice(loggerNameBits.length-precision).join(".");}}else{replacement=loggerName;}
break;case"d":var dateFormat=PatternLayout.ISO8601_DATEFORMAT;if(specifier){dateFormat=specifier;if(dateFormat=="ISO8601"){dateFormat=PatternLayout.ISO8601_DATEFORMAT;}else if(dateFormat=="ABSOLUTE"){dateFormat=PatternLayout.ABSOLUTETIME_DATEFORMAT;}else if(dateFormat=="DATE"){dateFormat=PatternLayout.DATETIME_DATEFORMAT;}}
replacement=(new SimpleDateFormat(dateFormat)).format(loggingEvent.timeStamp);break;case"f":if(this.hasCustomFields()){var fieldIndex=0;if(specifier){fieldIndex=parseInt(specifier,10);if(isNaN(fieldIndex)){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character 'f' - should be a number");}else if(fieldIndex===0){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character 'f' - must be greater than zero");}else if(fieldIndex>this.customFields.length){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character 'f' - there aren't that many custom fields");}else{fieldIndex=fieldIndex-1;}}
var val=this.customFields[fieldIndex].value;if(typeof val=="function"){val=val(this,loggingEvent);}
replacement=val;}
break;case"n":replacement=newLine;break;case"p":replacement=loggingEvent.level.name;break;case"r":replacement=""+loggingEvent.timeStamp.getDifference(applicationStartDate);break;case"%":replacement="%";break;default:replacement=matchedString;break;}
var l;if(truncation){l=parseInt(truncation.substr(1),10);var strLen=replacement.length;if(l<strLen){replacement=replacement.substring(strLen-l,strLen);}}
if(padding){if(padding.charAt(0)=="-"){l=parseInt(padding.substr(1),10);while(replacement.length<l){replacement+=" ";}}else{l=parseInt(padding,10);while(replacement.length<l){replacement=" "+replacement;}}}
formattedString+=replacement;}
searchString=searchString.substr(result.index+result[0].length);}
return formattedString;};PatternLayout.prototype.ignoresThrowable=function(){return true;};PatternLayout.prototype.toString=function(){return"PatternLayout";};log4javascript.PatternLayout=PatternLayout;function BrowserConsoleAppender(){}
BrowserConsoleAppender.prototype=new log4javascript.Appender();BrowserConsoleAppender.prototype.layout=new NullLayout();BrowserConsoleAppender.prototype.threshold=Level.DEBUG;BrowserConsoleAppender.prototype.append=function(loggingEvent){var appender=this;var getFormattedMessage=function(){var layout=appender.getLayout();var formattedMessage=layout.format(loggingEvent);if(layout.ignoresThrowable()&&loggingEvent.exception){formattedMessage+=loggingEvent.getThrowableStrRep();}
return formattedMessage;};if((typeof opera!="undefined")&&opera.postError){opera.postError(getFormattedMessage());}else if(window.console&&window.console.log){var formattedMesage=getFormattedMessage()[0];if(window.console.debug&&Level.DEBUG.isGreaterOrEqual(loggingEvent.level)){window.console.debug(formattedMesage);}else if(window.console.info&&Level.INFO.equals(loggingEvent.level)){window.console.info(formattedMesage);}else if(window.console.warn&&Level.WARN.equals(loggingEvent.level)){window.console.warn(formattedMesage);}else if(window.console.error&&loggingEvent.level.isGreaterOrEqual(Level.ERROR)){window.console.error(formattedMesage);}else{window.console.log(formattedMesage);}}};BrowserConsoleAppender.prototype.group=function(name){if(window.console&&window.console.group){window.console.group(name);}};BrowserConsoleAppender.prototype.groupEnd=function(){if(window.console&&window.console.groupEnd){window.console.groupEnd();}};BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender";};log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xmlHttpFactories=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];var getXmlHttp=function(errorHandler){var xmlHttp=null,factory;for(var i=0,len=xmlHttpFactories.length;i<len;i++){factory=xmlHttpFactories[i];try{xmlHttp=factory();getXmlHttp=factory;return xmlHttp;}catch(e){}}
if(errorHandler){errorHandler();}else{handleError("getXmlHttp: unable to obtain XMLHttpRequest object");}};function isHttpRequestSuccessful(xmlHttp){return isUndefined(xmlHttp.status)||xmlHttp.status===0||(xmlHttp.status>=200&&xmlHttp.status<300)||xmlHttp.status==1223;}
function AjaxAppender(url){var appender=this;var isSupported=true;if(!url){handleError("AjaxAppender: URL must be specified in constructor");isSupported=false;isLog4TcSupported=false;}
var timed=this.defaults.timed;var waitForResponse=this.defaults.waitForResponse;var batchSize=this.defaults.batchSize;var timerInterval=this.defaults.timerInterval;var requestSuccessCallback=this.defaults.requestSuccessCallback;var failCallback=this.defaults.failCallback;var postVarName=this.defaults.postVarName;var sendAllOnUnload=this.defaults.sendAllOnUnload;var contentType=this.defaults.contentType;var sessionId=null;var queuedLoggingEvents=[];var queuedRequests=[];var headers=[];var sending=false;var initialized=false;function checkCanConfigure(configOptionName){if(initialized){handleError("AjaxAppender: configuration option '"+
configOptionName+"' may not be set after the appender has been initialized");return false;}
return true;}
this.getSessionId=function(){return sessionId;};this.setSessionId=function(sessionIdParam){sessionId=extractStringFromParam(sessionIdParam,null);this.layout.setCustomField("sessionid",sessionId);};this.setLayout=function(layoutParam){if(checkCanConfigure("layout")){this.layout=layoutParam;if(sessionId!==null){this.setSessionId(sessionId);}}};this.isTimed=function(){return timed;};this.setTimed=function(timedParam){if(checkCanConfigure("timed")){timed=bool(timedParam);}};this.getTimerInterval=function(){return timerInterval;};this.setTimerInterval=function(timerIntervalParam){if(checkCanConfigure("timerInterval")){timerInterval=extractIntFromParam(timerIntervalParam,timerInterval);}};this.isWaitForResponse=function(){return waitForResponse;};this.setWaitForResponse=function(waitForResponseParam){if(checkCanConfigure("waitForResponse")){waitForResponse=bool(waitForResponseParam);}};this.getBatchSize=function(){return batchSize;};this.setBatchSize=function(batchSizeParam){if(checkCanConfigure("batchSize")){batchSize=extractIntFromParam(batchSizeParam,batchSize);}};this.isSendAllOnUnload=function(){return sendAllOnUnload;};this.setSendAllOnUnload=function(sendAllOnUnloadParam){if(checkCanConfigure("sendAllOnUnload")){sendAllOnUnload=extractBooleanFromParam(sendAllOnUnloadParam,sendAllOnUnload);}};this.setRequestSuccessCallback=function(requestSuccessCallbackParam){requestSuccessCallback=extractFunctionFromParam(requestSuccessCallbackParam,requestSuccessCallback);};this.setFailCallback=function(failCallbackParam){failCallback=extractFunctionFromParam(failCallbackParam,failCallback);};this.getPostVarName=function(){return postVarName;};this.setPostVarName=function(postVarNameParam){if(checkCanConfigure("postVarName")){postVarName=extractStringFromParam(postVarNameParam,postVarName);}};this.getHeaders=function(){return headers;};this.addHeader=function(name,value){if(name.toLowerCase()=="content-type"){contentType=value;}else{headers.push({name:name,value:value});}};function sendAll(){if(isSupported&&enabled){sending=true;var currentRequestBatch;if(waitForResponse){if(queuedRequests.length>0){currentRequestBatch=queuedRequests.shift();sendRequest(preparePostData(currentRequestBatch),sendAll);}else{sending=false;if(timed){scheduleSending();}}}else{while((currentRequestBatch=queuedRequests.shift())){sendRequest(preparePostData(currentRequestBatch));}
sending=false;if(timed){scheduleSending();}}}}
this.sendAll=sendAll;function sendAllRemaining(){var sendingAnything=false;if(isSupported&&enabled){var actualBatchSize=appender.getLayout().allowBatching()?batchSize:1;var currentLoggingEvent;var batchedLoggingEvents=[];while((currentLoggingEvent=queuedLoggingEvents.shift())){batchedLoggingEvents.push(currentLoggingEvent);if(queuedLoggingEvents.length>=actualBatchSize){queuedRequests.push(batchedLoggingEvents);batchedLoggingEvents=[];}}
if(batchedLoggingEvents.length>0){queuedRequests.push(batchedLoggingEvents);}
sendingAnything=(queuedRequests.length>0);waitForResponse=false;timed=false;sendAll();}
return sendingAnything;}
this.sendAllRemaining=sendAllRemaining;function preparePostData(batchedLoggingEvents){var formattedMessages=[];var currentLoggingEvent;var postData="";while((currentLoggingEvent=batchedLoggingEvents.shift())){var currentFormattedMessage=appender.getLayout().format(currentLoggingEvent);if(appender.getLayout().ignoresThrowable()){currentFormattedMessage+=currentLoggingEvent.getThrowableStrRep();}
formattedMessages.push(currentFormattedMessage);}
if(batchedLoggingEvents.length==1){postData=formattedMessages.join("");}else{postData=appender.getLayout().batchHeader+
formattedMessages.join(appender.getLayout().batchSeparator)+
appender.getLayout().batchFooter;}
if(contentType==appender.defaults.contentType){postData=appender.getLayout().returnsPostData?postData:urlEncode(postVarName)+"="+urlEncode(postData);if(postData.length>0){postData+="&";}
postData+="layout="+urlEncode(appender.getLayout().toString());}
return postData;}
function scheduleSending(){window.setTimeout(sendAll,timerInterval);}
function xmlHttpErrorHandler(){var msg="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(msg);isSupported=false;isLog4TcSupported=false;if(failCallback){failCallback(msg);}}
function sendRequest(postData,successCallback){try{var xmlHttp=getXmlHttp(xmlHttpErrorHandler);if(isSupported){if(xmlHttp.overrideMimeType){xmlHttp.overrideMimeType(appender.getLayout().getContentType());}
xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){if(isHttpRequestSuccessful(xmlHttp)){if(requestSuccessCallback){requestSuccessCallback(xmlHttp);}
if(successCallback){successCallback(xmlHttp);}}else{var msg="AjaxAppender.append: XMLHttpRequest request to URL "+
url+" returned status code "+xmlHttp.status;handleError(msg);if(failCallback){failCallback(msg);}}
xmlHttp.onreadystatechange=emptyFunction;xmlHttp=null;}};xmlHttp.open("POST",url,true);try{for(var i=0,header;header=headers[i++];){xmlHttp.setRequestHeader(header.name,header.value);}
xmlHttp.setRequestHeader("Content-Type",contentType);}catch(headerEx){var msg="AjaxAppender.append: your browser's XMLHttpRequest implementation"+" does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";handleError(msg);isSupported=false;isLog4TcSupported=false;if(failCallback){failCallback(msg);}
return;}
xmlHttp.send(postData);}}catch(ex){var errMsg="AjaxAppender.append: error sending log message to "+url;handleError(errMsg,ex);isSupported=false;isLog4TcSupported=false;if(failCallback){failCallback(errMsg+". Details: "+getExceptionStringRep(ex));}}}
this.append=function(loggingEvent){if(isSupported){if(!initialized){init();}
queuedLoggingEvents.push(loggingEvent);var actualBatchSize=this.getLayout().allowBatching()?batchSize:1;if(queuedLoggingEvents.length>=actualBatchSize){var currentLoggingEvent;var batchedLoggingEvents=[];while((currentLoggingEvent=queuedLoggingEvents.shift())){batchedLoggingEvents.push(currentLoggingEvent);}
queuedRequests.push(batchedLoggingEvents);if(!timed&&(!waitForResponse||(waitForResponse&&!sending))){sendAll();}}}};function init(){initialized=true;if(sendAllOnUnload){var oldBeforeUnload=window.onbeforeunload;window.onbeforeunload=function(){if(oldBeforeUnload){oldBeforeUnload();}
if(sendAllRemaining()){return"Sending log messages";}};}
if(timed){scheduleSending();}}}
AjaxAppender.prototype=new Appender();AjaxAppender.prototype.defaults={waitForResponse:false,timed:false,timerInterval:1000,batchSize:1,sendAllOnUnload:false,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"};AjaxAppender.prototype.layout=new HttpPostDataLayout();AjaxAppender.prototype.toString=function(){return"AjaxAppender";};log4javascript.AjaxAppender=AjaxAppender;log4javascript.setDocumentReady=function(){pageLoaded=true;log4javascript.dispatchEvent("load",{});};if(window.addEventListener){window.addEventListener("load",log4javascript.setDocumentReady,false);}else if(window.attachEvent){window.attachEvent("onload",log4javascript.setDocumentReady);}else{var oldOnload=window.onload;if(typeof window.onload!="function"){window.onload=log4javascript.setDocumentReady;}else{window.onload=function(evt){if(oldOnload){oldOnload(evt);}
log4javascript.setDocumentReady();};}}
return log4javascript;})();var ajaxAppenders=[];var consoleAppenders=[];var tcLogs=[];function toLevel(strLevel){switch(strLevel){case"ALL":return log4javascript.Level.ALL;case"TRACE":return log4javascript.Level.TRACE;case"DEBUG":return log4javascript.Level.DEBUG;case"INFO":return log4javascript.Level.INFO;case"WARN":return log4javascript.Level.WARN;case"ERROR":return log4javascript.Level.ERROR;case"FATAL":return log4javascript.Level.FATAL;case"OFF":return log4javascript.Level.OFF;default:return log4javascript.Level.ERROR;}}
function getUrls(defaultURL){return urls||{logJsURL:defaultURL};}
return{getLogger:function(loggerName,ajaxAppenderThreshold,consoleAppenderThreshold){if(tcLogs[loggerName]!=null){return log4javascript.getLogger(loggerName);}else{var jslog=log4javascript.getLogger(loggerName);var _urls=getUrls("https://tslogging.touchcommerce.com/tagserver/logging/log4js");var ajaxAppender=new log4javascript.AjaxAppender(_urls.logJsURL);ajaxAppender.setWaitForResponse(true);ajaxAppender.setLayout(new log4javascript.JsonLayout());if(ajaxAppenderThreshold){ajaxAppender.setThreshold(toLevel(ajaxAppenderThreshold));}
ajaxAppenders[loggerName]=ajaxAppender;jslog.addAppender(ajaxAppender);var browserConsoleAppender=new log4javascript.BrowserConsoleAppender();consoleAppenders[loggerName]=browserConsoleAppender;if(consoleAppenderThreshold){browserConsoleAppender.setThreshold(toLevel(consoleAppenderThreshold));}
jslog.addAppender(browserConsoleAppender);tcLogs[loggerName]=jslog;if(isLog4TcSupported===true&&typeof isQunitTest==="undefined"){jslog.debug("tclog has been initiated.");}
if(isLog4TcSupported===false){ajaxAppender.setThreshold(log4javascript.Level.OFF);}
if(JSLoggingDisabled){browserConsoleAppender.setThreshold(log4javascript.Level.OFF);}
return jslog;}},setLoggerLevel:function(logger,strLevel){logger.setLevel(toLevel(strLevel));},setAllLoggerLevel:function(strLevel){var i;for(i=0;i<tcLogs.length;i++){tcLogs[i].setLevel(toLevel(strLevel));}},setAjaxAppenderThreshold:function(loggerName,strLevel){if(ajaxAppenders[loggerName]){ajaxAppenders[loggerName].setThreshold(toLevel(strLevel));}},setAlltAjaxAppenderThreshold:function(strLevel){var i;for(i=0;i<ajaxAppenders.length;i++){ajaxAppenders[i].setThreshold(toLevel(strLevel));}},setConsoleAppenderThreshold:function(loggerName,strLevel){if(consoleAppenders[loggerName]){consoleAppenders[loggerName].setThreshold(toLevel(strLevel));}},setAllConsoleAppenderThreshold:function(strLevel){var i;for(i=0;i<consoleAppenders.length;i++){consoleAppenders[i].setThreshold(toLevel(strLevel));}}}
function sendWithPostToServer(msg){if(ROM){ROM.post(urls.logJsPostURL,msg);}}})();var tclog=log4tc.getLogger("IJSF");Date.prototype.roll=function(rollTimeInMS){this.setTime(this.getTime()+rollTimeInMS);return this;};Date.prototype.diff=function(otherDate){return otherDate?this.getTime()-otherDate.getTime():0;};Date.prototype.before=function(otherDate){return otherDate?this.getTime()<otherDate.getTime():0;};Date.prototype.after=function(otherDate){return otherDate?this.getTime()>otherDate.getTime():0;};Date.prototype.equals=function(otherDate){if(otherDate)
return this.getTime()==otherDate.getTime();return false;};var DateMixIn=(function(){return{equals:Date.prototype.equals,roll:Date.prototype.roll,diff:Date.prototype.diff,before:Date.prototype.before,after:Date.prototype.after};})();Array.prototype.contains=function(item,equalsFcn){for(var idx=0;idx<this.length;idx++){if((equalsFcn&&equalsFcn(this[idx],item))||(!isNullOrUndefined(item)&&item.equals&&item.equals(this[idx]))||this[idx]==item){return true;}}
return false;};Array.prototype.containsAll=function(_arr){for(var idx=0;idx<_arr.length;idx++){if(!this.contains(_arr[idx])){return false;}}
return true;};Array.prototype.isEmpty=function(){if(this.length){return false;}
return true;};Array.prototype.append=function(a){if(!!a&&!!a.length){for(var i=0;i<a.length;i++){this.push(a[i]);}}
return this;};Array.prototype.prepend=function(a){for(var i=0;i<a.length;i++){this.unshift(a[a.length-1-i]);}
return this;};Array.prototype.indexOf=function(el){var ind=-1;for(var i=0;i<this.length;i++){if(this[i]==el){ind=i;break;}}
return ind;};Array.prototype.constrain=function(len){if(len&&len>0&&this.length>len){this.length=len;}
return this;};Array.clone=function(_arr){if(_arr){var rv=[];if(typeOf(_arr)=='array'){for(var idx=0;idx<_arr.length;idx++){rv[idx]=_arr[idx];}
return rv;}}
return _arr;};Array.prototype._assertNumType=function(){if(this.length>0&&typeof this[0]!='number')
throw"OperationNotSupported: can't sum on a non-numerical list";};Array.prototype.sum=function(){this._assertNumType();if(!this.length){return 0;}else{return this[0]+this.slice(1).sum();}};Array.prototype.std_dev=function(){this._assertNumType();var sum=this.sum();var mean=sum/this.length;for(var i=0,variance=0;i<this.length;i++){variance+=Math.pow(this[i]-mean,2);}
variance=variance/this.length;return Math.sqrt(variance);};Array.prototype.average=function(){this._assertNumType();var sum=0;for(var i=0;i<this.length;i++){sum+=this[i];}
return sum/this.length;};Array.prototype.size=function(){return this.length;};Array.prototype._visit=function(o,bFcn,bool){for(var i=0;i<this.length;i++){if(bFcn(this[i],o)!=bool)
return false;}
return true;};Array.prototype.after=function(d){return this._visit(d,function(d1,d2){return d1.after(d2);},true);};Array.prototype.before=function(d){return this._visit(d,function(d1,d2){return d1.before(d2);},true);};Array.prototype.remove=function(index){if(index<0||index>this.length){return;}
for(var i=index;i+1<this.length;i++){this[i]=this[i+1];}
this.length=this.length-1;};Array.prototype.keys=function(){var out=new Array();for(var index=0;index<this.length;index++){var entry=this[index];out.push(entry.key);}
return out;};Array.prototype.values=function(){var out=new Array();for(var index=0;index<this.length;index++){var entry=this[index];out.push(entry.value);}
return out;};Array.prototype.findEntry=function(key){for(var index=0;index<this.length;index++){if(this[index].key==key){return this[index];}}
return null;};Array.prototype.get=function(key){var entry=this.findEntry(key);if(entry){return entry.value;}
return null;};Array.prototype.set=function(key,value,findEntry){var entry=null;if(typeof(findEntry)=='undefined'||findEntry==true){entry=this.findEntry(key);}
if(entry){entry.value=value;}
else{entry={key:key,value:value};this.push(entry);}};Array.prototype.unset=function(key){for(var index=0;index<this.length;index++){if(this[index].key==key){this.remove(index);break;}}};Array.prototype.clear=function(){this.length=0;};Array.prototype.collect=function(fnc){if(typeof fnc!="function"){return null;}
var out=[];for(var index=0;index<this.length;index++){var entry=this[index];if(entry.key&&entry.value){out.push(fnc(entry.key,entry.value));}
else{out.push(fnc(entry));}}
return out;};Array.prototype.each=function(fnc){if(typeof fnc!="function"){return;}
for(var index=0;index<this.length;index++){var entry=this[index];fnc(entry.key,entry.value,this);}};if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){for(var i=0,n=this.length;i<n;i++){if(i in this){callback.call(thisArg,this[i],i,this);}}};}
Array.prepareMapToSerialize=function(map){var out={};for(var i=0;i<map.length;i++){var element=map[i];out[element.key]=element.value;}
return out;};Number.prototype.inRange=function(low,high){if(high<low)throw("Incorrect range bounds: low = "+low+", high = "+high);if((this>=low)&&(this<=high))return true;else return false;};var NumberMixIn=(function(){return{inRange:Number.prototype.inRange};})();String.prototype.contains=function(searchString,bIgnoreCase,isRegexp){if(isNullOrUndefined(searchString)){return false;}
if(!isRegexp){var str1;var str2;if(bIgnoreCase){str1=this.toLowerCase();str2=searchString.toLowerCase();}else{str1=this;str2=searchString;}
var ind=str1.indexOf(str2);return(ind!=-1);}else{var reFlags="";if(bIgnoreCase)reFlags="i";var re=new RegExp(searchString,reFlags);return re.test(this);}};String.prototype.startsWith=function(searchString,bIgnoreCase,isRegexp){if(isNullOrUndefined(searchString)){return false;}
if(!isRegexp){var str1;var str2;if(bIgnoreCase){str1=this.toLowerCase();str2=searchString.toLowerCase();}else{str1=this;str2=searchString;}
var ind=str1.indexOf(str2);return(ind==0);}else{var reFlags="";if(bIgnoreCase)reFlags="i";if(searchString.charAt(0)!="^")searchString="^"+searchString;var re=new RegExp(searchString,reFlags);return re.test(this);}};String.prototype.endsWith=function(searchString,bIgnoreCase,isRegexp){if(isNullOrUndefined(searchString)){return false;}
if(!isRegexp){var str1;var str2;if(bIgnoreCase){str1=this.toLowerCase();str2=searchString.toLowerCase();}else{str1=this;str2=searchString;}
var ind=str1.lastIndexOf(str2);return((ind!=-1)&&(ind==(str1.length-str2.length)));}else{var reFlags="";if(bIgnoreCase)reFlags="i";if(searchString.charAt(searchString.length-1)!="$")searchString=searchString+"$";var re=new RegExp(searchString,reFlags);return re.test(this);}};String.prototype.equals=function(searchString,bIgnoreCase,isRegexp){if(isNullOrUndefined(searchString)){return false;}
if(!isRegexp){var str1;var str2;if(bIgnoreCase){str1=this.toLowerCase();str2=searchString.toLowerCase();}else{str1=this;str2=searchString;}
return(str1==str2);}else{var reFlags="";if(bIgnoreCase)reFlags="i";if(searchString.charAt(0)!="^")searchString="^"+searchString;if(searchString.charAt(searchString.length-1)!="$")searchString=searchString+"$";var re=new RegExp(searchString,reFlags);return re.test(this);}};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");}}
function DataExporter(){}
DataExporter.prototype.getData=function(){};var MI8=(function(){function _throwNoImpl(){throw(""+this.getID()+": "+arguments.callee.name+" requires override.");}
function wrapWithTryCatch(code){return"try{"+code+"}catch(e){if(window.console)window.console.error('ERROR:' + e.message);};\n";}
var XJA3={absorb:function(absorbee,agregateFlag){if(absorbee){for(var name in absorbee){if((typeOf(this[name])=='object')&&(typeOf(absorbee[name])=='object')&&agregateFlag){MI8.mixAbsorber(this[name]);this[name].absorb(absorbee[name]);}else{this[name]=absorbee[name];}}}
return this;}};var RC54={onRemoteCallback:_throwNoImpl,callRemote:function(url,data){ROM.doRemoteCall(url,data,this);},send:function(url,data){ROM.send(url,data);}};var Resource={_resource:function(id){this._rsrcID=id;},write:_throwNoImpl,read:_throwNoImpl,_serialize:_throwNoImpl,_deserialize:_throwNoImpl,getResourceID:function(){return this._rsrcID;}};var DataReadyListener={agrtyer:_throwNoImpl};var Persistable={getPersistentID:_throwNoImpl,load:_throwNoImpl,save:_throwNoImpl,agrtyer:_throwNoImpl};var FM2={_frameworkModule:function(id){this._id=id;},getID:function(){return this._id;},init:_throwNoImpl,start:_throwNoImpl,reset:_throwNoImpl};var Observable=(function(){var retval={addListeners:function(_arr){for(var idx=0;idx<_arr.length;idx++){this.addListener(_arr[idx]);}},_observable:function(){this._listeners=[];this.observable=true;},clearListeners:function(){this._listeners=[];},_fireEvt:function(vfcn,evt){for(var idx=0;idx<this._listeners.length;idx++){var listener=this._listeners[idx];vfcn(listener,evt);if(typeof listener.onAnyEvent=="function"){listener.onAnyEvent(evt);}}},addListener:function(l){if(l&&(this.isListener(l)||l.onAnyEvent)){this._listeners.push(l);}},isListener:_throwNoImpl};return retval;})();var JSON=(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return this.getTime();};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapeable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapeable.lastIndex=0;return escapeable.test(string)?'"'+string.replace(escapeable,function(a){var c=meta[a];if(typeof c==='string'){return c;}return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(typeof value.length==='number'&&!value.propertyIsEnumerable('length')){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(k+(gap?': ':':')+v);}}}}else{for(k in value){if(k!=""){try{if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(k+(gap?': ':':')+v);}}}catch(e){var eMsg='Exception at Object.hasOwnProperty.call('+value+', '+k+') ';eMsg+=catchFormatter(e)+' in JSON.str('+key+', '+holder+')';ROM.post(urls.loggingURL,{level:'WARN',line:(eMsg)});}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
function clone(object){return parse(stringify(object));}
function stringify(value,replacer,space){if(typeof value=="undefined"||value==null){return null;}
var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});}
function parse(text,reviver){if(!text)return null;var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
try{j=eval('('+text+')');}catch(e){e.message="Error while parsing JSON: "+e.message+". Input JSON: "+text;throw e;}
return typeof reviver==='function'?walk({'':j},''):j;}
var retval={clone:clone,stringify:stringify,parse:parse};return retval;})();var Cloneable=(function(){var retval={clone:function(){return JSON.parse(JSON.stringify(this));}};return retval;})();var im13=function(mixable){if(mixable){for(var name in mixable){if(!this[name]){if(this.prototype){this.prototype[name]=mixable[name];}else{this[name]=mixable[name];}}}}
return this;};function prepare(_class){if(_class){_class.im13=im13;}
return _class;}
function mixAbsorber(o){if(!o){o={};}
o.absorb=XJA3.absorb;return o;}
function clonize(o){if(!!o&&typeOf(o)=="object"){o.clone=function(){return JSON.parse(JSON.stringify(this));}}
return o;}
function mixSettable(o){if(isNullOrUndefined(o)){o={};}
if(!!o&&typeOf(o)=="object"){o.set=function(n,v){if(!!n||n===0||n===""){this[n]=v;}else{log("Settable: Unable to set n,v=("+n+","+v+") on "+this.toString()+". \n"+getStackTrace(new Error()));}
return this;};}
return o;}
function mixRemovable(o){if(isNullOrUndefined(o)){o={};}
if(!!o&&typeOf(o)=="object"){o.remove=function(n){if(!!n||n===0||n===""){delete this[n];}
return this;};}
return o;}
function mixRenamable(o){if(isNullOrUndefined(o)){o={};}
if(!!o&&typeOf(o)=="object"){o.rename=function(on,nn){if((!!on||on===0||on==="")&&(!!nn||nn===0||nn==="")){var v=this[on];if(!!v||v===0){delete this[on];}
this[nn]=v;}
return this;};}
return o;}
function unmixMutatable(o){delete o.rename;delete o.remove;delete o.set;return o;}
function mixMutatable(o){o=mixRemovable(o);o=mixSettable(o);o=mixRenamable(o);return o;}
function unmix(o){o=unmixMutatable(o);delete o.absorb;delete o.im13;return o;}
return{prepare:prepare,Observable:Observable,JSON:JSON,mixMutatable:mixMutatable,unmixMutatable:unmixMutatable,mixAbsorber:mixAbsorber,XJA3:XJA3,Resource:Resource,Persistable:Persistable,FM2:FM2,RC54:RC54,clonize:clonize,Cloneable:Cloneable,wrapWithTryCatch:wrapWithTryCatch,unmix:unmix};})();var businessConstants=site.businessConstants();var constants=MI8.mixAbsorber();constants.absorb({"CUST_IP_HOST_RESOLUTION_ACTIVE":false,"ASSISTED_AGENT_CHAT_COUNT":2.0,"ASSISTED_CUSTOMER_CHAT_COUNT":2.0,"DEBUG":true,"SALE_EXPIRATION":2592000000,"SALE_STATE_CONVERTED":"converted","SALE_STATE_ASSISTED":"assisted","SALE_STATE_UNSOLD":"unsold","SESSION_EXPIRE_TIME":1800000,"INC_GROUP_CONTROL":"CONTROL","INC_GROUP_CHAT":"CHAT","INC_STATE_ELIGIBLE":"ELIGIBLE","INC_STATE_TARGETED":"TARGETED","INC_STATE_EXPOSURE_QUALIFIED":"EXPOSURE_QUALIFIED","INC_STATE_EXPOSED":"EXPOSED","INC_STATE_ENGAGED":"ENGAGED","INC_STATE_INTERACTED":"INTERACTED","INC_STATE_ASSISTED":"ASSISTED","INC_STATE_CONVERTED":"CONVERTED","INC_GROUP_DURATION":2592000000,"INC_CONTROL_PERCENT":1.0,"MESSAGE_COUNT_ASSISTED":1.0,"PERSISTENT_ASSISTED":6.0,"UNDEFINED_ASSISTED":3.0,"MAX_LONG":9.223372036854776E18,"REMOVE_QUERY_STRING_FROM_TRACKING_URL":false,"RECHAT_INTERVAL":86400000,"JS_LOG_LEVEL":"ERROR"});constants.absorb(businessConstants);LoadMgr.frameStorage={};LoadMgr.p2sStorage={};LoadMgr.contexts={};LoadMgr.currFrameId=0;LoadMgr.ieVersion=getBrowserMajorVer(true);LoadMgr.init=false;function LoadMgr(){if(!LoadMgr.init)LoadMgr.init=LoadMgr._init();}
LoadMgr._init=function(){if(window["postMessage"]==null)return;if(window.addEventListener)
window.addEventListener("message",LoadMgr.handleSuccess,false);else if(window["attachEvent"])
window.attachEvent("onmessage",LoadMgr.handleSuccess);else
window.onmessage=LoadMgr.handleSuccess;LoadMgr.putItemToP2sStorage(urls.vanityURL,"/tagserver/postToServer.htm");LoadMgr.putItemToP2sStorage(urls.mediaRootURL,"/tagserver/postToServer.htm");LoadMgr.putItemToP2sStorage(urls.chatRouterVanityDomain,"/chatrouter/postToServer/postToServer.htm");LoadMgr.putItemToP2sStorage(urls.cobrowseURL,"/cobrowse/postToServer.htm","https");return true;};LoadMgr.handleIESuccess=function(data){var event={};event.data=data;LoadMgr.handleSuccess(event);};LoadMgr.putItemToP2sStorage=function(url,p2pPath,protocol){var parsedUrl=parseUrl(url);LoadMgr.p2sStorage[parsedUrl.host]=parsedUrl.host+p2pPath;if(protocol){LoadMgr.p2sStorage[parsedUrl.host].protocol=protocol;}};LoadMgr.handleSuccess=function(event){if(!event.data)return false;var data;if(typeof(event.data)=="string"){data=LoadMgr.convertStrToArray(event.data);}else{data=event.data;}
if(data&&data.length>1&&data[0]){var id=data[0];var context=LoadMgr.getContext(id);if(context){context.origin=event.origin;var cmd=data[1];context.id=id;if(data.length>2){context.responseStatus=data[2];context.responseHeaderCacheControl=data[3];context.contentType=data[4];if(context.contentType.indexOf("application/json")>-1){try{context.data=MI8.JSON.parse(cmd);}catch(e){logErrorToTagServer("LoadMgr.handleSuccess: "+e.message+". ["+(CHM.getChatID()?"chatID="+CHM.getChatID():"customerID="+Inq.getCustID())+", siteID="+Inq.getSiteID()+"]");}}else if(context.contentType.indexOf("image")>-1){LoadMgr.unregisterContext(id);return false;}else{context.data=cmd;}}else{context.data=cmd;context.eval=true;}
if(context.callbackFun){context.callbackFun.call(undefined,context);}
LoadMgr.unregisterContext(id);}else{log("Warning! Could not find context for ID "+id);}}
return false;};LoadMgr.registerContext=function(id,context){LoadMgr.contexts[id]=context;};LoadMgr.unregisterContext=function(id){delete LoadMgr.contexts[id];};LoadMgr.getContext=function(id){return LoadMgr.contexts[id];};LoadMgr.convertStrToArray=function(str){var arr=str.split("||");for(var i=0;i<arr.length;i++){arr[i]=decodeURIComponent(arr[i]);}
return arr;};LoadMgr.prototype.postRequestToIframeProxy=function(url,request,id,context){try{if(id&&context)LoadMgr.registerContext(id,context);var parsedUrl=parseUrl(url);var host=parsedUrl.host;var p2pPath=LoadMgr.p2sStorage[host];var protocol=p2pPath&&p2pPath.protocol?p2pPath.protocol:parsedUrl.protocol;var key=protocol+"://"+host;var frameItem=LoadMgr.frameStorage[key];if(!frameItem){var iframe=document.createElement("iframe");iframe.id="post_box_"+(++LoadMgr.currFrameId);iframe.name="_none";iframe.src=p2pPath?(protocol+"://"+p2pPath):url;iframe.style.cssText="overflow: hidden; display: none; border: none; top:0px;left:0px;width: 1px; height: 1px;";frameItem={frame:iframe,loaded:false,reqQueue:[],name:""};LoadMgr.frameStorage[key]=frameItem;var that=this;var iframCallback=function(){that.sendRequest(frameItem);frameItem.loaded=true;};if(window.addEventListener){iframe.addEventListener("load",iframCallback,false);}else if(iframe.attachEvent){iframe.attachEvent('onload',iframCallback);}else{iframe.onload=iframCallback;}
document.getElementsByTagName("body")[0].appendChild(iframe);}
frameItem.reqQueue.push(request);if(frameItem.loaded){this.sendRequest(frameItem);}}catch(e){if(window.console)window.console.error(e.message,e);logErrorToTagServer("LoadMgr.postRequestToIframeProxy: "+e.message+". ["+(CHM.getChatID()?"chatID="+CHM.getChatID():"customerID="+Inq.getCustID())+", siteID="+Inq.getSiteID()+"]");}};LoadMgr.prototype.updateFrameName=function(id,url){var parsedUrl=parseUrl(url);var host=parsedUrl.host;var p2pPath=LoadMgr.p2sStorage[host];var protocol=p2pPath&&p2pPath.protocol?p2pPath.protocol:parsedUrl.protocol;var key=protocol+"://"+host;var frameItem=LoadMgr.frameStorage[key];if(frameItem){var iframe=frameItem.frame;var name=frameItem.name;if(name.length>0){var cmnds=name.split("&&");var rem_indx=-1;for(var i=0;i<cmnds.length;i++){var cmd_id=cmnds[i].split("||")[1];if(cmd_id==id){rem_indx=i;break;}}
var new_name=cmnds.splice(rem_indx,0).join("&&");frameItem.name=new_name;}}};LoadMgr.prototype.sendRequest=function(frameItem){var iframe=frameItem.frame;try{var postMessageSupported=window["postMessage"]!=null;if(postMessageSupported){var win=iframe.contentWindow;for(var i=0;i<frameItem.reqQueue.length;i++){if(win!=null){if(LoadMgr.ieVersion>0&&LoadMgr.ieVersion<=9&&(typeof frameItem.reqQueue[i])!="string"){win.postMessage(frameItem.reqQueue[i].join("||"),"*");}else{win.postMessage(frameItem.reqQueue[i],"*");}}}}else{var names=frameItem.name;for(var i=0;i<frameItem.reqQueue.length;i++){if(names.length>0){names+="&&"+frameItem.reqQueue[i].join("||");}else{names=frameItem.reqQueue[i].join("||");}}
window.frames[iframe.id].name=names;frameItem.name=names;}
frameItem.reqQueue.clear();}catch(e){if(window.console)window.console.error(e.message,e);logErrorToTagServer("LoadMgr.sendRequest: "+e.message+". ["+(CHM.getChatID()?"chatID="+CHM.getChatID():"customerID="+Inq.getCustID())+", siteID="+Inq.getSiteID()+"]");}};function MediaMgr(data){this._frameworkModule("mm");this.absorb(data);for(var n1 in data){for(var n2 in data[n1]){MI8.clonize(data[n1][n2]);}}}
MI8.prepare(MediaMgr).im13(MI8.XJA3).im13(MI8.FM2);MediaMgr.prototype.start=MediaMgr.prototype.reset=MediaMgr.prototype.init=function(){};MediaMgr.prototype.getC2CSpec=function(id,subtree){var val=this["c2cSpecs"][id];if(isNullOrUndefined(val)){throw("MediaMgr-> no c2c spec for id="+id);}
val=MI8.mixAbsorber(val.clone());if(!!subtree)
val.absorb({c2cTheme:this.getC2CTheme(val['thId']),chatSpec:this.getChatSpec(val['chSpId'],subtree)});return val;};MediaMgr.prototype.getC2CTheme=function(id){var val=this['c2cThemes'][id];if(isNullOrUndefined(val)){throw("MediaMgr-> no c2c theme for id="+id);}
return MI8.mixAbsorber(val.clone());};MediaMgr.prototype.getChatSpec=function(id,subtree){var val=this["chatSpecs"][id];if(isNullOrUndefined(val)){throw("MediaMgr-> no chat spec for id="+id);}
val=MI8.mixAbsorber(val.clone());if(!!subtree)
val.absorb({chatTheme:this.getChatTheme(val['ctId'])});return val;};MediaMgr.prototype.getChatTheme=function(id){var val=this['chatThemes'][id];if(isNullOrUndefined(val)){throw("MediaMgr-> no chat theme for id="+id);}
return MI8.mixAbsorber(val.clone());};MediaMgr.prototype.mergeC2CTheme=function(c2cTheme){var val=!!c2cTheme.id?this.getC2CTheme(c2cTheme.id):this.getC2CThemeByName(c2cTheme.name);if(!!val){return val.absorb(c2cTheme);}
log("MediaMgr Error: c2cTheme not found for xml theme id="+c2cTheme.id);return null;};MediaMgr.prototype.mergeChatTheme=function(chatTheme){var val=!!chatTheme.id?this.getChatTheme(chatTheme.id):this.getChatThemeByName(chatTheme.name);if(!!val){for(var n in chatTheme){val[n]=chatTheme[n];}
return val;}
log("MediaMgr Error: chatTheme not found for xml theme id="+c2cTheme.id);return null;};MediaMgr.prototype.mergeChatSpec=function(chatSpec){var val=!!chatSpec.id?this.getChatSpec(chatSpec.id,true):this.getChatSpecByName(chatSpec.name,true);if(!!val){if(!!chatSpec.chatTheme){val['chatTheme']=this.mergeChatTheme(chatSpec.chatTheme);}
for(var n in chatSpec){if(n=='chatTheme')
continue;val[n]=chatSpec[n];}
return val;}
log("MediaMgr Error: chatTheme not found for xml theme id="+c2cTheme.id);return null;};MediaMgr.prototype.mergeC2CSpec=function(c2cSpec,excludeChatData){if(!isNullOrUndefined(c2cSpec)){var val=!!c2cSpec.id?this.getC2CSpec(c2cSpec.id,true):this.getC2CSpecByName(c2cSpec.name,true);if(!!excludeChatData){delete val.chatSpec;}
if(!!c2cSpec.c2cTheme){val['c2cTheme']=this.mergeC2CTheme(c2cSpec.c2cTheme);}
if(!!c2cSpec.chatSpec&&!excludeChatData){val['chatSpec']=this.mergeChatSpec(c2cSpec.chatSpec);}
for(var n in c2cSpec){if(n=='c2cTheme'||n=='chatSpec')
continue;val[n]=c2cSpec[n];}
return val;}
else{log("MediaMgr Error: bad c2cSpec passed. Check XML rule actions. ref="+c2cSpec)}
return null;};MediaMgr.prototype.getModelIdByName=function(modelName,instanceName){var result=null;for(var instance in this[modelName]){if(this[modelName][instance].name==instanceName){result=instance;break;}}
if(!result){throw("No media for name= "+instanceName+" found in list of "+modelName);}
return result;};MediaMgr.prototype.getChatThemeByName=function(name){var id=this.getModelIdByName('chatThemes',name);return this.getChatTheme(id);};MediaMgr.prototype.getChatSpecByName=function(name,subtree){var id=this.getModelIdByName('chatSpecs',name);return this.getChatSpec(id,subtree)};MediaMgr.prototype.getC2CThemeByName=function(name){var id=this.getModelIdByName('c2cThemes',name);return this.getC2CTheme(id);};MediaMgr.prototype.getC2CSpecByName=function(name,subtree){var id=this.getModelIdByName('c2cSpecs',name);return this.getC2CSpec(id,subtree);};function URI(uri){this._uri=uri;this.parseURI();}
MI8.prepare(URI).im13(MI8.XJA3);URI.partNames=["source","protocol","authority","domain","port","path","dirPath","fileName","query","anchor"];URI.parseURI=function(_uri){var obj={qMap:{}};var uriParts=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(_uri);for(var i=0;i<URI.partNames.length;i++){obj[URI.partNames[i]]=(uriParts[i]?uriParts[i]:"");}
if(obj.dirPath.length>0){obj.dirPath=obj.dirPath.replace(/\/?$/,"/");}
if(obj.query){var p=obj.query.split("&");for(var i=0;i<p.length;++i){var kvp=p[i].split("=");obj.qMap[kvp[0]]=(kvp.length>1)?unescape(kvp[1]):"";}}
if(obj.domain){obj.rootDomain=obj.domain;var arr=obj.domain.split('.');if(arr.length>2){for(var idx=0;idx<arr.length-2;idx++)arr.shift();obj.rootDomain=arr.join('.');}}
return obj;};URI.prototype.parseURI=function(){this.absorb(URI.parseURI(this._uri));};URI.prototype.getQ=function(q){var v=this.qMap[q];return(typeof v=="undefined"||v==null)?null:v;};function FcnMgr(namedFcns){this.fcns=namedFcns;}
FcnMgr.idx=0;FcnMgr.prototype.getFcn=function(fcnOrFcnName){if(!fcnOrFcnName)
throw"function name is null or undefined";switch(typeof fcnOrFcnName){case"string":case"function":break;default:throw"illegal parameter type: "+(typeof fcnOrFcnName);}
var fcn=(typeof fcnOrFcnName=="string")?this.fcns[fcnOrFcnName]:fcnOrFcnName;if(!fcn)
throw"function is null or undefined";return fcn;}
FcnMgr.prototype.callExternal=function(fcnOrFcnName){if(!window.self.parent.v3Lander){logErrorToTagServer("window.self.parent.v3Lander is undefined, callExternal returns null");return null;}
var fcn=this.getFcn(fcnOrFcnName);var name=this.publish(fcn);var args=this._normArgs(arguments);var retval=null;try{retval=window.self.parent.v3Lander.FMProxy.getFcn(name).apply(window.self.parent,args);}catch(err){throw"function eval failed. err="+err.toString();}
this.unpublish(name);return retval;};FcnMgr.prototype._normArgs=function(argumnts){var args=[];if(argumnts.length>1){for(var idx=1;idx<argumnts.length;idx++){args[idx-1]=argumnts[idx];}}
return args;};FcnMgr.prototype.exec=function(fcnOrFcnName){var fcn=this.getFcn(fcnOrFcnName);try{return fcn.apply(self,this._normArgs(arguments));}catch(err){throw"function eval failed. err="+err.toString();}};FcnMgr.prototype.publish=function(fcn,name){var name=!!name?name:'fcn_'+FcnMgr.idx++;window.self.parent.v3Lander.FMProxy.addFcn(name,fcn.toString());return name;};FcnMgr.prototype.unpublish=function(name){window.self.parent.v3Lander.FMProxy.removeFcn(name);};function CM47(id,xd){this._frameworkModule(id);this.xd=xd;this.cookies={};this.JSON=MI8.JSON;this.version=3;this.initMessagingComplete=false;this.set3rdPartyCookieBusy=false;this.set3rdPartyCookieQueue=[];this.overflowLogged=false;this.trdPartyCookieCnt=0;this.isLSused=false;this.cntHandlerTried=0;}
MI8.prepare(CM47).im13(MI8.FM2).im13(MI8.RC54);CM47.CM=null;var PERSISTENT_COOKIE_ALLOWED="pc";CM47.getInstance=function(xd){if(CM47.CM==null){CM47.CM=new CM47("CM",xd);}
return CM47.CM;};CM47.prototype.init=function(){if(this.initialized)return;this.initialized=true;log(this.getID()+" initialized.");this.initMessagingComplete=this.initMessaging();};CM47.prototype.start=function(){if(this.started)return;this.started=true;};CM47.prototype.getPeer=function(){return(isSameOrigin()&&isPersistentWindow())?window.parent.opener.inqFrame.Inq.CM:null;};CM47.prototype.addValueToCookieCache=function(cName,name,value,isJSON,update){if(value!=undefined){value=!!isJSON?MI8.JSON.parse(decodeURIComponent(value)):value;}
if(!update){if(isPersistentWindow()){try{var cmPeer=this.getPeer();if(!!cmPeer){if(cmPeer.persistentWindow!=win){cmPeer.persistentWindow=win;}
if(value!=undefined){cmPeer.addValueToCookieCache(cName,name,encodeURIComponent(MI8.JSON.stringify(value)),true,true);}else{cmPeer.addValueToCookieCache(cName,name,null,null,true);}}}catch(err){log("Error propagating value to main window from Cookie manager.");}}
else{try{var persistentWindow=this.persistentWindow;if(!!persistentWindow){var cmPersistent=persistentWindow.inqFrame.Inq.CM;if(!!cmPersistent){if(value!=undefined){cmPersistent.addValueToCookieCache(cName,name,encodeURIComponent(MI8.JSON.stringify(value)),true,true);}else{cmPersistent.addValueToCookieCache(cName,name,null,null,true);}}}}catch(err){log("Error propagating value to persistent");}}}
if(value==undefined){if(this.cookies[cName]){delete this.cookies[cName][name];}}else{if(!this.cookies[cName]){this.cookies[cName]={};}
if(typeof value=='object'){try{value=MI8.JSON.parse(MI8.JSON.stringify(value));}catch(e){log("Cookie value is malformed JSON : "+e);}}
this.cookies[cName][name]=value;}};CM47.prototype.write=function(cRes,name,value){var cObj=null;var cVal=null;var cName=cRes.getName();var cookieError=null;if(cName!=PERSISTENT_COOKIE_ALLOWED&&value!=undefined&&!this.isLSused){var predictedResult;try{predictedResult=this.predictOverflow(cRes,name,value);}catch(err){if(err.constructor===CookieDomainSizeError||err.constructor===CookieSizeError){cookieError=err;log(cookieError.toString());predictedResult=cookieError.getData().result;}}
if(!!cookieError&&predictedResult!=0){var overflowObject={_domain:"error",evt:"cookieoverflow",params:{custID:Inq.getCustID(),siteID:getSiteID(),resource:cName,varId:name,size:JSON.stringify(value).length,sessionId:getSessionID(),incAssignmentID:getIncAssignmentID(),incGroup:getIncGroupID()}};var msg="Cookie overflow!";if(cookieError.constructor==CookieDomainSizeError){var pruneSuccessful=this.pruneCookieOnOverflow(predictedResult,cRes.getPurgePriority());msg+=" New cookie overflows domain limit";if(pruneSuccessful){log("ERROR: variable named '"+name+"' (size="+value.length+") write aborted and cookie (name="+cName+") overflowed and dropped. VBER34: {"+name+":\""+value+"\"");}
overflowObject["pruneSuccess"]=pruneSuccessful;}
else if(cookieError.constructor===CookieSizeError){msg+=" cookie is packed to limit. Data dropped.";log("WARNING: Cookie overflowed when writing variable. varId="+name+", cookieName="+cName+", varSize="+value.length+", attemptedValue="+value);}
if(!this.overflowLogged){overflowObject["Log2ETL"]=true;overflowObject["params"]["msg"]=msg;this.send(urls.loggingURL,{line:JSON.stringify(overflowObject)});this.overflowLogged=true;}
if(cookieError.constructor===CookieSizeError){return;}}}
if(this.xd){var oldValue=this.JSON.stringify(this.cookies[cName]);this.addValueToCookieCache(cName,name,value);if(cRes.getResourceID()=="vital"){this.cookies[cName]["v"]=this.version;this.cookies[cName]["vcnt"]=this.trdPartyCookieCnt++;this.cookies[cName]["vtime"]=(new Date).getTime();}
var newValue=this.JSON.stringify(this.cookies[cName]);try{if(cRes.getResourceID()=="vital"&&!isNullOrUndefined(oldValue)&&oldValue.indexOf("_iID")!=-1){if(isNullOrUndefined(newValue)||newValue.indexOf("_iID")==-1){ROM.send(urls.loggingURL,{level:'ERROR',line:("overriding the incrAssignmentID for siteID="+Inq.getSiteID()+" customerID="+Inq.getCustID()+"oldValue="+oldValue+"newValue ="+newValue)});}}}catch(e){log("Error:overriding the valid incrAssignmentID for siteID"+Inq.getSiteID()+" customerID="+Inq.getCustID());}
if(true||oldValue!=newValue){this.set3rdPartyCookie("SCBR3_PM",siteID,cName,this.cookies[cName],!cRes.getPath()?null:cRes.getPath(),cRes.getLifetime());}}else{var c=this._getCookie(cName);if(c==null){cObj={};}else{try{cObj=this.JSON.parse(c);}catch(e){cObj={};}}
if(cObj==null)cObj={};if(value==undefined){delete cObj[name];}else{cObj[name]=value;}
if(cRes.getResourceID()=="vital"){cObj["v"]=this.version;}
cVal=this.JSON.stringify(cObj);this._setCookie(cRes,cVal);}};CM47.prototype.read=function(cRes,name){var cVal=null;var cName=cRes.getName();if(this.xd){try{if(!isNullOrUndefined(this.cookies[cName])){cVal=this.cookies[cName][name];}}catch(e){log(e);}}else{var c=this._getCookie(cName);var cObj=null;try{if(c){cObj=this.JSON.parse(c);if(cObj!=null){cVal=cObj[name];}}}catch(e){log(e);}}
return cVal;};CM47.prototype.clear=function(cResId){var cRes=resources[cResId];if(this.xd){var cName=cRes.getName();delete this.cookies[cName];this.set3rdPartyCookie("SCBR3_PM",siteID,cName,"",null,-1*86400000);this.send(urls.loggingURL,{level:"info",line:("clear cookie "+cName+", siteID="+siteID+", pageID="+LDM.getPageID()+", custID="+Inq.getCustID())});}else{this.expireCookie(cResId);}};CM47.prototype.dump=function(){if(this.xd){var boxID="box"+Math.floor(Math.random()*1000011);var port=(inqFrame.location.port!="")?":"+inqFrame.location.port:"";var parentURL=inqFrame.location.protocol+"//"+inqFrame.location.hostname+port+inqFrame.location.pathname;var postCookieRequest=["DUMP",boxID,"",parentURL,encodeURIComponent(secureHTTP(urls.loggingURL))];this.postRequestToIframeProxy(postCookieRequest,boxID);}};function CookieSizeError(cName,size,delta,limit,result){this.getData=function(){return{cookieName:cName,oldSize:size,delta:delta,limit:limit,result:result};};this.toString=function(){return"CookieSizeError: Cookie size violated, proposed size="+(size+delta)+", limit="+limit+", result="+result;};}
function CookieDomainSizeError(cName,size,delta,limit,result){this.getData=function(){return{cookieName:cName,oldSize:size,delta:delta,limit:limit,result:result};};this.toString=function(){return"CookieDomainSizeError: Cookie domain size violated, proposed size="+(size+delta)+", limit="+limit+", result="+result;};}
CM47.prototype.predictOverflow=function(cRes,name,value){var newObj={};newObj[name]=value;var newObjSize=encodeURIComponent(this.JSON.stringify(newObj)).length;var oldObjSize=0;var cName=cRes.getName();var cObj={};if(this.xd){if(this.cookies[cName]){cObj=this.cookies[cName];}}else{var c=this._getCookie(cName);if(c){try{cObj=this.JSON.parse(c);}catch(e){}}}
if(!isNullOrUndefined(cObj[name])){oldObjSize=encodeURIComponent(this.JSON.stringify(cObj[name])).length;}
var predictedDelta=newObjSize-oldObjSize;if(predictedDelta>0){var cResSize=this.getCookieSize(cRes);var cookieLimit=getCookieSizeLimit();if(cookieLimit&&(cResSize+predictedDelta>cookieLimit)){throw new CookieSizeError(cName,cResSize,predictedDelta,cookieLimit,cResSize+predictedDelta-cookieLimit);}else{var totalSize=this.getCookieSize();var cookieTotalLimit=getCookieTotalSizeLimit();if(cookieTotalLimit&&(totalSize+predictedDelta>cookieTotalLimit)){throw new CookieDomainSizeError(cName,totalSize,predictedDelta,cookieTotalLimit,totalSize+predictedDelta-cookieTotalLimit);}}}
return 0;};CM47.prototype.getCookieSize=function(cRes){var size=0;if(!cRes){if(this.xd){for(var res in resources){if(resources[res].constructor===CCD){size+=this.getCookieSize(resources[res]);}}}else{size=document.cookie.length;}}else{var cName=cRes.getName();var cVal;if(this.xd){cVal=this.JSON.stringify(this.cookies[cName]);}else{cVal=this._getCookie(cName);}
if(cVal)size=cName.length+1+encodeURIComponent(cVal).length;}
return size;};CM47.prototype.pruneCookieOnOverflow=function(byteCountToFree,currentCookiePriority){var cookiesToPrune=[];var bytesFreed=0;currentCookiePriority=(isNullOrUndefined(currentCookiePriority)?0:currentCookiePriority);var _resources=Object.keys(resources).map(function(k){return resources[k];}).filter(function(a){return!isNullOrUndefined(a)&&a.constructor===CCD&&(a.getPurgePriority()>currentCookiePriority);});_resources.sort(CCD.COOKIE_RESOURCE_PURGE_PRIORITY_SORT_FCN);for(var idx=0;idx<_resources.length;idx++){var resource=_resources[idx];log("************* "+resource.getResourceID()+" will be cleared.");bytesFreed+=this.getCookieSize(resource);cookiesToPrune.push(resource);if(bytesFreed>=byteCountToFree){break;}}
if(bytesFreed<byteCountToFree&&currentCookiePriority==0){var stateRes=resources["state"];bytesFreed+=this.getCookieSize(stateRes);if(bytesFreed>=byteCountToFree){cookiesToPrune.push(stateRes);}else if(!CHM.isChatInProgress()){var sesRes=resources["session"];bytesFreed+=this.getCookieSize(sesRes);if(bytesFreed>=byteCountToFree){cookiesToPrune.push(stateRes);cookiesToPrune.push(sesRes);}}}
if(cookiesToPrune.length>0){var cookieNames=cookiesToPrune.collect(function(cres){return cres.getName();});var msg="Cookie overflow! Trying to clear following cookie(s): "+cookieNames.join(',')+". ";log("ERROR: "+msg);if(!this.overflowLogged){msg=prepareLoggingContext(msg);this.send(urls.loggingURL,{level:'ERROR',line:msg});this.overflowLogged=true;}
for(var i=0;i<cookiesToPrune.length;i++){this.clear(cookiesToPrune[i].getResourceID());}}
return bytesFreed>=byteCountToFree;};CM47.prototype._setCookie=function(cRes,cVal,cLifetime){var name=cRes.getName();var lifetime=cRes.getLifetime();if(!!cLifetime)lifetime=cLifetime;var path=cRes.getPath();var domain=cRes.getDomain();var secure=cRes.getSecure();var now=new Date();var expires_date=new Date(now.getTime()+lifetime);var update=null;if((name==PERSISTENT_COOKIE_ALLOWED||this.isPersistentCookiesAllowed())&&lifetime>0){update=name+"="+encodeURIComponent(cVal)+";expires="+expires_date.toGMTString()+
((path)?";path="+path:"")+
((domain)?";domain="+domain:"")+
((secure)?";secure":"");}
else{update=name+"="+encodeURIComponent(cVal)+
((path)?";path="+path:"")+
((domain)?";domain="+domain:"")+
((secure)?";secure":"");}
document.cookie=update;};CM47.prototype._getCookie=function(cName,data){var cookies=this._getCookies(data);if(!!cookies&&!!cookies[cName]){return cookies[cName];}
return null;};CM47.prototype._getCookies=function(data){var a_all_cookies=(isNullOrUndefined(data))?document.cookie.split(COOKIE_DELIMITER):data.split(COOKIE_DELIMITER);var retval=null;a_all_cookies.forEach(function(cookie){var delim_index=cookie.indexOf('=');var cookie_name=(delim_index>0?cookie.substring(0,delim_index):cookie).replace(/^\s+|\s+$/g,'');var cookie_value='';if(delim_index>0&&delim_index<cookie.length-1){cookie_value=decodeURIComponent(cookie.substring(delim_index+1).replace(/^\s+|\s+$/g,''));}
if(retval==null)
retval={};retval[cookie_name]=cookie_value;});return retval;};CM47.prototype.setXDCookies=function(cookieData){this.cookies=cookieData;if(cookieData&&cookieData.pc&&cookieData.pc==2){this.isLSused=true;}};CM47.prototype.onThirdPartyCookieQueueEmpty=null;CM47.prototype.onThirdPartyCookieQueueEmptyHandlers=[];CM47.prototype.on3rdPartyCookieCommittedHandler=null;CM47.prototype.isThirdPartyCookieQueueEmpty=function(){return(0==this.set3rdPartyCookieQueue.length)&&!this.set3rdPartyCookieBusy;};CM47.prototype.set3rdPartyCookie=function(cmd,site,name,delta,path,expiry){if(!path)path="/";if(!expiry)expiry="";if(isNullOrUndefined(cmd)||isNullOrUndefined(site)||isNullOrUndefined(name))return;var boxID="box"+Math.floor(Math.random()*1000011);var port=(inqFrame.location.port!="")?":"+inqFrame.location.port:"";var parentURL=inqFrame.location.protocol+"//"+inqFrame.location.hostname+port+inqFrame.location.pathname;var sDelta=encodeURIComponent(""+this.JSON.stringify(delta));var postCookie=[cmd,boxID,site,parentURL,name,sDelta,path,expiry];if(0==this.set3rdPartyCookieQueue.length)
this.set3rdPartyCookieQueue.push({name:name,postCookie:postCookie});else{var i=0;for(i=0;i<this.set3rdPartyCookieQueue.length;i++){if(this.set3rdPartyCookieQueue[i].name==name){this.set3rdPartyCookieQueue[i].postCookie=postCookie;break;}}
if(i==this.set3rdPartyCookieQueue.length){this.set3rdPartyCookieQueue.push({name:name,postCookie:postCookie});}}
if(this.set3rdPartyCookieBusy)return;this.set3rdPartyCookieBusy=true;this.set3rdPartyCookieFromQueue();};CM47.prototype.set3rdPartyCookieFromQueue=function(){var cookieQItem=this.set3rdPartyCookieQueue.shift();if(!isNullOrUndefined(cookieQItem)){this.postRequestToIframeProxy(cookieQItem.postCookie,cookieQItem.postCookie[1]);}else{this.set3rdPartyCookieBusy=false;if(this.onThirdPartyCookieQueueEmpty!=null){this.onThirdPartyCookieQueueEmpty();}}};CM47.prototype.whenCookiesCommitted=function(handler){if(this.xd){if(this.isThirdPartyCookieQueueEmpty())
handler();else{this.onThirdPartyCookieQueueEmptyHandlers.push(handler);this.onThirdPartyCookieQueueEmpty=function(){(CM).whenCookiesFireHandlers();};if(this.isThirdPartyCookieQueueEmpty()){this.whenCookiesFireHandlers();}}}
else{handler();}};CM47.prototype.setWhen3rdPartyCookieCommittedHandler=function(handler){if(this.xd){try{var boxID="box"+Math.floor(Math.random()*1000011);var port=(inqFrame.location.port!="")?":"+inqFrame.location.port:"";var parentURL=inqFrame.location.protocol+"//"+inqFrame.location.hostname+port+inqFrame.location.pathname;var postCookieRequest=["COMMITPOINT",boxID,siteID,parentURL,encodeURIComponent(urls.loggingURL)];if(handler){this.on3rdPartyCookieCommittedHandler={"vcnt":this.cookies["inqVital"]['vcnt'],"callback":handler};}
this.set3rdPartyCookieQueue.push({name:"inqCallBack"+Math.floor(Math.random()*1000011),postCookie:postCookieRequest});if(!this.set3rdPartyCookieBusy){this.set3rdPartyCookieBusy=true;this.set3rdPartyCookieFromQueue();}}catch(e){log("exception in setWhen3rdPartyCookieCommittedHandler(): "+e.message,"error");}}else{return false;}};CM47.prototype.when3rdPartyCookieCommitted=function(vcnt){if(null!=this.on3rdPartyCookieCommittedHandler){try{if(!this.isLSused||this.cntHandlerTried>=120||(typeof vcnt!=="undefined"&&this.on3rdPartyCookieCommittedHandler["vcnt"]<=vcnt))
{this.on3rdPartyCookieCommittedHandler["callback"]();this.on3rdPartyCookieCommittedHandler=null;this.cntHandlerTried=0;this.set3rdPartyCookieFromQueue();}else{this.cntHandlerTried+=1;this.set3rdPartyCookieBusy=false;this.setWhen3rdPartyCookieCommittedHandler();}}catch(e){log("exception in CM47.prototype.when3rdPartyCookieCommitted: "+e.message,"error");}}else{this.set3rdPartyCookieFromQueue();}};CM47.prototype.whenCookiesFireHandlers=function(){log("CM47.whenCookiesFireHandlers() entered: got "+this.onThirdPartyCookieQueueEmptyHandlers.length+" handler(s).");this.onThirdPartyCookieQueueEmpty=null;while(this.onThirdPartyCookieQueueEmptyHandlers.length>0){var handlerRoutine=this.onThirdPartyCookieQueueEmptyHandlers.shift();if(handlerRoutine){try{handlerRoutine();}catch(e){log("exception in whenCookiesFireHandlers(): "+e.message,"error");}}}};CM47.prototype.postRequestToIframe=function(url,request,id,context){if(xdAutoSelect&&CM47.xdPsHelper.enabled&&CM47.xdPsHelper.hostFileURLUse){LoadM.postRequestToIframeProxy(CM47.xdPsHelper.hostFileURLUse+"?POST2SERVER",request,id,context);}else{LoadM.postRequestToIframeProxy(url,request,id,context);}};CM47.prototype.postRequestToIframeProxy=function(request,id,callback){var context={};context["callbackFun"]=callback||CM47.loadComplete;this.postRequestToIframe(this.getIFrameBaseURL(),request,id,context);};CM47.prototype.getIFrameBaseURL=function(){if(typeof this._iFrameBaseURL=='undefined'){this._iFrameBaseURL=Inq.urls.baseURL.split("/",3).join("/");this._iFrameBaseURL=secureHTTP(this._iFrameBaseURL);}
return this._iFrameBaseURL;};CM47.loadComplete=function(context){return CM.onMessage(context);};CM47.prototype.onMessage=function(context){if(CM47.xdPsHelper.isInFirstCookieProcess){CM47.xdPsHelper.processSavedXdCookie(context,context,this);}else{CM47.processMessage(context);return false;}};CM47.processMessage=function(context){try{if(context.eval){window.eval(context.data);}else{ROM.onRemoteCallback(context.id,context.data);}}catch(fault){ROM.post(urls.loggingURL,{level:'ERROR',line:('CM47.processMessage>> '+catchFormatter(fault))});}};CM47.xdPsHelper={};CM47.xdPsHelper.hostFileURLUse="";CM47.xdPsHelper.enabled=false;CM47.xdPsHelper.isInFirstCookieProcess=false;CM47.xdPsHelper.cntDomainsWithData=0;CM47.xdPsHelper.errorCode=0;CM47.xdPsHelper.isIos7=function(uagent){return/(iPad|iPhone).*OS 7/i.test(uagent);};CM47.xdPsHelper.is1pcEnabled=function(){if(typeof CM47.xdPsHelper.isUse1pcXdSolution.pc1Enabled=='undefined'){var value=Math.floor(Math.random()*101);var expiry=(new Date((new Date()).getTime()+(366*24*3600*1000))).toGMTString();document.cookie="pctest="+value+"; path=/; expires="+expiry+";";CM47.xdPsHelper.isUse1pcXdSolution.pc1Enabled=(document.cookie.indexOf("pctest="+value)!=-1)?true:false;}
return(CM47.xdPsHelper.isUse1pcXdSolution.pc1Enabled);};CM47.xdPsHelper.isUse1pcXdSolution=function(){var uiWebView=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);var androidWebview=/Android.*?(wv|Version\/[.0-9]+).*?Mobile/i.test(navigator.userAgent);return(uiWebView||androidWebview||isSafari())&&CM47.xdPsHelper.is1pcEnabled();};CM47.xdPsHelper.domains2Check=[];CM47.xdPsHelper.domains2Check.pushHostedFileUrl=function(hostedUrl){var ob=parseUrl(hostedUrl);if(ob!=null&&!this.contains(ob,function(a,b){return a.host==b.host;})){this.push(ob);CM47.xdPsHelper.hostDomainCnt+=1;return ob;}
return false;};CM47.xdPsHelper.domains2Check.assignDataByOrigin=function(origin,data){for(var i=0;i<this.length;i++){if(this[i].origin===origin){this[i].data=data;CM47.xdPsHelper.cntDomainsWithData+=1;}}
return null;};CM47.xdPsHelper.domains2Check.findEntryWithLatestCookie=function(){var date=null;var latestDate=null;var theobj=null;for(var i=0;i<this.length;i++){date=getDateFromData(this[i].data.data);if(date!=null){if(latestDate==null){theobj=this[i];latestDate=date;}else if(date>latestDate){theobj=this[i];latestDAte=date;}}}
if(theobj==null){for(var j=0;j<this.length;j++){if(this[j].domain==(inqFrame.location.domain?inqFrame.location.domain:parseUrl(inqFrame.location.href).domain)){theobj=this[j];}}}
if(theobj!=null){return theobj;}else{return null;}
function getDateFromData(data){var date=null;var dateStr=unescape(decodeURIComponent(data));var dateReg=/vtime:([0-9]*)/i;if(dateReg.test(dateStr)){date=dateReg.exec(dateStr)[1];}
return date;}};CM47.xdPsHelper.requestSavedXdCookies=function(){CM47.referer=window.parent.document.referrer;if(true){if(!populateDomains2Check())return;}else{CM47.xdPsHelper.domains2Check.pushHostedFileUrl(CM47.referer);}
CM47.xdPsHelper.isInFirstCookieProcess=true;for(var i=0;i<CM47.xdPsHelper.domains2Check.length;i++){callFirstPostRequestToIframeProxy(CM47.xdPsHelper.domains2Check[i].href);}
function callFirstPostRequestToIframeProxy(hostedURL){var boxID="box"+Math.floor(Math.random()*1000011);var port=(inqFrame.location.port!="")?":"+inqFrame.location.port:"";var parentURL=inqFrame.location.protocol+"//"+inqFrame.location.hostname+port+inqFrame.location.pathname;var postCookieRequest=["GCBR3",boxID,null,parentURL,"no action"];submitPsProcessRequest(postCookieRequest,boxID,hostedURL);function submitPsProcessRequest(request,frameId,baseUrl){var frameSrc=baseUrl+"?POST2SERVER";var context={};context["callbackFun"]=CM47.loadComplete;LoadM.postRequestToIframeProxy(frameSrc,request,request[1],context);}}
function populateDomains2Check(){var result=false;var hostedUrls=(typeof urls.siteHostedFileURL==="string")?urls.siteHostedFileURL.split(","):[];if(hostedUrls.length>1||hostedUrls[0].trim()!=""){for(var j=0;j<hostedUrls.length;j++){if(CM47.xdPsHelper.domains2Check.pushHostedFileUrl(hostedUrls[j].trim())){}else{}}
for(var i=0;i<CM47.xdPsHelper.domains2Check.length;i++){if(CM47.xdPsHelper.domains2Check[i].domain==(inqFrame.location.domain?inqFrame.location.domain:parseUrl(inqFrame.location.href).domain)){CM47.xdPsHelper.hostFileURLUse=CM47.xdPsHelper.domains2Check[i].href;result=true;}}}
if(isNullOrUndefined(CM47.xdPsHelper.hostFileURLUse)||CM47.xdPsHelper.hostFileURLUse==""){CM47.xdPsHelper.errorCode=2;result=false;}
return result;}};CM47.xdPsHelper.processSavedXdCookie=function(ev,data,that){CM47.xdPsHelper.domains2Check.assignDataByOrigin(ev.origin,data);var theob;if(CM47.xdPsHelper.cntDomainsWithData>=CM47.xdPsHelper.domains2Check.length){theob=CM47.xdPsHelper.domains2Check.findEntryWithLatestCookie();CM47.xdPsHelper.isInFirstCookieProcess=false;CM47.processMessage(theob.data);}};CM47.firstRequestCookie=function(){if(CM47.xdPsHelper.isUse1pcXdSolution()){CM47.xdPsHelper.enabled=true;CM47.xdPsHelper.requestSavedXdCookies();}else{CM.requestCookie();}};CM47.prototype.requestCookie=function(param,callback){param=param||"";var boxID="box"+Math.floor(Math.random()*1000011);var port=(inqFrame.location.port!="")?":"+inqFrame.location.port:"";var parentURL=inqFrame.location.protocol+"//"+inqFrame.location.hostname+port+inqFrame.location.pathname;var postCookieRequest=["GCBR3",boxID,param,parentURL,"no action"];this.postRequestToIframeProxy(postCookieRequest,boxID,callback);};CM47.prototype.updateCACookie=function(callbackFunc){var param="inqCA_"+Inq.siteID;var callback=function(context){var cObj=MI8.JSON.parse(context.data);CM.cookies.inqCA=cObj[param];callbackFunc();};this.requestCookie(param,callback);};CM47.prototype.initMessaging=function(){if(this.initMessagingComplete)return true;Inq["proxyError"]=this.proxyError;return true;};CM47.prototype.proxyError=function(errorText){ROM.post(urls.loggingURL,{level:"ERROR",line:encodeURIComponent(errorText)});};CM47.prototype.onRemoteCallback=function(data){this.setXDCookies(data);};CM47.prototype.expireCookie=function(cookieResourceId){log("EXPIRING COOKIE \""+cookieResourceId+"\"");var cRes=resources[cookieResourceId];this._setCookie(cRes,"",-1);};CM47.prototype.isPersistentCookiesAllowed=function(){if(isNullOrUndefined(this.isPersistentCookiesEnabled)){var pcVar=new VBER34(PERSISTENT_COOKIE_ALLOWED,{},resources[PERSISTENT_COOKIE_ALLOWED]);pcVar.setValue({});var enabled=!!this.read(resources[PERSISTENT_COOKIE_ALLOWED],PERSISTENT_COOKIE_ALLOWED);if(enabled)
CM.expireCookie(PERSISTENT_COOKIE_ALLOWED);this.isPersistentCookiesEnabled=enabled;}
return this.isPersistentCookiesEnabled;};CM47.isSessionCookiesEnabled=null;CM47.isSessionCookiesAllowed=function(){if(CM47.isSessionCookiesEnabled==null){var c_value=Math.floor(Math.random()*1001),c_name='sPc';CM47.isSessionCookiesEnabled=false;document.cookie=c_name+"="+c_value;if((document.cookie.indexOf(c_name)!=-1)&&(document.cookie.indexOf(c_value)!=-1)){CM47.isSessionCookiesEnabled=true;document.cookie=c_name+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT";}}
return CM47.isSessionCookiesEnabled;};var COOKIE_DELIMITER=';';function CCD(id,name,path,lifetime,domain,secure,overflowPriority,cm){this._resource(id);this._observable();this.getName=function(){return name;};this.getPath=function(){return path;};this.getLifetime=function(){return lifetime;};this.getDomain=function(){return domain;};this.isSecure=function(){return secure;};this.getSecure=function(){return this.isSecure();};this.getPurgePriority=function(){return overflowPriority;};this.cm=cm;}
MI8.prepare(CCD).im13(MI8.Resource).im13(MI8.JSON).im13(MI8.Observable);CCD.COOKIE_RESOURCE_PURGE_PRIORITY_SORT_FCN=function(a,b){return b.getPurgePriority()-a.getPurgePriority();};CCD.prototype.setCookieMgr=function(cm){this.cm=cm;};CCD.prototype.isListener=function(l){return!!(l&&(l.onResourceReset&&typeof l.onResourceReset=="function"));};CCD.prototype.fireResourceResetEvent=function(){function f(l,evt){try{if(!!l.onResourceReset){l.onResourceReset(evt);}}catch(e){log("Error firing event ResourceReset on "+l.toString()+":"+e);}}
var event={customerID:Inq.getCustID()};this._fireEvt(f,event);};CCD.prototype.write=function(name,value){if(this.cm){this.cm.write(this,name,value);}};CCD.prototype.read=function(name){var value=this.cm.read(this,name);return value;};CCD.prototype._serialize=function(value){return this.stringify(value);};CCD.prototype._unserialize=function(value){return this.parse(value);};CCD.prototype.getResourceID=function(){return this._rsrcID;};function WebResource(id,url,permissions,method){this._resource(id);this.url=url;this.permissions=permissions;this.method=method;}
MI8.prepare(WebResource).im13(MI8.Resource).im13(MI8.JSON).im13(MI8.RC54);WebResource.prototype.write=function(name,value){};WebResource.prototype.read=function(name){};WebResource.prototype._serialize=function(value){return value;};WebResource.prototype._unserialize=function(value){return value;};function JSResource(id,permissions){this._resource(id);this.data=[];}
MI8.prepare(JSResource).im13(MI8.Resource);JSResource.prototype.write=function(name,value){this.data[name]=value;};JSResource.prototype.read=function(name){try{return this.data[name];}
catch(e){}
return null;};JSResource.prototype._serialize=function(value){return value;};JSResource.prototype._unserialize=function(value){return value;};function VBER34(name,dfltValue,resource,shortName,fnCast,fnSer){this.name=name;this.resource=resource;this.dfltValue=dfltValue;this.shortName=shortName;if(typeof fnCast=="function"){this._cast=fnCast;}
if(typeof fnSer=="function"){this._serialize=fnSer;}
if(!isNullOrUndefined(resource)&&resource.observable){resource.addListener(this);}}
MI8.prepare(VBER34).im13(MI8.XJA3);VBER34.getInstanceFromData=function(data){var getResource=function(id){return id?resources[id]:null;};switch(data.type){case"generic":return new VBER34(data.name,data.defVal,getResource(data.rId),data.shName,data.fnCast,data.fnSer);case"String":return new StringVariable(data.name,data.defVal,getResource(data.rId),data.shName,data.fnCast,data.fnSer,data.maxSize);case"Date":return new DateVar(data.name,data.defVal,getResource(data.rId),data.shName);case"List":return new ListVariable(data.name,data.defVal,getResource(data.rId),data.shName,data.maxEntr);case"DateList":return new DateListVar(data.name,data.defVal,getResource(data.rId),data.shName,data.maxEntr);case"Map":return new MapVariable(data.name,data.defVal,getResource(data.rId),data.shName,data.maxEntr);}
throw("ERROR: Cannot instantiate variable for data: name="+data.name+", type="+data.type);};VBER34.getInstancesFromData=function(datArray){var retArr=[];for(var i=0;i<datArray.length;i++){retArr[i]=VBER34.getInstanceFromData(datArray[i]);}
return retArr;};VBER34.prototype.onResourceReset=function(evt){this.init();};VBER34.prototype.getName=function(){return this.name;};VBER34.prototype.getShortName=function(){return this.shortName;};VBER34.prototype.getPersistentName=function(){if(isNullOrUndefined(this.getShortName())){return this.getName();}else{return this.getShortName();}};VBER34.prototype.getResource=function(){return this.resource;};VBER34.prototype.reset=function(){this.setValue(this.dfltValue);};VBER34.prototype.init=function(){if(this.getValue()==null){this.setValue(this.dfltValue);}};VBER34.prototype._cast=function(v){return v;};VBER34.prototype._serialize=function(v){return v;};VBER34.prototype.getValue=function(){var r=this.getResource();var val=null;if(!!this.getShortName()&&(this.getShortName()!=this.getName())){var valByName=r.read(this.getName());var valByPerName=r.read(this.getShortName());if(!isNullOrUndefined(valByName)){r.write(this.getName());if(!valByPerName&&!(valByPerName===0)){r.write(this.getShortName(),valByName);valByPerName=valByName;}}
val=valByPerName;}
else{val=this.getResource().read(this.getPersistentName());}
return(isNullOrUndefined(val))?null:this._cast(val);};VBER34.prototype.setValue=function(newValue){this.getResource().write(this.getPersistentName(),this._serialize(newValue));return newValue;};function ListVariable(name,dfltValue,resource,shortName,maxEntries){this.name=name;this.dfltValue=dfltValue;this.resource=resource;this.shortName=shortName;if(!!maxEntries){this.maxEntries=maxEntries;}}
ListVariable.prototype=new VBER34();ListVariable.prototype.constructor=ListVariable;ListVariable.prototype.append=function(arrayParam){var arr=this.getValue();arr.append(arrayParam);arr.constrain(this.maxEntries);this.setValue(arr);};ListVariable.prototype.prepend=function(arrayParam){var arr=this.getValue();arr.prepend(arrayParam);arr.constrain(this.maxEntries);this.setValue(arr);};function DateVar(name,dfltValue,resource,shortName){this.name=name;this.dfltValue=dfltValue;this.resource=resource;this.shortName=shortName;}
DateVar.prototype=new VBER34();DateVar.prototype.constructor=DateVar;DateVar.prototype._serialize=function(o){return(o&&o.constructor===Date)?Math.floor(o.getTime()):o;};DateVar.prototype._cast=function(o){return(typeOf(o)=="number")?new Date(o):o;};function DateListVar(name,dfltValue,resource,shortName,maxEntries){this.name=name;this.dfltValue=dfltValue;this.resource=resource;this.shortName=shortName;if(!!maxEntries){this.maxEntries=maxEntries;}}
DateListVar.prototype=new ListVariable();DateListVar.prototype._serializeElement=DateVar.prototype._serialize;DateListVar.prototype._castElement=DateVar.prototype._cast;function MapVariable(name,dfltValue,resource,shortName,maxEntries){this.name=name;this.dfltValue=dfltValue;this.resource=resource;this.shortName=shortName;this.maxEntries=maxEntries;}
MapVariable.prototype=new VBER34();MapVariable.prototype.constructor=MapVariable;MapVariable.prototype.set=function(key,value){var map=this.getValue();if(typeof map!="object"){map=[];}
if(this.maxEntries){if(this.maxEntries>Object.keys(map).length){map.set(key,value);this.setValue(map);}else{log("Can't add new entry to a map variable "+this.getPersistentName()+" , max entries number is "+this.maxEntries);}}else{map.set(key,value);this.setValue(map);}};MapVariable.prototype.unset=function(key){var map=this.getValue();map.unset(key);this.setValue(map);};MapVariable.prototype.clear=function(){var map=this.getValue();map.clear();this.setValue(map);};MapVariable.prototype.each=function(fnc){var map=this.getValue();map.each(fnc);this.setValue(map);};function StringVariable(name,dfltValue,resource,shortName,fnCast,fnSer,maxSize){this.name=name;this.resource=resource;this.dfltValue=dfltValue;this.shortName=shortName;this.maxSize=maxSize;if(typeof fnCast=="function"){this._cast=fnCast;}
if(typeof fnSer=="function"){this._serialize=fnSer;}
if(!isNullOrUndefined(resource)&&resource.observable){resource.addListener(this);}}
StringVariable.prototype=new VBER34();StringVariable.prototype.constructor=StringVariable;StringVariable.prototype.setValue=function(newValue){if(!isNullOrUndefined(newValue)&&typeof newValue!="string"){log("StringVariable.setValue: format of data to set is wrong, it will not be set, data = "+newValue);return newValue;}else if(newValue&&this.maxSize&&this.maxSize<newValue.length){log(this.getPersistentName()+" cannot write value bigger that max size of "+this.maxSize+" and will be truncated");newValue=newValue.substring(0,this.maxSize);}
this.getResource().write(this.getPersistentName(),this._serialize(newValue));return newValue;};function X4334rtf(id,xd){this._frameworkModule(id);this.xd=xd;this._observable();this._vartable={};this.CM=CM47.getInstance(this.xd);this.getVar=function(varName,rule){var rv=this._vartable[varName+(rule?("_"+rule.getID()):"")];if(!rv){rv=this._vartable[varName];}
return!!rv?rv:null;};this.addVars=function(varArr){for(var i=0;i<varArr.length;i++){this.addVar(varArr[i]);}};this.addVar=function(v){this._vartable[v.getName()]=v;};this.fireDataReady=function(){for(var idx=0;idx<this._listeners.length;idx++){try{this._listeners[idx].agrtyer({});}catch(e){log(e);}}};this.isListener=function(l){return(l&&l.agrtyer)?true:false;};this.init=function(){if(this.initialized)return;this.initialized=true;for(var aVar in this._vartable){this._vartable[aVar].init();}
log(this.getID()+" initialized.");};this.reset=function(resourceID){if(!isNullOrUndefined(resourceID)){this.CM.clear(resourceID);var resource=resources[resourceID];if(!isNullOrUndefined(resource)){resource.fireResourceResetEvent();log("resource reset for resourceID : "+resourceID);}}};this.start=function(){if(this.started)return;this.started=true;};this.getCookieMgr=function(){return this.CM;};this.isCrossDomain=function(){return this.xd;};}
X4334rtf.PM=null;X4334rtf.getInstance=function(xd){if(X4334rtf.PM==null){X4334rtf.PM=new X4334rtf("PM",xd);}
return X4334rtf.PM;};MI8.prepare(X4334rtf).im13(MI8.Observable).im13(MI8.FM2);X4334rtf.im13(MI8.JSON).im13(MI8.XJA3);function toParamString(d,avoidRand){var rv="";if(!d)return rv;var separator="";if(!avoidRand){rv="_rand="+encodeURIComponent(randStr());separator="&";}
for(var idx in d){if(typeof d[idx]!="function"&&d[idx]!=null){rv+=(separator+idx+"="+encodeURIComponent(d[idx]));separator="&";}}
return rv;}
function randStr(){return(Math.round(Math.random()*1000000000000)).toString(36);}
function Channel(onComplete,onError){if(typeof onComplete=="function"){this.onComplete=onComplete;}
if(typeof onError=="function"){this.onError=onError;}
this.resendCount=0;this.img=this._newImage();}
Channel.prototype.getCallback=function(){return this.onComplete;};Channel.prototype.getResendCount=function(){return this.resendCount;};Channel.prototype.getUrl=function(){return this.url;};Channel.prototype.getSrcUrl=function(){return this.img.src;};Channel.prototype._newImage=function(){var img=new Image();img.channel=this;img.onload=function(evt){this.channel.done(evt);};img.onerror=function(e){this.channel.fail(e);};return img;};Channel.prototype._resend=function(err){var maxResend=this.maxResendTimes?this.maxResendTimes:3;if(!!this.resendOnError&&++this.resendCount<maxResend){this.img=this._newImage();if(!!this.data){this.data["resendCount"]=this.resendCount;}
if(this.timeout){var _this=this;setTimeout(function(){_this.send(_this.url,_this.data,_this.noCacheBust,_this.resendOnError,_this.maxResendTimes,_this.timeout);},_this.timeout);}else{this.send(this.url,this.data,this.noCacheBust,this.resendOnError,this.maxResendTimes,this.timeout);}}else{if(typeof this.onComplete=="function"){var errObj={state:"ERROR",url:this.getFullUrl(),attempts:this.resendCount};if(err&&err["type"]){errObj.evt={type:err["type"]};}
this.onComplete(errObj);}}
logErrorToTagServer("Send Error: Could not send data to service. retry count="+this.resendCount+",url="+this.getFullUrl()+(this.resendCount>2?", Failed!":""));};Channel.prototype.getFullUrl=function(){return this.url+(!!this.data?("?"+this.toParamString(this.data,this.noCacheBust)):"");};Channel.prototype.send=function(url,data,noCacheBust,resendOnError,maxResendTimes,timeout){this.url=url;this.data=data;this.noCacheBust=noCacheBust;this.resendOnError=resendOnError;this.maxResendTimes=maxResendTimes;this.timeout=timeout;this.img.src=this.getFullUrl();};Channel.prototype.toParamString=toParamString;Channel.prototype.rand=randStr;Channel.prototype.done=function(evt){if(typeof this.onComplete=="function"){this.onComplete({state:"SUCCESS",evt:evt,url:this.url});}};Channel.prototype.fail=function(err){if(typeof this.onError=="function"){this.onError({state:"ERROR",err:err});}else{this._resend(err);}};function RemoteOpsMgr(id,data){this._frameworkModule(id);this.waitingQ={};this.ch=[];this.i=0;this.pIdx=0;this.ridx=0;this.isIE=isIE();this.absorb(data);this.lastSendTime=new Date();this.requestTimestamp=0;this.postTime=[];this.sendCount=0;this.sleep=function(mlSec){var date=new Date();var curDate=null;do{curDate=new Date();}while(curDate-date<mlSec);};this.checkSendTime=function(){var curTime=new Date();if(curTime-this.lastSendTime>1000){this.sendCount=0;this.lastSendTime=curTime;return;}
if(this.sendCount<this.ch.length-1){this.sendCount++;this.lastSendTime=curTime;return;}
this.sleep(this.ch.length*55);this.sendCount=0;this.lastSendTime=new Date();};this.isOversizeRemoteCall=function(url,data){this.prepareDataToSend(data,null);return this.isOversizeCall(url,data);};this.isOversizeCall=function(url,data){var pstr=this.toParamString(data);pstr=((pstr&&pstr.length>0)?"?":"")+pstr;var reqURL=url+pstr;return(this.isIE&&reqURL.length>2048);};this.send=function(url,data,logOnError,resendOnError,maxResendTimes,timeout){var baseVanity=urls.vanityURL;var isVanity=url.indexOf(baseVanity)==0;var hasLogdata=url.indexOf("/logdata")!=-1;if(isVanity&&hasLogdata&&(data)&&(v3Lander)){data["codeVersion"]=v3Lander.codeVersion;}
if(isVanity&&this.isOversizeCall(url,data))return this.post(url,data,data.rid);try{this.checkSendTime();if(this.isOversizeCall(url,data)){this.postToServer(url,data);return;}
var rom=this;var _logOnError=logOnError;var channel=new Channel(function(evt){if(evt.state=="ERROR"&&!!_logOnError){logMessageToTagServer("Channel send failed: siteID="+Inq.getSiteID()+",customerID="+
Inq.getCustID()+",url="+this.getFullUrl(),LOG_LEVELS.ERROR);}
rom.ch.remove(channel);});channel.send(url,data,null,resendOnError,maxResendTimes,timeout);this.ch.push(channel);}catch(e){logErrorToTagServer("SvrCom.sendToServer ERROR:"+catchFormatter(e));var errMsg='RemoteOpsMgr.send >>Exception making an HTTP Request. URL '+url+catchFormatter(e);this.post(urls.loggingURL,{level:'ERROR',line:errMsg});}};this.post=function(url,data,id){try{id=id?id:"vanity"+Math.floor(Math.random()*1000001);var pstr=(typeof data=="string")?data:this.toParamString(data);var port=(inqFrame.location.port!="")?":"+inqFrame.location.port:"";var parentURL=inqFrame.location.protocol+"//"+inqFrame.location.hostname+port+inqFrame.location.pathname;var postCookieRequest=["POSTBR30",id,"",parentURL,encodeURIComponent(url+"?"+pstr)];(CM).postRequestToIframeProxy(postCookieRequest,id);}catch(e){logErrorToTagServer("SvrCom.sendToServer ERROR:"+catchFormatter(e));}};this.postToServer=function(action,data){if(isNullOrUndefined(data)||isNullOrUndefined(action)){return;}
var doc_=document;var div=doc_.getElementById("inqPostBox");if(!div){div=Inq.createFloatingDiv("inqPostBox",0,0,1,1);div.style.display="";div.style.opacity="0";}
var idx=this.pIdx%10;this.pIdx++;var iframe=doc_.getElementById("box"+idx);if(iframe){if(!isNullOrUndefined(this.postTime[idx])){var curTime=new Date().getTime();var waitTime=40;if(curTime-this.postTime[idx]<waitTime){this.sleep(waitTime);}}
div.removeChild(iframe);}
else{iframe=Inq.createHiddenIFrame("box"+idx,0,0,1,1);}
iframe.style.overflow="hidden";iframe.style.display="";iframe.width=1;iframe.height=1;iframe.src="javascript://";iframe.style.border="none";div.appendChild(iframe);var doc=null;if(iframe.contentDocument){doc=iframe.contentDocument;}else if(iframe.contentWindow){doc=iframe.contentWindow.document;}else if(iframe.document){doc=iframe.document;}
if(doc!=null){doc.open();doc.write('<form name="aform'+idx+'" id="aform'+idx+'" action="'+action+'" method="POST">');for(var name in data){if(typeof data[name]=="function")continue;doc.write('<textarea name="'+name+'">'+data[name]+'</textarea><br>');}
doc.write('</form><br>');doc.close();doc.getElementById("aform"+idx).submit();this.postTime[idx]=new Date().getTime();}};this.sendDataToAgent=function(agentID,data){if(agentID){this.post(urls.baseURL+"/tracking/agent",data);}};this.sendCobrowseMessage=function(engagementID,agentID,customerId,cobrowseEvent,cobrowseMessageText){this.post(urls.baseURL+"/tracking/cobrowse",{engagementID:engagementID,agentID:agentID,customerId:customerId,cobrowseEvent:cobrowseEvent,cobrowseMessageText:cobrowseMessageText});};this.composeURL=function(url,data,avoidRand){var p=this.toParamString(data,avoidRand);var idx=url.indexOf('?');if(p.length>0){if(idx<0){p="?"+p;}
else if(idx<(url.length-1)){p='&'+p;}
return url+p;}
return url;};this.prepareDataToSend=function(data,caller){if(isNullOrUndefined(caller)){data.rid="r1234567890";}
else{data.rid=this._queueCaller(caller);}};this.doRemoteCall=function(url,data,caller){var _win=inqFrame;this.prepareDataToSend(data,caller);var pstr=this.toParamString(data);var baseVanity=urls.vanityURL;if(url.indexOf(baseVanity)==0){this.post(url,pstr,data.rid);}
else{var fault=new Error("remote call to non-vanity domain");ROM.post(urls.loggingURL,{level:'ERROR',line:('VANITY DOMAIN ERROR: '+catchFormatter(fault))});}};this.newRID=function(){return"r"+(this.ridx++);};this._queueCaller=function(caller){var rid=this.newRID();if(caller&&caller.onRemoteCallback){this.waitingQ[rid]=caller;}else{throw"caller null or not an instance of RC54";}
return rid;};this._dequeueCaller=function(rid){var c=this.waitingQ[rid];if(c){delete this.waitingQ[rid];return c;}
return null;};this.onRemoteCallback=function(rid,data){if(rid){var caller=this._dequeueCaller(rid);if(caller!=null){try{caller.onRemoteCallback(data);}
catch(err){logErrorToTagServer(err);}}}};this.init=function(){if(this.initialized){return;}
this.initialized=true;};this.start=function(){if(this.started){return;}
this.started=true;};}
MI8.prepare(RemoteOpsMgr).im13(MI8.XJA3).im13(MI8.FM2);RemoteOpsMgr.prototype.toParamString=function(d,avoidRand){return RemoteOpsMgr.toParamString(d,avoidRand);};RemoteOpsMgr.prototype.rand=randStr;RemoteOpsMgr.toParamString=toParamString;RemoteOpsMgr.prototype.getTimestamp=function(){var timestamp=(new Date()).getTime();if(this.requestTimestamp<timestamp){this.requestTimestamp=timestamp;}else{this.requestTimestamp++;}
return this.requestTimestamp;};RemoteOpsMgr.prototype.sendBeacon=function(url){url+="&timestamp="+this.getTimestamp();if(navigator.sendBeacon){navigator.sendBeacon(url);}else{var ieVersion=getBrowserMajorVer(true);if(window.XMLHttpRequest&&(ieVersion==0||ieVersion>=10)){var xhr=new XMLHttpRequest();xhr.open("GET",url,false);xhr.send("");}else{var onError=function(){};var channel=new Channel(null,onError);channel.send(url);}}};function EXCBTT(cEvtData){this.absorb(cEvtData);}
EXCBTT.prototype.supportsListener=function(l){if(l){var lFcn=l["on"+this.name];if(lFcn&&typeof lFcn=="function"){return true;}
if(this.aliases&&this.aliases.length){for(var idx=0;idx<this.aliases.length;idx++){lFcn=l[this.aliases[idx].name];if(lFcn&&typeof lFcn=="function"){return true;}}}}
return false;};EXCBTT.prototype.getData=function(rule,evt){var data=this.getEvtData(rule,evt);if(this.evtDataSupplement){MI8.mixAbsorber(data);data.absorb(this.evtDataSupplement);}
return data;}
EXCBTT.prototype.invoke=function(l,rule,evt){if(this.supportsListener(l)){var lFcn=l["on"+this.name];if(lFcn&&typeof lFcn=="function"){l["on"+this.name](this.getData(rule,evt));}
if(this.aliases){for(var idx=0;idx<this.aliases.length;idx++){var aliasEvt=this.aliases[idx];lFcn=l[aliasEvt.name];if(lFcn&&typeof lFcn=="function"){try{var s=MI8.JSON.stringify(aliasEvt.getEvtData(rule,evt));var sName=MI8.JSON.stringify(aliasEvt.name);var label4l="_inq_el_"+(Math.round(Math.random()*982451653)).toString(36);win[label4l]=l;var code="(parent)."+label4l+"["+sName+"]("+s+")";eval(code);try{win[label4l]=null;delete win[label4l];}catch(e){}}catch(err){err["within"]="EXCBTT.invoke";var sErr=catchFormatter(err);log("Error while calling the client side listeners"+decodeURIComponent(sErr));logMessageToTagServer("Failure in EXCBTT invoke "+sErr,LOG_LEVELS.INFO);}}}}}};EXCBTT.prototype.toString=function(){return"EXCBTT "+this.name;};MI8.prepare(EXCBTT).im13(MI8.XJA3).im13(MI8.Cloneable);EXCBTT.prototype.clone=function(){return new EXCBTT(this);};function EMRTQ5(id){this._frameworkModule(id);this._observable();this.initialized=false;this.observables=[];this.cEvts={};this.init=function(){if(!this.initialized){this.initialized=true;}};this.addObservables=function(o){if(o){for(var idx in o){if(o[idx].observable&&o[idx]!=this){this.observables.push(o[idx]);}}}};this.start=function(){if(this.started){return;}
this.started=true;};this.addListeners=function(list){if(list&&list.length){for(var i=0;i<list.length;i++){this.addListener(list[i]);}}};this.isListener=function(l){for(var cEvtName in this.cEvts){var cEvt=this.cEvts[cEvtName];if(cEvt.supportsListener(l)){return true;}}
return false;};}
EMRTQ5.prototype.addCustomEvent=function(customEvt){if(customEvt&&!this.cEvts[customEvt.name]){this.cEvts[customEvt.name]=customEvt;}};EMRTQ5.prototype.addCustomEvents=function(customEvtsArr){if(customEvtsArr){for(var idx=0;idx<customEvtsArr.length;idx++){this.addCustomEvent(customEvtsArr[idx]);}}};EMRTQ5.prototype.getCustomEvent=function(name){return this.cEvts[name];};EMRTQ5.prototype.removeCustomEvent=function(customEvt){if(customEvt)
delete this.cEvts[customEvt.name];};EMRTQ5.prototype.fireCustomEvent=function(eventName,rule,evt,evtDataSupplementFcn,context){if(!!context&&CHM.isPersistentWindow()){try{parent.opener.Inq.fireCustomEvent(eventName,evt,rule);}catch(err){log("failed to fire custom event \""+eventName+"\" from persistent window: "+err);}}else{var cEvt=this.cEvts[eventName];if(cEvt){if(evtDataSupplementFcn){cEvt=cEvt.clone();if(typeof evtDataSupplementFcn==='function'){cEvt["evtDataSupplement"]=evtDataSupplementFcn(rule,evt);}else{cEvt["evtDataSupplement"]=eval("("+evtDataSupplementFcn+")()");}}
this._fireEvt(function(l,evt){if(l){cEvt.invoke(l,rule,evt);}},evt);return;}
throw("UnsupportedEventError: "+eventName);}};EMRTQ5.prototype.fireManualInvocationEvent=function(rule){BRM.fireManualInvocationEvent(rule);};MI8.prepare(EMRTQ5).im13(MI8.FM2).im13(MI8.Observable);EMRTQ5.prototype.addListener=function(l){if(l){for(var i=0;i<this.observables.length;i++){this.observables[i].addListener(l);}
if(this.isListener(l)){this._listeners.push(l);}}};EMRTQ5.prototype.toString=function(){return"EMRTQ5(\""+this._id+"\")";};function G3RE12(id,data){this._frameworkModule(id);this._observable();this.initialized=false;this.page=null;this.quickCGIndex={};var cgIndex=0;this.reinitialized=false;this.absorb(data);for(var cgId in this.contentGroups){this.contentGroups[cgId]=CG.c(this.contentGroups[cgId]);this.quickCGIndex[cgId]=cgIndex++;}}
MI8.prepare(G3RE12).im13(MI8.FM2).im13(MI8.XJA3).im13(MI8.Observable).im13(MI8.Persistable);G3RE12.prototype.getData=function(){return MI8.clonize({pageMarker:this.getPageMarker(),pageID:this.getPageID(),pageURL:this.getCurrentPageURL(),landingHistory:this.getLandingHistory()}).clone();};G3RE12.prototype.init=function(doReinit){if(!!doReinit){this.page=null;this.reinitialized=true;}
if(!this.initialized){this.stateVar=new VBER34(this.getID(),{lh:[]},resources["state"]);this.stateVar.init();this.load();}
this.initialized=true;if(this.page==null){var orID=Inq.overridePageID;if(orID>0){this.page=(this.pages[orID]?this.pages[orID]:null);}
else if(v3Lander.isRplMode){this.page=win.v3Lander.getPage();}
else{this._resolvePage();}}
this.pageFound=(this.page!=null);};G3RE12.prototype._resolvePage=function(){var pages=this.pages;var pageURL=win.location.href;for(var i in pages){var re=pages[i].re;var caseInsensitive=false;if(re.indexOf("(?i)")===0){re=re.substr(4);caseInsensitive=true;}
var r=new RegExp(re,caseInsensitive?"i":undefined);var mat=r.exec(pageURL);if(!!mat&&mat[0]==pageURL){this.page=pages[i];break;}}};G3RE12.prototype.getCurrentPageURL=function(){try{return CHM.isPersistentWindow()?top.opener.location.href:win.location.href;}catch(e){return win.location.href;}};G3RE12.prototype.getPageMarker=function(idx){var p=null;if(CHM.isPersistentWindow()){try{p=window.parent.opener.inqFrame.Inq.LDM.getPage(idx);}catch(err){logMessageToTagServer("Can't get opener page marker data for ChatID = "+CHM.getChatID()+". CustomerID = "+getCustID(),LOG_LEVELS.WARN);}}
if(!p){p=this.getPage(idx);}
return p?p.mID:"unmarked page";};G3RE12.prototype.getPageID=function(idx){var p=null;if(CHM.isPersistentWindow()){try{p=window.parent.opener.inqFrame.Inq.LDM.getPage(idx);}catch(err){logMessageToTagServer("Can't get opener page id data for ChatID = "+CHM.getChatID()+". CustomerID = "+getCustID(),LOG_LEVELS.WARN);}}
if(!p){p=this.getPage(idx);}
return p?p.id:-1;};G3RE12.prototype.getPage=function(idx){try{var page=this.lh[idx?idx:0];if(page){var tempPage=this.pages[page.id];if(!isNullOrUndefined(tempPage)){return tempPage;}else{return{id:0,mID:"unmarked page",re:"(.*)"};}}}catch(err){}
return null;};G3RE12.prototype.getPageMarkerById=function(id){var page=this.pages[id];if(page){return page.mID;}else{return"unmarked page";}};G3RE12.prototype.onPageLanding=function(){var pageid;var cgIdsArray;if(this.pageFound){pageid=this.page.id;}else{pageid=-1;}
if(v3Lander.isRplMode&&win.v3Lander.getContentGroupIDs()){cgIdsArray=this.getCorrespondedCGIndexes(win.v3Lander.getContentGroupIDs());}else{cgIdsArray=this.findCorrespondedCG(pageid);}
this.lh.unshift({id:pageid,cg:cgIdsArray});if(this.lh.length>this.qsize){this.lh.length=this.qsize>0?this.qsize:1;}
this.save();};G3RE12.prototype.load=function(){this.absorb(this.stateVar.getValue());};G3RE12.prototype.save=function(){this.stateVar.setValue({lh:this.lh});};G3RE12.prototype.getLandingHistory=function(){var retval=[];for(var idx=0;idx<this.lh.length;idx++){retval[idx]=this.getPageMarker(idx);}
return retval;};G3RE12.prototype.start=function(){this.fireOnPageLandingEvent(this.page);};G3RE12.prototype.pageCheck=function(pageID){if(isNullOrUndefined(this.page)){return false;}else{return this.page.id==pageID;}};G3RE12.prototype.reset=function(){};G3RE12.prototype.fireOnPageLandingEvent=function(dat){function onPageLanding(l,evt){try{if(l.onPageLanding){l.onPageLanding(evt);}}catch(e){log(e);}}
this._fireEvt(onPageLanding,{page:this.page,data:dat,reinitialized:this.reinitialized});};G3RE12.prototype.isListener=function(l){return(l&&l.onPageLanding);};G3RE12.prototype.getPersistentID=function(){return this.getID();};G3RE12.prototype.agrtyer=function(){log("G3RE12#agrtyer");};G3RE12.prototype.findCorrespondedCG=function(pgId){var out=[];var url=this.getCurrentPageURL();var index=0;for(var cgId in this.contentGroups){var cg=this.contentGroups[cgId];if(cg.contains(pgId,url,this.contentGroups)){out[out.length]=index;}
index++;}
return out;};G3RE12.prototype.getCorrespondedCGIndexes=function(cgIDs){var out=[];for(var i=0;i<cgIDs.length;i++){out.push(this.quickCGIndex[cgIDs[i]]);}
return out;};G3RE12.prototype.checkCG=function(cgID,optPgIdx){var page=this.lh[optPgIdx&&optPgIdx<this.lh.length?optPgIdx:0];var cgIndex=this.quickCGIndex[cgID];if(isNullOrUndefined(cgIndex)||isNullOrUndefined(page)){return false;}
var passedCG=page.cg;for(var index=0;index<passedCG.length;index++){if(passedCG[index]==cgIndex){return true;}}
return false;};G3RE12.prototype.getCGBusinessUnits=function(){var result=[];for(var cg in this.contentGroups){var buIDs=null;if(this.contentGroups[cg].contains(this.getPageID(),this.getCurrentPageURL(),this.contentGroups)){buIDs=this.contentGroups[cg].getBusinessUnits();if(buIDs){for(var i=0;i<buIDs.length;i++){result.push(buIDs[i]);}}}}
return result;};function G3RE13(id,data,disableMutationObservation){this._frameworkModule(id);this._observable();this._counter=0;this._isSuspending=false;this._maxAllowedEventsPerSeconds=5;this._delayInMS=50;this._lastDomMutationTime=0;this._oneSecond=1000;this._domRules=[];var rulesIndexes={};var _brMgr=this;function onDomMutation(mutations){if(_brMgr._isSuspending){return;}
var curTime=new Date();if(_brMgr._lastDomMutationTime===0){_brMgr._lastDomMutationTime=curTime;}
var diffTime=curTime-_brMgr._lastDomMutationTime;_brMgr._counter++;if(diffTime<_brMgr._oneSecond){if(_brMgr._counter>_brMgr._maxAllowedEventsPerSeconds){_brMgr._suspend();return;}}else{_brMgr._counter=0;_brMgr._lastDomMutationTime=curTime;}
_brMgr.onDomMutation(mutations);}
if(!!window.MutationObserver&&!disableMutationObservation){domObserver=new MutationObserver(onDomMutation);domObserver.observe(doc.body,{childList:true,subtree:true,attributes:true});doc.body.setAttribute('data-inq-observer','1');}
if(data&&data.rules){for(var i=0;i<data.rules.length;i++){var r=data.rules[i];if(r.hasDomTrigger){this._domRules.push(r);}
var id=r.getID();var overridableRuleInd=rulesIndexes[id];if(overridableRuleInd==undefined){rulesIndexes[id]=i;}else{data.rules[overridableRuleInd]=r;data.rules.splice(i,1);i--;}}}
this.absorb(data);this._varTable={};this._rulesById={};this._ruleIds=[];this._bActionable=true;if(data&&data.rules){for(var i=0;i<data.rules.length;i++){var r=data.rules[i];this._varTable[r.getID()]=r.getVars();this._rulesById[r.getID()]=r;this._ruleIds[i]=r.getID();}}
this.addGlobalRuleAttributes=function(){var ruleIdsToProcess=[];if(this.globalRAtts.brIds){ruleIdsToProcess.append(this.globalRAtts.brIds);}else{if(this.globalRAtts.exclude){for(var i=0;i<this._ruleIds.length;i++){var rId=this._ruleIds[i];if(!this.globalRAtts.exclude.contains(rId)){ruleIdsToProcess.push(rId);}}}else{ruleIdsToProcess.append(this._ruleIds);}}
for(var i=0;i<ruleIdsToProcess.length;i++){var rId=ruleIdsToProcess[i];var r=this.getRuleById(rId);if(r&&r.addRuleAttributes){r.addRuleAttributes(this.globalRAtts.atts);}}};if(this.globalRAtts){this.addGlobalRuleAttributes();}
this.getRules=function(){return this.rules;};this.start=function(){if(this.started){return;}
this.started=true;};this.init=function(reinitialize){if(this.initialized&&!reinitialize){return;}
for(var i=0;i<this.getRules().length;i++){this.getRules()[i].init();}
this.initialized=true;log(this.getID()+" initialized.");};this.load=function(){};this.save=function(){};this.agrtyer=function(){};this.reset=function(){for(var i=0;i<this.rules.length;i++){this.rules[i].reset();}};this._suspend=function(){_brMgr._isSuspending=true;return window.setTimeout(function(){_brMgr._counter=0;_brMgr._isSuspending=false;_brMgr._lastMutationEventTime=new Date();},_brMgr._delayInMS);};}
MI8.prepare(G3RE13).im13(MI8.Persistable).im13(MI8.XJA3).im13(MI8.FM2);G3RE13.im13(MI8.Observable);G3RE13.prototype.getData=function(){return{qBRs:this.getQualifiedBusinessRules(),rules:this.getRules()};};G3RE13.prototype.resetForReinit=function(){for(var i=0;i<this.rules.length;i++){var triggers=this.rules[i].triggersFcn(this.rules[i]);for(var j=0;j<triggers.length;j++){var trig=triggers[j];var elArray=[];var el;if(trig.domElementID){el=doc.getElementById(trig.domElementID);if(!!el)elArray[0]=el;}else if(trig.domElements){for(var idx=0;idx<trig.domElements.length;idx++){elArray.append(trig.domElements[idx]);}}
for(var k=0;k<elArray.length;k++){el=elArray[k];if(!isNullOrUndefined(el)){el["tcRuleIDs"]=null;}}}}};G3RE13.prototype.getPersistentID=function(){return this.getID();};G3RE13.prototype.getQualifiedBusinessRules=function(noShallowCopy){var sc=!noShallowCopy;return this._collect(function(rule){if(rule.isBR()&&rule.areConditionalsMet()){return sc?MI8.clonize(rule).clone():rule;}});};G3RE13.prototype.onDomMutation=function(mutations){var nodesAdded=mutations.some(function(mutation){return(mutation.addedNodes.length>0);},this);var attrChanged=mutations.some(function(mutation){return((!!mutation.attributeName)?mutation.attributeName.length>0:false);},this);if(nodesAdded||attrChanged){this.refreshDomRules();}};G3RE13.prototype.refreshDomRules=function(){this._domRules.forEach(function(rule){rule.reattachDomTriggers();});};G3RE13.prototype._collect=function(fcn){var retcol=[];if(isNullOrUndefined(fcn)||typeOf(fcn)!="function"){throw new Error("Illegal Argument: expected a function, got "+(typeof fcn));}
for(var i=0;i<this.rules.length;i++){var rule=this.rules[i];var val=fcn(rule,i);if(!isNullOrUndefined(val)){retcol[retcol.length]=val;}}
return retcol;};G3RE13.prototype.getRuleVarTable=function(){return this._varTable;};G3RE13.prototype.getRuleByName=function(ruleName){var rule=null;for(var i=0;i<this.rules.length;i++){if(this.rules[i].getName()===ruleName){rule=this.rules[i];break;}}
return rule;};G3RE13.prototype.getRuleById=function(ruleId){return this._rulesById[ruleId];};G3RE13.prototype.setActionable=function(bActionable){this._bActionable=bActionable;};G3RE13.prototype.isControlGroup=function(){return!this._bActionable;};G3RE13.prototype.fireManualInvocationEvent=function(rule){var evt={};if(!isNullOrUndefined(rule)&&rule.onManualInvocation){rule.onManualInvocation(evt);}};G3RE13.prototype.fireRuleSatisfiedEvent=function(rule){var event={rule:rule};function f(l,evt){try{if(l.onRuleSatisfied){l.onRuleSatisfied(evt);}}catch(e){log("Error firing event onRuleSatisfied on "+l.toString()+": \n"+e);}}
this._fireEvt(f,event);};G3RE13.prototype.fireServiceInvitationEvent=function(rule,serviceType){var event={rule:rule,serviceType:serviceType};function f(l,evt){try{if(l.onServiceInvitation){l.onServiceInvitation(evt);}}catch(e){log("Error firing event onServiceInvitation on "+l.toString()+": \n"+e);}}
this._fireEvt(f,event);};G3RE13.prototype.fireServiceEngagedEvent=function(eventData){var outRule=null;try{outRule=this.getRuleById(eventData.brID)}
catch(e){log("error "+e)}
if(isNullOrUndefined(outRule)){outRule={id:eventData.brID};}
var event={rule:outRule};function f(l,evt){try{if(l.onServiceEngaged){l.onServiceEngaged(evt);}}catch(e){log("Error firing event onServiceEngaged on "+l.toString()+": \n"+e);}}
this._fireEvt(f,event);};G3RE13.prototype.fireServiceInteractedEvent=function(eventData){var event={rule:{id:eventData.brID}};function f(l,evt){try{if(l.onServiceInteracted){l.onServiceInteracted(evt);}}catch(e){log("Error firing event onServiceInteracted on "+l.toString()+": \n"+e);}}
this._fireEvt(f,event);};G3RE13.prototype.fireServiceMissedEvent=function(rule,serviceType){var event={rule:rule,serviceType:serviceType};function f(l,evt){try{if(l.onServiceMissed){l.onServiceMissed(evt);}}catch(e){log("Error firing event onServiceMissed on "+l.toString()+": \n"+e);}}
this._fireEvt(f,event);};G3RE13.prototype.fireExposureQualifiedEvent=function(eventData){var event=eventData;function f(l,evt){try{if(l.onExposureQualified){l.onExposureQualified(evt);}}catch(e){log("Error firing event onExposureQualified on "+l.toString()+": \n"+e);}}
this._fireEvt(f,event);};G3RE13.prototype.isListener=function(l){var bListener=false;if(l&&(l.onRuleSatisfied||l.onServiceInvitation||l.onServiceEngaged||l.onServiceInteracted||l.onServiceMissed||l.onExposureQualified)){bListener=true;}
return bListener;};G3RE13.prototype.logExposureResult=function(exposureData,chatType){var isReactive=!!(chatType==CHM.CHAT_TYPES.C2C);var agID=exposureData.agID?", agID="+exposureData.agID:"";var msgData="siteID="+exposureData.siteID+", custID="+exposureData.customerID+", pageID="+exposureData.pageID+", brID="+exposureData.brID+agID+", buID="+exposureData.buID;if(exposureData.result==this.EXPOSURE_QUALIFIED_RESULT.OUT_HOP){isReactive?log("Callback: MISSED OPP: Outside of business hours for C2C "+msgData):log("No Proactive Launch: Out of hours "+msgData);}else if(exposureData.result==this.EXPOSURE_QUALIFIED_RESULT.NO_AVAILABILITY){log("No agents available "+msgData);}else if(exposureData.result==this.EXPOSURE_QUALIFIED_RESULT.WILL_OFFER){log("Agents available "+msgData);}}
G3RE13.prototype.EXPOSURE_QUALIFIED_RESULT={OUT_HOP:"out_hop",NO_AVAILABILITY:"no_availability",EXISTING_OFFER:"existing_offer",WILL_OFFER:"will_offer"};function Trigger(id,delayInMS){this.id=id;this.delayInMS=delayInMS?delayInMS:null;}
function Rule(data){this.constants={};this.absorbFields(data);}
Rule.prototype.absorbFields=function(data){this.triggerMet=false;this.absorb(data);this.vtable={};if(data&&data.vars){for(var i=0;i<data.vars.length;i++){this.vars[i]=VBER34.getInstanceFromData(data.vars[i]);this.vtable[this.vars[i].getName()]=this.vars[i];}}
this.doActions=this.actionFcn;};MI8.prepare(Rule).im13(MI8.JSON).im13(MI8.XJA3);Rule.create=function(data){return new Rule(data);};Rule.prototype.getID=function(){return this.id;};Rule._delayedRules={};Rule._timers=[];Rule._TIDX=0;Rule._setTimeout=function(rule,delayInMS){var tidx=Rule._TIDX++;Rule._delayedRules[tidx]=rule;this.tidx=tidx;return window.setTimeout(function(){Inq.Rule._timerCallback(tidx);},delayInMS);};Rule._timerCallback=function(tidx){Rule._popDelayedRule(tidx).timerCallback();};Rule._popDelayedRule=function(tidx){var rule=Rule._delayedRules[tidx];delete Rule._delayedRules[tidx];return(rule?rule:null);};Rule.prototype.sleep=function(delayInMS){this.tid=Rule._setTimeout(this,delayInMS);};Rule.prototype.reset=function(){Rule._popDelayedRule(this.tidx);};Rule.prototype.fireRule=function(evt,delayInMS){this.evt=evt;this.triggerMet=true;if(delayInMS>0){this.sleep(delayInMS);}else{this.execute(evt);}};Rule.prototype.getName=function(){return this.name;};Rule.prototype.init=function(data){if(!this.triggersFcn){log("ERROR: Rule+("+this.id+")["+this.name+"] was set without triggers. Rule will not execute.");return;}else if(typeOf(this.triggersFcn)=='function'){this.triggers=this.triggersFcn(this);}
for(var idx=0;idx<this.triggers.length;idx++){var trig=this.triggers[idx];if(trig.domElementID||trig.domElements){initRule[this.getID()]=true;this._processDomTrigger(trig,true);}
else if(trig.serviceType){this._processSvcTrigger(trig);}
else{this._processStdTrigger(trig);}}};Rule.prototype.reattachDomTriggers=function(){var triggers=this.triggersFcn(this);triggers.forEach(function(trig){this._processDomTrigger(trig,false);},this);};Rule.prototype._processStdTrigger=function(trig){var atrig=trig;this[trig.id]=function(evt){this.fireRule(evt,atrig.delayInMS);};};Rule.prototype._processDomTrigger=function(trig,init){var elArray=[];if(trig.domElementID){var el=doc.getElementById(trig.domElementID);if(!!el)elArray[0]=el;}else if(trig.domElements){for(var idx=0;idx<trig.domElements.length;idx++){elArray.append(trig.domElements[idx]);}}
if(elArray.length>0){var r=this;if(initRule[this.getID()]){for(var i=0;i<elArray.length;i++){var el=elArray[i];if(!isNullOrUndefined(el)){if(isNullOrUndefined(el["tcRuleIDs"]))el["tcRuleIDs"]=[];var ruleIDs=el["tcRuleIDs"];if(init||(!ruleIDs.contains(this.getID()))){if(trig.id=="mousehover"){attachListener(el,"mouseover",function(evt){var hoverTime=trig.hoverTime?trig.hoverTime:15000;r.startHover=window.setTimeout('inqFrame.Inq.BRM.getRuleById('+r.getID()+').fireRule('+MI8.JSON.stringify(evt)+','+trig.delayInMS+')',hoverTime);});attachListener(el,"mouseout",function(evt){window.clearTimeout(r.startHover);});}else{attachListener(el,trig.id,function(evt){r.fireRule(evt,trig.delayInMS);});}
el["tcRuleIDs"].push(this.id);}}}}}};Rule.prototype.log=function(msg,e){log("Rule #"+this.id+"("+this.name+"): "+msg+(e?"-> error="+e:""));};Rule.prototype._processSvcTrigger=function(trig){var svcTypes=this[trig.id+"_ServiceTypes"];var trigServiceType=trig.serviceType;if(isNullOrUndefined(svcTypes)){svcTypes=this[trig.id+"_ServiceTypes"]=[trigServiceType];this[trig.id]=function(evt){var evtServiceType=evt.chatType;if(svcTypes.contains(evtServiceType)||svcTypes.contains("ALL")){this.fireRule(evt,trig.delayInMS);}};}else{if(!svcTypes.contains(trigServiceType)&&!svcTypes.contains("ALL")){svcTypes.push(trigServiceType);}}};Rule.prototype.isWithinDateRange=function(){var inRange=true;if(!!this.dates){var now=new Date();var start=!!this.dates.start?this.dates.start:new Date(0);var end=!!this.dates.end?this.dates.end:new Date(now.getTime()+1);inRange=now.after(start)&&now.before(end);}
return inRange;};Rule.prototype.areConditionalsMet=function(){return(this.conditionalFcn(this,this.evt)&&this.triggerMet&&this.isWithinDateRange());};Rule.prototype.timerCallback=function(){this.execute();};Rule.prototype.getConstant=function(cID){if(isNullOrUndefined(this.constants[cID])){return constants[cID];}
return this.constants[cID];};Rule.prototype.execute=function(){try{if(this.active&&this.areConditionalsMet()){this.doActions(this,this.evt);}}catch(e){logActionErr(e,this);}};Rule.prototype.assertTrue=function(bfcn,testName,failmsg){var msg="ASSERT: "+this.getName()+" - "+testName+": ";try{var b=bfcn();msg+=b?"PASSED":("FAILED. "+failmsg);if(!b){msg="*** "+msg;}}catch(err){msg+=("FAULT: "+err);}
ROM.send(urls.loggingURL,{level:"info",line:msg});log(msg);};Rule.prototype.getVars=function(){return this.vars;};Rule.prototype.toString=function(){return"Rule "+this.getID()+" \""+this.name+"\"";};Rule.prototype.isBR=function(){return false;};function BusinessRule(data){this.constants={};this.absorbFields(data);if(!!this.ignoreFunnelLevel){this.constants["ifl"]=true;this.constants["fl"]=Number.NEGATIVE_INFINITY;}
else if(!isNullOrUndefined(this.funnelLevel)){if(isNullOrUndefined(this.constants["fl"]))
this.constants["fl"]=this.funnelLevel;}}
BusinessRule.prototype=new Rule();BusinessRule.prototype.constructor=BusinessRule;BusinessRule.create=function(data){return new BusinessRule(data);};MI8.prepare(BusinessRule).im13(MI8.Observable).im13(MI8.RC54);BusinessRule.prototype.isBR=function(){return true;};BusinessRule.prototype.execute=function(){try{if(this.active&&this.areConditionalsMet()){if(!!this.ruleType&&(getBlockedServicesList().contains(this.ruleType)||((this.ruleType==CHM.CHAT_TYPES.POPUP||this.ruleType==CHM.CHAT_TYPES.POPUP_CALL)&&this.constants["fl"]>PM.getVar("cfl").getValue()))){return;}
BRM.fireRuleSatisfiedEvent(this);var incr_exclude=this.getRuleAttributeValue("incr_exclude")=="yes";if(!BRM.isControlGroup()||incr_exclude){this.doActions(this,this.evt);}else{var dataMap={buID:this.getBusinessUnitID(),siteID:Inq.getSiteID(),brID:this.getID(),agentAttributes:MI8.JSON.stringify(this.getAgentAttributes())};this.callRemote(Inq.urls.agentsAvailabilityCheckURL,dataMap);}}}catch(e){logActionErr(e,this);}};BusinessRule.prototype.onRemoteCallback=function(jsonData){var result=null;if(jsonData.inHOP==="true"){if(jsonData.availability==="true"){result=BRM.EXPOSURE_QUALIFIED_RESULT.WILL_OFFER;}else{result=BRM.EXPOSURE_QUALIFIED_RESULT.NO_AVAILABILITY;}}else{result=BRM.EXPOSURE_QUALIFIED_RESULT.OUT_HOP;}
try{var exposureData={siteID:Inq.getSiteID(),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:this.id,group:PM.getVar("incGroup").getValue(),businessUnitID:this.getBusinessUnitID(),result:result,rule:this};BRM.fireExposureQualifiedEvent(exposureData);}catch(e){logErrorToTagServer("Error onRemoteCallback for control group customer : "+e);}};BusinessRule.prototype.toString=function(){return"BusinessRule "+this.getID()+" \""+this.name+"\"";};Rule.prototype.getBusinessUnitID=function(){var buID;if(!isNullOrUndefined(this.getBusinessUnitIdFromRule)){buID=this.getBusinessUnitIdFromRule();}else if(!isNullOrUndefined(this.businessUnitID)){buID=this.businessUnitID;}
else{buID=getDefaultBusinessUnitID();}
log("Rule#getBusinessUnitId(ruleid="+this.getID()+"): business-unit-id="+buID);return buID;};BusinessRule.prototype.attrNamesEqual=function(attr1,attr2){return(attr1&&attr2&&attr1.name&&attr2.name&&(attr1.name==attr2.name));};BusinessRule.prototype.getAgentAttributes=function(){return this.getAAtts();};BusinessRule.prototype.setAgentAttributes=function(attribs){this.aAtts=attribs;};BusinessRule.prototype.containsAgentAttribute=function(attribute){return this.getAAtts().contains(attribute,BusinessRule.prototype.attrNamesEqual);};BusinessRule.prototype.addAgentAttribute=function(attribute){var attsArray=this.getAAtts();var isRemove=attribute.value=='';if(isRemove){this.removeAgentAttribute(attribute);return;}
if(!this.containsAgentAttribute(attribute)){attsArray.append([attribute]);}else{for(var idx=0;idx<attsArray.length;idx++){if(this.attrNamesEqual(attsArray[idx],attribute)){attsArray[idx].value=attribute.value;}}}};BusinessRule.prototype.removeAgentAttribute=function(attribute){var attsArray=this.getAAtts();if(this.containsAgentAttribute(attribute)){for(var idx=0;idx<attsArray.length;idx++){if(this.attrNamesEqual(attsArray[idx],attribute)){attsArray.remove(idx);break;}}}};BusinessRule.prototype.addAgentAttributes=function(attributes){for(var idx=0;idx<attributes.length;idx++){this.addAgentAttribute(attributes[idx]);}};BusinessRule.convertToAttributeString=function(data){if(isNullOrUndefined(data)){return null;}
var out="";for(var index=0;index<data.length;index++){if(index>0){out+=";";}
out+=data[index].name+","+data[index].value;}
return out;}
BusinessRule.prototype.getAgentAttributesAsString=function(){if(!this.getAgentAttributes){log("Only BusinessRule can have agent attributes.");return null;}
return BusinessRule.convertToAttributeString(this.getAgentAttributes());};BusinessRule.prototype.getRuleAttributesAsString=function(){if(!this.getRuleAttributes){log("Only BusinessRule can have rule attributes.");return null;}
return BusinessRule.convertToAttributeString(this.getRuleAttributes());};BusinessRule.prototype.getRuleAttributes=function(){return this.getRAtts();};BusinessRule.prototype.setRuleAttributes=function(attribs){this.rAtts=attribs;};BusinessRule.prototype.getRuleAttributesAsArray=function(){return this.rAtts;};BusinessRule.prototype.getRuleAttributeValue=function(attName){var rAtt=this.getRuleAttribute(attName);return(!!rAtt&&!!rAtt.value)?rAtt.value:null;};BusinessRule.prototype.containsRuleAttribute=function(attribute){return this.getRuleAttributesAsArray().contains(attribute,BusinessRule.prototype.attrNamesEqual);};BusinessRule.prototype.getRuleAttribute=function(attName){var rAtts=this.getRuleAttributes();for(var ix=0;ix<rAtts.length;ix++){if(rAtts[ix].name==attName){return rAtts[ix];}}
return null;};BusinessRule.prototype.addRuleAttribute=function(attribute){if(!this.rAtts)this.rAtts=[];var attsArray=this.getRuleAttributesAsArray();if(!this.containsRuleAttribute(attribute)){attsArray.append([attribute]);}else{for(var idx=0;idx<attsArray.length;idx++){if(this.attrNamesEqual(attsArray[idx],attribute)){attsArray[idx].value=attribute.value;}}}};BusinessRule.prototype.addRuleAttributes=function(attributes){for(var idx=0;idx<attributes.length;idx++){this.addRuleAttribute(attributes[idx]);}};BusinessRule.prototype.getPriority=function(){return this.priority;};BusinessRule.prototype.getStartDate=function(){var start=null;if(this.dates&&this.dates.start){start=this.dates.start;}
return start;};BusinessRule.prototype.getEndDate=function(){var end=null;if(this.dates&&this.dates.end){end=this.dates.end;}
return end;};BusinessRule.prototype.getLanguage=function(){var language;if(!isNullOrUndefined(this._getLanguage)){try{language=this._getLanguage(this);}catch(e){language=getDefaultLanguage();log("Error while getting language from the given Rule: \n"+e+"\n");}}else{language=getDefaultLanguage();}
return language;};BusinessRule.prototype.getAgentGroupID=function(){var agentGroupID;if(!!this.getAgID){agentGroupID=this.getAgID();}else if(!!this.agID){agentGroupID=this.agID;}else{agentGroupID=!!getDefaultAgentGroupId()?getDefaultAgentGroupId():undefined;}
return agentGroupID;};BusinessRule.prototype.getUniqueAgentName=function(){if(!!this.getAgentName&&!!this.getAgentName()){return this.getAgentName();}
return undefined;};BusinessRule.prototype.getFunnelLevel=function(){return this.funnelLevel;};var Schedule=(function(){function Schedule(id,periodStart,periodEnd,startTime,endTime,days,timezone){this.id=id;this.periodStart=periodStart;this.periodEnd=periodEnd;this.startTime=startTime;this.endTime=endTime;this.days=days;this.isScheduleMet=function(){return false;};if(typeof timezone=='undefined'){this.isScheduleMet=isScheduleMetCur;}
else{this.timezone=timezone;scheduleTZs[this.timezone]=0;this.isScheduleMet=isScheduleMetNew;}
function isScheduleMetCur(dt,clientTimeLag,siteTzOfstMillis){var result=true;if(clientTimeLag)dt.roll(clientTimeLag);if(this.periodStart)result=dt.after(this.periodStart)||dt.equals(this.periodStart);if(result&&this.periodEnd)result=dt.before(this.periodEnd)||dt.equals(this.periodEnd);if(result&&this.days&&!this.days.isEmpty()){if(!siteTzOfstMillis)siteTzOfstMillis=0;var dtToGetSiteDay=new Date(dt.getTime()+dt.getTimezoneOffset()*60000-siteTzOfstMillis);var currentDayAtSite=dtToGetSiteDay.getDay();result=this.days.contains(currentDayAtSite);}
if(result&&(this.startTime||this.endTime)){var DAY_MILLISEC=24*60*60*1000;var msSinceBOD,dtSrvTime=dt.getTime();if(!siteTzOfstMillis){siteTzOfstMillis=0;}
if(!this.startTime){this.startTime=new Date(siteTzOfstMillis);}
if(!this.endTime){this.endTime=new Date(this.startTime.getTime()+DAY_MILLISEC-siteTzOfstMillis);}
msSinceBOD=dtSrvTime%DAY_MILLISEC;if(this.endTime.getTime()>DAY_MILLISEC){if(msSinceBOD<=(this.endTime.getTime()-DAY_MILLISEC)){msSinceBOD+=DAY_MILLISEC;}}
if(this.startTime)result=msSinceBOD>=this.startTime.getTime();if(result&&this.endTime)result=msSinceBOD<=this.endTime.getTime();}
return result;}
function isScheduleMetNew(dt,clientTimeLag){var result=true;if(clientTimeLag)dt.roll(clientTimeLag);result=Schedule.checkPeriod(dt,this);if(result){if(this.days&&!this.days.isEmpty()){result=Schedule.checkDays(dt,this);}}
if(result){result=Schedule.checkTime(dt,this);}
return result;}}
Schedule.prototype.setScheduleDate=function(dt){this.scheduleDate=new Date(dt.getTime());this.scheduleDate.roll(Schedule.getOffsetDiff(this.tzOffset,Schedule.getTimezoneOffsetMilli(dt)));}
Schedule.checkPeriod=function(dat,schedule){var result=true;if(schedule.periodStart&&typeof schedule.periodStart.getTime=="function")result=dat.after(schedule.periodStart)||dat.equals(schedule.periodStart);if(result&&schedule.periodEnd&&typeof schedule.periodEnd.getTime=="function")result=dat.before(schedule.periodEnd)||dat.equals(schedule.periodEnd);return result;}
Schedule.checkDays=function(dat,schedule){var result=true;schedule.setScheduleDate(dat);if(schedule.days){var scheduleDateLocalDay=schedule.scheduleDate.getDay();result=schedule.days.contains(scheduleDateLocalDay);}
return result;}
Schedule.checkTime=function(dat,schedule){var result=true;schedule.setScheduleDate(dat);var scheduleTimeInSec=schedule.scheduleDate.getHours()*60*60+schedule.scheduleDate.getMinutes()*60+schedule.scheduleDate.getSeconds();schedule.scheduleTimeInMilSec=scheduleTimeInSec*1000;if(result&&schedule.startTime){result=schedule.scheduleTimeInMilSec>=schedule.startTime;}
if(result&&schedule.endTime){result=schedule.scheduleTimeInMilSec<=schedule.endTime;}
return result;}
Schedule.getTimezoneOffsetMilli=function(dt){return-dt.getTimezoneOffset()*60*1000;}
Schedule.getOffsetDiff=function(offsetSchedule,offsetLocal){return offsetSchedule-offsetLocal;}
return{createSchedule:function(id,periodStart,periodEnd,startTime,endTime,days,timezone)
{return new Schedule(id,periodStart,periodEnd,startTime,endTime,days,timezone);},checkPeriod:Schedule.checkPeriod,checkDays:Schedule.checkDays,checkTime:Schedule.checkTime,getTimezoneOffsetMilli:Schedule.getTimezoneOffsetMilli,getOffsetDiff:Schedule.getOffsetDiff}}())
function C2C(mgr,rule,chatType,specDataFcn,c2p,adaCompliant,adaAndroidC2cSupportDomains){this._mgr=mgr;this._rule=rule;this.chatType=chatType;this.c2cSpec=MM.mergeC2CSpec(specDataFcn(rule));this.specDataFcn=specDataFcn;this.adaCompliant=adaCompliant;this.adaAndroidC2cSupportDomains=adaAndroidC2cSupportDomains;EVM.addListener(this);this.idx=C2C.IDX++;this.clicked=false;this.c2p=c2p;this.pollCount=0;this.pollTime=0;this.oldState=null;this.newState=null;this.parentPositionStyle=null;this.positionChanged=false;this.listeners=[];}
MI8.prepare(C2C).im13(MI8.XJA3).im13(MI8.RC54);C2C.IDX=0;C2C.c2CPageElementIDs=[];C2C.prototype.getIdx=function(){return this.idx;};C2C.prototype.getXmlChatSpec=function(){if(isNullOrUndefined(this._rule)){throw"C2C not ready: rule is undefined";}
var xmlC2cSpec=this.specDataFcn(this._rule);if(!!xmlC2cSpec.chatSpec){return xmlC2cSpec.chatSpec;}
var c2cSpec=MM.mergeC2CSpec(xmlC2cSpec);return{id:c2cSpec.chatSpec.id};};C2C.prototype.onRemoteCallback=function(dat){var setFocus=false;if(!!dat.c2cRedisplayed){BRM.fireRuleSatisfiedEvent(this.getRule());if(dat.c2cRedisplayed&&dat.c2cRedisplayed==true)setFocus=true;}
var exposureData={siteID:Inq.getSiteID(),pageID:isNullOrUndefined(LDM.getPageID())?-1:LDM.getPageID(),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:this._rule.getID(),group:PM.getVar("incGroup").getValue(),buID:this._rule.getBusinessUnitID(),agID:this._rule.getAgentGroupID(),channelID:this._rule.getBusinessUnitID(),result:dat.result,rule:this._rule};if(!this.repolled||(this.repolled&&dat.result!=this.result)){BRM.fireExposureQualifiedEvent(exposureData);BRM.logExposureResult(exposureData,CHM.CHAT_TYPES.C2C);}else{this.skipExposed=true;}
this.absorb(dat);this.show(setFocus);if(this.optDataPass&&!this.optDataPassListening){EVM.addListener({source:this,onAgentAssigned:this.optDataPass});this.optDataPassListening=true;}
if(this.serviceMissedEvent){BRM.fireServiceMissedEvent(this._rule,CHM.CHAT_TYPES.C2C);}
this._mgr.nextRequest(this);};C2C.prototype.showAgentsBusyIcon=function(){this.showImg(this.busyURL);};C2C.prototype.showIcon=function(name,clickable){if(this.c2cSpec.c2cTheme.renderAsHTML){this.showTextButton(name,clickable);}else{this.showImg(name,clickable);}
this.updateContainerStyle();};C2C.prototype.showTextButton=function(html,clickable){var div=this.getDiv();var tabObjects=["img","a","li","input","div","select","button"];var eventName=isIOS()?"ontouchstart":((isIE()&&getBrowserMajorVer()<=7)?'onmouseup':'onclick');var onclicktxt=clickable?(eventName+'=\"inqFrame.Inq.C2CM.agrty('+this.idx+'); return false;\" onmouseover=\"this.style.cursor=\'pointer\'\" tabindex="0"'):'';div.innerHTML='<div '+onclicktxt+'>'+this.c2cSpec.c2cTheme[html]+'</div>';if(div.firstChild!=null){for(var i=0;i<tabObjects.length;i++){if(isTagInElement(div.firstChild,tabObjects[i])===true){div.firstChild.removeAttribute('tabindex');break;}}}
function isTagInElement(element,tag){return(element&&element.getElementsByTagName&&element.getElementsByTagName(tag).length>0);}};C2C.prototype.showImg=function(img,clickable){var div=this.getDiv(),func=null;try{func=div["setSource"];}catch(e){func=null};var c2cModel=MM.getC2CSpec(this.c2cSpec.id);var altText=this.c2cSpec.c2cTheme[img+'alt'];if(typeof altText==='undefined'||altText==null||altText===""){altText=this.c2cSpec.altText?this.c2cSpec.altText:(c2cModel.altText?c2cModel.altText:"Click To Chat");}
var eventName=isIOS()?"ontouchstart":((isIE()&&getBrowserMajorVer()<=7)?'onmouseup':'onclick');var onclicktxt=clickable?(eventName+'=\"'+'inqFrame.Inq.C2CM.agrty('+this.idx+'); return false;\" onmouseover=\"this.style.cursor=\'pointer\'\" alt=\"'+altText+'\" tabindex="0"'):'alt=\"'+altText+'\"';if(!!func){var domain=div["iframeDomain"];onclicktxt='top.top.inqFrame.Inq.C2CM.agrty('+this.idx+'); return false;';var mapAttributes={};mapAttributes["style"]="border-style: none; border-width: 0px;";mapAttributes["alt"]=altText;mapAttributes["tabindex"]="0";if(clickable){mapAttributes["style"]="border-style: none; border-width: 0px; cursor: pointer;";mapAttributes["onclick"]=onclicktxt;}
mapAttributes["src"]=urls.mediaSiteURL+'/images/'+this.c2cSpec.c2cTheme[img];mapAttributes["role"]="button";func(mapAttributes,domain);}
else if((this.c2p||this.adaCompliant)&&clickable){div.innerHTML='<input type="image" role="button" src=\"'+urls.mediaSiteURL+'/images/'+this.c2cSpec.c2cTheme[img]+'\"'+onclicktxt+(this.adaCompliant?' style="cursor:default" ':'')+'/>';if(C2C.DummyC2CBtn.checkCondition(this.adaCompliant,this.adaAndroidC2cSupportDomains)){if(C2C.talkBackDummyC2CBtnAdded==null){C2C.DummyC2CBtn.add(div);}
C2C.DummyC2CBtn.show(div);}
if(this.adaCompliant&&isIOS9()){window.setTimeout(function(){var active=window.parent.document.activeElement;div.firstChild.focus();active.focus();},500);}}
else{div.innerHTML='<img src=\"'+urls.mediaSiteURL+'/images/'+this.c2cSpec.c2cTheme[img]+'\"'+onclicktxt+' style="cursor:default" '+(CHM&&CHM.chat&&CHM.chat._isVisible?'aria-hidden="true" tabindex="-1"':'')+'/>';if(C2C.talkBackDummyC2CBtnAdded==true){C2C.DummyC2CBtn.hide(div);}}};C2C.prototype.showClickToCallHtml=function(urlHtml){var div=this.getDiv();var target=urls.mediaSiteURL+'/images/'+this.c2cSpec.c2cTheme["r"];if(div!=null&&target==div.firstChild["src"]){var frameSource=window.location.protocol+"//"+
window.location.host+((window.location.port=="")?"":":"+window.location.port)+
inqFrame.Inq.v3framesrc;if(inqFrame.Inq.FlashPeer["showCallButton"]==null){inqFrame.Inq.FlashPeer.showCallButton=function(indx,source,left,top,number,show,giveFocus,title){(inqFrame.Inq.C2CM).showCallButton(indx,source,left,top,number,show,giveFocus,title);};}
var iframeName=encodeURIComponent('{id: "'+this.idx+'", clientHtml: "'+frameSource+'"}');div.innerHTML='<iframe width="100%" height="100%" '+'name="'+iframeName+'" '+'border="0" '+'allowTransparency="true" '+'frameborder="0" scrolling="no" '+'src="'+urlHtml+'" '+'></iframe><input type="image" style="display: none;"></input>';}};C2C.prototype.showCallButton=function(source,left,top,number,showButton,giveFocus,title){var callBtnId="tcCallButton";if(giveFocus==null)giveFocus=true;if(title==null)title="Call "+number;if(giveFocus==null)giveFocus=false;if(showButton==null)showButton=true;var div=this.getDiv();div.style.position="relative";var form=document.createElement("form");var inputImage=null;var haveBtn=true;if(inputImage==null&showButton==false)return;var inputImages=div.getElementsByTagName("INPUT");if(inputImages!=null&&inputImages.length>0)
inputImage=inputImages[0];var whenClicked='(inqFrame.Inq.C2CM).agrty('+this.idx+','+number+'); return false;';inputImage.id=callBtnId;inputImage.src=source;inputImage.idx=this.idx;inputImage.fone=number;inputImage.title=title;inputImage.style.cssText="display: "+((showButton)?"":"none")+";position: absolute; left: "+left+"px; top: "+top+"px;";inputImage.onClick=inputImage.onclick=function(){var indx=this.idx;var fon=this.fone;(inqFrame.Inq.C2CM).agrty(indx,fon);return false;};if(giveFocus&&showButton){if(inputImage["focus"]!=null){try{inputImage.focus();}catch(e){}}}};C2C.prototype.setClicked=function(isClicked){this.clicked=isClicked;if(!isNullOrUndefined(C2C.VirtualKeyboardOpenCloseHandler)){C2C.VirtualKeyboardOpenCloseHandler.removeListener();}};C2C.prototype.isClicked=function(){return this.clicked;};C2C.prototype.forceGetDiv=function(){if(!isNullOrUndefined(this.c2cSpec.div)){return this.c2cSpec.div;}
this.pageElementID=!!this.c2cSpec.peId?this.c2cSpec.peId:C2C.c2CPageElementIDs[this.id];var divId=this.pageElementID;return win.document.getElementById(divId);};C2C.prototype.isDivOccupied=function(){var adiv=this.forceGetDiv();if(!adiv){return false;}
return(!!adiv.occupied);};C2C.prototype.getDiv=function(){var div=this.forceGetDiv();div=(!!div&&(!div.occupied||div.ruleID==this._rule.getID()))?div:null;try{if(div!=null&&typeof this.c2cSpec.chatSpec.lang!="undefined"){div.setAttribute("lang",this.c2cSpec.chatSpec.lang);}}catch(err){}
return div;};C2C.prototype.clear=function(){var div=this.getDiv();if(div){div.occupied=false;div.innerHTML="";}};C2C.prototype.reset=function(){this.stopC2CAgentCheckTimer();this.clear();this.clearListeners();};C2C.prototype.show=function(setFocus){var div=this.getDiv();if(!!this.c2cSpec.abs){div.style.position="absolute";div.style.top=this.c2cSpec.abs.y;div.style.left=this.c2cSpec.abs.x;}
var image=this.image;if(CHM.isChatInProgress()){this.launchable=false;image=this._mgr.IMAGETYPES.disabled;}
if(!!div){div.occupied=true;div.ruleID=this._rule.getID();div.idx=this.idx;this.showIcon(image,this.launchable);if(this.newState){this.oldState=this.newState;}
this.newState=C2CM.STATES[image];if(this.newState!=this.oldState){C2CM.fireC2CStateChanged({oldState:this.oldState,newState:this.newState,c2c:this,rule:this._rule,data:this.data});}
if(this.launchable&&!this.skipExposed){C2CM.fireC2CDisplayed({c2c:this,rule:this._rule,data:this.data});BRM.fireServiceInvitationEvent(this._rule,CHM.CHAT_TYPES.C2C);if(!isNullOrUndefined(C2C.VirtualKeyboardOpenCloseHandler)){C2C.VirtualKeyboardOpenCloseHandler.addListener(this.pageElementID);}}
this.skipExposed=false;if(setFocus===true&&((!X43.lastusedC2CId&&X43.c2cBtnId==null&&div.idx===0)||(!X43.lastusedC2CId&&X43.c2cBtnId!=null&&X43.c2cBtnId==div.idx)||(X43.lastusedC2CId&&X43.lastusedC2CId===div.id))){window.setTimeout(function(){var c2cDiv=win.document.getElementById(div.id);if(c2cDiv&&c2cDiv.firstChild){if(c2cDiv.firstChild.getAttribute('tabindex')!==null){c2cDiv.firstChild.focus();}else if(c2cDiv.firstChild.firstChild){if(c2cDiv.firstChild.firstChild.getAttribute('tabindex')===null){c2cDiv.firstChild.firstChild.setAttribute('tabindex',0);}
c2cDiv.firstChild.firstChild.focus();}}
X43.lastusedC2CId=null;},300);}else if(this.launchable&&!this.c2cSpec.c2cTheme.renderAsHTML){X43.c2cBtnId=this.idx;}}
this.pollCount++;if(this.pollCount<this.c2cSpec.aaciPollCount){this.runC2CAgentCheckTimer();}};C2C.prototype.showDisabledIcon=function(){this.launchable=false;if(this.getDiv()){this.showIcon(this._mgr.IMAGETYPES.disabled,this.launchable);}};C2C.prototype.onChatLaunched=function(evt){this.showDisabled(evt);};C2C.prototype.showDisabled=function(evt){this.stopC2CAgentCheckTimer();this.oldState=this.newState;this.newState=C2CM.STATES.d;this.launchable=false;C2CM.fireC2CStateChanged({oldState:this.oldState,newState:this.newState,c2c:this,rule:this._rule,data:this.data});if(this.getDiv()){this.showIcon(this._mgr.IMAGETYPES.disabled,this.launchable);}};C2C.prototype.onChatClosed=function(evt){this.absorb(this.specDataFcn());this.clear();if(evt.evtType===Inq.CHM.EVTS.CLOSED){this.C2CRedisplayed=true;this.request();}
this.C2CRedisplayed=null;this.setClicked(false);};C2C.prototype.request=function(){if(C2CM.isBlocked(this.getChatType())){this.reset();return;}
var rule=this.getRule();var data={siteID:siteID,brID:rule.getID(),brn:rule.getName(),pageID:LDM.getPageID(),chatType:this.chatType,priority:rule.getPriority(),qt:rule.getQueueThreshold(),buID:rule.getBusinessUnitID(),custID:Inq.getCustID(),agID:rule.getAgentGroupID()};if(isNullOrUndefined(data.pageID)){data.pageID=-1;}
if(!isNullOrUndefined(this.c2cSpec.igaa)){data.igaa=this.c2cSpec.igaa;}
if(!isNullOrUndefined(this._rule.getRuleAttributes())){data.rAtts=this._rule.getRuleAttributes();}
if(!isNullOrUndefined(this._rule.getAgentAttributes())){data.aAtts=this._rule.getAgentAttributes();}
if(!!this.c2cSpec.chatSpec&&!isNullOrUndefined(this.c2cSpec.chatSpec.ignHOP)){data.ignHOP=this.c2cSpec.chatSpec.ignHOP;}
if(CHM.isCallServiceType(this.chatType)&&CHM.getLastCallID()){data.lastCallId=CHM.getLastCallID();}
if(!!this.C2CRedisplayed){data.c2cRedisplayed=this.C2CRedisplayed;}
var sData=MI8.JSON.stringify(data);this.callRemote(urls.requestC2CImageURL,{d:sData,xd:Inq.xd});};C2C.prototype.getID=function(){return this.id;};C2C.prototype.getC2cTheme=function(){return this.c2cSpec.c2cTheme;};C2C.prototype.getChatSpec=function(){return this.c2cSpec.chatSpec;};C2C.prototype.hasAbsolutePosition=function(){return!!this.c2cSpec.abs;};C2C.prototype.getPosition=function(){return this.c2cSpec.position;};C2C.prototype.getRule=function(){return this._rule;};C2C.prototype.getChatType=function(){return this.chatType;};C2C.prototype.runC2CAgentCheckTimer=function(){var maxPollTime=Number.MAX_VALUE;if(this.c2cSpec.aaciMaxTime){maxPollTime=this.c2cSpec.aaciMaxTime;}
this.pollTime+=this.c2cSpec.aaci;if(!this.c2cSpec.igaa&&this.c2cSpec.aaci&&(this.c2cSpec.aaci>0)&&(this.pollTime<maxPollTime)){this.repolled=true;this.timeout_id=window.setTimeout("Inq.C2CM.getC2C("+this.getIdx()+").request()",this.c2cSpec.aaci);}};C2C.prototype.stopC2CAgentCheckTimer=function(){if(this.timeout_id)window.clearTimeout(this.timeout_id);this.repolled=false;};C2C.prototype.parseStyle=function(styleText){var style={};var styleList=styleText.split(";");for(var i=0,item;i<styleList.length;i++){item=styleList[i].split(":");if(!item[0])continue;style[item[0].trim()]=item[1]?item[1].trim():"";}
return style;};C2C.prototype.applyStyle=function(element,style){var stylePositionController={stylesMap:{},appliedProperty:[],addProperty:function(name){this.appliedProperty.push(name);},fixKnownStyleIssues:function(element){if(isIE()&&getBrowserMajorVer(true)<=6){if(this.stylesMap["position"]=="fixed"&&this.appliedProperty.indexOf("position")!=-1){element.style["position"]="absolute";}}},clearExcessivePropertyValue:function(element){for(var i=0;i<this.appliedProperty.length;i++){switch(this.appliedProperty[i]){case"top":if(this.appliedProperty.indexOf("bottom")==-1){element.style["bottom"]="";}
break;case"bottom":if(this.appliedProperty.indexOf("top")==-1){element.style["top"]="";}
break;case"left":if(this.appliedProperty.indexOf("right")==-1){element.style["right"]="";}
break;case"right":if(this.appliedProperty.indexOf("left")==-1){element.style["left"]="";}
break;}}}};if(typeof style=="string"){style=this.parseStyle(style);}
stylePositionController.stylesMap=style;for(var prop in style){element.style[prop]=style[prop];stylePositionController.addProperty(prop);}
stylePositionController.clearExcessivePropertyValue(element);stylePositionController.fixKnownStyleIssues(element);};C2C.prototype.isChangePositionNeeded=function(){var docEl=top.document.documentElement;var docRatio=docEl.scrollWidth/docEl.scrollHeight;var screenRatio=screen.width/screen.height;return docRatio>screenRatio;};C2C.prototype.updateIconPositionToInitial=function(){this.applyStyle(this.getDiv(),this.parentPositionStyle);this.positionChanged=false;this.updateIconPositionAfterDelay();};C2C.prototype.updateIconPositionAfterDelay=function(){setTimeout(function(){this.updateIconPosition();}.bind(this),500);};C2C.prototype.updateIconPosition=function(){var element=this.getDiv();var style=copy(this.parentPositionStyle);var rollBackChanges=false;var styleChanged=false;var newTop;if(isAndroidWebView()){if(window.top.pageYOffset<=0){if(isElementOutsideOfViewport(0)){newTop=newTopPosition(0);styleChanged=true;}}else if(this.positionChanged){rollBackChanges=true;}}else{if(this.isChangePositionNeeded()){if(this.positionChanged){if(isElementOutsideOfViewport(0)){newTop=newTopPosition(0);styleChanged=true;}}else if(style["bottom"]!=null&&style["top"]==null){var bottomPosition=parseInt(style["bottom"]);if(!isNaN(bottomPosition)){if(isElementOutsideOfViewport(bottomPosition)){newTop=newTopPosition(bottomPosition);styleChanged=true;}}}}else if(this.positionChanged){rollBackChanges=true;}}
if(styleChanged){style["top"]=newTop+"px";delete style["bottom"];this.applyStyle(element,style);this.positionChanged=true;}else if(rollBackChanges){this.applyStyle(element,this.parentPositionStyle);this.positionChanged=false;}
function isElementOutsideOfViewport(bottom){return element.getBoundingClientRect().bottom+bottom>window.top.document.documentElement.scrollHeight;}
function newTopPosition(bottom){return window.top.document.documentElement.scrollHeight-element.offsetHeight-bottom;}
function copy(object){var out={};for(var k in object){out[k]=object[k];}
return out;}};C2C.prototype.updateContainerStyle=function(){var element=this.getDiv();var child=element?element.children[0]:null;if(child){var styleText=child.getAttribute("data-parent-style");if(child.children[0]&&styleText==null||styleText==""){styleText=child.children[0].getAttribute("data-parent-style");}
if(styleText!=null&&styleText!=""){this.parentPositionStyle=this.parseStyle(styleText);this.applyStyle(element,this.parentPositionStyle);if("Android"==getOSType()&&styleText.contains("position")&&styleText.contains("fixed")){if(isAndroidWebView()){if(this.parentPositionStyle["bottom"]!=null&&this.parentPositionStyle["top"]==null){this.updateIconPosition();this.addListener(window.top,"scroll",this.updateIconPositionAfterDelay.bind(this));}
this.addListener(window.top,"orientationchange",this.updateIconPositionToInitial.bind(this));}else if(isChrome()){if(this.isChangePositionNeeded()){var img=element.getElementsByTagName("img")[0];var inputEl=element.getElementsByTagName("input")[0];if(!img&&inputEl&&inputEl.type=="image"){img=inputEl;}
if(img&&!img.complete){var onloadListener=img.onload;img.onload=function(){if(typeof onloadListener=="function"){onloadListener();}
this.updateIconPosition();}.bind(this);}else{this.updateIconPosition();}}
this.addListener(window.top,"orientationchange",this.updateIconPositionAfterDelay.bind(this));}}}}};C2C.prototype.addListener=function(target,type,listener){attachListener(target,type,listener);this.listeners.push({target:target,type:type,listener:listener})};C2C.prototype.clearListeners=function(){for(var i=this.listeners.length;i--;){detachListener(this.listeners[i].target,this.listeners[i].type,this.listeners[i].listener);}};C2C.setC2CPageElementIDs=function(pageElementIDs){C2C.c2CPageElementIDs=pageElementIDs;};C2C.talkBackDummyC2CBtn=null;C2C.talkBackDummyC2CBtnAdded=null;C2C.VirtualKeyboardOpenCloseHandler={addListener:function(c2CElementId){if(!isNullOrUndefined(inqFrame.Inq.FlashPeer.getDeviceType)&&(inqFrame.Inq.FlashPeer.getDeviceType()==="Phone")&&!isNullOrUndefined(isIOS)&&!isIOS()){var keyboardDetectionThreshhold=200;var c2cId=c2CElementId;this.c2cHandler=function(){var c2cBtn=window.top.document.getElementById(c2cId);if(!isNullOrUndefined(c2cBtn)){var zoomRatio=window.top.screen.width/window.top.innerWidth;var innerHeight=window.top.innerHeight*zoomRatio;var screenHeight=window.top.screen.height;if((screenHeight-innerHeight)>keyboardDetectionThreshhold){c2cBtn.style.display="none";}else{c2cBtn.style.display="block";}}};window.top.addEventListener("resize",this.c2cHandler);}},removeListener:function(){if(!isNullOrUndefined(inqFrame.Inq.FlashPeer.getDeviceType)&&(inqFrame.Inq.FlashPeer.getDeviceType()==="Phone")&&!isNullOrUndefined(isIOS)&&!isIOS()){window.top.removeEventListener("resize",this.c2cHandler);}}};C2C.DummyC2CBtn={checkCondition:function(adaCompliant,adaAndroidC2cSupportDomains){var result=false;try{if(adaCompliant!=true||typeof adaAndroidC2cSupportDomains=="undefined"||adaAndroidC2cSupportDomains.length==0){return;}
if(window.navigator.userAgent.toLowerCase().indexOf("android")>-1){var adaAndroidC2cSupportDomainsArr=adaAndroidC2cSupportDomains.split(',');for(var i=0;i<adaAndroidC2cSupportDomainsArr.length&&result==false;i++){if(parseUrl(inqFrame.location.href).host.toLowerCase()==adaAndroidC2cSupportDomainsArr[i].trim().toLowerCase()){result=true;break;}}}}
catch(err){}
return result;},add:function(divC2C){try{C2C.talkBackDummyC2CBtn=divC2C.cloneNode(true);var divC2CImg=divC2C.getElementsByTagName('input')[0];divC2CImg.setAttribute('tabindex','-1');divC2CImg.setAttribute("aria-hidden","true");C2C.talkBackDummyC2CBtn.id=C2C.talkBackDummyC2CBtn.id+'_talkback';C2C.talkBackDummyC2CBtn.style.width="100%";var btnDummyHome;var footers=top.document.getElementsByTagName('footer');if(footers.length>0){btnDummyHome=footers[0];}
else{btnDummyHome=top.document.body;}
btnDummyHome.appendChild(C2C.talkBackDummyC2CBtn);C2C.talkBackDummyC2CBtnAdded=true;}catch(err){}},show:function(divC2C){if(C2C.talkBackDummyC2CBtn!=null){try{C2C.talkBackDummyC2CBtn.style.display="block";var btnC2CImg=divC2C.getElementsByTagName('input')[0];btnC2CImg.setAttribute('tabindex','-1');btnC2CImg.setAttribute("aria-hidden","true");}
catch(err){}}},hide:function(divC2C){if(C2C.talkBackDummyC2CBtn!=null){try{C2C.talkBackDummyC2CBtn.style.display="none";var btnC2CImg=divC2C.getElementsByTagName('input')[0];btnC2CImg.setAttribute('tabindex','0');btnC2CImg.removeAttribute("aria-hidden");}
catch(err){}}},remove:function(divC2C){if(C2C.talkBackDummyC2CBtn!=null){try{var btnC2CImg=divC2C.getElementsByTagName('input')[0];btnC2CImg.setAttribute('tabindex','0');btnC2CImg.removeAttribute("aria-hidden");C2C.talkBackDummyC2CBtn.parentNode.removeChild(C2C.talkBackDummyC2CBtn);C2C.talkBackDummyC2CBtn=null;C2C.talkBackDummyC2CBtnAdded=null;}
catch(err){}}}};function GR34(id,data){this._className="GR34";this._frameworkModule(id);this._observable();this.pmor=false;this.absorb(data);this.popoutWindow=null;this.persisentWindow=null;this.chat=null;this._init=false;this.chatRequestQ=[];this.requestInProgress=false;this.hasEngaged=false;this.dataLoaded=false;this.evtIdx=0;this.lpt=0;this.earlyPopout=null;this.lastChat={};this.lastCallId=0;this._flashvarFcns=[];this._closeRetries=0;this.retryTimeout=null;}
GR34.CHM=null;GR34.persistentTarget="_inqPersistentChat";GR34.prototype.getInstance=GR34.getInstance=function(data){if(isNullOrUndefined(GR34.CHM)){GR34.CHM=new GR34("CHM",data);}
return GR34.CHM;};GR34.prototype.getData=function(){if(this.isChatInProgress()){return MI8.clonize(this.getChat().getChatData()).clone();}
return null;};GR34.prototype.StopClosingChatFromPersistent=function(){var instance=GR34.getInstance();if(instance.retryTimeout!=null){window.clearTimeout(instance.retryTimeout);instance.retryTimeout=null;}};MI8.prepare(GR34).im13(MI8.FM2).im13(MI8.Observable).im13(MI8.XJA3).im13(MI8.Persistable).im13(MI8.RC54);GR34.prototype.log=function(msg){log("CHM: "+msg);};GR34.prototype.drainRequestQ=function(){for(var i=0;i<this.chatRequestQ.length;i++){var reqDat=this.chatRequestQ[i];var exposureData={siteID:Inq.getSiteID(),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:reqDat.rule.id,group:PM.getVar("incGroup").getValue(),businessUnitID:reqDat.rule.getBusinessUnitID(),result:"existing_offer",rule:reqDat.rule};BRM.fireExposureQualifiedEvent(exposureData);}
this.chatRequestQ=[];};GR34.prototype.request=function(rule,chatType,xmlSpec,phoneNumber,c2cPersistent,chatInProgressHandler){var dat;if(!rule&&this.chatRequestQ.length>0){dat=this.chatRequestQ.shift();rule=dat.rule;chatType=dat.chatType;xmlSpec=dat.xmlSpec;phoneNumber=dat.phoneNumber;c2cPersistent=dat.c2cPersistent;chatInProgressHandler=dat.chatInProgressHandler;this.log("De-queued data for "+rule);}
if(this.isChatInProgress()){this.log("Chat already in progress... rule chat request ignored. rule="+rule.toString());dat=!!dat?dat:{rule:rule};this.chatRequestQ.push(dat);this.drainRequestQ();this.requestInProgress=false;chatInProgressHandler();return;}
if(this.requestInProgress){this.chatRequestQ.push({rule:rule,chatType:chatType,xmlSpec:xmlSpec,phoneNumber:phoneNumber,c2cPersistent:c2cPersistent,chatInProgressHandler:chatInProgressHandler});this.log("CHAT REQUEST ALREADY IN PROGRESS... waiting "+rule.toString());return;}
this.requestInProgress=true;this.log("Requesting chat for rule: "+rule.toString());var c2cToPersistent=c2cPersistent?c2cPersistent:isC2cPersistent();this.chatData={ruleID:rule.getID(),chatType:chatType,xmlSpec:xmlSpec,pn:phoneNumber,pC:false,ci:{},aMsgCnt:0,cMsgCnt:0,c2cToPersistent:c2cToPersistent,buID:-1};if(this.isBlocked(chatType)){return;}
this.rule=rule;if(!!phoneNumber)
this.rule["phoneNumber"]=phoneNumber;this.xmlSpec=xmlSpec;var incGroup=PM.getVar("incGroup").getValue();this.chatType=chatType;var data={p:(GR34.persistentTarget==window.parent.name),xd:PM.isCrossDomain(),siteID:siteID,pageID:LDM.getPageID(),custID:Inq.getCustID(),chatSpec:MM.mergeChatSpec(xmlSpec),chatType:chatType,pmor:this.pmor,rule:{id:rule.getID(),name:rule.getName(),priority:rule.getPriority(),qt:rule.getQueueThreshold(),aAtts:rule.getAgentAttributes(),ruleAttributes:rule.getRuleAttributes(),phoneNumber:phoneNumber,buID:rule.getBusinessUnitID(),agID:rule.getAgentGroupID()},incAssignmentID:getIncAssignmentID(),sessionID:getSessionID(),incGroup:incGroup};if(this.isCallServiceType(chatType)&&this.getLastCallID()){data.lastCallId=this.getLastCallID();}
this.fireChatRequested(this,data);var sData=MI8.JSON.stringify(data);try{this.callRemote(urls.requestChatLaunchURL,{d:sData});}catch(e){}};GR34.prototype.init=function(){if(this._init){return;}
this.vitalVar=new VBER34(this.getID(),{},resources["vital"]);this.stateVar=new VBER34(this.getID(),{},resources["state"]);this.sessionVar=new VBER34(this.getID(),{},resources["session"]);this._init=true;return this;};GR34.prototype.getChatRouterURL=function(){return urls.chatRouterVanityDomain;};GR34.prototype.ask=function(url,dataJSON,bust){var rand=(Math.round(Math.random()*1000000000123)).toString(36);var crHost=this.getChatRouterURL()+url+"?";for(name in dataJSON){crHost+=((crHost.indexOf("?")==-1)?"?":"&")+name+"="+dataJSON[name];}
if(bust)crHost+="&z="+rand;var s=window.document.createElement("sc"+"ript");s.setAttribute("type","text/javascript");s.setAttribute("language","JavaScript");s.setAttribute("src",crHost);window.document.getElementsByTagName("body")[0].appendChild(s);};GR34.prototype.getPersistentID=function(){};GR34.prototype.agrtyer=function(){if(this.dataLoaded){return;}
this.dataLoaded=true;this.init();this.load();if(this.isPersistentWindow()){this.setPersistentChatSetting(true);}
this.resetStateAfterPersistentChat();if(this.isPersistentWindow()){var o=getOpener();try{o.setTimeout(o.inqFrame.Inq.GR34.StopClosingChatFromPersistent,1);}
catch(e){log(e+" StopClosingChatFromPersistent");}}};GR34.prototype.urtvd3=function(isPersistent,protoDomain,transferURL,needNewOpener){if(isPersistent){var myProtoDomain=window.location.protocol+"//"+window.location.hostname;if(myProtoDomain!=protoDomain){if(Inq.multiHost){var myHash=transferURL.split("#");myHash.shift();transferURL=myProtoDomain+window.location.pathname+"#"+myHash.join("#");}
this.againPopoutChat(transferURL,true);}
if(needNewOpener&&(myProtoDomain==protoDomain)){this.againPopoutChat(transferURL,false);}}else{var instance=inqFrame.Inq.GR34.getInstance();instance.setPersistentChatSetting(false)}};GR34.prototype.isPersistentChatMaybeActive=function(){return this.getPersistentChatSetting();};GR34.prototype.onRemoteCallback=function(chatData){this.requestInProgress=false;try{this.log("Request callback for rule: "+this.rule.toString());if(this.isPersistentWindow()){if(!this.chat.pC){var fault=new Error("chatData incorrect");fault.name="Launch Error";fault.funcName="onRemoteCallback";logMessageToTagServer("Failure to Launch: "+catchFormatter(fault),LOG_LEVELS.INFO);}}
var incGroup=PM.getVar("incGroup").getValue();this.pmor=chatData.pmor;if(this.chatType==this.CHAT_TYPES.POPUP||this.chatType==this.CHAT_TYPES.POPUP_CALL){var exposureData={siteID:Inq.getSiteID(),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:this.rule.id,buID:this.rule.getBusinessUnitID(),agID:this.rule.getAgentGroupID(),pageID:isNullOrUndefined(LDM.getPageID())?-1:LDM.getPageID(),group:incGroup,businessUnitID:this.rule.getBusinessUnitID(),result:chatData.result,rule:this.rule};BRM.fireExposureQualifiedEvent(exposureData);BRM.logExposureResult(exposureData,this.chatType);}
if(isNullOrUndefined(chatData.chatID)){if(chatData.serviceMissedEvent){BRM.fireServiceMissedEvent(this.rule,this.chatData.chatType);}
this.save();return;}
this.chatData['id']=chatData.chatID;this.chatData['v3TO']=chatData.v3TO;this.chatData['qt']=chatData.qt;this.chat=Chat.unmarshal(this.chatData).load();var launchTime=new Date();if(this.isImagePosition){this.getChatData().getChatSpec().chatTheme.pos="CENTER";this.getChatData().getChatSpec().chatTheme.lx=0;this.getChatData().getChatSpec().chatTheme.ly=0;}
this.lastChat={id:this.getChatID(),chatType:this.chat.getChatType(),timestamp:launchTime,businessUnitID:this.rule.getBusinessUnitID(),brID:this.rule.id,agentGroupID:this.rule.getAgentGroupID()};if(this.isCallServiceType(this.getChatType())){this.lastCallId=this.getChatID();}
if(this.getChatType()==this.CHAT_TYPES.POPUP){this.lpt=new Date().getTime();}
if(getInitialDFV()){window.parent.Inq.datapass=getInitialDFV().toString();}
this.chat.inHOP=chatData.inHOP;this.setDisconnectFlag(0);this.launchChat(this.chat);if(this.getChatType()==this.CHAT_TYPES.MONITOR){this.closeChat();}
this.save();if(this.getChatType()==this.CHAT_TYPES.C2C||this.getChatType()==this.CHAT_TYPES.C2CALL){BRM.fireServiceEngagedEvent({brID:this.rule.id});}}catch(e){logMessageToTagServer("Failure to Launch: "+catchFormatter(e),LOG_LEVELS.INFO);log("Error parsing Chat Data: \n"+e+"\n"+chatData);if(this.earlyPopout){try{this.earlyPopout.close();}catch(e){}}}
finally{if(this.chatRequestQ.length>0){this.request();}}};GR34.prototype.resetStateAfterPersistentChat=function(){if(!this.isPersistentChat()){return;}
if(!this.isPersistentChatInProgress()){this.chat.close();delete this.chat;this.save();}};GR34.prototype.setDisconnectFlag=function(value){var disconnectVar=PM.getVar("disconnect");if(!disconnectVar){disconnectVar=new VBER34("disconnect",0,resources["state"],"_dcnt",function(o){return parseFloat(o);});disconnectVar.init();disconnectVar.setValue(value);PM.addVar(disconnectVar);}else{disconnectVar.setValue(value);}
if(value==1){var msg=prepareLoggingContext("Chat was closed by timeout.");ROM.post(urls.loggingURL,{level:LOG_LEVELS.INFO,line:msg});log(msg,LOG_LEVELS.INFO);}};GR34.prototype.onPageLanding=function(evt){try{if(!!evt.reinitialized&&this.isChatInProgress())
return;if(this.getPersistentChatSetting()){this.setPersistentWindowActive(true);var o=getOpener();if(o){try{o.setTimeout("inqFrame.Inq.FlashPeer.setPersistentWindowActive(true);",1);}catch(e){}}}
if(!this.isPersistentChat()){if(this.isV3Continue()){var now=(new Date()).getTime();var chatInterfaceData=this.getChatInterfaceData();var then=chatInterfaceData.lt;var initialTimeOut=chatInterfaceData.it;var chatWindowAppeared=chatInterfaceData.cwa;var isEngaged=chatInterfaceData.isEngaged;if(CM.xd){var unloadTime=Number(CM.cookies["inqLT"]);if(unloadTime&&then&&unloadTime>then){then=unloadTime;}}
then=(then)?(then+(1000*this.getChat().getChatData().v3TO)):null;if((then!=null&&then<now)||(!isEngaged&&(now-chatWindowAppeared)>initialTimeOut*1000)){this.setDisconnectFlag(1);this.setChatInterfaceData({});this.chat=null;this.save();}
else if(!this.isV3Active()&&!this.isPersistentChatActive()){if(v3Lander.isBupMode&&isNullOrUndefined(this.getChat().getRule())){v3Lander.loadMbuDataForBU(this.getChat().getChatData().buID,function(ruleDataFcn){eval("var dataFcn = "+ruleDataFcn.toString());var ruleData=dataFcn();CHM.continueChatting(ruleData);});}
else{this.continueChatting();}}else if(getOSType()==="iOS"||getOSType()==="Android"){this.continueChatting();}}
else if(this.chat!=null&&!this.isV3Active()){this.chat.close();delete this.chat;this.save();log("Ended chat was closed");}else{if(this.chat!=null){log("There is chat interface opened in other tabs, no c2c available or proactive will be displayed ");}}}else{this.testForPersistentChat();}}catch(e){logMessageToTagServer("CHM failure on onPageLanding: "+catchFormatter(e),LOG_LEVELS.ERROR);}};GR34.prototype.start=function(){if(this.started){return;}
this.started=true;};GR34.prototype.load=function(){function fixBlockedServicesData(){var blocked={};var sessionServices=sessionData["blocked"];if(!!sessionServices){for(var service in sessionServices){blocked[service]=sessionServices[service];}}
var stateServices=stateData["blocked"];if(!!stateServices){for(var service in stateServices){blocked[service]=stateServices[service];}}
return blocked;}
this.absorb(this.vitalVar.getValue());this.absorb(this.stateVar.getValue());this.absorb(this.sessionVar.getValue());this.chat=Chat.unmarshal().load();if(!!this.chat){this.rule=this.chat.getRule();}
if(!!this.blocked){var stateData=this.stateVar.getValue();var sessionData=this.sessionVar.getValue();this.blocked=fixBlockedServicesData();}
if(this.getLastChat()&&this.getLastChat().svyPrms){MI8.mixAbsorber(this.getLastChat().svyPrms);}
return this;};GR34.prototype.save=function(){function prepareBlockedServicesData(services){for(var service in services){if(services[service]==0){if(!sessionData.blocked){sessionData.blocked={};}
sessionData.blocked[service]=services[service];}else if(services[service]==-2){}else{if(!stateData.blocked){stateData.blocked={};}
stateData.blocked[service]=services[service];}}}
var sessionData={pmor:this.pmor,cb:this.cb};if(this.chat!=null){this.chat.save();sessionData.chat={id:this.getChatID(),ruleID:this.rule?this.rule.getID():this.chat.getRuleId(),aid:this.chat.getAgentID(),pC:this.chat.isPersistent()};}
var vitalData={lpt:this.lpt,lastChat:this.lastChat,lastCallId:this.lastCallId};var stateData={};if(!!this.blocked){prepareBlockedServicesData(this.blocked);}
try{this.vitalVar.setValue(vitalData);}catch(e){log("GR34.save sessionData: "+e,e);}
try{this.stateVar.setValue(stateData);}catch(e){log("GR34.save sessionData: "+e,e);}
try{this.sessionVar.setValue(sessionData);}catch(e){log("GR34.save sessionData: "+e,e);}};GR34.prototype.isListener=function(l){if(l&&(l.onChatRequested||l.onChatLaunched||l.onChatShown||l.onChatClosed||l.onPersistentPush||l.onAgentMsg||l.onCustomerMsg||l.onAgentAssigned||l.onChatEngagedEvent||l.onChatEvent||l.onBeforeChatClosed))
return true;return false;};GR34.prototype.cloneChatInterfaceData=function(srcobj){if(srcobj==null||typeof(srcobj)!='object')
return srcobj;var newobj=new srcobj.constructor();for(var key in srcobj)
newobj[key]=this.cloneChatInterfaceData(srcobj[key]);return newobj;};GR34.prototype.getChatInterfaceData=function(){return!!this.chat?this.chat.getCiData():{};};GR34.prototype.setChatInterfaceData=function(data){if(!this.chat)
return;this.chat.setCiData(data);};GR34.prototype.wecv56=function(cT){var winTest=null;var url="",target=GR34.persistentTarget;var tools="toolbar=no,location=no,menubar=no,status=no,scrollbars=no"+",top="+cT.py+",left="+cT.px+",width="+cT.pw+",height="+cT.ph+",resizable=1";try{winTest=top.open(url,target,tools);}catch(e1){winTest=null;}
try{if(null!=winTest&&getOSType()==="iOS"&&window.focus){top.focus();}}catch(e2){}
this.earlyPopout=winTest;};GR34.prototype.engagePersistentChat=function(xfr){var chatID=this.getChatID();var myProtoDomain=window.location.protocol+"//"+window.location.hostname;try{this.ask("/chatrouter/chat/isPersistentActive",{"engagementID":chatID,pd:myProtoDomain,xfr:(xfr)?xfr:false,"customerID":Inq.getCustID()},true);}catch(e){log("GR34.proto.engagePersistentChat: 524: ERROR"+e,e);}
return;};GR34.prototype.CloseChatFromPersistent=function(){GR34.getInstance().r345jjm();};GR34.prototype.__againGetPersistentWindow=function(){var winTest=null;var tools="toolbar=no,location=no,menubar=no,status=no,scrollbars=no"+",top="+"-500"+",left="+"-500"+",width="+"0"+",height="+"0"+"";try{winTest=win.open("",GR34.persistentTarget,tools);if(winTest!=null){var loc="err";try{loc=winTest.location.href;}catch(e){loc="err";}
if("about:blank"==loc){winTest.close();winTest=null;}else if(loc!="err"&&loc!=undefined){if(!!winTest.document&&!!winTest.document.body){if(""==winTest.document.body.innerHTML){winTest.close();winTest=null;}}
else{winTest.close();winTest=null;}}
if(winTest==top||winTest==self)
return null;}}catch(e){};return winTest;};GR34.prototype.againPopoutChat=function(transferURL,differentDomains){var winTest=null;var url,target;var port=(window.parent.document.location.port=="")?"":(":"+window.parent.document.location.port);url=(Inq.v3framesrc.indexOf("/")==0)?window.parent.document.location.protocol+"//"+window.parent.document.location.hostname+port+Inq.v3framesrc:Inq.v3framesrc;var ix=transferURL.indexOf("#");if(ix>=0){url=transferURL.substr(0,ix);}else{url=transferURL;}
target=GR34.persistentTarget;var tools="toolbar=no,location=no,menubar=no,status=no,scrollbars=no"+",top="+"-500"+",left="+"-500"+",width="+"0"+",height="+"0"+"";winTest=this.__againGetPersistentWindow();if(winTest!=null)try{try{winTest=window.parent.open(url,target,tools);}
catch(e){winTest=Inq.win.open(url,target,tools);}
if(!winTest){log("pop up blocker");}
if(""!=url){if(winTest==top)
winTest=null;}else{throw new Error("GR34.prototype.againPopoutChat: ERROR: popup url is empty");}}catch(e){log("throw: "+e);winTest=null;}
this.persisentWindow=winTest;if(winTest){if(winTest.focus)
try{winTest.focus();}catch(e){}
return true;}
else
return false;};GR34.prototype.getPersistentChatSetting=function(){var pc;var pcVar=Inq.PM.getVar("pc");if(pcVar==null){pcVar=(new VBER34("pc",(pc=""+(GR34.persistentTarget==window.parent.name)),resources["session"]));pcVar.init();pcVar.getValue();Inq.PM.addVar(pcVar);}
try{pc=pcVar.getValue();}
catch(e){log("GR34.getPersistentChatSetting ERROR:"+e,e);}
return(pc=="true");};GR34.prototype.setPersistentChatSetting=function(pc){pc=""+pc;var pcVar=Inq.PM.getVar("pc");if(pcVar==null){pcVar=(new VBER34("pc",pc,resources["session"]));pcVar.init();pcVar.setValue(pc);Inq.PM.addVar(pcVar);return;}
pcVar.setValue(pc);};GR34.prototype.setPersistentWindowActive=function(status){try{if(status==null)
return;if(GR34.persistentTarget==win.name&&Inq.isSameOrigin()){if(!!this.chat)
this.chat.pC=status;this.save();var o=(win.opener&&win.opener.inqFrame)?win.opener.inqFrame:((window.opener)?window.opener:null);o.setTimeout('Inq.CHM.setPersistentWindowActive('+status+')',0);}
else if(!isNullOrUndefined(this.chat)&&this.chat.pC!=status){this.chat.pC=status;}}catch(e){logMessageToTagServer("Failure on setPersistentWindowActive: "+catchFormatter(e),LOG_LEVELS.INFO);}};GR34.prototype.isPersistentChatActive=function(){return this.isPersistentChatMaybeActive();};GR34.prototype.isPersistentChatInProgress=function(){return this.isPersistentChatActive();};GR34.prototype.isPersistentChat=function(){if(this.chat&&this.chat.pC){return true;}
else{return false;}};GR34.prototype.r11rbbv=function(){var winTest=null;var strWidth;var strHeight=300;var sLeft=0;var sTop=0;strWidth=0;if(GR34.persistentTarget==win.name)return true;var toolsForTest="toolbar=no,location=no,menubar=no,status=no,scrollbars=no"+",top="+"-500"+",left="+"-500"+",width="+"0"+",height="+"0"+"";try{if(this.popoutWindow!=null&&this.popoutWindow!=false&&this.popoutWindow!=true&&typeof(this.popoutWindow)=="object"){if(this.popoutWindow.closed){this.popoutWindow=null;return null;}}
if(this.chat.popoutWindow==false)
return null;if(this.earlyPopout)
return null;winTest=win.open("",GR34.persistentTarget,toolsForTest);if(winTest!=null){if("about:blank"==winTest.location.href){winTest.close();winTest=null;}else{if(winTest.document&&winTest.document.body){if(""==winTest.document.body.innerHTML){winTest.close();winTest=null;}}
else{winTest.close();winTest=null;}}
if(winTest==top||winTest==self)
winTest=null;}
this.popoutWindow=winTest;}
catch(e){winTest=null;}
return(winTest);};GR34.prototype.testForPersistentChat=function(){if(this.isPersistentWindow()){this.testForContinueChatting();var isPersistentInitialization=false;if(FP.isInitializationRequired()==true){isPersistentInitialization=true;FP.resetInitializationFlag();}
if(isPersistentInitialization){this.chat.transitionMessage(this.PERSISTENT.PERSISTENT_COMPLETE);}}else if(this.isPersistentChatMaybeActive()){this.engagePersistentChat(false);}};GR34.prototype.testForContinueChatting=function(){if(this.isV3Continue()){this.continueChatting();}else{var o=getOpener();var c=(o.Inq.CHM.chat==null)?Inq.CHM.chat:o.Inq.CHM.chat;if(c==null){var fault=new Error("Missing Chat Object");fault.name="Persistent Fault:";fault.func="testForContinueChatting";logMessageToTagServer("Failure to Launch: "+catchFormatter(fault),LOG_LEVELS.INFO);window.parent.close();}else{var cd=MI8.JSON.clone(c.cd);this.chat=Chat.unmarshal(cd).load();this.chat.show();}}};GR34.prototype.continueChatting=function(optRuleData){if(!isNullOrUndefined(optRuleData)){for(var idx=0;idx<optRuleData.rules.length;idx++){var rule=optRuleData.rules[idx];if(rule.getID()==this.getLastChat().brID){this.getChat().rule=rule;break;}}
if(isNullOrUndefined(this.getChat().getRule())){logErrorToTagServer("Rule for BU not found. Chat lost.");throw"Rule for BU not found. Chat lost.";}}
this.chat.chatMgr=this;this.chat.show();};GR34.prototype.nnm89=function(chatID){try{var crHost=this.getChatRouterURL();var exitChat=crHost+"/chatrouter/chat/exitChat";ROM.send(exitChat,{"engagementID":chatID,"customerID":Inq.getCustID()});}catch(e){}};GR34.prototype.passNamedDataToAgent=function(name,value){var data=MI8.unmixMutatable(MI8.mixMutatable(MI8.mixAbsorber(MI8.mixMutatable()).absorb(safe('inqData'))).set("agentID",this.getAgentID()).set("engagementID",this.getChatID()).set(name,value));ROM.sendDataToAgent(this.getAgentID(),data);};GR34.prototype.r345jjm=function(){try{if(!this.isMobile()||this._closeRetries++<20){var pw=inqFrame["persistentChatWindow"];if(pw!=null&&!pw.closed){this.retryTimeout=window.setTimeout('inqFrame.Inq.FlashPeer.CloseChatFromPersistent()',50);return;}
else{this.retryTimeout=null;}}
else{this._closeRetries=0;}}
catch(e){log("Error in GR34.r345jjm: "+e);}
if(this.chat){this.chat.persistentChat=false;}
if(CM.persistentWindow){CM.persistentWindow=null;}
if(window.parent.Inq.datapass){window.parent.Inq.datapass=null;}
this.setPersistentChatSetting(false);this.setChatInterfaceData({});this.nnm89(this.getChatID());this.fireChatClosed();if(this.chat){this.chat.close();}
this.setPersistentWindowActive(false);delete this.chat;this.save();};GR34.prototype.setSurveyAuxParams=function(params){if(this.getLastChat()){var svyPrms=this.getLastChat().svyPrms;if(!svyPrms){svyPrms=this.getLastChat().svyPrms=MI8.mixAbsorber({});}
svyPrms.absorb(params);this.save();}else{log("Warning: setting survey params failed - last chat data object doesn't exist.");}};GR34.prototype.getSurveyAuxParams=function(){if(this.getLastChat()){return this.getLastChat().svyPrms;}else{return null;}};GR34.prototype.setClickStreamSent=function(isSent){if(this.getLastChat()){this.getLastChat().clkstr=isSent;this.save();}else{log("Warning: setting ClickStreamSent flag failed - last chat data object doesn't exist.");}};GR34.prototype.isClickStreamSent=function(){if(this.getLastChat()){return this.getLastChat().clkstr;}else{return null;}};GR34.prototype.closePersistent=function(){var chatID=this.getChatID();if(!Inq.isSameOrigin()){this.nnm89(chatID);}
else{try{var o=getOpener();o.inqFrame["persistentChatWindow"]=window.parent;inqFrame.Inq.MSG.closePersistent(o);}
catch(err){this.nnm89(chatID);}}};GR34.prototype.inactivateChat=function(){if(this.chat==null)return;this.chat.setVisible(false);FP.closeChatInterface();};GR34.prototype.closeChat=function(){if(this.isPersistentWindow()){this.closePersistent();}
else
{if(!this.chat){return;}
if(!this.persistentChat){this.fireChatClosed();}
this.chat.close();this.chat=null;this.save();}
if(window.parent.Inq.datapass){window.parent.Inq.datapass=null;}};GR34.prototype.closeChatMonitor=function(){this.chat.closeChatMonitor();};GR34.prototype._assertChatInProgress=function(_inProgress){if(this.chat==null){if(_inProgress)
throw Error("Chat "+(_inProgress?"not ":"")+"in progress");}
else if(this.chat.isVisible()||this.isPersistentChatInProgress()){if(!_inProgress)
throw Error("Chat "+(_inProgress?"not ":"")+"in progress");}};GR34.prototype.setOpacity=function(opac){if(this.chat)this.chat.setOpacity(opac);};GR34.prototype.showPersistentButton=function(x,y,w,h){this.chat.pb.setPosition(x,y,w,h);this.chat.pb.setVisible(true);};GR34.prototype.showTextInput=function(bShow,y,x,w,h){var o,offsetY;offsetY=this.chat.chatSpec.chatTheme.tbh;o=win.document.getElementById("inqInput4Chat");if(o){o.style.display=(bShow)?"":"none";o.style.top=(y+offsetY)+"px";o.style.left=x+"px";o.style.width=w+"px";o.style.height=h+"px";}};GR34.prototype.hidePersistentButton=function(){this.chat.pb.setVisible(false);};GR34.prototype.setPersistentButtonDebugActive=function(active){this.chat.pb.setDebugActive(active);};GR34.prototype._resetChat=function(){this._assertChatInProgress(true);win.document.body.removeChild(this.chat.container);this.chat.close();this.chat=null;this.thankYouShown=!this.displayTYImage;this.setChatInterfaceData({});this.save();};GR34.prototype.setChatVisible=function(_vis){this.chat.setVisible(_vis);};GR34.prototype.launchChat=function(chat){try{this._assertChatInProgress(false);if(this.chat!=chat){this.chat=chat;}
if(!(this.getChatType()==this.CHAT_TYPES.MONITOR)){this.chat.show();}
this.fireChatLaunched(this.chat.getChatData());if(this.getChatType()==GR34.CHM.CHAT_TYPES.POPUP||this.getChatType()==GR34.CHM.CHAT_TYPES.POPUP_CALL){BRM.fireServiceInvitationEvent(this.chat.getRule(),this.getChatType());}}catch(e){logMessageToTagServer("Failure to Launch: "+catchFormatter(e),LOG_LEVELS.INFO);}};GR34.prototype.getAgentID=function(){return(this.chat)?this.chat.getAgentID():null;};GR34.prototype.getAgentName=function(){return(this.chat)?this.chat.getAgentName():null;};GR34.prototype.getAgentAttributeValue=function(attrName){return this.chat?this.chat.getAgentAttributeValue(attrName):"";};GR34.prototype.addAgentAttributesToEvent=function(evt){var attrList=PM.getVar("eventAgentAttributeList");if(attrList){var list=attrList.getValue().split(",");for(var i=0,name;i<list.length;i++){name=list[i].trim();if(name!=""){evt[name]=this.getAgentAttributeValue(name);}}}};GR34.prototype.getCustomerName=function(){return(this.chat)?this.chat.getCustomerName():null;};GR34.prototype.isPersistentWindow=function(){return isPersistentWindow();};GR34.prototype.getChat=function(){return this.chat?this.chat:null;};GR34.prototype.getBusinessUnitID=function(evt,rule){return this.chat&&this.chat.getChatData()&&this.chat.getChatData().buID&&(parseInt(this.chat.getChatData().buID)>0)?this.chat.getChatData().buID:(this.chat&&this.chat.getBusinessUnitID()?this.chat.getBusinessUnitID():(evt.rule&&evt.rule.getBusinessUnitID?evt.rule.getBusinessUnitID():(this.lastChat&&this.lastChat.businessUnitID?this.lastChat.businessUnitID:rule.getBusinessUnitID())));};GR34.prototype.getLastChat=function(){return this.lastChat?this.lastChat:null;};GR34.prototype.getEmailSpecId=function(){var emailSpecId=0;var chat=this.getChat();if(!!chat){emailSpecId=chat.chatSpec.emSpId;}
return emailSpecId;};GR34.prototype.getChatID=function(){var id="0";if(!!this.chat){try{id=this.chat.getChatID();}catch(e){}}
return id;};GR34.prototype.getLastChatID=function(){var id="0";if(!!this.lastChat&&!!this.lastChat.id){id=this.lastChat.id;}
return id;};GR34.prototype.getLastAgentID=function(){var agentId="";if(!!this.lastChat&&!!this.lastChat.agentID){agentId=this.lastChat.agentID;}
return agentId;};GR34.prototype.getLastCallID=function(){return this.lastCallId;};GR34.prototype.getChatType=function(){return this.chat?this.chat.getChatType():null;};GR34.prototype.getLastChatType=function(){return this.lastChat?this.lastChat.chatType:null;};GR34.prototype.tryue=function(serviceType,period){if(serviceType!=GR34.CHM.CHAT_TYPES.POPUP&&serviceType!=GR34.CHM.CHAT_TYPES.POPUP_CALL){return;}
if(isNullOrUndefined(this.blocked)){this.blocked={};}
if(isNullOrUndefined(this.blocked[serviceType])||(!isNullOrUndefined(this.blocked[serviceType])&&this.blocked[serviceType]<(new Date).getTime())){if(period>0){var now=new Date();period+=now.getTime();}
this.blocked[serviceType]=period;this.save();}};GR34.prototype.unblockService=function(serviceType){if(serviceType!=GR34.CHM.CHAT_TYPES.POPUP&&serviceType!=GR34.CHM.CHAT_TYPES.POPUP_CALL){return;}
if(!isNullOrUndefined(this.blocked)&&!isNullOrUndefined(this.blocked[serviceType])){delete this.blocked[serviceType];}
this.save();};GR34.prototype.setCobrowseFlag=function(flag){var val=(flag)?1:0;if(this.cb!=val){this.cb=val;this.save();}};GR34.prototype.getCobrowseFlag=function(){return(!!this.cb)?true:false;};GR34.prototype.isBlocked=function(serviceType){var blockedValue=false;if(!isNullOrUndefined(this.blocked)&&!isNullOrUndefined(this.blocked[serviceType])){var now=new Date();var toDate=this.blocked[serviceType];if(toDate<=0){blockedValue=true;}
else{blockedValue=toDate>=now.getTime();}}
return blockedValue;};GR34.prototype.isAnyBlocked=function(){if(isNullOrUndefined(this.blocked)){return false;}
for(var prop in this.blocked){return true;}
return false;};GR34.prototype.isProactiveExpired=function(){if(!this.lpt)return false;var expireTime=new Date(this.lpt).getTime()+Inq.rechatInterval*24*60*60*1000;var now=new Date().getTime();return now>expireTime;};GR34.prototype.isMobile=function(){var deviceType=getDeviceType();return(deviceType==='Phone'||deviceType==='Tablet');}
GR34.prototype.popOutChat=function(transition){if(!this.isPersistentChatActive())
this._firePersistentPushEvt({});if(CM.xd){if(transition){this.chat.transitionMessage(this.PERSISTENT.PERSISTENT);}
CM.dump();if(null==this.earlyPopout||this.earlyPopout.closed){this.wecv56(this.chat.chatSpec.chatTheme);}
CM.setWhen3rdPartyCookieCommittedHandler(function(){(inqFrame.Inq.CHM).relocateToHostedPage(5);});return true;}else{if(this.isMobile()){inqFrame.Inq.FlashPeer.closePopupChat();}
return this.chat.popOutChat(transition);}};GR34.prototype.relocateToHostedPage=function(retryCnt){try{this.popoutWindow=this.earlyPopout;this.popoutWindow.location.href=Inq.v3framesrc;this.chat.persistentChat=true;window.Inq.isPersistentInitialization=true;if(getOSType()==="iOS"&&this.popoutWindow.focus){try{this.popoutWindow.focus();}catch(errFocus){}}
this.earlyPopout=null;}catch(err){err["this"]=this;err["popoutWindow"]=(this.popoutWindow)?this.popoutWindow:"undefined";err["earlyPopout"]=(this.earlyPopout)?this.earlyPopout:"undefined";err["popoutWindow_location"]=(this.popoutWindow.location)?this.popoutWindow.location:"undefined";if(retryCnt==0)
err["PersistentFailure"]="Persistent Popout failed, all retries exhausted";logMessageToTagServer("Failure to relocateToHostedPage("+retryCnt+"): "+catchFormatter(err),LOG_LEVELS.INFO);if(retryCnt>0){inqFrame.Inq.FlashPeer["__relocateToHostedPage"]=function(retryCnt){(inqFrame.Inq.CHM).relocateToHostedPage(retryCnt);};inqFrame.setTimeout('inqFrame.Inq.FlashPeer.__relocateToHostedPage('+(--retryCnt)+');',50);}
else{var wins=[this.earlyPopout,this.popoutWindow];while(wins.length){w=wins.shift()
if(w){try{if(!w.closed)
w.close();}catch(e){}}}
this.earlyPopout=this.popoutWindow=null;}}};GR34.prototype.reset=function(){};GR34.prototype.sendMsg=function(_msgData,_src){ROM.send(Inq.urls.sendToAgentURL,{chatID:_msgData.chatID,msg:escape(_msgData.msg)});};GR34.prototype.toString=function(){return"GR34: "+MI8.JSON.stringify(this);};GR34.prototype._addListener=function(_l,_lArr){if(!_l.id)
_l.id=Math.random();_lArr.push(_l);};GR34.prototype.hasAlreadyChatted=function(chatData){if(!this.lastChat)return false;var lastChatTimeMS=new Date(this.lastChat.time).getTime();var nowMS=(new Date()).getTime();var reChatTimeMS=lastChatTimeMS+Inq.rechatInterval*(24*60*60*1000);return(reChatTimeMS>=nowMS);};GR34.prototype.clearAllChatListeners=function(){this._listeners=[];};GR34.prototype.assignAgent=function(aid,noSave,cobrowseEnabled,eventData,buID,agID){log("Agent Assigned: GR34.assignAgent("+aid+")");try{var agentAttrs;if(typeof(eventData)=="object"){agentAttrs=eventData["agtAttrs"];}
var msg=prepareLoggingContext("Set agent config : agentID="+aid+",buID="+buID+",agID="+agID+",agentAttrs="+agentAttrs+". ");ROM.post(urls.loggingURL,{level:LOG_LEVELS.INFO,line:msg});this.chat.setAgentConfig(aid,buID,agID,agentAttrs);if(!noSave){this.save();}
this.fireAgentAssigned(aid,cobrowseEnabled,eventData,buID,agID);if(this.isPersistentWindow()&&Inq.isSameOrigin()){if(typeof(eventData)=="object"){eventData=MI8.JSON.stringify(eventData);}
var delayedCommand='inqFrame.Inq.CHM.assignAgent("'+aid+'", true,'+cobrowseEnabled+','
+eventData+','+buID+','+agID+')';win.opener.inqFrame.setTimeout(delayedCommand,50);}}catch(er){log("FAILED ATTEMPT TO SET AGENT ID FROM FLASH: "+er);}};GR34.prototype.getAgentGroupNameByID=function(agID){var agName=undefined;if(!isNullOrUndefined(agID)&&site.siteAgentGroups.hasOwnProperty(agID)){agName=site.siteAgentGroups[agID];}
return agName;}
GR34.prototype.isV3Continue=function(){var ciData=this.getChatInterfaceData();return ciData?ciData.c==1:false;};GR34.prototype.isV3Active=function(){if(CM.xd){try{var activeFlag=CM.cookies["inqCA"];var activeCount;if(activeFlag==null)
return false;if(isNaN(activeCount=parseInt(activeFlag))){return false;}
if(activeCount<=0)return false;return true;}catch(e){log("Error detecting isV3Active:"+e);return false;}}else{var ciData=this.getChatInterfaceData();if(!!ciData){return(ciData.a==true);}
return false;}};GR34.prototype.isChatInProgress=function(){if(this.isV3Active())
return true;if(this.isPersistentChat()){if(this.isPersistentChatInProgress()){return true;}
else{this.resetStateAfterPersistentChat();return false;}}
else{return this.isV3Continue()||this.isInlineChatInProgress();}};GR34.prototype.isInlineChatInProgress=function(){return(!!this.chat&&this.chat.isVisible());};GR34.prototype.isThankYouEnabled=function(){return this.thankYouEnabled;};GR34.prototype.getChatData=function(){return this.getChat();};GR34.prototype.getLaunchPageId=function(){if(this.chat&&this.chat.getChatData()){return this.chat.getChatData().launchPageId;}else{return"";}};GR34.prototype.onChatLaunched=function(evt){if(!CM.isPersistentCookiesAllowed()&&isIE()){var sesOnlyCookieMsg="Only Session Cookies are allowed for this chatID. "+this.getChatID();if(!JSLoggingDisabled){log(""+sesOnlyCookieMsg);logMessageToTagServer(sesOnlyCookieMsg,LOG_LEVELS.INFO);}}};GR34.prototype._fireChatEvt=function(evt){this._fireEvt(function(l,evt){if(l.onChatEvent)l.onChatEvent(evt);},evt);};GR34.prototype.fireAgentMsgEvent=function(){if(isNullOrUndefined(this.chat)){return;}
this.chat.bumpAgtMsgCount();var event={customerID:Inq.getCustID(),chatID:this.getChatID(),custMsgCnt:this.chat.getCustMsgCnt(),agtMsgCnt:this.chat.getAgentMsgCnt()};this._fireEvt(function(l,event){try{if(typeof l.onAgentMsg=="function")l.onAgentMsg(event);if(typeof l.onChatEvent=="function")l.onChatEvent(event);}catch(e){log("Error firing event onAgentMsg on "+l.toString()+": \n"+e);}},event);if(!this.isPersistentWindow()||!isIE())
this.chat.save();};GR34.prototype.fireCustomerMsgEvent=function(evt){if(isNullOrUndefined(this.chat)){return;}
this.chat.bumpCustMsgCount();var event=MI8.mixAbsorber({customerID:Inq.getCustID(),chatID:this.getChatID(),custMsgCnt:this.chat.getCustMsgCnt(),agtMsgCnt:this.chat.getAgentMsgCnt(),textLine:evt.textLine.substring(0,50)});this._fireEvt(function(l,event){try{if(typeof l.onCustomerMsg=="function")l.onCustomerMsg(event);if(typeof l.onChatEvent=="function")l.onChatEvent(event);}catch(e){log("Error firing event onCustomerMsg on "+l.toString()+": \n"+e);}},event);if(!this.isPersistentWindow()||!isIE())
this.chat.save();};GR34.prototype.fireChatRequested=function(src,evtData){var evt=MI8.mixAbsorber({});evt.absorb(evtData);evt.id=this.evtIdx++;evt.evtType=this.EVTS.REQUESTED;evt.timestamp=new Date();evt.src=src;this._fireEvt(function(l,evt){if(typeof l.onChatRequested=="function")l.onChatRequested(evt);},evt);};GR34.prototype.fireChatLaunched=function(chatData){if(chatData==null)chatData=this.chat.getChatData();var evt=MI8.mixAbsorber({id:this.evtIdx++,evtType:this.EVTS.LAUNCHED,src:this,chatID:chatData.id});evt.absorb(chatData).absorb({"customerID":Inq.getCustID(),rule:this.rule});if(this.chat)evt.inHOP=this.chat.inHOP;var custEvt=MI8.mixAbsorber({customerID:Inq.getCustID(),chatID:chatData.id,evtType:this.EVTS.LAUNCHED,chatType:this.getChatType(),bizRuleName:this.rule.getName()});var buID=null;var agID=null;if(evt["buID"]){buID=evt["buID"];delete evt["buID"];}
if(evt["agID"]){agID=evt["agID"];delete evt["agID"];}
if(!(buID&&agID)||parseInt(buID)<=0||parseInt(agID)<=0){var rule=BRM.getRuleById(chatData.ruleID)?BRM.getRuleById(chatData.ruleID):this.rule;if(rule){buID=buID&&parseInt(buID)>0?buID:rule.getBusinessUnitID();agID=agID&&parseInt(agID)>0?agID:rule.getAgentGroupID();}}
if(agID&&parseInt(agID)>0){custEvt.absorb({agentGroupID:agID});evt.absorb({agentGroupID:agID});}
if(buID&&parseInt(buID)>0){custEvt.absorb({businessUnitID:buID});evt.absorb({businessUnitID:buID});}
this._fireEvt(function(l,evt){var event=isNullOrUndefined(l.custApi)?evt:custEvt;try{if(typeof l.onChatLaunched=="function")l.onChatLaunched(event);if(typeof l.onChatEvent=="function")l.onChatEvent(event);}catch(e){log("Error firing event onChatLaunched on "+l.toString()+": \n"+e);}},evt);if(window.parent.name==GR34.persistentTarget){var o=getOpener();if(o||Inq.isSameOrigin()){o.setTimeout('Inq.CHM.fireChatLaunched(null)',0);}}};GR34.prototype.fireChatShown=function(chatData){if(chatData==null)chatData=this.chat.getChatData();var evt=MI8.mixAbsorber({id:this.evtIdx++,evtType:this.EVTS.SHOWN,src:this,chatID:chatData.id});evt.absorb(chatData).absorb({"customerID":Inq.getCustID(),rule:this.rule});if(this.chat)evt.inHOP=this.chat.inHOP;this._fireEvt(function(l,evt){try{if(typeof l.onChatShown=="function")l.onChatShown(evt);if(typeof l.onChatEvent=="function")l.onChatEvent(evt);}catch(e){log("Error firing event onChatShown on "+l.toString()+": \n"+e);}},evt);};GR34.prototype.fireBeforeChatClosed=function(){try{var chatData=this.chat.getChatData();var evt=MI8.mixAbsorber({id:this.evtIdx++,chatID:chatData.id,evtType:this.EVTS.BEFORE_CLOSED,timestamp:new Date(),rule:this.rule,src:this});evt.absorb(chatData).absorb({"customerID":Inq.getCustID(),"agentID":this.getAgentID()});this._fireEvt(function(l,evt){try{if(typeof l.onBeforeChatClosed=="function")l.onBeforeChatClosed(evt);if(typeof l.onChatEvent=="function")l.onChatEvent(evt);}catch(e){log("Error firing event onBeforeChatClosed on "+l.toString()+": \n"+e);}},evt);}catch(e){logMessageToTagServer("Failure to fireBeforeChatClosed: "+catchFormatter(e),LOG_LEVELS.INFO);}};GR34.prototype.fireChatClosed=function(chatData){try{if(chatData==null)chatData=this.chat.getChatData();this.hasEngaged=false;var evt=MI8.mixAbsorber({id:this.evtIdx++,chatID:chatData.id,evtType:this.EVTS.CLOSED,timestamp:new Date(),rule:this.rule,src:this});evt.absorb(chatData).absorb({"customerID":Inq.getCustID(),"agentID":this.getAgentID()});var custEvt=MI8.mixAbsorber({customerID:Inq.getCustID(),chatID:chatData.id,evtType:this.EVTS.LAUNCHED,chatType:this.getChatType(),bizRuleName:this.rule.getName()});var buID=null;var agID=null;if(evt["buID"]){buID=evt["buID"];delete evt["buID"];}
if(evt["agID"]){agID=evt["agID"];delete evt["agID"];}
if(!(buID&&agID)||parseInt(buID)<=0||parseInt(agID)<=0){var rule=BRM.getRuleById(chatData.ruleID)?BRM.getRuleById(chatData.ruleID):this.rule;if(rule){buID=buID&&parseInt(buID)>0?buID:rule.getBusinessUnitID();agID=agID&&parseInt(agID)>0?agID:rule.getAgentGroupID();}}
if(agID&&parseInt(agID)>0){custEvt.absorb({agentGroupID:agID});evt.absorb({agentGroupID:agID});}
if(buID&&parseInt(buID)>0){custEvt.absorb({businessUnitID:buID});evt.absorb({businessUnitID:buID});}
var custEvt={customerID:Inq.getCustID(),chatID:chatData.id,agentID:this.getAgentID(),bizRuleName:this.rule.getName(),businessUnitID:buID,agentGroupID:agID};this._fireEvt(function(l,evt){var event=isNullOrUndefined(l.custApi)?evt:custEvt;try{if(typeof l.onChatClosed=="function")l.onChatClosed(event);if(typeof l.onChatEvent=="function")l.onChatEvent(event);}catch(e){log("Error firing event onChatClosed on "+l.toString()+": \n"+e);}},evt);}catch(e){logMessageToTagServer("Failure to fireChatClosed: "+catchFormatter(e),LOG_LEVELS.INFO);}};GR34.prototype.fireChatEngaged=function(_src){if(this.hasEngaged){return;}
this.hasEngaged=true;var evt=MI8.mixAbsorber({evtType:this.EVTS.ENGAGED,timestamp:new Date(),src:_src,chat:this.getChatData(),bizRuleName:this.rule.getName()});var chatData=this.getChatData();evt.absorb(chatData).absorb({"chatID":this.getChatID(),"chatType":this.getChatType(),"customerID":Inq.getCustID(),"agentID":this.getAgentID()});var custEvt=MI8.mixAbsorber({customerID:Inq.getCustID(),chatID:chatData.id,evtType:this.EVTS.LAUNCHED,chatType:this.getChatType(),bizRuleName:this.rule.getName()});var buID=null;var agID=null;if(evt["buID"]){buID=evt["buID"];delete evt["buID"];}
if(evt["agID"]){agID=evt["agID"];delete evt["agID"];}
if(!(buID&&agID)||parseInt(buID)<=0||parseInt(agID)<=0){var rule=BRM.getRuleById(chatData.ruleID)?BRM.getRuleById(chatData.ruleID):this.rule;if(rule){buID=buID&&parseInt(buID)>0?buID:rule.getBusinessUnitID();agID=agID&&parseInt(agID)>0?agID:rule.getAgentGroupID();}}
if(agID&&parseInt(agID)>0){custEvt.absorb({agentGroupID:agID});evt.absorb({agentGroupID:agID});}
if(buID&&parseInt(buID)>0){custEvt.absorb({businessUnitID:buID});evt.absorb({businessUnitID:buID});}
this._fireEvt(function(l,evt){if(typeof l.onChatEngagedEvent=="function")l.onChatEngagedEvent(evt);if(typeof l.onChatEvent=="function")l.onChatEvent(evt);},evt);};GR34.prototype.firePersistentPush=function(){this._fireChatEvt({id:++this.evtIdx,chatType:this.chat.getChatType(),evtType:this.EVTS.PERSISTENT_PUSH,chat:this.getChatData(),timestamp:new Date()});};GR34.prototype._firePersistentPushEvt=function(evt){var chatData=null;var inh=null;if(this.chat){inh=this.chat.inHOP;chatData=this.chat.getChatData();}
evt=MI8.mixAbsorber({id:this.evtIdx++,evtType:this.EVTS.PERSISTENT_PUSH,src:this,chatID:(chatData?chatData.id:null),inHOP:inh});evt.absorb(chatData).absorb({"customerID":Inq.getCustID(),rule:this.rule});this._fireEvt(function(l,_evt){if(l.onPersistentPush)l.onPersistentPush(_evt);},evt);};GR34.prototype.fireAgentAssigned=function(_agtID,_cobrowseEnabled,eventData,buID,agID){try{this.evtIdx++;var evt=MI8.mixAbsorber({id:this.evtIdx,agentID:_agtID,cobrowseEnabled:!!_cobrowseEnabled,ruleID:this.chat.getRule().getID(),chatID:this.getChatID(),timestamp:new Date(),businessUnitID:buID});if(agID){evt.agentGroupID=agID;}
this.addAgentAttributesToEvent(evt);if(typeof(eventData)=="object"){evt.absorb(eventData);}else if(typeof(eventData)=="string"){evt.absorb(MI8.JSON.parse(eventData));}
this._fireEvt(function(l,evt){if(l&&typeof l.onAgentAssigned=="function"){l.onAgentAssigned(evt);}},evt);}catch(e){ROM.post(urls.loggingURL,{level:LOG_LEVELS.WARN,line:"Failure to fireAgentAssigned: "+catchFormatter(e)});}};GR34.prototype.isServiceSupported=function(chatType){return!!this.CHAT_TYPES[chatType];};GR34.prototype.isCallServiceType=function(chatType){return(this.CHAT_TYPES.C2CALL==chatType||this.CHAT_TYPES.POPUP_CALL==chatType);};GR34.prototype.isVAChat=function(){var ciData=this.getChatInterfaceData();return ciData?ciData.va==1:false;};GR34.prototype.getConversionType=function(){if(!!this.chat){if(this.isVAChat()){return"virtualAssistant";}
return this.isCallServiceType(this.getChatType())?"call":"chat";}else{return null;}};GR34.prototype.isServiceInProgress=function(chatType){var inProgress=false;if(!!this.chat){var thisChatType=this.chat.getChatType();if(chatType=="ANY"){return!isNullOrUndefined(thisChatType);}
if(!this.isServiceSupported(chatType)){throw"ServiceTypeNotRecognized - not supported chat type provided: '"+chatType+"'";}
if(!isNullOrUndefined(chatType)){if(this.isPersistentWindow()&&chatType==this.CHAT_TYPES.PERSISTENT){inProgress=true;}
else{inProgress=(chatType==thisChatType);}}}
return inProgress;};GR34.prototype.registerFlashvarFcn=function(fcn){this._flashvarFcns.push(fcn);};GR34.prototype.getCobrowseBannerText=function(){return!!this.chat?this.chat.getCobrowseBannerText():"";};GR34.prototype.endCobrowseSessionFromBanner=function(){try{var parentRef=window.parent;if(!this.isChatInProgress()){parentRef=this.r11rbbv();}
parentRef.inqFrame.Application.application.customerEndsCobrowse();}catch(e){log("We have a cobrowse error"+e);}};GR34.prototype.getFlashVarData=function(){var retval=null;if(this._flashvarFcns.length>0){retval=MI8.mixAbsorber({});for(var idx=0;idx<this._flashvarFcns.length;idx++){retval.absorb(this._flashvarFcns[idx]());}}
return retval;}
GR34.prototype.getAgentGroupID=function(evt,agentAssignedStage){var agentGroupID;if(agentAssignedStage){agentGroupID=this.getChat()&&this.getChat().getChatData()&&this.getChat().getChatAgentGroupID()?this.getChat().getChatAgentGroupID():undefined;}else{agentGroupID=this.getChat()&&this.getChat().getChatData()&&this.getChat().getChatAgentGroupID()?this.getChat().getChatAgentGroupID():(this.getChat()&&this.getChat().getAgentGroupID()?this.getChat().getAgentGroupID():(evt.rule&&evt.rule.getAgentGroupID()?evt.rule.getAgentGroupID():(this.getLastChat()&&this.getLastChat().agentGroupID?this.getLastChat().agentGroupID:undefined)));}
return agentGroupID;}
GR34.prototype.setCABeacon=function(action,data){if(this.chat){this.chat.setCABeacon(action,data);}};GR34.prototype.getQueueThreshold=function(){return this.getChat()?this.getChat().getChatData().qt:null;}
GR34.prototype.getQueueMessagingSpecId=function(){if(this.chat&&this.chat.chatSpec){return this.chat.chatSpec["qmspec"];}};GR34.prototype.EVTS={LAUNCHED:"LAUNCHED",PERSISTENT_PUSH:"PERSISTENT_PUSH",CLOSED:"CLOSED",REQUESTED:"REQUESTED",SHOWN:"SHOWN",ENGAGED:"ENGAGED",BEFORE_CLOSED:"BEFORE_CLOSED"};GR34.prototype.PERSISTENT={PERSISTENT:"persistent",PERSISTENT_COMPLETE:"persistent.complete"};function X43(id,data){this._observable();this._frameworkModule(id);this.absorb(data);this._c2cList=[];this.stateVar=null;this.sessionVar=null;this.requestInProgress=false;}
MI8.prepare(X43).im13(MI8.XJA3).im13(MI8.FM2).im13(MI8.Persistable).im13(MI8.Observable);X43.prototype.getPersistentID=function(){return this.getID();};X43.prototype.init=X43.prototype.start=function(){};X43.prototype.reset=function(){for(var i=0;i<this._c2cList.length;i++){if(typeof this._c2cList[i]!=="undefined"){this._c2cList[i].reset();this._c2cList[i].onChatClosed=null;delete this._c2cList[i];}}};X43.prototype.load=function(){function fixBlockedServicesData(){var blocked={};var sessionServices=sessionData["blocked"];if(!!sessionServices){for(var service in sessionServices){blocked[service]=sessionServices[service];}}
var stateServices=stateData["blocked"];if(!!stateServices){for(var service in stateServices){blocked[service]=stateServices[service];}}
return blocked;}
this.stateVar=new VBER34(this.getID(),{},resources["state"]);this.sessionVar=new VBER34(this.getID(),{},resources["session"]);var stateData=this.stateVar.getValue();this.absorb(stateData);var sessionData=this.sessionVar.getValue();this.absorb(sessionData);if(!!this.blocked){this.blocked=fixBlockedServicesData();}};X43.prototype.save=function(){function prepareBlockedServicesData(services){for(var service in services){if(services[service]==0){if(!sessionData.blocked){sessionData.blocked={};}
sessionData.blocked[service]=services[service];}else if(services[service]==-2){}else{if(!stateData.blocked){stateData.blocked={};}
stateData.blocked[service]=services[service];}}}
var stateData={};var sessionData={};if(!!this.blocked){prepareBlockedServicesData(this.blocked);}
this.stateVar.setValue(stateData);this.sessionVar.setValue(sessionData);};X43.prototype.agrtyer=function(){this.load();};X43.prototype.tryue=function(serviceType,period){if(serviceType!=GR34.CHM.CHAT_TYPES.C2C&&serviceType!=GR34.CHM.CHAT_TYPES.C2CALL){return;}
if(isNullOrUndefined(this.blocked)){this.blocked={};}
if(isNullOrUndefined(this.blocked[serviceType])||(!isNullOrUndefined(this.blocked[serviceType])&&this.blocked[serviceType]<(new Date).getTime())){if(period>0){var now=new Date();period+=now.getTime();}
this.blocked[serviceType]=period;this.save();}};X43.prototype.unblockService=function(serviceType){if(serviceType!=GR34.CHM.CHAT_TYPES.C2C&&serviceType!=GR34.CHM.CHAT_TYPES.C2CALL){return;}
if(!isNullOrUndefined(this.blocked)&&!isNullOrUndefined(this.blocked[serviceType])){delete this.blocked[serviceType];}
this.save();};X43.prototype.isBlocked=function(serviceType){var blockedValue=false;if(!isNullOrUndefined(this.blocked)&&!isNullOrUndefined(this.blocked[serviceType])){var now=new Date();var toDate=this.blocked[serviceType];if(toDate<=0){blockedValue=true;}
else{blockedValue=toDate>=now.getTime();}}
return blockedValue;};X43.prototype.isAnyBlocked=function(){if(isNullOrUndefined(this.blocked)){return false;}
for(var prop in this.blocked){return true;}
return false;};X43.prototype.agrty=function(idx,callThisNumber){var c2c=this.getC2C(idx);if(!c2c){log("can't find c2c "+idx);return;}
if((c2c.c2p&&c2c.getChatType()!=GR34.CHM.CHAT_TYPES.C2CALL)||(callThisNumber!=null&&(!c2c.isClicked()))){CHM.wecv56(c2c.c2cSpec.chatSpec.chatTheme);}
if(!c2c.isClicked()){this.fireC2CClicked(c2c);var self=this;CM.updateCACookie(function(){CHM.request(c2c.getRule(),c2c.getChatType(),c2c.getXmlChatSpec(),callThisNumber||null,c2c.c2p,function(){self.showDisabledIcon();});});c2c.setClicked(true);X43.lastusedC2CId=c2c.pageElementID;X43.c2cBtnId=null;}
else{log("Ignored C2C double click");}};X43.prototype.showDisabledIcon=function(){for(var i=0;i<this._c2cList.length;i++){if(typeof this._c2cList[i]!=="undefined"){this.getC2C(i).showDisabledIcon();}}};X43.prototype.getC2C=function(idx){return this._c2cList[idx];};X43.prototype.request=function(rule,chatType,dataFcn,clickToPersistent){if(this.isBlocked(chatType)){return;}
var c2c=new C2C(this,rule,chatType,dataFcn,clickToPersistent?clickToPersistent:isC2cPersistent(),this.adaCompliant,this.adaAndroidC2cSupportDomains);if(c2c.getDiv()){this._c2cList[c2c.getIdx()]=c2c;if(!this.requestInProgress){this.requestInProgress=true;c2c.request();}
log('X43 request: {ruleName: \"'+rule.getName()+'\"}');}else{C2C.IDX--;if(c2c.isDivOccupied()){var exposureData={siteID:Inq.getSiteID(),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:rule.id,group:PM.getVar("incGroup").getValue(),businessUnitID:rule.getBusinessUnitID(),result:"existing_offer",rule:rule};BRM.fireExposureQualifiedEvent(exposureData);log("C2C div already occupied: "+rule.getName());}else{log("C2C div not found for "+rule.getName());}}};X43.prototype.nextRequest=function(completedC2C){log("C2C request complete for "+completedC2C.getRule().getName());this.requestInProgress=false;var nextIdx=completedC2C.getIdx()+1;var nextC2C=this._c2cList[nextIdx];if(!!nextC2C){log("Issuing next C2C request for "+nextC2C.getRule().getName());this.requestInProgress=true;nextC2C.request();}};X43.prototype.showCallButton=function(indx,source,left,top,number,show,giveFocus,title){var c2c=this.getC2C(indx);if(c2c!=null)
c2c.showCallButton(source,left,top,number,show,giveFocus,title);};X43.prototype.isListener=function(l){return!!(l&&(l.onC2CDisplayed||l.onC2CClicked||l.onC2CStateChanged));};X43.prototype.onChatClosed=function(){this.clicked=false;};X43.prototype.fireC2CStateChanged=function(data){var evt={c2c:data.c2c,oldState:data.oldState,newState:data.newState,rule:data.rule,serviceType:CHM.CHAT_TYPES.C2C,customerID:Inq.getCustID(),data:data.data,bizRuleName:data.rule?data.rule.getName():null};function f(l,evt){try{if(!!l.onC2CStateChanged){l.onC2CStateChanged(evt);}}catch(e){log("Error firing event fireC2CStateChanged on "+l.toString()+":"+e);}}
this._fireEvt(f,evt);};X43.prototype.fireC2CDisplayed=function(data){var evt=MI8.mixAbsorber({c2c:data.c2c,rule:data.rule,serviceType:CHM.CHAT_TYPES.C2C,customerID:Inq.getCustID(),data:data.data,bizRuleName:data.rule?data.rule.getName():null});var buID=data.rule?data.rule.getBusinessUnitID():null;var agID=data.rule?data.rule.getAgentGroupID():null;if(agID&&parseInt(agID)>0){evt.absorb({agentGroupID:agID});}
if(buID&&parseInt(buID)>0){evt.absorb({businessUnitID:buID});}
function f(l,evt){try{if(!!l.onC2CDisplayed){l.onC2CDisplayed(evt);}}catch(e){log("Error firing event C2CDisplayed on "+l.toString()+":"+e);}}
this._fireEvt(f,evt);};X43.prototype.fireC2CClicked=function(c2c){var evt=MI8.mixAbsorber({c2c:c2c,rule:c2c.getRule(),serviceType:CHM.CHAT_TYPES.C2C,customerID:Inq.getCustID(),bizRuleName:c2c.getRule()?c2c.getRule().getName():null});var buID=c2c.getRule()?c2c.getRule().getBusinessUnitID():null;var agID=c2c.getRule()?c2c.getRule().getAgentGroupID():null;if(agID&&parseInt(agID)>0){evt.absorb({agentGroupID:agID});}
if(buID&&parseInt(buID)>0){evt.absorb({businessUnitID:buID});}
function f(l,evt){try{if(!!l.onC2CClicked){l.onC2CClicked(evt);}}catch(e){log("Error firing event C2CClicked on "+l.toString()+":"+e);}}
this._fireEvt(f,evt);};X43.prototype.IMAGETYPES={disabled:"d",busy:"b",afterHours:"ah",ready:"r"};X43.prototype.STATES={"d":"chatactive","b":"busy","ah":"outofhours","r":"ready"};X43.c2cBtnId=null;function Chat(chatData){this.sesVar=new VBER34("chat",{},resources["session"]);this._className="Chat";this._stage=window.parent.document.getElementById("inqChatStage");this.intervalId=0;this._isVisible=false;this.dragHandleID="inqTitleBar";this.cd=MI8.clonize(chatData);this.rule=null;this.agID=null;this.agName=null;this.BEACON_DATA="DATA";}
MI8.prepare(Chat).im13(MI8.XJA3);Chat.prototype.setSurvey=function(sdat){if(!!sdat&&sdat.id>0){this.cd.sid=sdat.id;this.save();}else{log("chat.setSurvey(): Survey data set failed. sdat undefined or invalid sid"+sdat);}};Chat.prototype.load=function(){var cd=this.cd;if(isNullOrUndefined(cd)){cd=MI8.clonize(this.sesVar.getValue());if(isNullOrUndefined(cd)){return null;}}
if(!isNullOrUndefined(cd)){cd.aMsgCnt=(isNullOrUndefined(cd.aMsgCnt))?0:cd.aMsgCnt;cd.cMsgCnt=(isNullOrUndefined(cd.cMsgCnt))?0:cd.cMsgCnt;if(isNullOrUndefined(cd.launchPageId)){cd.launchPageId=LDM.getPageID();}}
Chat.validate(cd);this.cd=cd;this.chatSpec=MM.mergeChatSpec(cd.xmlSpec);this.rule=BRM.getRuleById(cd.ruleID);return this;};Chat.prototype.getCiData=function(){return!!this.cd?this.cd.ci:{};};Chat.prototype.setCiData=function(dat,doNotSave){if(this.cd){this.cd.ci=dat;if(!doNotSave)
this.save();}};Chat.unmarshal=function(chatData){return new Chat(chatData);};Chat.prototype.bumpAgtMsgCount=function(){if(!!this.cd)
this.cd.aMsgCnt+=1;};Chat.prototype.bumpCustMsgCount=function(){if(!!this.cd)
this.cd.cMsgCnt+=1;};Chat.prototype.getCustMsgCnt=function(){if(!!this.cd)
return this.cd.cMsgCnt;return 0;};Chat.prototype.getChatData=function(){try{return!!this.cd?this.cd.clone():null;}catch(err){MI8.clonize(this.cd);return this.cd.clone();}};Chat.prototype.getAgentMsgCnt=function(){if(!!this.cd)
return this.cd.aMsgCnt;return 0;};Chat.prototype.save=function(){this.sesVar.setValue(this.cd);};Chat.prototype.getCustID=function(){return Inq.custID;};Chat.prototype.getChatID=function(){if(!!this.cd)
return this.cd.id;return null;};Chat.prototype.getChatType=function(){return this.cd.chatType;};Chat.prototype.isC2cToPersistent=function(){return this.cd.c2cToPersistent;};Chat.prototype.getLanguage=function(){var language;try{language=this.getRule().getLanguage();}catch(e){log("Error while getting language from Rule: \n"+e+"\n");}
if(!language){language=getDefaultLanguage();}
return language;};Chat.prototype.onLocalCallback=function(){try{this.show();}catch(e){log("Error in above code: \n"+e+"\n"+data);}};Chat.prototype.getRule=function(){return this.rule;};Chat.prototype.getRuleId=function(){var ruleID=this.rule.getID();return!!ruleID?ruleID:"";};Chat.prototype.getRuleName=function(){return this.rule.getName();};Chat.prototype.monitorChatActive=function(){if(!(CM.xd))return;CM.cookies["inqCA"]=1;var request=["CHATACTIVE","CHATACTIVE",Inq.siteID,isPersistentWindow(),this.getChatData().v3TO];CM.postRequestToIframeProxy(request);};Chat.prototype.closeChatMonitor=function(){if(!(CM.xd))return;CM.cookies["inqCA"]=0;var request=["CHATACTIVE","CHATDEACTIVATE",Inq.siteID,isPersistentWindow(),this.getChatData().v3TO];CM.postRequestToIframeProxy(request);};Chat.prototype.setCABeacon=function(action,data){var url=secureHTTP(Inq.urls.pageUnloadURL);var beaconData={};beaconData[KEY_ENGAGEMENT_ID_STRING]=this.getChatID();beaconData[KEY_CUSTOMER_ID_STRING]=this.getCustID();if(action==this.BEACON_DATA&&data){for(var key in data){beaconData[key]=data[key];}}
var beaconRequest=["BEACON",action,MI8.JSON.stringify(beaconData),url,this.getChatID()];LoadM.postRequestToIframeProxy(url,beaconRequest);};Chat.prototype.show=function(){var type=this.getChatType();if(this.chatSpec!=null&&((type==CHM.CHAT_TYPES.C2C)||(type==CHM.CHAT_TYPES.PERSISTENT))&&this.isC2cToPersistent()){if(!CHM.r11rbbv()){CHM.popOutChat(true);return;}}
this.preloadChat();this.monitorChatActive();this.setVisible(true);FP.startChatInterface();};Chat.prototype.close=function(){this.setVisible(false);this.closeChatMonitor();FP.closeChatInterface();this.closed=true;this.sesVar.setValue(null);this.endCobrowseSession();};Chat.prototype.isClosed=function(){return!!(this.closed);};Chat.prototype.isVisible=function(){return this._isVisible;};Chat.prototype.setVisible=function(vis){this._isVisible=vis;var _corner=window.parent.document.getElementById("inqDivResizeCorner");var _title=window.parent.document.getElementById("inqTitleBar");var _stage=window.parent.document.getElementById("inqChatStage");_stage.style.display=(vis)?"":"none";if(_corner)_corner.style.display=(vis)?"":"none";if(_title)_title.style.display=(vis)?"":"none";};Chat.prototype.getDragHandle=function(){return this.dragHandleID;};Chat.prototype.setDragHandle=function(handleElementID){this.dragHandleID=handleElementID;};Chat.prototype.setResizable=function(){if(this._stage==null)
this._stage=window.parent.document.getElementById("inqChatStage");var resizeHandleElem=window.parent.document.getElementById("inqDivResizeCorner");if(typeof Inq.Resize!="undefined"&&resizeHandleElem){Inq.Resize.__init(resizeHandleElem,this._stage);}};Chat.prototype.setDragable=function(){if(this._stage==null)
this._stage=window.parent.document.getElementById("inqChatStage");var dragHandleElem=window.parent.document.getElementById("inqTitleBar");try{if(typeof Inq.Drag!="undefined"&&dragHandleElem)
Inq.Drag.__init(dragHandleElem,this._stage);}catch(e){}};Chat.prototype.transitionMessage=function(persistentState){var params={agentID:CHM.getAgentID(),chatID:CHM.getChatID(),transitioning:persistentState};ROM.send(urls.baseURL+"/tracking/persistentMsg",params,false,true,20,5000);if(persistentState.equals(CHM.PERSISTENT.PERSISTENT_COMPLETE)&&this.getCiData().isEngaged){ROM.send(CHM.getChatRouterURL()+"/chatrouter/chat/persistentComplete",{"engagementID":CHM.getChatID()});}};Chat.prototype.popOutChat=function(transition,top,left,bottom,right){if(transition)
this.transitionMessage(Inq.CHM.PERSISTENT.PERSISTENT);CHM.setPersistentChatSetting("true");var persistentFocus=true;var winTest=null;var sHeight=300;var sWidth=400;var sLeft=40;var sTop=20;var cdata=this.chatSpec;if(cdata&&cdata.chatTheme){sHeight=cdata.chatTheme.ph;sWidth=cdata.chatTheme.pw;sLeft=cdata.chatTheme.px;sTop=cdata.chatTheme.py;}
var url,target;url=Inq.v3framesrc;target="_inqPersistentChat";winTest=CHM.earlyPopout;if(winTest!=null&&winTest.closed==false){CHM.earlyPopout=null;winTest.location=url;}
else{CHM.earlyPopout=null;var tools="toolbar=no,location=no,menubar=no,status=no,scrollbars=no"+",top="+sTop+",left="+sLeft+",width="+sWidth+",height="+sHeight+",resizable=1";try{winTest=window.parent.top.open(url,target,tools);if(!winTest){CHM.sendMsg({chatID:this.getChatID(),msg:MI8.JSON.stringify({PopupBlocker:"<b>Persistent Chat Push: FAILED</b>"})});}
if(""!=url){if(winTest==top)
winTest=null;}
else{var newdoc=null;if(winTest){try{newdoc=winTest["document"];}catch(e){}
if(newdoc==null)
try{newdoc=winTest.document;}catch(e){}}
if(newdoc){var scriptz=document.getElementsByTagName("SC"+"RIPT");var scrp=null;for(ix=0;ix<scriptz.length;ix++){if(scriptz[ix].src.indexOf("/inqChatLaunch")>=0){scr='<script type="text/javascript" src="'+scriptz[ix].src+'"/></script>';break;}}
if(scrp)
newdoc.write(scrp);else
newdoc.close();}}
cdata.pC=null!=winTest;}catch(e){winTest=null;}}
CHM.popoutWindow=winTest;if(winTest){if(winTest.focus&&!CHM.isMobile()){try{winTest.focus();}
catch(e){}}
cdata.pC=true;return true;}
else
return false;};Chat.prototype.toString=function(){var val='Chat: ';for(var n in this){val+=""+n+"="+this[n]+",";}
return val;};Chat.prototype.getFlashVars=function(){var sesVar=PM.getVar("sesID");var incVar=PM.getVar("incID");var launchPageId=this.getChatData().launchPageId;var launchPageMarker=LDM.getPageMarkerById(launchPageId);var visitorAttributes=encodeURIComponent(VAM.getCopyAsArray(true).join(';'));var externalCustomerIDs=encodeURIComponent(VAM.getExternalCustomerIdVisitorAttributesAsString());var flashvars='continued='+(CHM.isV3Continue()?'1':'0')+'&sessionID='+(sesVar?sesVar.getValue():123456)+'&incAssignmentID='+(incVar?incVar.getValue():123456)+'&businessUnitID='+this.getBusinessUnitID()+'&chatID='+this.getChatID()+'&customerID='+this.getCustID()+'&agentName='+encodeURIComponent(this.getAgentName())+'&overrideAgentAlias='+this.getOverrideAgentAlias()+'&scriptID='+this.getScriptID()+'&agentExitLine='+encodeURIComponent(this.getAgentExitLine())+'&siteID='+Inq.siteID+'&userName='+encodeURIComponent(this.getCustomerName())+'&agent'+'&newFramework=1'+'&title=foo'+'&chatTitle='+this.rule.name+'&crHost='+CHM.getChatRouterURL()+'&submitURL='+CHM.getChatRouterURL()+'&tagServerBaseURL='+Inq.urls.vanityURL+'&commTypes=http'+'&brID='+this.rule.id+'&agentAttributes='+encodeURIComponent(this.getAgentAttributesAsString())+'&ruleAttributes='+encodeURIComponent(this.getRuleAttributesAsString())+'&deviceType='+getDeviceType()+'&browserType='+getClientBrowserType()+'&browserVersion='+getClientBrowserVersion()+'&operatingSystemType='+getOSType()+'&visitorAttributes='+visitorAttributes+'&launchType='+this.getChatType()+'&language='+this.getLanguage()+'&launchPageMarker='+launchPageMarker+'&launchPageId='+launchPageId+'&qt='+CHM.getQueueThreshold();if(this.rule["phoneNumber"]!=null)
flashvars+='&clickToPhone='+this.rule.phoneNumber;if(this.pC||CHM.isPersistentWindow())flashvars+="&PersistentFrame=1";var automatonId=this.getAutomatonId();if(!isNullOrUndefined(automatonId)){flashvars+='&automatonId='+automatonId;var automatonFields=this.getAutomatonFields();if(!isNullOrUndefined(automatonFields)){flashvars+='&automatonFields='+encodeURIComponent(JSON.stringify(automatonFields));}}
var automatonSpecData=this.getAutomatonSpecData();if(!isNullOrUndefined(automatonSpecData)){flashvars+='&automatonSpecData='+encodeURIComponent(MI8.JSON.stringify(automatonSpecData));}
if(externalCustomerIDs){flashvars+='&externalCustomerIDs='+externalCustomerIDs;}
if(this.getOpenerName()){flashvars+='&openerName='+this.getOpenerName();}else{flashvars+='&openerID='+this.getOpenerID();}
var agID=this.getAgentGroupID();if(!isNullOrUndefined(agID)){flashvars+='&agID='+agID;var agName=CHM.getAgentGroupNameByID(agID);if(!isNullOrUndefined(agName)){flashvars+='&agName='+agName;}}
var uniqueAgentName=this.getUniqueAgentName();if(!isNullOrUndefined(uniqueAgentName)){flashvars+='&uniqueAgentName='+uniqueAgentName;}
var agentAutoOpenerId=this.getAgentAutoOpenerId();if(!isNullOrUndefined(agentAutoOpenerId)){flashvars+='&agentAutoOpenerId='+agentAutoOpenerId;}
var flashvarFcnsData=decodeURIComponent(Inq.ROM.toParamString(CHM.getFlashVarData()));if(flashvarFcnsData&&flashvarFcnsData.length>0){flashvars+="&"+flashvarFcnsData;}
flashvars=this._fixFlashVars(flashvars);return flashvars;};Chat.prototype.getAgentAttributesAsString=function(){try{return this.getRule().getAgentAttributesAsString();}
catch(e){log("Error getAgentAttributes "+e);}
return null;};Chat.prototype.getRuleAttributesAsString=function(){try{return this.getRule().getRuleAttributesAsString();}
catch(e){log("Error getting rule attributes "+e);}
return null;};Chat.prototype.getSkin=function(){return Inq.urls.skinURL+this.chatSpec.chatTheme.fn.replace(/\.(mxml|zip)$/,"")+".mxml";};Chat.prototype.getImagePath=function(){return Inq.urls.mediaSiteURL+"/flash/";};Chat.prototype.preloadChat=function(){var src;var scrpt=document.createElement("SC"+"RIPT");scrpt.type="text/javascript";scrpt.language="javascript";scrpt.setAttribute("language","javascript");scrpt.setAttribute("type","text/javascript");scrpt.charset="utf-8";src=Inq.urls.mediaRootURL+"/flash/InqFramework";switch(getCiObfuscationLevel()){case 1:src+="-w";break;case 2:src+="-s";break;case 3:src+=(isJsLoggingActive())?"-a":"-qa";break;case 0:default:break;}
src+=".js?codeVersion="+((v3Lander)?encodeURIComponent(v3Lander.codeVersion):"undefined");scrpt.src=src;scrpt.id="inqChatJs";window.document.getElementsByTagName("body")[0].appendChild(scrpt);if(!window.parent.Inq.datapass&&isPersistentWindow()){window.parent.Inq.datapass=window.parent.opener.Inq.datapass;}};Chat.prototype._fixFlashVars=function(fv){if(undefined==fv)
return"";if(fv.indexOf("&clickStream=")>=0)
return fv;var extraFlashVars="";var clickStreamData=null;try{var obj=(CHM.isPersistentWindow())?window.parent.opener.inqFrame.Inq.FlashPeer.getAgentData():FP.getAgentData();clickStreamData=unescape(Inq.ROM.toParamString(obj,true));}catch(e){log(e);}
if(clickStreamData!=null&&clickStreamData!="")
extraFlashVars+="&clickStream="+escape(clickStreamData);if(navigator.userAgent)
extraFlashVars+="&userAgent="+escape(navigator.userAgent);return(fv+extraFlashVars);};Chat.prototype.isPersistent=function(){return this.pC;};Chat.prototype.getBusinessUnitID=function(){var businessUnitID;try{businessUnitID=this.getRule().getBusinessUnitID();}catch(e){log("Error getting chat business unit id: \n"+e+"\n");}
if(isNullOrUndefined(businessUnitID)){businessUnitID=getDefaultBusinessUnitID();}
return businessUnitID;};Chat.prototype.getAgentGroupID=function(){return this.rule==null?null:this.rule.getAgentGroupID();};Chat.prototype.getUniqueAgentName=function(){return this.rule==null?null:this.rule.getUniqueAgentName();};Chat.prototype.getAgentName=function(){var agentName="";try{agentName=this.chatSpec.chatTheme.an;if(!agentName){agentName=MM.getChatTheme(this.chatSpec.chatTheme.id).an;}}catch(e){}
return agentName;};Chat.prototype.getOverrideAgentAlias=function(){var result=false;if(this.chatSpec&&this.chatSpec.chatTheme&&!isNullOrUndefined(this.chatSpec.chatTheme.oaa)){result=this.chatSpec.chatTheme.oaa;}
return result;};Chat.prototype.getAgentID=function(){return isNullOrUndefined(this.cd.aid)?"":this.cd.aid;};Chat.prototype.setAgentConfig=function(aid,buID,agID,agentAttrs){var agName=CHM.getAgentGroupNameByID(agID);this.cd.aid=isNullOrUndefined(aid)?"":aid;this.cd.buID=buID;this.cd.agID=agID;this.cd.agName=agName;this.cd.agtAttrs=this.agentAttributesStringToMap(agentAttrs);CHM.getLastChat().businessUnitID=buID;CHM.getLastChat().agentGroupID=agID;CHM.getLastChat().agentGroupName=agName;CHM.getLastChat().agentID=aid;};Chat.prototype.agentAttributesStringToMap=function(attrs){function split2(str,sep){var index=str.indexOf(sep);if(index<0){return[str,""];}else{return[str.substring(0,index),str.substring(index+sep.length)];}}
var map={};var delimiter='=';if(!!attrs){var attrsArray=attrs.split(',');for(var i=0;i<attrsArray.length;i++){var nameValue=split2(attrsArray[i],delimiter);if(!map[nameValue[0]]){map[nameValue[0]]=[];}
map[nameValue[0]].push(nameValue[1]);}}
return map;};Chat.prototype.testAgentAttributesValue=function(name,testValue){var agentAttrs=this.cd.agtAttrs;var values=agentAttrs[name];if(values){for(var i=0;i<values.length;i++){if(values[i]==testValue){return true;}}}
return false;};Chat.prototype.getChatBusinessUnitID=function(){return isNullOrUndefined(this.cd.buID)?-1:this.cd.buID;};Chat.prototype.getChatAgentGroupID=function(){return isNullOrUndefined(this.cd.agID)?null:this.cd.agID;};Chat.prototype.getChatAgentGroupName=function(){return isNullOrUndefined(this.cd.agName)?null:this.cd.agName;};Chat.prototype.getScriptID=function(){var id=0;try{id=this.chatSpec.stId;}catch(e){}
return id;};Chat.prototype.getAgentExitLine=function(){var line="";try{line=this.chatSpec.ael;}catch(e){}
return line;};Chat.prototype.getOpenerID=function(){var opener=0;try{opener=this.chatSpec.oId;}catch(e){}
return opener;};Chat.prototype.getOpenerName=function(){return!!this.chatSpec&&!!this.chatSpec.oName?this.chatSpec.oName:null;};Chat.prototype.getAgentAutoOpenerId=function(){return!!this.chatSpec&&!!this.chatSpec.aaoId?this.chatSpec.aaoId:null;};Chat.prototype.getCustomerName=function(){var name="";try{name=this.chatSpec.chatTheme.cn;if(!name){name=MM.getChatTheme(this.chatSpec.chatTheme.id).cn;}}catch(e){}
return name;};Chat.prototype.getChatSpec=function(){var spec=null;try{spec=this.chatSpec;}catch(e){}
return spec;};Chat.prototype.getAutomatonId=function(){try{if(!isNullOrUndefined(this.chatSpec.aId)){return this.chatSpec.aId;}else if(!isNullOrUndefined(this.chatSpec.aSpecId)){return this.chatSpec.aSpecId;}}catch(e){}
return null;};Chat.prototype.getAutomatonFields=function(){var result=null;if(this.chatSpec&&this.chatSpec.aFields){result=this.chatSpec.aFields;}
return result;};Chat.prototype.getAutomatonSpecData=function(){try{if(!isNullOrUndefined(this.chatSpec.aspecData)){return this.chatSpec.aspecData;}}catch(e){}
return null;};Chat.prototype.endCobrowseSession=function(){if(Inq["CBC"])Inq.CBC.stop();};Chat.prototype.getCobrowseBannerText=function(){if(Inq["CBC"])
return Inq.CBC.getCobrowseBannerText();return"";};Chat.prototype.getAgentAttributeValue=function(attrName){var agentAttributes=this.cd.agtAttrs;if(typeof attrName=="string"||attrName.length!=0||agentAttributes[attrName]){return agentAttributes[attrName][0];}else{return"";}};Chat.validate=function(data){var inou=isNullOrUndefined;var cerr="Chat.constructor Err: ";if(inou(data))
throw(cerr+"chatData empty");if(!data.chatType)
throw(cerr+"chat type missing");if(!data.xmlSpec)
throw(cerr+"chat xml data missing");if(!data.ruleID)
throw(cerr+"ruleID missing");if(!data.id)
throw(cerr+"chatID missing");if(inou(data.pC))
throw(cerr+"persistent chat boolean missing");if(inou(data.aMsgCnt)||data.aMsgCnt<0||inou(data.cMsgCnt)||data.cMsgCnt<0){throw(cerr+"agt/cust msg cnt not properly initialized");}
if(inou(data.ci)){throw(cerr+"ci data missing");}};function FlashPeer(id,data){function isV3C2CPersistent(){return!!v3C2cPersistent;}
function closePopupChat(isRequestedFromPersistentMode){if(isRequestedFromPersistentMode){setTimeout(closePopupChat,0);}else{CHM.inactivateChat();}}
function closePopupChatFromPersistent(){var opener=window.parent.opener;if(opener!=null&&typeof opener.inqFrame!="undefined"&&typeof opener.inqFrame.Inq!="undefined"&&typeof opener.inqFrame.inqFrame.Inq.FlashPeer!="undefined"&&typeof opener.inqFrame.Inq.FlashPeer.closePopupChat!="undefined"){opener.inqFrame.Inq.FlashPeer.closePopupChat(true);}else{log("Could not close popup chat");}}
function isAutoFixPrechatSurvey(){var autoFix=getConstant("AUTO_FIX_PRECHAT_SURVAY",null);if(autoFix===undefined)autoFix=true;return autoFix;}
function setData(data){FlashPeer.data=data;}
function fireCustomEvent(eventName,rule,evt,evtDataSupplementFcn){if(typeof evtDataSupplementFcn==='string'&&evtDataSupplementFcn.indexOf('function(')==-1){evtDataSupplementFcn="function() { return "+evtDataSupplementFcn+"}";}
EVM.fireCustomEvent(eventName,rule,evt,evtDataSupplementFcn);}
function fireCustomEvt(eventName,jsonData,dataFcn){var evt=null;if(typeof jsonData=="string"){evt=MI8.JSON.parse(jsonData);}
if(typeof dataFcn==='string'&&dataFcn.indexOf('function(')==-1){dataFcn="function() { return "+dataFcn+";}";}
EVM.fireCustomEvent(eventName,null,evt,dataFcn);}
function set3rdPartyCookieFromQueue(){var obj=CM;obj.set3rdPartyCookieFromQueue();}
function closeChat(_doSoftKill){Inq.log("closeChat("+_doSoftKill+")");if(_doSoftKill){CHM.softKill(this,null,"Flash closed");}else{CHM.closeChat(this,null,"Flash closed");}}
function setSurveyAuxParams(surveyParams){CHM.setSurveyAuxParams(surveyParams);}
function getSurveyAuxParams(){return CHM.getSurveyAuxParams();}
function setClickStreamSent(isSent){CHM.setClickStreamSent(isSent);}
function isClickStreamSent(){return CHM.isClickStreamSent();}
function agentSurveyCall(specID){SVYM.showSurvey(specID,"",CHM.getSurveyAuxParams());}
function showTextInput(bShow,y,x,w,h){CHM.showTextInput(bShow,y,x,w,h);}
function showPersistentButton(x,y,w,h){}
function setDisconnectFlag(){CHM.setDisconnectFlag(1);}
function setPersistentButtonDebugActive(active){log("setPersistentButtonDebugActive()");CHM.setPersistentButtonDebugActive(active);}
function hidePersistentButton(){log("hidePersistentButton()");CHM.hidePersistentButton();}
function showThankyou(){log("showThankyou()");try{CHM.closeChat(this,null,"Flash thankyou.");return true;}
catch(e){log(e);}
return false;}
function hideFramesetChat(){CHM.closeChat();}
function postRequestToIframeProxy(serverPath,request,id,context){LoadM.postRequestToIframeProxy(serverPath,request,id,context);}
function updateFrameName(id,key){LoadM.updateFrameName(id,key);}
function setChatBanished(){}
function setAgentConfig(_agentID,cobrowseEnabled,eventDataStr,buID,agID){CHM.assignAgent(_agentID,false,cobrowseEnabled,eventDataStr,buID,agID);}
function registerWDMClient(clientID,checkInterval,isAliveCallback,resetStateCallback){WDM.registerClient(clientID,checkInterval,isAliveCallback,resetStateCallback);}
function unregisterWDMClient(clientID){WDM.unregisterClient(clientID);}
function getAgentData(){var params=MI8.mixAbsorber({});try{if(typeof self.inqAgentData!="undefined"){params.absorb(self.inqAgentData);}
if(!isNullOrUndefined(self.inqData)){if(self.inqData instanceof Array){for(var i=0;i<self.inqData.length;i++){params["data"+i]=self.inqData[i];}}
else if(self.inqData instanceof Object){params.absorb(self.inqData);}}
params["markerHistory"]=LDM.getLandingHistory().join(", ");var launchPageId=CHM.getChatData().getChatData().launchPageId;params["launchPageMarker"]=LDM.getPageMarkerById(launchPageId);}catch(e){}
return params;}
function onEngaged(event){Inq.CHM.fireChatEngaged(event);BRM.fireServiceEngagedEvent(event);}
function onChatShown(event){CHM.fireChatShown(null);}
function onBeforeChatClosed(){CHM.fireBeforeChatClosed();}
function onInteracted(event){BRM.fireServiceInteractedEvent(event);}
function onCustomerMsg(eventData){CHM.fireCustomerMsgEvent(eventData);}
function onAgentMsg(){CHM.fireAgentMsgEvent();}
function onAssisted(){}
function PushToFrameset(_sUrl,_sTarget,_fromClick){if(_fromClick&&(_sTarget!="_self")&&(_sTarget!="_top")&&(_sTarget!="_parent")){if(!(CM).isThirdPartyCookieQueueEmpty()){var winTarget=null;var tools="left=0,top=0,toolbar=1,location=1,menubar=1,status=1,scrollbars=1";winTarget=window.parent.top.open("about:blank",_sTarget,tools);if(null==winTarget){winTarget=window.parent.top.open("about:blank",_sTarget);}}}
CM.whenCookiesCommitted(new Function("inqFrame.Inq.FlashPeer.doPushToFrameset("+toJsString(_sUrl,'"')+","+toJsString(_sTarget,'"')+");"));}
function doPushToFrameset(_sUrl,_sTarget){try{if("_inqPersistentChat"==top.name){if("_self"==_sTarget){getOpener().top.document.location.href=_sUrl;}else{var winTarget=null;var tools="left=0,top=0,toolbar=1,location=1,menubar=1,status=1,scrollbars=1";winTarget=window.parent.top.open(_sUrl,_sTarget,tools);if(null==winTarget){winTarget=window.parent.top.open(_sUrl,_sTarget);}}}else{if("_self"==_sTarget){window.parent.top.document.location.href=_sUrl;}else{var winTarget=null;winTarget=window.parent.top.open(_sUrl,_sTarget,"top=0;left=0");if(null==winTarget){winTarget=window.parent.top.open(_sUrl,_sTarget);}}}}catch(e){}}
function browserHasFlash(){var flash_version;if(navigator.plugins&&typeof navigator.plugins["Shockwave Flash"]=="object"){var desc=navigator.plugins["Shockwave Flash"].description;if(desc){var versionStr=desc.replace(/^.*\s+(\S+\s+\S+$)/,"$1");var major=parseInt(versionStr.replace(/^(.*)\..*$/,"$1"));var build=parseInt(versionStr.replace(/^.*r(.*)$/,"$1"));flash_version=parseFloat(major+"."+build);}}else if(window.ActiveXObject){try{var flashObj=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");var desc=flashObj.GetVariable("$version");if(desc){var versionArr=desc.replace(/^\S+\s+(.*)$/,"$1").split(",");var major=parseInt(versionArr[0]);var build=parseInt(versionArr[2]);flash_version=parseFloat(major+"."+build);}}catch(e){}}
if(typeof flash_version!="undefined"){return(flash_version>=Inq.requiredFlashVersion);}
return false;}
function ForceFocus(){try{try{document.createElement("object").setAttribute("type","application/x-shockwave-flash");}catch(er){}
var clnt=self.document.getElementById("client");var nclnt=self.document.getElementById("notclient");if(clnt){self.focus();clnt.focus();if(nclnt){nclnt.focus();}}}catch(e){}}
function requestTranscript(_emailAddress,customerName){var url=urls.vanityURL+"/tagserver/transcriptrequest/logTranscriptRequest";var _chatID=CHM.getChatID();var _emailSpecID=CHM.getEmailSpecId();var _customerName=(customerName?customerName:CHM.getCustomerName());var _siteID=Inq.getSiteID();var map={chatID:_chatID,emailAddress:_emailAddress,emailSpecID:_emailSpecID,customerName:_customerName,siteID:_siteID};fireCustomEvent("ChatTranscriptEmailedToCustomer",CHM.getChatData().rule,map);ROM.send(url,map);}
function captureEmailAddress(_emailAddress){var map={custID:Inq.getCustID(),chatID:CHM.getChatID(),emailAddress:_emailAddress};ROM.send(urls.vanityURL+"/tagserver/emailrequest/logEmailAddressCapture",map);}
function startLaunches(isActive){if(!isActive){Inq.CHM.continueChatting();}}
function setDragable(){if(Inq.CHM.chat!=null)
Inq.CHM.chat.setDragable();}
function setResizable(){if(Inq.CHM.chat!=null)
Inq.CHM.chat.setResizable();}
function setV3Data(dictionary){Inq.CHM.setChatInterfaceData(dictionary);}
function getV3Data(){return CHM.getChatInterfaceData();}
function popOutChat(b,resizable){return Inq.CHM.popOutChat(b,resizable);}
function getBaseURL(){return window.Inq.urls.baseURL;}
function getMediaBaseURL(){return window.Inq.urls.mediaBaseURL;}
function getXFormsDomain(){return window.Inq.urls.xFormsDomain;}
function getVanityUrl(){return window.Inq.urls.vanityURL;}
function getChatRouterVanityUrl(){return window.Inq.urls.chatRouterVanityDomain;}
function getTitleBarHeight(){try{return Inq.CHM.chat.chatSpec.chatTheme.tbh;}catch(e){}
return 50;}
function setPopoutChatPosAndDim(x,y,w,h){if(!isNullOrUndefined(x)){Inq.CHM.chat.chatSpec.chatTheme.px=x;}
if(!isNullOrUndefined(y)){Inq.CHM.chat.chatSpec.chatTheme.py=y;}
if(!isNullOrUndefined(w)){Inq.CHM.chat.chatSpec.chatTheme.pw=w;}
if(!isNullOrUndefined(h)){Inq.CHM.chat.chatSpec.chatTheme.ph=h;}};function getPopupCloserWidth(){try{return Inq.CHM.chat.chatSpec.chatTheme.ciw;}catch(e){}
return 50;}
function getLocalizedMessage(key){return Inq.getLocalizedMessage(key);}
function getSkinLocation(){try{return Inq.CHM.chat.chatSpec.chatTheme.pos;}catch(e){}
return"UPPER_LEFT";}
function getSkinHeight(){try{return Inq.CHM.chat.chatSpec.chatTheme.dh;}catch(e){}
return 300;}
function getSkinWidth(){try{return Inq.CHM.chat.chatSpec.chatTheme.dw;}catch(e){}
return 400;}
function getSkinLeft(){try{return Inq.CHM.chat.chatSpec.chatTheme.lx;}catch(e){}
return 0;}
function getSkinTop(){try{return Inq.CHM.chat.chatSpec.chatTheme.ly;}catch(e){}
return 0;}
function getPersistentXPos(){try{return Inq.CHM.chat.chatSpec.chatTheme.px;}catch(e){}
return 0;}
function getPersistentYPos(){try{return Inq.CHM.chat.chatSpec.chatTheme.py;}catch(e){}
return 0;}
function getPersistentWidth(){try{return Inq.CHM.chat.chatSpec.chatTheme.pw;}catch(e){}
return 0;}
function getPersistentHeight(){try{return Inq.CHM.chat.chatSpec.chatTheme.ph;}catch(e){}
return 0;}
function getFlashVars(){try{return Inq.CHM.chat.getFlashVars();}catch(e){log("Error obtaining flashvars from Chat object: "+e);}
return"";}
function getSkin(){try{return Inq.CHM.chat.getSkin();}catch(e){}
return"TouchCommerce.mxml";}
function getImagePath(){return Inq.CHM.chat.getImagePath();}
function setSessionParam(key,val){}
function closePersistent(){window.Inq.CHM.closePersistent();}
function isThankYouEnabled(){return window.Inq.CHM.thankYouEnabled;}
function tryue(blockDetails){var serviceType="ALL";var period=-1;if(!isNullOrUndefined(blockDetails)){if((blockDetails.charAt(0)=='(')&&(blockDetails.charAt(blockDetails.length-1)==')')){blockDetails=blockDetails.substr(1,blockDetails.length-2);}
var blockParams=MI8.JSON.parse(blockDetails);serviceType=blockParams.serviceType;period=blockParams.period;}
window.Inq.tryue(serviceType,period);}
function wasSaleAction(){return window.Inq.wasSaleAction();}
function setVisible(visible){try{var app=window["Application"];if(app&&app.application&&app.application.setVisible){app.application.setVisible(visible);}}
catch(e){log(e);}}
function sendDTEvent(eventName,data){try{var app=window["Application"];if(app&&app.application&&app.application.sendDTEvent){app.application.sendDTEvent(eventName,data);}}
catch(e){log(e);}}
function _executeCustomCommand(params){executeCustomCommand(params);}
function urtvd3(isPersistent,protoDomain,transferURL,needNewOpener){var inst=GR34.getInstance();inst.urtvd3(isPersistent,protoDomain,transferURL,needNewOpener);}
function registerPersistentWindow(){try{var opener=window.parent.opener.inqFrame;opener.Inq.CHM.persisentWindow=window.parent;return true;}catch(e){}
return false;}
function isPersistentChat(){return CHM.isPersistentChat();}
function isPersistentWindow(){return CHM.isPersistentWindow();}
function setPersistentWindowActive(state){var inst=GR34.getInstance();inst.setPersistentWindowActive(state);}
function CloseChatFromPersistent(){log("@@@CloseChatFromPersistent");window.inqFrame.Inq.CHM.CloseChatFromPersistent();}
function bind(handler){var handlerContext={obj:this,method:handler,safeFunc:function(){var closure=arguments.callee.closure;return closure.method.apply(closure.obj,arguments);}};handlerContext.safeFunc.closure=handlerContext
return handlerContext.safeFunc;}
function getCBC(){var cbc=null;if(CHM.isPersistentWindow()){var opener=window.parent.opener;try{if(opener){if((opener.inqFrame)&&(opener.inqFrame.Inq)&&(opener.inqFrame.Inq["CBC"])){cbc=opener.inqFrame.Inq["CBC"];}else{logInfo("opener.inqFrame.Inq['CBC'] is not accessible");}}else{logInfo("No window opener");}}catch(error){}}
if(!cbc){if(window.Inq){if(window.Inq["CBC"]){cbc=window.Inq["CBC"];}else{throw new Error("CBC module is not defined");}}else{if(window.inqFrame&&window.inqFrame.Inq&&window.inqFrame.Inq.CBC){cbc=window.inqFrame.Inq.CBC;}else{throw new Error("Inq object is not defined");}}}
return cbc;}
function acceptCobrowseInvitation(startPerformanceTest){inqFrame.com.inq.flash.client.chatskins.CoBrowseMgr.acceptCobInv();}
function acceptCobrowseInvitationSafe(startPerformanceTest){try{getCBC().accept(startPerformanceTest);}catch(e){logError("CBC ERROR: ",e);}}
function acceptCobrowseShareControl(startPerformanceTest){try{getCBC().acceptShare(startPerformanceTest);}catch(e){logError("CBC ERROR: ",e);}}
function endCobrowseSession(){try{getCBC().stopQuiet();}catch(e){logError("CBC ERROR: ",e);}}
function acceptCobAndShare(startPerformanceTest){try{getCBC().accept(startPerformanceTest);}catch(e){logError("CBC ERROR: ",e);}}
function isCobrowseEngaged(){try{if(site.enableCobrowse){return getCBC().isCobrowseEngaged();}}catch(e){logError("CBC ERROR: ",e);}
return false;}
function isSharedControl(){try{if(site.enableCobrowse){return getCBC().isSharedControl();}}catch(e){logError("CBC ERROR: ",e);}
return false;}
function logInfo(message){ROM.send(urls.loggingURL,{level:'INFO',line:message+" [chatID="+CHM.getChatID()+"]"});}
function logError(messagePrefix,e){log(messagePrefix+e.message);var errorDetails="";if(logError.caller!=null){errorDetails+="  at "+logError.caller.toString().split("{")[0];}
if(e.stack!=null){errorDetails+="  Stack: "+e.stack;}
ROM.send(urls.loggingURL,{level:'ERROR',line:messagePrefix+e.message+" [chatID="+CHM.getChatID()+", siteID="+Inq.getSiteID()+"] "+errorDetails});}
function sendText(){this.ciSendText(null);}
function ciSendText(){throw("sendText is not defined");}
function ciAcceptCobInv(){throw("ciAcceptCobInv is not defined");}
function ciActionBtnCloseChat(){throw("ciActionBtnCloseChat is not defined");}
function ciActionBtnCloseThankyou(){throw("ciActionBtnCloseThankyou is not defined");}
function ciDeclineCobInv(){throw("ciDeclineCobInv is not defined");}
function ciAcceptCobShareInv(){throw("ciAcceptCobShareInv is not defined");}
function ciDeclineCobShareInv(){throw("ciDeclineCobShareInv is not defined");}
function ciAcceptCobAndShareInv(){throw("ciAcceptCobAndShareInv is not defined");}
function ciAcceptVideoInv(){throw("ciAcceptVideoInv is not defined");}
function ciDeclineVideoInv(){throw("ciDeclineVideoInv is not defined");}
function ciStopVideo(){throw("ciStopVideo is not defined");}
function setCiFunction(fName,fBody){if(/^ci/.test(fName)){this[fName]=fBody;}else{throw("Error: CI framework function name must start with ci");}}
function ciHideLayer(layerID){log('ciHideLayer: '+layerID);try{var hideLayer=window.inqFrame.com.inq.flash.client.control.XFrameWorker.hideLayer;if(!isNullOrUndefined(hideLayer)){hideLayer(layerID);}}catch(e){log('ciHideLayer: hideLayer function was not published in CI: '+e.message);}}
function ciShowLayer(layerID){log('ciShowLayer: '+layerID);try{var showLayer=window.inqFrame.com.inq.flash.client.control.XFrameWorker.showLayer;if(!isNullOrUndefined(showLayer)){showLayer(layerID);}}catch(e){log('ciShowLayer: showLayer function was not published in CI: '+e.message);}}
function ciGrowLayer(layerID){log('ciGrowLayer: '+layerID);try{var growLayer=window.inqFrame.com.inq.flash.client.control.XFrameWorker.grow;if(!isNullOrUndefined(growLayer)){growLayer(layerID);}}catch(e){log('ciGrowLayer: grow function was not published in CI: '+e.message);}}
function ciShrinkLayer(layerID){log('ciShrinkLayer: '+layerID);try{var shrinkLayer=window.inqFrame.com.inq.flash.client.control.XFrameWorker.shrink;if(!isNullOrUndefined(shrinkLayer)){shrinkLayer(layerID);}}catch(e){log('ciShrinkLayer: shrink function was not published in CI: '+e.message);}}
function ciMinimize(){log('ciMinimize');try{var minimize=window.inqFrame.com.inq.flash.client.control.MinimizeManager.actionMinimize;if(!isNullOrUndefined(minimize)){minimize();}}catch(e){log('ciMinimize: actionMinimize function was not published in CI: '+e.message);}}
function ciRestore(){log('ciRestore');try{var restore=window.inqFrame.com.inq.flash.client.control.MinimizeManager.actionRestore;if(!isNullOrUndefined(restore)){restore();}}catch(e){log('ciRestore: actionRestore function was not published in CI: '+e.message);}}
function isLoggingDisabled(){return JSLoggingDisabled;}
function setCobrowseBannerText(bannerText){try{var cbc=getCBC();if(!!cbc){return cbc.setCobrowseBannerText(bannerText);}}catch(e){log("CBC ERROR:"+e.message);}
return true;}
function createXFrame(div,url,businessUnitID,scrolling,data,initiator,location,initOnLoad,method){var ldr=new XFormsLoader();return ldr.createXFrame(div,url,businessUnitID,scrolling,data,null,initiator,location,initOnLoad,method);}
function getClientPageURL(){return win.location.href;}
function updateXFrameFromBizRule(layerID,url,businessUnitID){try{var app=window["Application"];if(app&&app.application&&app.application.updateXFrameFromBizRule){app.application.updateXFrameFromBizRule(layerID,url,businessUnitID);}else{log("ERROR: update-xframe failed for layer ["+layerID+"]: app.application is not initialized");}}
catch(e){log(e);}}
function showAutomaton(layerId,url,businessUnitId,initiator){try{var app=window["Application"];if(app&&app.application&&app.application.showAutomaton){app.application.showAutomaton(layerId,url,businessUnitId,initiator);}else{log("ERROR: showAutomaton failed for layer ["+layerId+"]: app.application is not initialized");}}catch(e){log(e);}}
function isInitializationRequired(){var o=getOpener();if(o&&o.Inq.isPersistentInitialization){return o.Inq.isPersistentInitialization;}
return false;}
function resetInitializationFlag(){var o=getOpener();if(o&&o.Inq.isPersistentInitialization){o.Inq.isPersistentInitialization=false;}}
var URL_REGEXP_IS_FORM=/(^.*)(forms(v3)?\.inq\.com)/;function parseXFrameUrl(url){var pattern=new RegExp(URL_REGEXP_IS_FORM);if(url.search(URL_REGEXP_IS_FORM)>=0){url=url.replace(URL_REGEXP_IS_FORM,getXFormsDomain());}else if(url.charAt(0)=='/'&&url.charAt(1)!='/'){url=getXFormsDomain()+url}
var res=url.split('?');var params={};if(res[1]!=null){var oldParams=res[1].split('&');for(var i=0;i<oldParams.length;i++){var nameValue=oldParams[i].split('=');params[nameValue[0]]=nameValue[1];}}
return{url:res[0],params:params};}
function getPageID(){return Inq.LDM.getPageID();}
function isPortal(){return true;}
function getBusinessUnitID(){return(CHM.getChat())?CHM.getChat().getBusinessUnitID():getDefaultBusinessUnitID();}
function getCustID(){return Inq.getCustID();}
function getSesID(){return getSessionID();}
function getIncAsID(){return getIncAssignmentID();}
function getPageMarker(){return LDM.getPageMarker();}
function getAutomatonDataMap(){var automatonDataMap=PM.getVar("automatonDataMap");return((automatonDataMap)?automatonDataMap.getValue():"");}
function getPersistentCustomerID(){return objectAsLogString(getPersistCustID(),true);}
function getBrID(){return CHM.getChat().getRule().getID();}
function getBrName(){return CHM.getChat().getRule().getName();}
function getAgentID(){return CHM.getAgentID();}
function onCookiesCommitted(handler){var closure=(typeof handler=="string")?new Function(handler):handler;CM.whenCookiesCommitted(closure);}
function when3rdPartyCookieCommitted(vcnt){CM.when3rdPartyCookieCommitted(vcnt);}
function _getDeviceType(){var deviceType="Other";try{deviceType=getDeviceType();}catch(e){log("Error in getDeviceType: "+e);}
return deviceType;}
function closePersistentWindowIfOpen(){if(!isNullOrUndefined(CHM.earlyPopout)){CHM.earlyPopout.close();}
if(!isNullOrUndefined(CHM.popoutWindow)){CHM.popoutWindow.close();}}
function getBuRuleAgentGroupID(brID){return BRM.getRuleById(brID).getAgentGroupID();}
function startChatInterface(){window.launchWhenReady=true;}
function closeChatInterface(){var app=window["Application"];if(app&&app.application&&app.application.close){try{app.application.close();}
catch(e){Inq.log("Could not close ChatInterface: "+e);}}}
function _getBrowserTypeAndVersion(){return getBrowserTypeAndVersion();}
function _getBrowserMajorVer(compatibility){return getBrowserMajorVer(compatibility);}
function restartTimer(){var app=window["Application"];var errMessage="Could not restart timer to close not started chat: ";if(app&&app.application&&app.application.restartTimer){try{app.application.restartTimer();}
catch(e){Inq.log(errMessage+e);}}else{Inq.log(errMessage+"app.application.restartTimer is not initialized");}}
function ciActionBtnCloseChat(){throw("ciActionBtnCloseChat is not defined");}
function fileTransferSize(){return fileUploadSize;}
function fileTransferServerUrl(){return"";}
function setCABeacon(action,data){CHM.setCABeacon(action,data);}
function closeChatMonitor(){CHM.closeChatMonitor();}
function getQueueMessagingSpec(){var QUEUE_MESSAGING_SPECS="queueMessagingSpecs";var qmspec=CHM.getQueueMessagingSpecId();if(!isNullOrUndefined(site[QUEUE_MESSAGING_SPECS])&&!isNullOrUndefined(qmspec)){return site[QUEUE_MESSAGING_SPECS][qmspec];}else{return null;}}
return{startChatInterface:startChatInterface,closeChatInterface:closeChatInterface,getBrID:getBrID,getBrName:getBrName,getAutomatonDataMap:getAutomatonDataMap,getPageMarker:getPageMarker,getIncAssignmentID:getIncAsID,getSessionID:getSesID,getCustID:getCustID,getAgentID:getAgentID,isPortal:isPortal,setCobBan:setCobrowseBannerText,acceptCobAndShare:acceptCobAndShare,isCobEngaged:isCobrowseEngaged,isCobShared:isSharedControl,isAutoFixPrechatSurvey:isAutoFixPrechatSurvey,acceptCob:acceptCobrowseInvitation,acceptCobSafe:acceptCobrowseInvitationSafe,acceptCobShare:acceptCobrowseShareControl,endCob:endCobrowseSession,registerWDMClient:registerWDMClient,unregisterWDMClient:unregisterWDMClient,isV3C2CPersistent:isV3C2CPersistent,closePopupChat:closePopupChat,setData:setData,closeChat:closeChat,showTextInput:showTextInput,showPersistentButton:showPersistentButton,setPersistentButtonDebugActive:setPersistentButtonDebugActive,hidePersistentButton:hidePersistentButton,showThankyou:showThankyou,hideFramesetChat:hideFramesetChat,postRequestToIframeProxy:postRequestToIframeProxy,updateFrameName:updateFrameName,setChatBanished:setChatBanished,setAgentConfig:setAgentConfig,getAgentData:getAgentData,onEngaged:onEngaged,onChatShown:onChatShown,onBeforeChatClosed:onBeforeChatClosed,onInteracted:onInteracted,onCustomerMsg:onCustomerMsg,onAgentMsg:onAgentMsg,onAssisted:onAssisted,PushToFrameset:PushToFrameset,doPushToFrameset:doPushToFrameset,browserHasFlash:browserHasFlash,ForceFocus:ForceFocus,requestTranscript:requestTranscript,captureEmailAddress:captureEmailAddress,startLaunches:startLaunches,setDragable:setDragable,setResizable:setResizable,setV3Data:setV3Data,set3rdPartyCookieFromQueue:set3rdPartyCookieFromQueue,getV3Data:getV3Data,popOutChat:popOutChat,getBaseURL:getBaseURL,getMediaBaseURL:getMediaBaseURL,getTitleBarHeight:getTitleBarHeight,getPersistentCustomerID:getPersistentCustomerID,getPopupCloserWidth:getPopupCloserWidth,getSkinLocation:getSkinLocation,getSkinHeight:getSkinHeight,getSkinWidth:getSkinWidth,getSkinLeft:getSkinLeft,getSkinTop:getSkinTop,getFlashVars:getFlashVars,getSkin:getSkin,getImagePath:getImagePath,setSessionParam:setSessionParam,closePersistent:closePersistent,isThankYouEnabled:isThankYouEnabled,blockTheService:tryue,whenIsPersistent:urtvd3,registerPersistentWindow:registerPersistentWindow,setPersistentWindowActive:setPersistentWindowActive,isPersistentChat:isPersistentChat,isPersistentWindow:isPersistentWindow,setVisible:setVisible,CloseChatFromPersistent:CloseChatFromPersistent,executeCustomCommand:_executeCustomCommand,wasSaleAction:wasSaleAction,sendDTEvent:sendDTEvent,agentSurveyCall:agentSurveyCall,setSurveyAuxParams:setSurveyAuxParams,getSurveyAuxParams:getSurveyAuxParams,isClickStreamSent:isClickStreamSent,setClickStreamSent:setClickStreamSent,fireCustomEvent:fireCustomEvent,isLoggingDisabled:isLoggingDisabled,createXFrame:createXFrame,formsLoader:XFormsLoader,getClientPageURL:getClientPageURL,updateXFrameFromBizRule:updateXFrameFromBizRule,showAutomaton:showAutomaton,parseXFrameUrl:parseXFrameUrl,fireCustomEvt:fireCustomEvt,onCookiesCommitted:onCookiesCommitted,when3rdPartyCookieCommitted:when3rdPartyCookieCommitted,isInitializationRequired:isInitializationRequired,resetInitializationFlag:resetInitializationFlag,getBusinessUnitID:getBusinessUnitID,getPageID:getPageID,getVanityUrl:getVanityUrl,getChatRouterVanityUrl:getChatRouterVanityUrl,getXFormsDomain:getXFormsDomain,getDeviceType:_getDeviceType,closePersistentWindowIfOpen:closePersistentWindowIfOpen,getBuRuleAgentGroupID:getBuRuleAgentGroupID,ciActionBtnCloseChat:ciActionBtnCloseChat,ciActionBtnCloseThankyou:ciActionBtnCloseThankyou,ciAcceptCobInv:ciAcceptCobInv,ciDeclineCobInv:ciDeclineCobInv,ciAcceptCobShareInv:ciAcceptCobShareInv,ciDeclineCobShareInv:ciDeclineCobShareInv,ciAcceptCobAndShareInv:ciAcceptCobAndShareInv,ciAcceptVideoInv:ciAcceptVideoInv,ciDeclineVideoInv:ciDeclineVideoInv,ciStopVideo:ciStopVideo,closePopupChatFromPersistent:closePopupChatFromPersistent,setCiFunction:setCiFunction,ciSendText:ciSendText,sendText:sendText,getLocalizedMessage:getLocalizedMessage,getBrowserTypeAndVersion:_getBrowserTypeAndVersion,getBrowserMajorVer:_getBrowserMajorVer,restartTimer:restartTimer,setCABeacon:setCABeacon,closeChatMonitor:closeChatMonitor,logError:logError,logInfo:logInfo,getQueueMessagingSpec:getQueueMessagingSpec,ciHideLayer:ciHideLayer,ciShowLayer:ciShowLayer,ciGrowLayer:ciGrowLayer,ciShrinkLayer:ciShrinkLayer,ciMinimize:ciMinimize,ciRestore:ciRestore,getPersistentXPos:getPersistentXPos,getPersistentYPos:getPersistentYPos,getPersistentWidth:getPersistentWidth,getPersistentHeight:getPersistentHeight,setPopoutChatPosAndDim:setPopoutChatPosAndDim,setDisconnectFlag:setDisconnectFlag,fileTransferSize:fileTransferSize,fileTransferServerUrl:fileTransferServerUrl}}
function Resize(){this.obj=null,this.win=window.parent,this.doc=window.parent.document;this.width=0,this.height=0,this.__init=function(o,oRoot,minX,maxX,minY,maxY,bSwapHorzRef,bSwapVertRef,fXMapper,fYMapper,_win){if(typeof o=="undefined"||o==null){return;}
Inq.Resize.win=(null==_win)?this.win:_win;Inq.Resize.doc=Inq.Resize.win.document;o.box=this.doc.getElementById("inqResizeBox");doc=window.parent.document;o.onmousedown=Inq.Resize.__start;o.hmode=bSwapHorzRef?false:true;o.vmode=bSwapVertRef?false:true;o.root=((oRoot)&&(oRoot!=null))?oRoot:o;Inq.Resize.width=o.root.clientWidth;Inq.Resize.height=o.root.clientHeight;if(o.hmode&&isNaN(parseInt(o.root.style.left)))o.root.style.left="0px";if(o.vmode&&isNaN(parseInt(o.root.style.top)))o.root.style.top="0px";if(!o.hmode&&isNaN(parseInt(o.root.style.right)))o.root.style.right="0px";if(!o.vmode&&isNaN(parseInt(o.root.style.bottom)))o.root.style.bottom="0px";o.minX=typeof minX!='undefined'?minX:null;o.minY=typeof minY!='undefined'?minY:null;o.maxX=typeof maxX!='undefined'?maxX:null;o.maxY=typeof maxY!='undefined'?maxY:null;o.xMapper=fXMapper?fXMapper:null;o.yMapper=fYMapper?fYMapper:null;o.root.onDragStart=new Function();o.root.onDragEnd=new Function();o.root.onDrag=new Function();};this.__start=function(e){var o=Inq.Resize.obj=this;e=Inq.Resize.fixE(e);var y=parseInt(o.vmode?o.root.style.top:o.root.style.bottom);var x=parseInt(o.hmode?o.root.style.left:o.root.style.right);o.root.onDragStart(x,y);if(o.box!=null)
{o.box.style.top=o.root.style.top;o.box.style.left=o.root.style.left;o.box.style.width=o.root.style.width;o.box.style.height=o.root.style.height;o.box.style.border="thin dotted rgb(32,32,32)";o.box.style.display="";o.style.top=(parseInt(o.root.style.top)+parseInt(o.root.style.height)-16)+"px";o.style.left=(parseInt(o.root.style.left)+parseInt(o.root.style.width)-16)+"px";}
o.lastMouseX=e.clientX;o.lastMouseY=e.clientY;if(o.hmode){if(o.minX!=null)o.minMouseX=e.clientX-x+o.minX;if(o.maxX!=null)o.maxMouseX=o.minMouseX+o.maxX-o.minX;}else{if(o.minX!=null)o.maxMouseX=-o.minX+e.clientX+x;if(o.maxX!=null)o.minMouseX=-o.maxX+e.clientX+x;}
if(o.vmode){if(o.minY!=null)o.minMouseY=e.clientY-y+o.minY;if(o.maxY!=null)o.maxMouseY=o.minMouseY+o.maxY-o.minY;}else{if(o.minY!=null)o.maxMouseY=-o.minY+e.clientY+y;if(o.maxY!=null)o.minMouseY=-o.maxY+e.clientY+y;}
Inq.Resize.doc.onmousemove=Inq.Resize.resize;Inq.Resize.doc.onmouseup=Inq.Resize.end;var newWidth=parseInt(Inq.Resize.obj.style.left)+16;var newHeight=parseInt(Inq.Resize.obj.style.top)+16;var oDiv=Inq.Resize.doc.getElementById("inqTitleBar");newWidth=newWidth-24;oDiv.style.width=newWidth+"px";return false;};this.resize=function(e){e=Inq.Resize.fixE(e);var o=Inq.Resize.obj;var ey=e.clientY;var ex=e.clientX;var y=parseInt(o.vmode?o.root.style.top:o.root.style.bottom);var x=parseInt(o.hmode?o.root.style.left:o.root.style.right);var nx,ny;if(o.minX!=null)ex=o.hmode?Math.max(ex,o.minMouseX):Math.min(ex,o.maxMouseX);if(o.maxX!=null)ex=o.hmode?Math.min(ex,o.maxMouseX):Math.max(ex,o.minMouseX);if(o.minY!=null)ey=o.vmode?Math.max(ey,o.minMouseY):Math.min(ey,o.maxMouseY);if(o.maxY!=null)ey=o.vmode?Math.min(ey,o.maxMouseY):Math.max(ey,o.minMouseY);nx=x+((ex-o.lastMouseX)*(o.hmode?1:-1));ny=y+((ey-o.lastMouseY)*(o.vmode?1:-1));if(o.xMapper)nx=o.xMapper(y);else if(o.yMapper)ny=o.yMapper(x);nx=ex-o.lastMouseX;ny=ey-o.lastMouseY;var _top=parseInt(Inq.Resize.obj.style["top"]);var _left=parseInt(Inq.Resize.obj.style["left"]);Inq.Resize.obj.style["left"]=(_left+nx)+"px";Inq.Resize.obj.style["top"]=(_top+ny)+"px";Inq.Resize.obj.style[o.hmode?"left":"right"]=(nx+_left)+"px";Inq.Resize.obj.style[o.vmode?"top":"bottom"]=ny+_top+"px";Inq.Resize.obj.lastMouseX=ex;Inq.Resize.obj.lastMouseY=ey;Inq.Resize.obj.root.onDrag(nx,ny);if(Inq.Resize.obj.box)
{var height=ny+_top-parseInt(Inq.Resize.obj.box.style.top)+16;var width=nx+_left-parseInt(Inq.Resize.obj.box.style.left)+16;if(width>=16&&height>=16){Inq.Resize.obj.box.style.width=width+"px";Inq.Resize.obj.box.style.height=height+"px";}}
return false;};this.end=function(){Inq.Resize.doc.onmousemove=null;Inq.Resize.doc.onmouseup=null;var newWidth=parseInt(Inq.Resize.obj.style.left)-parseInt(Inq.Resize.obj.root.style.left)+16;var newHeight=parseInt(Inq.Resize.obj.style.top)-parseInt(Inq.Resize.obj.root.style.top)+16;if(Inq.Resize.obj.box){Inq.Resize.obj.box.style.display="none";}
Inq.Resize.obj.root.onDragEnd(parseInt(Inq.Resize.obj.root.style[Inq.Resize.obj.hmode?"left":"right"]),parseInt(Inq.Resize.obj.root.style[Inq.Resize.obj.vmode?"top":"bottom"]));if(newWidth<16||newHeight<16){newWidth=parseInt(Inq.Resize.obj.root.style.width);newHeight=parseInt(Inq.Resize.obj.root.style.height);}
Application.ResizeStage(newWidth,newHeight);Inq.Resize.obj=null;};this.fixE=function(e){if(typeof e=='undefined')
{e=Inq.Resize.win.event;}
if(typeof e.layerX=='undefined')e.layerX=e.offsetX;if(typeof e.layerY=='undefined')e.layerY=e.offsetY;return e;}}
function Drag(){this.obj=null,this.win=window.parent,this.doc=window.parent.document;this.__init=function(o,oRoot,minX,maxX,minY,maxY,bSwapHorzRef,bSwapVertRef,fXMapper,fYMapper,_win){Inq.Drag.win=(null==_win)?this.win:_win;Inq.Drag.doc=Inq.Drag.win.document;if(typeof o=="undefined"||o==null){return;}
o.onmousedown=Inq.Drag.__start;o.hmode=bSwapHorzRef?false:true;o.vmode=bSwapVertRef?false:true;o.root=oRoot&&oRoot!=null?oRoot:o;if(o.hmode&&isNaN(parseInt(o.root.style.left)))o.root.style.left="0px";if(o.vmode&&isNaN(parseInt(o.root.style.top)))o.root.style.top="0px";if(!o.hmode&&isNaN(parseInt(o.root.style.right)))o.root.style.right="0px";if(!o.vmode&&isNaN(parseInt(o.root.style.bottom)))o.root.style.bottom="0px";o.minX=typeof minX!='undefined'?minX:null;o.minY=typeof minY!='undefined'?minY:null;o.maxX=typeof maxX!='undefined'?maxX:null;o.maxY=typeof maxY!='undefined'?maxY:null;o.xMapper=fXMapper?fXMapper:null;o.yMapper=fYMapper?fYMapper:null;o.corner=this.doc.getElementById("inqDivResizeCorner");o.root.onDragStart=new Function();o.root.onDragEnd=new Function();o.root.onDrag=new Function();};this.__start=function(e){var o=Inq.Drag.obj=this;e=Inq.Drag.fixE(e);var y=parseInt(o.vmode?o.root.style.top:o.root.style.bottom);var x=parseInt(o.hmode?o.root.style.left:o.root.style.right);o.root.onDragStart(x,y);if(o.corner)o.corner.style.display="none";o.lastMouseX=e.clientX;o.lastMouseY=e.clientY;if(o.hmode){if(o.minX!=null)o.minMouseX=e.clientX-x+o.minX;if(o.maxX!=null)o.maxMouseX=o.minMouseX+o.maxX-o.minX;}else{if(o.minX!=null)o.maxMouseX=-o.minX+e.clientX+x;if(o.maxX!=null)o.minMouseX=-o.maxX+e.clientX+x;}
if(o.vmode){if(o.minY!=null)o.minMouseY=e.clientY-y+o.minY;if(o.maxY!=null)o.maxMouseY=o.minMouseY+o.maxY-o.minY;}else{if(o.minY!=null)o.maxMouseY=-o.minY+e.clientY+y;if(o.maxY!=null)o.minMouseY=-o.maxY+e.clientY+y;}
Inq.Drag.doc.onmousemove=Inq.Drag.drag;Inq.Drag.doc.onmouseup=Inq.Drag.end;return false;};this.drag=function(e){e=Inq.Drag.fixE(e);var o=Inq.Drag.obj;var ey=e.clientY;var ex=e.clientX;var y=parseInt(o.vmode?o.root.style.top:o.root.style.bottom);var x=parseInt(o.hmode?o.root.style.left:o.root.style.right);var nx,ny;if(o.minX!=null)ex=o.hmode?Math.max(ex,o.minMouseX):Math.min(ex,o.maxMouseX);if(o.maxX!=null)ex=o.hmode?Math.min(ex,o.maxMouseX):Math.max(ex,o.minMouseX);if(o.minY!=null)ey=o.vmode?Math.max(ey,o.minMouseY):Math.min(ey,o.maxMouseY);if(o.maxY!=null)ey=o.vmode?Math.min(ey,o.maxMouseY):Math.max(ey,o.minMouseY);nx=x+((ex-o.lastMouseX)*(o.hmode?1:-1));ny=y+((ey-o.lastMouseY)*(o.vmode?1:-1));if(o.xMapper)
nx=o.xMapper(y);else if(o.yMapper)
ny=o.yMapper(x);Inq.Drag.obj.style[o.hmode?"left":"right"]=nx+"px";Inq.Drag.obj.style[o.vmode?"top":"bottom"]=ny+"px";Inq.Drag.obj.root.style[o.hmode?"left":"right"]=nx+"px";Inq.Drag.obj.root.style[o.vmode?"top":"bottom"]=ny+"px";Inq.Drag.obj.lastMouseX=ex;Inq.Drag.obj.lastMouseY=ey;Inq.Drag.obj.root.onDrag(nx,ny);return false;};this.end=function(){Inq.Drag.doc.onmousemove=null;Inq.Drag.doc.onmouseup=null;var newLeft=parseInt(Inq.Drag.obj.root.style["left"]);var newTop=parseInt(Inq.Drag.obj.root.style["top"]);Inq.Drag.obj.root.onDragEnd(parseInt(Inq.Drag.obj.root.style[Inq.Drag.obj.hmode?"left":"right"]),parseInt(Inq.Drag.obj.root.style[Inq.Drag.obj.vmode?"top":"bottom"]));Inq.Drag.obj=null;if(Application)
Application.MoveStage(newLeft,newTop);};this.fixE=function(e){if(typeof e=='undefined')e=Inq.Drag.win.event;if(typeof e.layerX=='undefined')e.layerX=e.offsetX;if(typeof e.layerY=='undefined')e.layerY=e.offsetY;return e;};}
function SurveyMgr(surveyDataMap){var surveyURL=urls.baseURL+"/survey/genericSurvey.do";this._observable();this.defaultWindowSpec="statusbar=0, scrollbars=1, resizable=1, toolbar=0, menubar=0, copyhistory=0";this.poppedWindows={};function getAltSurveyURL(data,rule){try{var brName=BRM.getRuleById(CHM.getLastChat().brID).getName();}catch(err){brName="NO BR Name Available";}
return ROM.composeURL(data.altURL,{chatID:CHM.getLastChatID(),agentID:CHM.getLastAgentID(),clientID:siteID,BRName:brName,custID:Inq.getCustID(),businessUnitID:data.businessUnitID,sessionID:data.sessionID,stage:data.stage,incAssignmentID:data.incAssignmentID,siteID:data.siteID,surveyContent:data.surveyContent});}
function composeURL(url,data){return ROM.composeURL(url,data);}
this.getSurveySpec=function(specID){if(isNullOrUndefined(specID)){throw new Error("Survey spec is null or undefined.");}
return surveyDataMap[specID];};this.popwindow=function(webResourceID,winName,data,winSpecDataStr){var webResource=resources[webResourceID];if(!!webResource){if(!!winName){if(webResource.method=="POST"){try{var lwin=this.poppedWindows[winName]=win.open("",winName,winSpecDataStr);var div=lwin.document.createElement("div");var formName="TCSurveyWin"+(SurveyMgr.IDX++);var formStr="<form id='"+formName+"' name='"+formName+"' action='"+webResource.url+"' method='POST' target='"+winName+"'>\n";for(var name in data){if(typeof data[name]=="function")continue;formStr+=("\t<input type='hidden' id='"+name+"' name='"+name+"' value='"+data[name]+"'>\n");}
formStr+="</form>";div.style.cssText="position:absolute;top:0px;left:0px;width:1px;height:1px;";div.innerHTML=formStr;lwin.document.body.appendChild(div);div.firstChild.submit();}catch(e){log(e);}
lwin.document.removeChild(div);}else{this.poppedWindows[winName]=win.open(ROM.composeURL(webResource.url,data),winName,!!winSpecDataStr?winSpecDataStr:this.defaultWindowSpec);}}
else{log("Popout Window Error: winName is required but not provided.");}}else{log("Popout Window Error: Web resource not found for popout window for resource ID = "+webResourceID);}};this.parseSurveyIdFromURL=function(surveyURL,defaultID){try{if(surveyURL){var found=surveyURL.match(/http.*\/(\d+)\/[a-fA-F0-9]+\/.*/);if(found&&found.length>1){return parseInt(found[1]);}}}catch(err){log("Survey spec lookup error: Survey URL '"+surveyURL+"' parse failure. err="+err);}
return defaultID;};this.showSurvey=function(surveySpecID,rule,brSurveySpecOverride,preSurveyDataPass,windowFeatures,surveyUrlOverride,surveyReporting){var windowSpec=windowFeatures?(","+windowFeatures+","):', statusbar=0, menubar=0, scrollbars=1, resizable=1, toolbar=0, copyhistory=0,';var data=this.getSurveySpec(surveySpecID);if(surveyUrlOverride){windowURL=surveyUrlOverride;}
if(data){MI8.mixAbsorber(data);if(brSurveySpecOverride){data.absorb(brSurveySpecOverride);}
surveyURL=surveyUrlOverride||data.altURL||surveyURL;try{var lastChat=CHM.getLastChat();if(surveyReporting){var surveyID=this.parseSurveyIdFromURL(surveyURL,surveySpecID);var automatonID="SAT_"+surveyID;var surveyName=data.name?data.name:automatonID;var automatonStartedData={_domain:"automaton",evt:"started",automatonID:automatonID,automatonStartedBy:("BR,"+(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID()).toString())),automatonName:surveyName,startedIn:"div",automatonType:"satisfactionSurvey",businessUnitID:CHM.getBusinessUnitID(),chatID:lastChat.id,customerID:Inq.getCustID(),incAssignmentID:getIncAssignmentID(),sessionID:getSessionID(),siteID:getSiteID(),pageID:LDM.getPageID(),businessRuleID:lastChat.brID,deviceType:getDeviceType(),operatingSystemType:getOSType(),browserType:getClientBrowserType(),browserVersion:getClientBrowserVersion(),agentGroupID:CHM.getAgentGroupID(rule.evt),visitorAttributes:VAM.getCopyAsArray(true).join(";"),brAttributes:firstExisting('getRuleAttributesAsString',CHM.getChat(),rule),agentID:lastChat.agentID?lastChat.agentID:""};ROM.send(urls.logDataURL,automatonStartedData);var formDataAddition={chatID:lastChat.id,customerID:Inq.getCustID(),agentID:CHM.getAgentID(),incAssignmentID:getIncAssignmentID(),sessionID:getSessionID(),visitorAttributes:VAM.getCopyAsArray(false).join(";"),automatonAttributes:"",siteID:getSiteID(),pageID:LDM.getPageID(),businessUnitID:CHM.getBusinessUnitID(),businessRuleID:lastChat.brID};if(preSurveyDataPass){MI8.mixAbsorber(preSurveyDataPass).absorb(formDataAddition);}
else{preSurveyDataPass=formDataAddition;}}
var logData=null;if(!!lastChat){logData={_domain:"chat",evt:"surveyPresented",siteID:Inq.getSiteID(),businessUnitID:rule.getBusinessUnitID(),chatID:lastChat.id,customerID:Inq.getCustID(),sessionID:getSessionID(),incAssignmentID:getIncAssignmentID(),stage:"post-chat",surveyID:surveySpecID};if(lastChat.svyPrms){MI8.mixAbsorber(logData);logData.absorb(lastChat.svyPrms);}
ROM.send(urls.logDataURL,logData);data["customerID"]=logData.customerID;data["businessUnitID"]=logData.businessUnitID;data["sessionID"]=logData.sessionID;data["stage"]=logData.stage;data["incAssignmentID"]=logData.incAssignmentID;data["siteID"]=logData.siteID;data["surveyContent"]="";data["ClientID"]=logData.siteID;data["chatID"]=logData.chatID;data["override"]=1;data["custID"]=data.customerID;if(lastChat.svyPrms){MI8.mixAbsorber(data);data.absorb(lastChat.svyPrms);}}
if(preSurveyDataPass){if(!surveyURL){log("Can't submit survey with POST because URL is not provided: surveySpecID="+surveySpecID);return;}
var w=635;var h=650;var x=data.x?data.x:0;var y=data.y?data.y:0;if(data&&!isNullOrUndefined(data.w)){w=data.w;}
if(data&&!isNullOrUndefined(data.h)){h=data.h;}
try{this.surveyWindow=win.open(prepareURLForPostRequest(surveyURL),"",windowFeatures?windowFeatures:("left="+x+",top="+y+",width="+w+",height="+h+",scrollbars=yes,resizable=yes"));}catch(e){log("Can't launch survey window :"+e);}
if(typeof this.surveyWindow!=="undefined"&&this.surveyWindow!=null){if(preSurveyDataPass){surveyURL=prepareURLForPostRequest(surveyURL);var survForm=this.surveyWindow.document.createElement("form");survForm.name="surveyForm";survForm.id="inqSurveyForm";survForm.action=surveyURL;survForm.method="POST";survForm.style.display="none";for(var k in preSurveyDataPass){if(typeof preSurveyDataPass[k]==="function"||typeof preSurveyDataPass[k]==="object"||k=="height"||k=="width"){continue;}
if(k=="agentAttr"){getAAforKeySurvey(preSurveyDataPass[k],this.surveyWindow)}else{addInput(k,preSurveyDataPass[k],this.surveyWindow);}}
if(!this.surveyWindow.document.body){setTimeout(function(){this.surveyWindow.document.body.appendChild(survForm);survForm.submit();},1);}else{this.surveyWindow.document.body.appendChild(survForm);survForm.submit();}}
log("Survey URL: "+surveyURL);}}else{var windowURL=surveyUrlOverride?surveyUrlOverride:(data.altURL.length>0)?getAltSurveyURL(data,rule):ROM.composeURL(surveyURL,data)
this.surveyWindow=win.open(windowURL,'SurveyWindow',('top='+(data.y?data.y:0)+', left='+(data.x?data.x:0)+windowSpec+' width='+(data.w?data.w:0)+', height='+(data.h?data.h:0)));}}catch(e){log(e);}}
else{log("Survey Error: no survey spec found. surveySpecID="+surveySpecID);}
function addInput(name,value,sWin){var input=sWin.document.createElement("input");input.type="hidden";input.name=name;input.value=value;survForm.appendChild(input);}
function getAAforKeySurvey(aa,sWin){var aaObj=MI8.JSON.parse(aa);for(var i in aaObj){if(aaObj.hasOwnProperty(i)){for(var j in aaObj[i]){if(aaObj[i].hasOwnProperty(j)){addInput(i,((aaObj[i])[j]).replace(/\s+/g,''),sWin);}}}}}
function prepareURLForPostRequest(url){return url.replace(/\?[^\/]*$/,"").replace("keysurvey.com","keysurvey.com/votingmodule/s180");}};}
MI8.prepare(SurveyMgr).im13(MI8.Observable).im13(MI8.XJA3);SurveyMgr.IDX=0;SurveyMgr.prototype.isListener=function(l){return(!!l&&(l.onSurveyLaunchEvent||l.fireSurveySubmitted));};SurveyMgr.prototype.fireSurveyLaunched=function(chatdata,_src){var evt=MI8.mixAbsorber({id:++this.evtIdx,evtType:this.TYPES.SLAUNCHED,timestamp:new Date(),src:_src});evt.absorb({chatID:chatdata.chatID,ruleID:chatdata.ruleID,customerID:mockCustID});var buID=chatdata["buID"]?chatdata["buID"]:null;var agID=chatdata["agID"]?chatdata["agID"]:null;if(!(agID&&buID)||parseInt(buID)<=0||parseInt(agID)<=0){var rule=BRM.getRuleById(chatdata.ruleID);if(rule){buID=buID&&parseInt(buID)>0?buID:rule.getBusinessUnitID();agID=agID&&parseInt(agID)>0?agID:rule.getAgentGroupID();}}
if(agID&&parseInt(agID)>0){evt.absorb({agentGroupID:agID});}
if(buID&&parseInt(buID)>0){evt.absorb({businessUnitID:buID});}
this._fireEvt(function(l,evt){if(typeof l.onSurveyLaunchEvent=="function")l.onSurveyLaunchEvent(evt);},evt);};SurveyMgr.prototype.fireSurveySubmitted=function(chatdata,_src){};SurveyMgr.prototype.TYPES=SurveyMgr.TYPES={SLAUNCHED:"SLAUNCHED",SSUBMIT:"SSUBMIT"};function reinitChat(pageID,dat){try{Inq.overridePageID=undefined;win.inqSiteID=undefined;var data=((dat&&dat.constructor==String)?MI8.JSON.parse(dat):dat);if(!CHM.isPersistentWindow()){if(Inq.CBC){Inq.CBC.reset();}
if(data){if(data['pass']){win.inqData=data['pass'];}
else if(data['data']){win.inqData=data['data'];}}
if(data&&data.sale){var s=data.sale;var w=win;w.inqSalesProducts=s.products;w.inqSalesPrices=s.prices;w.inqSalesQuantities=s.quantities;w.inqTestOrder=s.test;w.inqClientOrderNum=s.ordernum;w.inqClientTimeStamp=s.timestamp;w.inqCustomerName=s.customerName;w.inqOtherInfo=s.otherInfo;}
if(CHM.isChatInProgress()){if(pageID&&pageID>0){Inq.overridePageID=pageID;}
C2CM.reset();LDM.init(true);BRM.reset();BRM.resetForReinit();BRM.init(true);BRM.start();if(!pageID){LDM._resolvePage();}
LDM.start();}else{if(pageID&&pageID>0){win.inqSiteID=pageID;}
C2CM.reset();CHM.reset();BRM.resetForReinit();resetObserver();DM.reset();win.v3Lander.reload();}}}catch(e){logErrorToTagServer("Error on reinitChat call. site="+siteID+",custID="+custID+",page="+LDM.getPageID()+",error="+e.message);}}
function resetObserver(){if(doc.body.getAttribute('data-inq-observer')=='1'){win.Inq.observer.disconnect();doc.body.setAttribute('data-inq-observer','0');}}
function launchChatNowByPageID(ruleID){var rule=BRM.getRuleById(ruleID);if(rule!=null){EVM.fireManualInvocationEvent(rule);}}
function launchChatNow(ruleName){var rule=BRM.getRuleByName(ruleName);if(rule!=null){EVM.fireManualInvocationEvent(rule);}}
function setChatSuppressedForSession(){Inq.tryue("ALL",0);}
function blockChat(scope){switch(scope){case"page":break;case"session":Inq.tryue("ALL",0);break;default:break;}}
function getSaleID(){var saleID=-1;try{var saleIdVar=PM.getVar("saleID");if(!!saleIdVar){var sid=saleIdVar.getValue();saleID=isNullOrUndefined(sid)?-1:sid;}}catch(err){saleID=-1;}
return saleID;}
function getChatID(){var chatID=-1;try{if(!!CHM.getChatID())
chatID=CHM.getChatID();}catch(err){chatID=-1;}
return chatID;}
function showClickToCallHtml(index,html){C2CM.getC2C(index).showClickToCallHtml(html);}
function getData(){return getMgrData(mgrList);}
function getMgrData(list){var retval={};for(var idx=0;idx<list.length;idx++){var mgr=list[idx];if(!!mgr.getData&&typeof mgr.getData=="function"){retval[mgr.getID()]=mgr.getData();}}
return retval;}
function publishAPI(apiString,varid,ruleID,_win){if(!apiString){return false;}
var osa=apiString.split(".");var fcn=function(){return getVar(varid,ruleID);};if(!_win){_win=win;}
var obj=_win?_win:window.parent;for(var idx=0;idx<osa.length;idx++){if(idx==osa.length-1){if(!!obj){obj[osa[idx]]=fcn;}else{log("Cannot publish API "+apiString+" because object is null of undefined");}}else if(isNullOrUndefined(obj[osa[idx]])){obj[osa[idx]]={};}
obj=obj[osa[idx]];}
return true;}
function exposeCustomerApi(){var win=window.parent;if(isNullOrUndefined(win.Inq)){win.Inq={};win.Inq.SaleMgr={};}
win.Inq.launchChatNowByPageID=launchChatNowByPageID;win.Inq.launchChatNow=launchChatNow;win.Inq.setChatSupressedForSession=setChatSuppressedForSession;win.Inq.setChatSuppressedForSession=setChatSuppressedForSession;win.Inq.blockChat=blockChat;win.Inq.reinitChat=reinitChat;win.Inq.reinit=reinitChat;win.Inq.SaleMgr={getSaleID:getSaleID,getChatID:getChatID};win.Inq.showClickToCallHtml=showClickToCallHtml;win.Inq.fireCustomEvent=fireCustomEvent;win.Inq.getData=getData;win.Inq.observer=domObserver;}
function CG(includeIds,includeCGIds,includeURLFunction,excludeIds,excludeCGIds,excludeURLFunction,businessUnits){var _lut={};var _includeIds=includeIds?includeIds:[];var _includeCGIds=includeCGIds?includeCGIds:[];var _includeURLFunction=includeURLFunction;var _excludeIds=excludeIds?excludeIds:[];var _excludeIdQuick={};var _excludeURLFunction=excludeURLFunction;var _excludeCGIds=excludeCGIds?excludeCGIds:[];this.length=_includeIds.length;for(var idx=0;idx<_includeIds.length;idx++){_lut[_includeIds[idx]]=_includeIds[idx];}
for(var i=0;i<_excludeIds.length;i++){_excludeIdQuick[_excludeIds[i]]=_excludeIds[i];}
var buIDs=businessUnits;this.contains=function(pgID,url,contentGroups){if(typeof _excludeIdQuick[pgID]=='number'){return false;}
if(this.isInCGList(_excludeCGIds,pgID,url,contentGroups)){return false;}
if(url&&_excludeURLFunction&&_excludeURLFunction(url)){return false;}
if(typeof _lut[pgID]=='number'){return true;}
if(this.isInCGList(_includeCGIds,pgID,url,contentGroups)){return true;}
return url&&_includeURLFunction&&_includeURLFunction(url);};this.isInCGList=function(cgList,pgID,url,contentGroups){for(var i=0;i<cgList.length;i++){var cg=contentGroups[cgList[i]];if(!cg){continue;}
if(cg.contains(pgID,url,contentGroups)){return true;}}
return false;};this.getBusinessUnits=function(){return buIDs?buIDs:null;};}
CG.c=function(d){return new CG(d[0],d[1],d[2],d[3],d[4],d[5],d[6]);};function CRMT(callback){this.absorb(callback);}
MI8.prepare(CRMT).im13(MI8.XJA3).im13(MI8.RC54).im13(MI8.JSON);CRMT.create=function(callback){return new CRMT(callback);};CRMT.prototype.onRemoteCallback=function(dstr){var data=typeof dstr=="string"?this.parse(dstr):dstr;this.doCallbackActions(data);}
function ABCDE(d){this.absorb(d);this.data=d;}
MI8.prepare(ABCDE).im13(MI8.XJA3);ABCDE.c=function(data){return new ABCDE(data);};ABCDE.prototype.request=function(){if(this.data.onAgentAssigned)
EVM.addListener(this.data);if(this.flashvarFcn){CHM.registerFlashvarFcn(this.flashvarFcn);}
if(this.data.agtid)this.chatSpec.aid=this.data.agtid;var self=this;CM.updateCACookie(function(){CHM.request(self.rule,self.chatType,self.chatSpec,"",null,function(){C2CM.showDisabledIcon();});});};function DFV(i,f,v,initial){this.id=i;this.f=f;this.v=v;this.initial=initial;}
DFV.c=function(i,f,v,initial){return new DFV(i,f,v,initial);};DFV.prototype.toString=function(dflt){var o=dflt;try{var o=safe("("+this.f.toString()+")()",{});}catch(err){log("DFV ["+this.id+"] execution failed:"+err);}
var template=this.v;for(var name in o){var s=o[name];template=template.replace("${"+name+"}",s);}
return template;};window.XFormsLoader=function(){var INITIATOR="_$initiator";var LOCATION="_$location";var PERSISTENT_CUSTOMER_ID="_persistCustId";var _JSON=MI8.JSON;function stringify(obj){return _JSON.stringify(obj);}
function log(text){if(Inq&&Inq.log){Inq.log("XF: "+text);}else if(window.console){window.console.log("XF: "+text);}}
function logError(e){log("Error: "+e.message);if(e.origin){log("   at "+e.origin);}else if(logError.caller!=null){log("   at "+logError.caller.toString().split("{")[0]);}
return function(value){log("   trace:["+value+"]")};}
var XFormsLoader=function(){var headerData={};this._xhr;this._dtid;this._source;this._xframe;this.index=XFormsLoader.instances.length;XFormsLoader.instances.push(this);function getQuery(data){var query="";try{for(var key in data){query+="&"+key+"="+encodeURIComponent(data[key]);}}catch(e){logError(e);}
return query;}
function getLBStickyAsFirstParameter(){return"?customerID="+Inq.getCustID();}
this.createXFrame=function(div,url,businessUnitID,scrolling,data,overrideRule,initiator,location,initOnLoad,method){var chat=CHM.getChat();var rule=overrideRule?overrideRule:(chat?chat.getRule():null);headerData={url:url,siteID:Inq.getSiteID(),workerPath:"window.com.inq.flash.client.control.XFrameWorker",clientHtml:getHostedFileUrl(),_chatID:CHM.getChatID()?CHM.getChatID():"",_agentID:(CHM.getAgentID())?CHM.getAgentID():"",_businessUnitID:(businessUnitID)?businessUnitID:((CHM.getChat())?CHM.getChat().getBusinessUnitID():FP.getBusinessUnitID()),_siteID:Inq.getSiteID(),_customerID:Inq.getCustID(),_sessionID:FP.getSessionID(),_incAssignmentID:FP.getIncAssignmentID(),_clientPageURL:FP.getClientPageURL(),_pageMarker:LDM.getPageMarker(),_pageID:initOnLoad?CHM.getLaunchPageId():LDM.getPageID(),_language:rule?rule.getLanguage():Inq.getDefaultLanguage(),_visitorAttributes:VAM.getCopyAsArray(true).join(";"),_brAttributes:rule?rule.getRuleAttributesAsString():"",_browserType:getClientBrowserType(),_browserVersion:getClientBrowserVersion(),_operatingSystemType:getOSType(),_deviceType:getDeviceType(),_qt:CHM.getQueueThreshold()?CHM.getQueueThreshold():"",_externalCustomerIDs:VAM.getExternalCustomerIdVisitorAttributesAsString()};if(chat&&chat.getAutomatonSpecData()){try{headerData._automatonDataMap=stringify(chat.getAutomatonSpecData());}catch(e){logError(e)("automatonDataMap is malformed for rule "+rule.getID()+" siteID="+Inq.getSiteID()+" customerID="+Inq.getCustID());}}else{var automatonDataMap=PM.getVar("automatonDataMap");if(automatonDataMap){var value=automatonDataMap.getValue();if(value){headerData._automatonDataMap=value;}}}
var brId="";if(rule){headerData._brName=rule.getName();headerData._brId=brId=rule.getID();}
headerData[INITIATOR]=stringify(initiator?initiator:{type:"br",id:brId});headerData[LOCATION]=location?stringify(location):"";var agID=getAgentGroupId(location,rule,chat);if(agID){headerData._agentGroupID=agID;}
var persistentCustomerID=FP.getPersistentCustomerID();if(persistentCustomerID){headerData[PERSISTENT_CUSTOMER_ID]=persistentCustomerID;}
for(var field in data){if(!headerData[field]){headerData[field]=data[field];}}
var nameIFrame=encodeURIComponent(MI8.JSON.stringify(headerData));if(!scrolling)scrolling="no";div.innerHTML='<IFRAME width="100%" height="100%" class="inqChatFoo" frameborder="0" scrolling="'+scrolling+'" '+'name="'+nameIFrame+'" ></IFRAME>';this._xframe=div.getElementsByTagName("IFRAME")[0];this._xframe.headerData=headerData;if(url){this._source=url;this._dtid=data.dtid;if(!!method&&method=="POST"){ROM.post(url,headerData);}else{this.loadForm(url);}}
return this._xframe;};function getAgentGroupId(location,rule,chat){if(chat&&location&&location.type=="chat"){var chatAgID=chat.getChatAgentGroupID();if(chatAgID){return chatAgID;}else{return chat.getAgentGroupID();}}else{return rule?rule.getAgentGroupID():null;}}
this.loadForm=function(automatonRequestUrl){XFormsLoader.requestQueue.push(this);if(!XFormsLoader.isGetSessionIdInProgress){XFormsLoader.getJavaSessionId(automatonRequestUrl,1);}};XFormsLoader.getSessionIdUrl=function(automatonRequestUrl){var parts=automatonRequestUrl.split("/");var protocol=parts[0];var domain=parts[2];return protocol+"//"+domain+"/"+parts[3]+"/jsid/getSessionId"+getLBStickyAsFirstParameter();};XFormsLoader.getJavaSessionId=function(automatonRequestUrl,attemptNumber){try{if(window.top==window.parent&&window==window.top.inqFrame){var sessionId=XFormsLoader.initJsid();XMLHttpRequestFacade.jsessionid=(!!sessionId)?sessionId:null;var xhr=new XMLHttpRequestFacade();var urlGetSessionId=XFormsLoader.getSessionIdUrl(automatonRequestUrl);xhr.open("GET",urlGetSessionId,true);xhr.onreadystatechange=function(){if(xhr.readyState==XMLHttpRequestFacade.DONE){if(xhr.status==200){XFormsLoader.obtainedSessionId(xhr.response);XFormsLoader.isGetSessionIdInProgress=false;}else if(xhr.status==404){logErrorToTagServer("XFormsLoader.getJavaSessionId: Can't get JSESSIONID. "+"attempts=["+attemptNumber+"] status=["+xhr.status+"] response=["+xhr.response+"]");XFormsLoader.isGetSessionIdInProgress=false;XFormsLoader.continueLoadingForms();}else if(xhr.status==0&&attemptNumber<XFormsLoader.MAX_ATTEMPTS_COUNT){setTimeout(function(){XFormsLoader.getJavaSessionId(automatonRequestUrl,attemptNumber+1);},1000);}else{XFormsLoader.isGetSessionIdInProgress=false;logErrorToTagServer("XFormsLoader.getJavaSessionId: Can't get JSESSIONID. "+"attempts=["+attemptNumber+"] status=["+xhr.status+"] response=["+xhr.response+"]");}
xhr.onreadystatechange=null;xhr=null;}};XFormsLoader.isGetSessionIdInProgress=true;xhr.send();}else{XFormsLoader.continueLoadingForms();}}catch(e){logError(e)("getJavaSessionId");}};XFormsLoader.obtainedSessionId=function(jSessionId){if(jSessionId.length>0){XMLHttpRequestFacade.jsessionid=jSessionId;XFormsLoader.persistJsid(jSessionId);}
XFormsLoader.continueLoadingForms();};XFormsLoader.continueLoadingForms=function(){for(var i=0;i<XFormsLoader.requestQueue.length;i++){XFormsLoader.requestQueue[i].continueLoadingForm();}
XFormsLoader.requestQueue=[];};this.continueLoadingForm=function(){this._xhr=new XMLHttpRequestFacade();var XFormsLoaderInst=this;this._xhr.onreadystatechange=function(){var xhr=this;if(xhr.readyState==XMLHttpRequestFacade.DONE){XFormsLoaderInst.obtainedSourceHtml(xhr.response);XFormsLoaderInst=null;}};var url=this._source+getLBStickyAsFirstParameter()+getQuery(headerData);this._xframe["href"]=url;this._xhr.open("GET",url,true);this._xhr.send();return false;};function fixDocumentRewriteBug(html,win){try{win.DOCUMENT_REWRITE_BUG=true;}catch(e){logActionErr(e,this);}
html=html.replace('</head>','<script type="text/javascript">if (typeof DOCUMENT_REWRITE_BUG != "undefined") {top.inqFrame.Inq.FlashPeer.formsLoader.resetGlobalVars(window);}</script></head>');var host=window.location.host.replace(/:\d+$/,"");if(host!=document.domain){html=html.replace(/(<\s*body\b[^>]*>)/gi,'\n$1\n<script type="text/javascript">try{document.domain=\"'+document.domain+'";}catch(er){};</script>\n');}
return html;}
this.fixDocumentRewriteBug=fixDocumentRewriteBug;this.obtainedSourceHtml=function(response){this._html=normalizeHtml(response,this._source);this._xframe["XFormsLoader"]=this;if(!this._xframe.src){this._xframe.onload=function(){var ifrm=this;var inst=ifrm["XFormsLoader"];inst.writeObtainedHtml();};this._xframe.onreadystatechange=function(){var ifrm=this;if(ifrm.readyState=="complete"||ifrm.readyState=="loaded"){var inst=ifrm["XFormsLoader"];inst.writeObtainedHtml();}};this._xframe.src=(window.location.href).split("?")[0]+"?BLNK";}else{this.writeObtainedHtml();}};this.writeObtainedHtml=function(){this._xframe.onreadystatechange=null;this._xframe.onload=null;this._html=fixDocumentRewriteBug(this._html,this._xframe.contentWindow);if(this._xframe.contentDocument){writeForm(this._xframe.contentDocument,this._html);}else if(this._xframe.contentWindow){writeForm(this._xframe.contentWindow.document,this._html);}else{logError({origin:"writeObtainedHtml",message:"Target document not found"});}};function writeForm(doc,html){doc.open();doc.write(html);doc.close();XFormsLoader.instances[this.index]=null;XFormsLoader.instances.splice(this.index,1);}
function normalizeHtml(html,source){var srcParts=source.split("/");var proto=srcParts[0];var domain=srcParts[2];srcParts.pop();var path=srcParts.join("/");var x=new RegExp('(href|src|action)=\"((inq://|http://|https://|//|/|#){0,1}[^\"]*)\"','gi');var matches=html.match(x);if(matches!=null){for(var ix=0;ix<matches.length;ix++){try{var fix=matches[ix];x=new RegExp('(href|src|action)=\"((inq://|javascript:|http://|https://|//|/|#){0,1}([a-zA-Z0-9._-]+)([^\"]*)\")','gi');var parts=x.exec(fix);if(parts!=null){var url;switch((parts[3]).toLowerCase()){case"inq://":if(parts.length>4){switch(parts[4]){case"agentsAvailabilityCheckURL":url=Inq.urls.agentsAvailabilityCheckURL;break;case"baseURL":url=Inq.urls.baseURL;break;case"chatRouterVanityDomain":url=Inq.urls.chatRouterVanityDomain;break;case"pageUnloadURL":url=Inq.urls.pageUnloadURL;break;case"cobrowseURL":url=Inq.urls.cobrowseURL;break;case"cookieClearAllURL":url=Inq.urls.cookieClearAllURL;break;case"cookieClearOneURL":url=Inq.urls.cookieClearOneURL;break;case"cookieGetURL":url=Inq.urls.cookieGetURL;break;case"cookieSetURL":url=Inq.urls.cookieSetURL;break;case"getSiteTzOffsetURL":url=Inq.urls.getSiteTzOffsetURL;break;case"initFrameworkURL":url=Inq.urls.initFrameworkURL;break;case"logDataURL":url=Inq.urls.logDataURL;break;case"logJsPostURL":url=Inq.urls.logJsPostURL;break;case"loggingURL":url=Inq.urls.loggingURL;break;case"mediaBaseURL":url=Inq.urls.mediaBaseURL;break;case"mediaRootURL":url=Inq.urls.mediaRootURL;break;case"mediaSiteURL":url=Inq.urls.mediaSiteURL;break;case"requestC2CImageURL":url=Inq.urls.requestC2CImageURL;break;case"requestChatLaunchURL":url=Inq.urls.requestChatLaunchURL;break;case"siteHostedFileURL":url=Inq.urls.siteHostedFileURL;break;case"skinURL":url=Inq.urls.skinURL;break;case"vanityURL":url=Inq.urls.vanityURL;break;case"xFormsDomain":default:url=Inq.urls.xFormsDomain;break}
url+=parts[5];};break;case"http://":case"https://":case"javascript:":case"#":url=parts[2];break;case"//":url=proto+parts[2];break;case"/":url=proto+"//"+domain+parts[2];break;default:url=path+"/"+parts[2];break;}
url=parts[1]+'=\"'+url+'\"';if(url!=fix){html=html.replace(fix,url);}}}
catch(e){}}}
return html;}
this.fixFormSubmit=function(xwin,headerData){function collectFormData(form){var data=[];for(var i=0;i<form.length;i++){var child=form[i];if(child.nodeName=="INPUT"||child.nodeName=="BUTTON"){if(child.name){data.push(encodeURIComponent(child.name)+"="+encodeURIComponent(child.value));}}}
return data.join("&");}
function overrideSubmit(){var method=this.method.toUpperCase();var url=(headerData.srcurl)?headerData.srcurl+"&cbust="+Math.floor(Math.random()*1000011):this.action;var data=collectFormData(this);var callback=function(){if(this.readyState==XMLHttpRequestFacade.DONE&&this.status==200){this.onreadystatechange=null;var html=normalizeHtml(this.responseText,url);html=fixDocumentRewriteBug(html,xwin);writeForm(xwin.document,html);}};var xdr=new XMLHttpRequestFacade();if(method=="POST"){xdr.open(method,url,true);xdr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xdr.setRequestHeader("Content-Length",data.length);xdr.setRequestHeader("Connection","keep-alive");xdr.onreadystatechange=callback;xdr.send(data);}else{xdr.open(method,url+="?"+data,true);xdr.onreadystatechange=callback;xdr.send();}
return true;}
var forms=xwin.document.getElementsByTagName("FORM");for(var i=0;i<forms.length;i++){forms[i].submit=overrideSubmit;}};};XFormsLoader.instances=[];XFormsLoader.JSESSIONID="ji";XFormsLoader.requestQueue=[];XFormsLoader.isGetSessionIdInProgress=false;XFormsLoader.MAX_ATTEMPTS_COUNT=3;XFormsLoader.resetGlobalVars=function(win){"use strict";function getCleanWindow(ijsfWin){var cleanIFrame=ijsfWin.document.getElementById("cleanIFrame");if(!cleanIFrame){cleanIFrame=ijsfWin.Inq.createHiddenIFrame("cleanIFrame");ijsfWin.document.body.appendChild(cleanIFrame);}
var win=cleanIFrame.contentWindow;if(typeof win=="undefined"||win==null){logError({message:"Failed to get clean window object"});}
return win;}
log("Resetting global variables to overcome WebKit's peculiarity");var cleanWindow=getCleanWindow(window);if(win.XMLHttpRequestOriginal){win.XMLHttpRequest=win.XMLHttpRequestOriginal;win.XMLHttpRequestOriginal=undefined;}
for(var property in win){if(win.hasOwnProperty(property)&&typeof cleanWindow[property]=="undefined"){try{win[property]=undefined;}catch(ex){log("WARN: cannot delete global variable '"+property+"'");}}}
if(typeof YAHOO!='undefined'){logError({message:"Failed to delete the YAHOO global variable."});}};XFormsLoader.initJsid=function(){var jsidVar=PM.getVar(XFormsLoader.JSESSIONID);if(!jsidVar){jsidVar=(new VBER34(XFormsLoader.JSESSIONID,"",resources["session"]));jsidVar.init();jsidVar.getValue();PM.addVar(jsidVar);}
return jsidVar.getValue();};XFormsLoader.persistJsid=function(jsid){PM.getVar(XFormsLoader.JSESSIONID).setValue(jsid);};XFormsLoader.showInClientDiv=function(divId,rule,ruleBusinessUnitId,url,items,method){var divEl=doc.getElementById(divId);if(isNullOrUndefined(divEl)){log("Error: DIV with id \""+divId+"\" not found.");}else{var buID=ruleBusinessUnitId?ruleBusinessUnitId:rule.getBusinessUnitID();var urlData=FP.parseXFrameUrl(url);if(typeof urlData.params=='object'){MI8.prepare(urlData.params).im13(MI8.XJA3);urlData.params=MI8.unmix(urlData.params.absorb(items));}
var ldr=new XFormsLoader();method=method?method:null;ldr.createXFrame(divEl,urlData.url,buID,"no",urlData.params,rule,{type:"br",id:rule.getID()},{type:"div",id:divId},false,method);}}
return XFormsLoader;}();function CBMR(id,config,cobrowseBannerText){this.cobrowseBannerText=cobrowseBannerText;this._frameworkModule(id);this._config=config;}
MI8.prepare(CBMR).im13(MI8.FM2);CBMR.prototype.load=function(handler){if(CBMR.isSupported()){var maskingConfig=this._config.cobrowseMaskingConfig;var isEmbeddedResource=this._config.isEmbeddedResource;var cobrowseBannerText=this.cobrowseBannerText;loadScript(urls.mediaRootURL,"/flash/jquery-1.11.1.js","/flash/jquery-1.11.1.min.js",function(greeting){loadScript(urls.vanityURL,"/tagserver/cbc.js","/tagserver/cbc-min.js",function(greeting){try{if(window["cobrowse"]){window.cobrowse.initialize(maskingConfig,isEmbeddedResource,isIE(),cobrowseBannerText,CHM.isPersistentWindow());}
CHM.setCobrowseFlag(true);}catch(e){log("Cobrowse Initialization failed: "+e);}
try{if(handler){handler();}}catch(e){log("Cobrowse load on demand failed: "+e);}},handler);},handler);}};CBMR.prototype.init=function(){this.load();};CBMR.prototype.runOnDemand=function(handler){if(typeof(window.cobrowse)!="undefined"){handler();}
else{this.load(handler);}};CBMR.isSupported=function(){var _isSupported=false;if("Standard"===getDeviceType()){_isSupported=true;}
return _isSupported;};CBMR.prototype.start=function(){};CBMR.prototype.reset=function(){};function AutomatonDT(){}
AutomatonDT.prototype.addDTEventFields=function(div,dataToSend){var children=div.getElementsByTagName('input');var selectedCheckboxNames=[];for(var i=0;i<children.length;i++){var elem=children[i];if(elem.type=="checkbox"){dataToSend[elem.name]=""+elem.checked;if(elem.checked){selectedCheckboxNames[selectedCheckboxNames.length]=elem.name;}}
else{dataToSend[elem.name]=""+elem.value;}}
return selectedCheckboxNames;};AutomatonDT.prototype.getAnswerText=function(button,div){if(isNullOrUndefined(button)){return null;}
if(button.nodeName=="A"){return button.innerHTML;}
if(!isNullOrUndefined(button.text)){return button.text;}
if(!isNullOrUndefined(button.type)){if(button.type=='button'){var out='';var children=div.getElementsByTagName('input');for(var i=0;i<children.length;i++){var elem=children[i];if(elem.type=="checkbox"){if(elem.checked){if(out.length>0){out+=" ";}
out+="'"+elem.value+"'";}}}
if(out.length==0){out="Nothing";}
return button.name+' ('+out+' selected)';}}
return null;};AutomatonDT.prototype.sendDTEvent=function(eventName,button,data){try{var div=document.getElementById(data.divId);var dataToSend=null;try{dataToSend=data.model;}
catch(e){log("sendDTEvent can't read data model "+e);}
if(isNullOrUndefined(dataToSend)){dataToSend={};}
var dataNode=button.parentNode;var selectedCheckboxNames=this.addDTEventFields(dataNode,dataToSend);if(button){data.selectedLinkName=button.name;}
data.selectedCheckboxNames=selectedCheckboxNames;data.model=MI8.JSON.stringify(dataToSend);var answerText=this.getAnswerText(button,div);if(answerText){data.answerText=answerText;}
FP.sendDTEvent(eventName,data);}
catch(e){log("sendDTEvent error "+e);}
return false;};function EXCVTR(){this._observable();this.secondAttempt=false;this.enabled=false;this.masterEnabled=true;this.resetPromptTimer='';this.USIdone=false;this.initialized=false;this._rule=null;}
MI8.prepare(EXCVTR).im13(MI8.Observable).im13(MI8.RC54);EXCVTR.prototype.isListener=function(l){return!!(l&&((l.onCancelExit&&typeof l.onCancelExit=="function")||(l.onBeforeExitConfirmation&&typeof l.onBeforeExitConfirmation=="function")));};EXCVTR.prototype.fireCancelExitEvent=function(){function f(l,evt){try{if(!!l.onCancelExit){l.onCancelExit(evt);}}catch(e){log("Error firing event CancelExit on "+l.toString()+":"+e);}}
var event={rule:this._rule};this._fireEvt(f,event);};EXCVTR.prototype.onChatLaunched=function(evt){this.setEnabled(false);};EXCVTR.prototype.onChatClosed=function(evt){this.setEnabled(true);};EXCVTR.prototype.fireBeforeExitConfirmationEvent=function(){function f(l,evt){try{if(!!l.onBeforeExitConfirmation){l.onBeforeExitConfirmation(evt);}}catch(e){log("Error firing event BeforeExitConfirmation on "+l.toString()+":"+e);}}
var event={rule:this._rule};this._fireEvt(f,event);};EXCVTR.prototype.tempDisable=function(){if(Inq.EC.isEnabled()){Inq.EC.setEnabled(false);log('Exit Chat temporarily disabled');if(Inq.EC.resetPromptTimer!=''){win.clearTimeout(Inq.EC.resetPromptTimer);}
Inq.EC.resetPromptTimer=win.setTimeout(Inq.EC.reEnable,3000);}};EXCVTR.prototype.disableExitChat=function(){Inq.EC.masterEnabled=false;return true;};EXCVTR.prototype.reEnable=function(){if(!Inq.EC.USIdone){Inq.EC.setEnabled(true);}
Inq.EC.resetPromptTimer='';log("re-enabled alert");};EXCVTR.prototype.doActions=function(evt){setTimeout(function(){inqFrame.Inq.EC.fireCancelExitEvent();},1000);};EXCVTR.prototype.doInit=function(rule,aTxt,image,cTxt,automatedAgent,businessUnitID,checkAgentAvailabilityInterval){if(isServiceBlocked("POPUP")){return;}
this._rule=rule;var showImage=(image!=null)&&(isSafari()||isChrome());var imageWidth=0;var imageHeight=0;var imageElement;if(showImage){imageElement=document.createElement("img");imageElement.src=urls.mediaSiteURL+'/images/'+image;imageElement.id="ExitConfirmImage";imageElement.style.cssText="position:absolute;top:0px;left:0px;"
document.body.appendChild(imageElement);}
this._businessUnitID=businessUnitID;this._automatedAgent=(!!automatedAgent===automatedAgent?automatedAgent:!automatedAgent);if(this._automatedAgent){this.reEnable();}else{this.dataMap={buID:this._businessUnitID,siteID:Inq.siteID,brID:rule.id,agentAttributes:rule.getAgentAttributes(),ruleAttributes:rule.getRuleAttributes(),agID:rule.getAgentGroupID()};if(checkAgentAvailabilityInterval){this.runAgentCheckTimer(checkAgentAvailabilityInterval);}else{this.callRemote(Inq.urls.agentsAvailabilityCheckURL,this.dataMap);}}
addListener(win.document.documentElement,"mousedown",this.tempDisable);addListener(win.document.documentElement,"click",this.tempDisable);addListener(win.document.documentElement,"keypress",this.tempDisable);addListener(win.document.documentElement,"submit",this.disableExitChat);win.v3Lander.prepareBeforeUnload(aTxt,cTxt,this.doActions,showImage,imageElement);if(this.initialized)
throw"Single Use Exception. Exit Confirmation may only be used once per page for rules. Check for redundant rules of this type.";this.rule=rule;this.initialized=true;function addListener(element,eventName,handler){if(element.addEventListener){element.addEventListener(eventName,handler,true);}else if(iframe.attachEvent){element.attachEvent("on"+eventName,handler);}}};EXCVTR.prototype.onRemoteCallback=function(jsonData){if(!isNullOrUndefined(jsonData)&&!isNullOrUndefined(jsonData.availability)&&!isNullOrUndefined(jsonData.inHOP)){Inq.EC.setEnabled(jsonData.availability==="true"&&jsonData.inHOP==="true");}};EXCVTR.prototype.update=function(evt){this.USIdone=true;if(this.resetPromptTimer!=''){clearTimeout(this.resetPromptTimer);}
var ruleFL=this._rule.getConstant("fl",rule);if(Inq.GR34.isChatInProgress()||(ruleFL&&ruleFL>=PM.getVar("cfl").getValue())){this.setEnabled(false);}
return((this.masterEnabled==true)&&(this.enabled==true));};EXCVTR.prototype.isEnabled=function(){return this.enabled;};EXCVTR.prototype.setEnabled=function(b){this.enabled=b;};EXCVTR.prototype.runAgentCheckTimer=function(interval){Inq.EC.callRemote(Inq.urls.agentsAvailabilityCheckURL,Inq.EC.dataMap);var launchString="Inq.EC.runAgentCheckTimer("+interval+")";setTimeout(launchString,interval);};EXCVTR.prototype.isInitialized=function(){return this.initialized;};function ExitHook(){this._observable();this.initialized=false;this._rule=null;}
MI8.prepare(ExitHook).im13(MI8.Observable);ExitHook.prototype.isListener=function(l){return!!(l&&(l.onBeforeUnload&&typeof l.onBeforeUnload=="function"));};ExitHook.prototype.fireBeforeUnloadEvent=function(){function f(l,evt){try{if(!!l.onBeforeUnload){l.onBeforeUnload(evt);}}catch(e){log("Error firing event BeforeUnload on "+l.toString()+":"+e);}}
var event={rule:this._rule};this._fireEvt(f,event);};ExitHook.prototype.doInit=function(rule){this._rule=rule;win.v3Lander.prepareBeforeUnloadForEH();this.initialized=true;};ExitHook.prototype.isInitialized=function(){return this.initialized;};ExitHook.prototype.init=function(){if(Inq.FlashPeer.getIsSkinLocal&&Inq.FlashPeer.getIsSkinLocal()){}else{if(/(iPad|iPhone).*OS 9/i.test(navigator.userAgent)){attachListener(window,"pagehide",Inq.FlashPeer.sendBeacon);}else{attachListener(window,"beforeunload",Inq.FlashPeer.sendBeacon);}}};function VAMgr(id,data){this._frameworkModule(id);this.absorb(data);this._varTable={};this._bActionable=true;this.currentVisitorAttributes={};this.banned={};this.hashed={};this.storedValues=new MapVariable("VA",new Array(),resources.state);this.allowDynamic=true;this.crc32map={};this.crc32=function(str){if(!this.crc32map[str]){var table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var crc=-1;var x=0;var y=0;for(var i=0,iTop=str.length;i<iTop;i++){y=(crc^str.charCodeAt(i))&0xFF;x="0x"+table.substr(y*9,8);crc=(crc>>>8)^x;}
crc=crc^(-1);if(crc<0)
{crc=0xFFFFFFFF+crc+1;}
this.crc32map[str]="a"+((crc).toString(36));}
return this.crc32map[str];};this.test=function(visitorAttributes){var result=false;for(var a in visitorAttributes){if(this.currentVisitorAttributes[a]){result=true;if(visitorAttributes[a].values){if(this.currentVisitorAttributes[a].values){for(var valueChecking in visitorAttributes[a].values){if(!this.currentVisitorAttributes[a].values[valueChecking]){return false;}}}else{result=false;}}}}
return result;};this.checkBanDuration=function(attributeName){var attr;var expiry;if((attr=this.businessVisitorAttributes[attributeName])||(attr=this.programVisitorAttributes[attributeName])){var b=this.banned[this.crc32(attributeName)];if(b){var currentTime=new Date().getTime();expiry=parseInt(b.d,36)*1000;if(!isNullOrUndefined(b.d)&&(expiry>0)&&(expiry<currentTime)){delete this.banned[this.crc32(attributeName)];attr.banAll=false;}else{for(var bannedValue in b){if(bannedValue!='d'){expiry=parseInt(b[bannedValue].d,36)*1000;if((expiry>0)&&(expiry<currentTime)){delete b[bannedValue];}}}}}}};this.add=function(visitorAttributes){for(var a in visitorAttributes){if(typeof visitorAttributes[a]=="function")continue;var attr;var val=null;if((attr=this.businessVisitorAttributes[a])||(attr=this.programVisitorAttributes[a])){this.checkBanDuration(a);if(!attr.banAll){for(var valueAdding in visitorAttributes[a].values){if(typeof visitorAttributes[a].values[valueAdding]=="function")
continue;if(((attr.values[valueAdding]&&!this.allowDynamic)||this.allowDynamic)&&!(this.banned[this.crc32(a)]&&this.banned[this.crc32(a)][this.crc32(valueAdding)])){if(!this.currentVisitorAttributes[a]||attr.mutuallyExclusive){this.currentVisitorAttributes[a]={};this.hashed[this.crc32(a)]=[];this.currentVisitorAttributes[a].values={};}
this.currentVisitorAttributes[a].values[valueAdding]=true;if(this.allowDynamic){val=valueAdding;}else{val=this.crc32(valueAdding);}
if(!this.hashed[this.crc32(a)].contains(val)){this.hashed[this.crc32(a)].append([val]);}}}}}
if(!!val)
this.logData("visitorAttributeAdded",a,this.getAttributeValues(a,visitorAttributes));}
this.save();};this.remove=function(visitorAttributes,fromRemoveAll){var removedAttrs=new Array();for(var a in visitorAttributes){if(typeof visitorAttributes[a]=="function"||this.isMutuallyExclusiveAttribute(a))continue;if(this.currentVisitorAttributes[a]){var hasNoValues=true;for(var valueRemoving in visitorAttributes[a].values){if(typeof visitorAttributes[a].values[valueRemoving]=="function")
continue;hasNoValues=false;removedAttrs.push(valueRemoving);if(this.currentVisitorAttributes[a].values[valueRemoving]){delete this.currentVisitorAttributes[a].values[valueRemoving];var ind;if(this.allowDynamic){ind=this.hashed[this.crc32(a)].indexOf(valueRemoving);}else{ind=this.hashed[this.crc32(a)].indexOf(this.crc32(valueRemoving));}
this.hashed[this.crc32(a)].remove(ind);if(Object.keys(this.currentVisitorAttributes[a].values).length==0){delete this.currentVisitorAttributes[a];delete this.hashed[this.crc32(a)];}}}
if(hasNoValues||fromRemoveAll){removedAttrs=this.getAttributeValues(a,this.currentVisitorAttributes);delete this.currentVisitorAttributes[a];delete this.hashed[this.crc32(a)];}}
this.logData("visitorAttributeRemoved",a,removedAttrs);}
this.save();};this.removeAll=function(){this.remove(this.currentVisitorAttributes,true);};this.ban=function(visitorAttributes,duration){var sendlog=false;if(duration>0){duration=Math.ceil((new Date().getTime()+duration)/1000).toString(36);}
for(var a in visitorAttributes){if(typeof visitorAttributes[a]=="function"||this.isMutuallyExclusiveAttribute(a))continue;var attr;var crc=this.crc32(a);if((attr=this.businessVisitorAttributes[a])||(attr=this.programVisitorAttributes[a])){var banAll=true;if(visitorAttributes[a].values){for(var valueBanning in visitorAttributes[a].values){if(typeof visitorAttributes[a].values[valueBanning]=="function")
continue;banAll=false;if(this.allowDynamic||attr.values[valueBanning]){if(this.currentVisitorAttributes[a]&&this.currentVisitorAttributes[a].values&&this.currentVisitorAttributes[a].values[valueBanning]){delete this.currentVisitorAttributes[a].values[valueBanning];if(this.allowDynamic){delete this.hashed[this.crc32(a)][valueBanning];}else{delete this.hashed[this.crc32(a)][this.crc32(valueBanning)];}}
if(!this.banned[crc]){this.banned[crc]={};}
sendlog=true;this.banned[crc][this.crc32(valueBanning)]={"d":duration};}}}
if(banAll){sendlog=true;attr.banAll=true;delete this.currentVisitorAttributes[a];delete this.hashed[this.crc32(a)];this.banned[this.crc32(a)]={"d":duration};}}
if(sendlog)
this.logData("visitorAttributeBanned",a,this.getAttributeValues(a,visitorAttributes));}
this.save();};this.unban=function(visitorAttributes){for(var a in visitorAttributes){if(typeof visitorAttributes[a]=="function"||this.isMutuallyExclusiveAttribute(a))continue;var attr;if((attr=this.businessVisitorAttributes[a])||(attr=this.programVisitorAttributes[a])){var unbanAll=true;if(visitorAttributes[a].values&&this.banned[this.crc32(a)]){for(var valueBanning in visitorAttributes[a].values){if(typeof visitorAttributes[a].values[valueBanning]=="function")
continue;delete this.banned[this.crc32(a)][this.crc32(valueBanning)];unbanAll=false;}}
if(!unbanAll){unbanAll=true;for(var bannedValue in this.banned[this.crc32(a)]){if(bannedValue!="d"){unbanAll=false;break;}}}
if(unbanAll){attr.banAll=false;delete this.banned[this.crc32(a)];}}
this.logData("visitorAttributeUnbanned",a,this.getAttributeValues(a,visitorAttributes));}
this.save();};this.initBanned=function(visitorAttributes){for(var a in visitorAttributes){var attr=visitorAttributes[a];var crc=this.crc32(a);if(this.banned[crc]){var banAll=true;for(var tmp in this.banned[crc]){if(tmp!="d"){banAll=false;break;}}
if(banAll){attr.banAll=true;}}}};this.initHashed=function(visitorAttributes){for(var a in visitorAttributes){var attr=visitorAttributes[a];var crc=this.crc32(a);if(this.hashed[crc]){this.currentVisitorAttributes[a]={};this.currentVisitorAttributes[a].values={};if(this.hashed[crc].length){if(this.allowDynamic){for(var i=0;i<this.hashed[crc].length;i++){valueAdding=this.hashed[crc][i];this.currentVisitorAttributes[a].values[valueAdding]=true;}}else{for(var valueAdding in attr.values){if(this.hashed[crc][this.crc32(valueAdding)]){this.currentVisitorAttributes[a].values[valueAdding]=true;}}}}}}};this.init=function(){};this.getAttributeValues=function(a,source){var values=[];if(source==null){source=this.currentVisitorAttributes;}
if(source[a]){for(var value in source[a].values){values[values.length]=value;}}
return values;};this.getExternalCustomerIdVisitorAttributesAsString=function(){var visitorAttrs=this.businessVisitorAttributes;var result="";for(var attr in visitorAttrs){if(visitorAttrs[attr].externalCustomerID){result+=result?","+encodeURIComponent(attr):encodeURIComponent(attr);}}
return result;}
this.getCopyAsMap=function(){var copy={currentVisitorAttributes:this.currentVisitorAttributes,keys:function(){var keys=[];for(var a in this.currentVisitorAttributes){keys[keys.length]=a;}
return keys;},values:function(){var values=[];for(var a in this.currentVisitorAttributes){values[values.length]=this.get(a);}
return values;},each:function(func){if(typeof func=="function"){for(var a in this.currentVisitorAttributes){func(a,this.get(a),this);}}},clear:function(){},set:function(){},get:function(key){var values=[];var cVatt=this.currentVisitorAttributes[key];if(!!cVatt&&!!cVatt.values){for(var value in cVatt.values){values[values.length]=value;}}
return values;},unset:function(){}};return copy;};this.start=function(){};this.reset=function(){};this.load=function(){if(this.storedValues.getValue()==null){this.storedValues.init();}else{this.banned=this.storedValues.getValue().get("ban");if(this.banned){this.initBanned(this.businessVisitorAttributes);this.initBanned(this.programVisitorAttributes);}else{this.banned={};}
this.hashed=this.storedValues.getValue().get("hash");if(this.hashed){this.initHashed(this.businessVisitorAttributes);this.initHashed(this.programVisitorAttributes);}else{this.hashed={};}}};this.save=function(){this.storedValues.set("hash",this.hashed);this.storedValues.set("ban",this.banned);};this.agrtyer=function(){this.load();};this.getPersistentId=function(){return this.getID();};this.getCopyAsArray=function(urlEncodingRequired){var tmp=new Array();for(var attribute in this.currentVisitorAttributes){var values=this.getAttributeValues(attribute);var keyValues=new Array(values.length);var attr=urlEncodingRequired?encodeURIComponent(attribute):attribute;for(var i=0;i<values.length;i++){var val=urlEncodingRequired?encodeURIComponent(values[i]):values[i];keyValues[i]=attr+','+val;}
tmp[tmp.length]=keyValues.length>0?keyValues.join(';'):(attr+",");}
return tmp;};this.logData=function(event,attribute,values){var encodedValues=new Array(values.length);if(values.length>0){for(var i=0;i<values.length;i++){encodedValues[i]=encodeURIComponent(attribute)+","+encodeURIComponent(values[i]);}}else{encodedValues.push(encodeURIComponent(attribute)+",");}
ROM.send(urls.logDataURL,{_domain:"customer",evt:event,siteID:Inq.siteID,incAssignmentID:getIncAssignmentID(),sessionID:getSessionID(),customerID:Inq.getCustID(),atts:encodedValues.join(";"),currentAtts:(this.getCopyAsArray(true).join(";"))});};this.testBanned=function(visitorAttribute){var result=false;for(var a in visitorAttribute){this.checkBanDuration(a);var attr=visitorAttribute[a];var crc=this.crc32(a);if(this.banned[crc]){var banAll=true;for(var tmp in this.banned[crc]){if(tmp!="d"){banAll=false;break;}}
if(banAll){result=true;}else{for(var valueBanning in attr.values){if(this.banned[crc][this.crc32(valueBanning)]){result=true;break;}}}}}
return result;};this.toString=function(){return!!this.getCopyAsArray()?this.getCopyAsArray().toString():"";};this.isMutuallyExclusiveAttribute=function(attr){return attr=="mutuallyExclusive";};};MI8.prepare(VAMgr).im13(MI8.Persistable).im13(MI8.FM2).im13(MI8.XJA3);function MessageMgr(w){var self=this;this.window=(w)?w:window;this.messageEnabled=this.enablePostMessage();if(this.messageEnabled){try{this.window.addEventListener("message",function(message){self.onMessage(message);});}catch(e){log(e);}}}
MessageMgr.prototype.enablePostMessage=function(){var deviceType=getDeviceType();return(deviceType==='Phone'||deviceType==='Tablet');}
MessageMgr.CMD_CLOSE_PERSISTENT="CLOSE_PERSISTENT";MessageMgr.prototype.onMessage=function(message){if(this.isSecure(message)){switch(message.data){case MessageMgr.CMD_CLOSE_PERSISTENT:this.window.setTimeout("inqFrame.Inq.FlashPeer.CloseChatFromPersistent()",0);break;}}
return true;}
MessageMgr.prototype.isSecure=function(message){var locs=this.getAuthorizedOrigins();var origin=this.parseUrl(message.origin);for(var i=0;i<locs.length;i++){var loc=this.parseUrl(locs[i]);if(loc.port==origin.port&&loc.domain==origin.domain){return true;}}
return false;}
MessageMgr.prototype.parseUrl=function(string){var m=string.match(/^(https?):\/\/([^\/:]+)(:?(\d*))/);var host=m[2];var domain=(host.indexOf('.')>=0)?host.split('.').slice(1).join('.'):host;return{protocol:m[1],domain:domain,port:(m[4]?m[4]:80)};}
MessageMgr.prototype.getAuthorizedOrigins=function(){var locs=[];locs.push(this.window.location.href);locs.push(this.window.document.location.href);if(this.window.parent&&(this.window.parent!==this.window)){locs.push(this.window.parent.location.href);locs.push(this.window.parent.document.location.href);}
if(this.window.opener){locs.push(this.window.opener.location.href);locs.push(this.window.opener.document.location.href);}
return locs;}
MessageMgr.prototype.closePersistent=function(win,targetHost){this.send(win,MessageMgr.CMD_CLOSE_PERSISTENT,targetHost);}
MessageMgr.prototype.send=function(win,command,targetHost){if(!win)throw"Illegal argument: null 'win'";if(!command)throw"Illegal argument: null 'command'";var t=targetHost||"*";if(this.messageEnabled){win.postMessage(command,t);}
else{win.Inq.MSG.onMessage({data:command,origin:this.window.location.href});}}
function WatchDogMgr(){this.clients=[];this._className="WatchDogMgr";}
WatchDogMgr.prototype.registerClient=function(clientID,checkInterval,isAliveCallback,resetStateCallback){this.unregisterClient(clientID);var client=new Object();client.id=clientID;client.checkInterval=checkInterval;client.isAlive=isAliveCallback;client.resetState=resetStateCallback;var me=this;client.timer=window.setInterval(function(){me.onProcessClient(client);},checkInterval);this.clients.push(client);}
WatchDogMgr.prototype.unregisterClient=function(clientID){for(var i=0;i<this.clients.length;i++){if(this.clients[i].id==clientID){window.clearInterval(this.clients[i].timer);this.clients.splice(i,1);return;}}}
WatchDogMgr.prototype.onProcessClient=function(client){try{if(client.isAlive){if(!client.isAlive()&&client.resetState){Inq.FlashPeer.logInfo("Client "+client.id+" is not alive. Try to reset state");client.resetState();}}}catch(e){Inq.FlashPeer.logError("Error WatchDogMgr.onProcessClient "+e);}}
WatchDogMgr.WDM=null;WatchDogMgr.getInstance=function(){if(WatchDogMgr.WDM==null){WatchDogMgr.WDM=new WatchDogMgr();}
return WatchDogMgr.WDM;};function DestinationMonitor(){this.KEY_F5=116;this.initialized=false;this.target=null;}
DestinationMonitor.prototype.init=function(){if(isPersistentWindow()){return;}
attachListener(doc,"keydown",this._keydownHandler,false);if(isFF()){attachListener(doc,"focus",this._focusinMonitor,true);}else{attachListener(doc,"focusin",this._focusinMonitor,false);}
if(isFF()){attachListener(doc,"blur",this._focusoutMonitor,true);}else{attachListener(doc,"focusout",this._focusoutMonitor,false);}
if(isSafari()){attachListener(doc,"mousedown",this._focusinMonitor,false);}
this.initialized=true;};DestinationMonitor.prototype.reset=function(){if(this.initialized){detachListener(doc,"keydown",this._keydownHandler,false);detachListener(doc,"focus",this._focusinMonitor,true);detachListener(doc,"focusin",this._focusinMonitor,false);detachListener(doc,"blur",this._focusoutMonitor,true);detachListener(doc,"focusout",this._focusoutMonitor,false);detachListener(doc,"mousedown",this._focusinMonitor,false);this.initialized=false;}};DestinationMonitor.prototype.addTarget=function(e){e=e||window.event;var target=this.filterTarget(e);if(target){this.target=target;this.saveDestinationURL(target.href);}};DestinationMonitor.prototype.removeTarget=function(e){e=e||window.event;var target=this.filterTarget(e);if(target&&this.target==target){this.target=null;this.clearDestinationURL();}};DestinationMonitor.prototype.filterTarget=function(e){var target=e.target||e.srcElement;if(target.tagName&&"A"==target.tagName.toUpperCase()&&target.href&&target.getAttribute("target")!="_blank"){return target;}else{return null;}};DestinationMonitor.prototype._keydownHandler=function(e){if(DM){DM.keydownHandler.apply(DM,arguments);}};DestinationMonitor.prototype.keydownHandler=function(e){e=e||window.event;if(this.KEY_F5==e.keyCode&&!isSafari()){this.clearDestinationURL();}};DestinationMonitor.prototype._focusinMonitor=function(e){if(DM){DM.focusinMonitor.apply(DM,arguments);}};DestinationMonitor.prototype.focusinMonitor=function(e){this.addTarget(e);};DestinationMonitor.prototype._focusoutMonitor=function(e){if(DM){DM.focusoutMonitor.apply(DM,arguments);}};DestinationMonitor.prototype.focusoutMonitor=function(e){this.removeTarget(e);};DestinationMonitor.prototype.saveDestinationURL=function(url){var chat=CHM.getChat();if(chat&&!CHM.isPersistentChat()){CHM.setCABeacon(CHM.getChat().BEACON_DATA,{lastDestinationUrl:url});}};DestinationMonitor.prototype.clearDestinationURL=function(){this.saveDestinationURL("");};function getOpener(){var opener=null;if(isPersistentWindow()){try{opener=(window.parent.opener&&window.parent.opener.inqFrame)?window.parent.opener.inqFrame:((window.opener)?window.opener:null);}catch(e){log("Error getting opener: "+e.message);}}
return opener;}
var frameworkCanRun=site.frameworkCanRun;function toJsString(val,quote){var value=val;value=value.split("\\").join("\\\\");value=value.split("\"").join("\\\"");value=value.split("\'").join("\\\'");value=value.split("\n").join("\\n");value=value.split("\r").join("\\r");value=value.split("\t").join("\\t");if(quote)
value=quote+value+quote;return value;}
function formatArgument(arg){try{var type="[unknown]";try{type=(typeof(arg)=="object")?((arg["constructor"]!=null)?arg.constructor.toString():""+arg):("("+typeof(arg)+")");}
catch(e){type=""+arg;}
if(type.indexOf("function")!=-1){type=type.split("\n").join(" ").replace(/^\s*function (\w+)\s*\(\)[^\n]*/g,"[object $1]");}
if(type=="(boolean)"||type=="[object Boolean]")type=(arg)?"true":"false";if(type=="(string)"||type=="[object String]")type=toJsString(arg,"\"");if(type=="(number)")type=""+arg;if(type=="(array)"||type=="[object Array]"){type="";for(var ix=0;ix<arg.length;ix++){type+=((type.length!=0)?",":"")+formatArgument(arg[ix]);if(type.length>128)break;}
if(type.length>128)
type=type.substr(0,128-3)+"...";return"["+type+"]";}
return type;}catch(e){return"[argument]";}}
function isSameOrigin(){try{if(isPersistentWindow()){if(window.parent.opener.Inq){return true;}else{return false;}}}catch(err){return false;}}
function getID(){return this._id;}
function getCustID(){if(isNullOrUndefined(this.custID)){return"";}else{return this.custID;}}
function getPersistCustID(){return persistentCustomerID;}
function setPersistCustID(persistCustID){persistentCustomerID=persistCustID;Inq.save();}
function getCustIP(){return this.custIP;}
var siteID=site.siteID;function getSiteID(){return siteID;}
var fileUploadSize=site.fileTransferSize;function getDefaultLanguage(){return site.language;}
function getCiObfuscationLevel(){return parseInt(site.ciObfuscation);}
function isJsDebugActive(){return site.JSDebugMode;}
function isJsLoggingActive(){return!site.JSLoggingDisabled;}
function getDefaultAgentGroupId(){return site.defaultAgentGroup;}
function getSessionID(){var sesVar=PM.getVar("sesID");return sesVar?sesVar.getValue():"";}
function getIncAssignmentID(){var incAssignmentID=PM.getVar("incID");return incAssignmentID?incAssignmentID.getValue():"";}
function getIncGroupID(){var inqGroupID=PM.getVar("incGroup");return inqGroupID?inqGroupID.getValue():"";}
var getDefaultBusinessUnitID=site.getDefaultBusinessUnitID;var deviceType="Standard";function setDeviceType(newDeviceType){deviceType=newDeviceType;}
function getDeviceType(){return deviceType;}
function isDeviceType(type){return type==getDeviceType();}
var clntLag;function getClientTimeLag(){return clntLag;}
var siteTzID=site.timezoneID;var siteTzOffset;var scheduleTZs={};function getSiteTZOffset(){return siteTzOffset;}
function isTZRequestRequired(){if((!isEmptyObject(businessSchedules)||!isEmptyObject(programSchedules))&&isNullOrUndefined(siteTzOffset))
return true;else return false;}
function isSchMet(scheduleId){if(schedules[scheduleId]){schedules[scheduleId].tzOffset=scheduleTZs[schedules[scheduleId].timezone];}
return(schedules[scheduleId]&&schedules[scheduleId].isScheduleMet(new Date(),getClientTimeLag(),getSiteTZOffset()));}
function processCustomerApiRegistry(){Inq.overridePageID=(!!win.inqSiteID)?win.inqSiteID:-1;var registry=isNullOrUndefined(window.parent.InqRegistry)?{}:window.parent.InqRegistry;var listeners=[];if(!isNullOrUndefined(registry.chatListeners)){listeners.append(registry.chatListeners);}
if(!isNullOrUndefined(registry.saleListeners)){listeners.append(registry.saleListeners);}
if(!isNullOrUndefined(registry.incrementalityListeners)){listeners.append(registry.incrementalityListeners);}
if(!isNullOrUndefined(registry.listeners)){listeners.append(registry.listeners);}
for(var x=0;x<listeners.length;x++){listeners[x].custApi=true;}
EVM.addListeners(listeners);if(!isNullOrUndefined(registry.disableChat)&&registry.disableChat==true){tryue(CHM.CHAT_TYPES.POPUP,0);}
if(!isNullOrUndefined(registry.disableC2C)&&registry.disableC2C==true){tryue(CHM.CHAT_TYPES.C2C,0);}}
function initMgrs(mgrList){PM.addVars(programVars);PM.addVars(businessVars);var table=BRM.getRuleVarTable();for(var ruleID in table){if(!!table[ruleID]){PM.addVars(table[ruleID]);}}
for(var m in mgrList){try{if(mgrList[m].init){mgrList[m].init();}}catch(e){log(e);}}}
function startMgrs(mgrList){for(var m in mgrList){try{if(mgrList[m].start){mgrList[m].start();}}catch(e){log(e);}}}
function start(){if(!this.isFrameworkReady()){return;}
if(this.started){return;}
this.started=true;EVM.addObservables(mgrList);EVM.addObservables([EC]);EVM.addObservables([EH]);EVM.addListeners(mgrList);EVM.addListeners([EC]);EVM.addCustomEvents([new EXCBTT({name:"NewSession",getEvtData:function(rule,evt){return MI8.mixAbsorber({sessionID:getSessionID(),loyalty:PM.getVar("loyalty",rule).getValue(),timestamp:new Date()}).absorb(evt);}}),new EXCBTT({name:"SaleLanding",getEvtData:function(rule,evt){return MI8.mixAbsorber({products:(exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null)),quantities:(exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null)),prices:(exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null)),productTypes:(exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null)),products2:(exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):(exists(function(){return window.parent.inqSalesProducts2;},false,true)?window.parent.inqSalesProducts2:null)),quantities2:(exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):(exists(function(){return window.parent.inqSalesQuantities2;},false,true)?window.parent.inqSalesQuantities2:null)),prices2:(exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):(exists(function(){return window.parent.inqSalesPrices2;},false,true)?window.parent.inqSalesPrices2:null)),productTypes2:(exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):(exists(function(){return window.parent.inqSalesProductTypes2;},false,true)?window.parent.inqSalesProductTypes2:null)),orderType:(exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null)),lc:PM.getVar("saleLC",rule).getValue(),customerID:Inq.getCustID(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)}).absorb(evt);},aliases:[{name:"onSaleEvent",getEvtData:function(rule,evt){return{products:(exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null)),quantities:(exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null)),prices:(exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null)),productTypes:(exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null)),total:FM.callExternal("saleValue"),products2:(exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):(exists(function(){return window.parent.inqSalesProducts2;},false,true)?window.parent.inqSalesProducts2:null)),quantities2:(exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):(exists(function(){return window.parent.inqSalesQuantities2;},false,true)?window.parent.inqSalesQuantities2:null)),prices2:(exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):(exists(function(){return window.parent.inqSalesPrices2;},false,true)?window.parent.inqSalesPrices2:null)),productTypes2:(exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):(exists(function(){return window.parent.inqSalesProductTypes2;},false,true)?window.parent.inqSalesProductTypes2:null)),orderType:(exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null)),lc:PM.getVar("saleLC",rule).getValue(),customerID:Inq.getCustID(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)};}}]}),new EXCBTT({name:"Assisted",getEvtData:function(rule,evt){return MI8.mixAbsorber({agentID:CHM.getAgentID(),chatID:CHM.getChatID(),customerID:Inq.getCustID(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)}).absorb(evt);},aliases:[{name:"onSaleQualifiedEvent",getEvtData:function(rule,evt){return{agentID:PM.getVar("assistAgt",rule).getValue(),chatID:PM.getVar("assistChatID",rule).getValue(),customerID:Inq.getCustID(),bizRuleName:PM.getVar("asstRuleName",rule).getValue(),chatType:CHM.getChatType(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)};}}]}),new EXCBTT({name:"Converted",getEvtData:function(rule,evt){return MI8.mixAbsorber({saleID:PM.getVar("saleID",rule).getValue(),agentID:PM.getVar("assistAgt",rule).getValue(),chatID:PM.getVar("assistChatID",rule).getValue(),customerID:Inq.getCustID(),products:(exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null)),quantities:(exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null)),prices:(exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null)),productTypes:(exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null)),products2:(exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):(exists(function(){return window.parent.inqSalesProducts2;},false,true)?window.parent.inqSalesProducts2:null)),quantities2:(exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):(exists(function(){return window.parent.inqSalesQuantities2;},false,true)?window.parent.inqSalesQuantities2:null)),prices2:(exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):(exists(function(){return window.parent.inqSalesPrices2;},false,true)?window.parent.inqSalesPrices2:null)),productTypes2:(exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):(exists(function(){return window.parent.inqSalesProductTypes2;},false,true)?window.parent.inqSalesProductTypes2:null)),orderType:(exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null)),lc:PM.getVar("saleLC",rule).getValue(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)}).absorb(evt);},aliases:[{name:"onSoldEvent",getEvtData:function(rule,evt){return{saleID:PM.getVar("saleID",rule).getValue(),agentID:PM.getVar("assistAgt",rule).getValue(),chatID:PM.getVar("assistChatID",rule).getValue(),customerID:Inq.getCustID(),chatType:CHM.getChatType(),products:(exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null)),quantities:(exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null)),prices:(exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null)),productTypes:(exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null)),products2:(exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):(exists(function(){return window.parent.inqSalesProducts2;},false,true)?window.parent.inqSalesProducts2:null)),quantities2:(exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):(exists(function(){return window.parent.inqSalesQuantities2;},false,true)?window.parent.inqSalesQuantities2:null)),prices2:(exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):(exists(function(){return window.parent.inqSalesPrices2;},false,true)?window.parent.inqSalesPrices2:null)),productTypes2:(exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):(exists(function(){return window.parent.inqSalesProductTypes2;},false,true)?window.parent.inqSalesProductTypes2:null)),orderType:(exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null)),lc:PM.getVar("saleLC",rule).getValue(),bizRuleName:PM.getVar("asstRuleName",rule).getValue(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)};}}]}),new EXCBTT({name:"CustomerHostDomainResolved",getEvtData:function(rule,evt){return MI8.mixAbsorber({hostName:PM.getVar("custHost",rule).getValue(),ip:Inq.getCustIP()}).absorb(evt);}}),new EXCBTT({name:"SaleStateTransition",getEvtData:function(rule,evt){return MI8.mixAbsorber({chatID:CHM.getChatID(),customerID:Inq.getCustID(),oldAssistChatID:PM.getVar("oldAssistChatID",rule).getValue(),oldAssistDT:PM.getVar("oldAssistDT",rule).getValue(),oldAssistAgt:PM.getVar("oldAssistAgt",rule).getValue(),oldAsstRuleID:PM.getVar("oldAsstRuleID",rule).getValue(),oldAsstRuleName:PM.getVar("oldAsstRuleName",rule).getValue(),oldSaleState:PM.getVar("oldSaleState",rule).getValue(),oldIncState:PM.getVar("oldIncState",rule).getValue(),oldSaleID:PM.getVar("oldSaleID",rule).getValue(),oldSoldDT:PM.getVar("oldSoldDT",rule).getValue(),assistChatID:PM.getVar("assistChatID",rule).getValue(),assistDT:PM.getVar("assistDT",rule).getValue(),assistAgt:PM.getVar("assistAgt",rule).getValue(),asstRuleID:PM.getVar("asstRuleID",rule).getValue(),asstRuleName:PM.getVar("asstRuleName",rule).getValue(),saleState:PM.getVar("saleState",rule).getValue(),incState:PM.getVar("incState",rule).getValue(),saleID:PM.getVar("saleID",rule).getValue(),soldDT:PM.getVar("soldDT",rule).getValue()}).absorb(evt);}}),new EXCBTT({name:"EligibleEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),group:PM.getVar("incGroup",rule).getValue(),businessUnitID:CHM.getBusinessUnitID(evt,rule)}).absorb(evt);},aliases:[{name:"onGroupAssignment",getEvtData:function(rule,evt){return{customerID:Inq.getCustID(),group:PM.getVar("incGroup",rule).getValue()};}}]}),new EXCBTT({name:"TargetedEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),group:PM.getVar("incGroup",rule).getValue(),brID:CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID()),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)}).absorb(evt);},aliases:[{name:"onTargeted",getEvtData:function(rule,evt){return{customerID:Inq.getCustID(),group:PM.getVar("incGroup",rule).getValue(),bizRuleName:rule.evt.rule.name,businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)};}}]}),new EXCBTT({name:"ExposedEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID()),chatID:CHM.getChatID(),businessUnitID:CHM.getBusinessUnitID(evt,rule)}).absorb(evt);}}),new EXCBTT({name:"EngagedEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID()),chatID:CHM.getChatID(),businessUnitID:CHM.getBusinessUnitID(evt,rule)}).absorb(evt);}}),new EXCBTT({name:"InteractedEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID()),chatID:CHM.getChatID(),businessUnitID:CHM.getBusinessUnitID(evt,rule),type:CHM.getConversionType()}).absorb(evt);}}),new EXCBTT({name:"AssistedEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),brID:CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID()),chatID:CHM.getChatID(),businessUnitID:CHM.getBusinessUnitID(evt,rule),type:CHM.getConversionType()}).absorb(evt);}}),new EXCBTT({name:"ConvertedEvent",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),pageID:LDM.getPageID(0),customerID:Inq.getCustID(),incrementalityID:getIncAssignmentID(),sessionID:getSessionID(),group:PM.getVar("incGroup",rule).getValue(),products:(exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):null),quantities:(exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):null),prices:(exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):null),productTypes:(exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):null),products2:(exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):null),quantities2:(exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):null),prices2:(exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):null),productTypes2:(exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):null),orderType:(exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):null),orderID:(exists(function(){return safe("inqClientOrderNum");},false,true)?safe("inqClientOrderNum"):null),clientTimestamp:(exists(function(){return safe("inqClientTimeStamp");},false,true)?safe("inqClientTimeStamp"):null),testOrder:(exists(function(){return safe("inqTestOrder");},false,true)?safe("inqTestOrder"):null),businessUnitID:CHM.getBusinessUnitID(evt,rule),total:FM.callExternal("saleValue"),agentGroupID:CHM.getAgentGroupID(evt,false)}).absorb(evt);},aliases:[{name:"onConversion",getEvtData:function(rule,evt){return{customerID:Inq.getCustID(),group:PM.getVar("incGroup",rule).getValue(),bizRuleName:PM.getVar("asstRuleName",rule).getValue(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)};}}]}),new EXCBTT({name:"SurveyLaunched",getEvtData:function(rule,evt){return MI8.mixAbsorber({siteID:getSiteID(),businessUnitID:CHM.getBusinessUnitID(evt,rule),agentGroupID:CHM.getAgentGroupID(evt,false)}).absorb(evt);}}),new EXCBTT({name:"PreChatSurveyComplete",getEvtData:function(rule,evt){return MI8.mixAbsorber({}).absorb(evt);}}),new EXCBTT({name:"IncStateFunnelTransition",getEvtData:function(rule,evt){return MI8.mixAbsorber({newState:"to be set by firing rule"}).absorb(evt);}}),new EXCBTT({name:"IframeC2C",getEvtData:function(rule,evt){return MI8.mixAbsorber({c2cIFrameDomainName:getConstant("C2C_IFRAME_DOMAIN_NAME",rule),queryData:"{}"}).absorb(evt);}}),new EXCBTT({name:"ChatMinimized",getEvtData:function(rule,evt){return MI8.mixAbsorber({}).absorb(evt);}}),new EXCBTT({name:"ChatRestored",getEvtData:function(rule,evt){return MI8.mixAbsorber({}).absorb(evt);}}),new EXCBTT({name:"ChatTranscriptEmailedToCustomer",getEvtData:function(rule,evt){return MI8.mixAbsorber({}).absorb(evt);}})]);EVM.addCustomEvents(businessCustomEvents);PM.fireDataReady();processCustomerApiRegistry();initMgrs(mgrList);EVM.addListeners(BRM.getRules());startMgrs(mgrList);}
function agrtyer(data){if(this.dataReady){return;}
this.dataReady=true;this.load();}
function load(){var vitalVar=new VBER34(this.getID(),{},resources["vital"]);var vitalData=vitalVar.getValue();if(vitalData){if(vitalData.clntLag){clntLag=vitalData.clntLag;delete vitalData.clntLag;}
this.absorb(vitalData);}
var persistDataVar=new VBER34("pcID",{},resources["session"]);var persistCustID=persistDataVar.getValue();if(persistCustID){setPersistCustID(persistCustID);}
var siteTzOffsetVar=new VBER34("siteTzOffset",null,resources["session"],"tzOf");siteTzOffset=siteTzOffsetVar.getValue();}
function save(){var vitalVar=new VBER34(this.getID(),{},resources["vital"]);var persistDataVar=new VBER34("pcID",{},resources["session"]);var vitalData={custID:this.getCustID(),custIP:this.getCustIP()};if(getClientTimeLag()){vitalData.clntLag=getClientTimeLag();}
var persistCustID=getPersistCustID();if(persistCustID){persistDataVar.setValue(persistCustID);}
vitalVar.setValue(vitalData);if(!isNullOrUndefined(siteTzOffset)){var siteTzOffsetVar=new VBER34("siteTzOffset",0,resources["session"],"tzOf");siteTzOffsetVar.setValue(siteTzOffset);}}
function isDataReady(){return this.dataReady;}
function setFrameworkData(data){if(!isNullOrUndefined(data["siteTzOffset"])){siteTzOffset=data["siteTzOffset"];delete data["siteTzOffset"];}
if(!isNullOrUndefined(data["scheduleTZs"])){scheduleTZs=data["scheduleTZs"];delete data["scheduleTZs"];}
this.absorb(data);if(data.serverTime){clntLag=data.serverTime-(new Date()).getTime();if(Math.abs(clntLag)<1000)clntLag=undefined;}
this.save();}
function getDFV(dfvID){return dfvs[dfvID];}
function getInitialDFV(){var result=null;for(name in dfvs){var dfv=dfvs[name];if(dfv.initial){result=dfv;}}
return result;}
function isThirdPartyCookiesEnabled(){return this.thirdPartyCookiesEnabled;}
function isFrameworkReady(){var isReady=true;var id=this.getCustID();if(isNullOrUndefined(id)||id==""||id=="0"){isReady=false;}
return isReady;}
function tryue(serviceType,duration){switch(serviceType){case CHM.CHAT_TYPES.POPUP:case CHM.CHAT_TYPES.POPUP_CALL:CHM.tryue(serviceType,duration);break;case CHM.CHAT_TYPES.C2C:case CHM.CHAT_TYPES.C2CALL:C2CM.tryue(serviceType,duration);break;case"ALL":CHM.tryue(CHM.CHAT_TYPES.POPUP,duration);CHM.tryue(CHM.CHAT_TYPES.POPUP_CALL,duration);C2CM.tryue(CHM.CHAT_TYPES.C2C,duration);C2CM.tryue(CHM.CHAT_TYPES.C2CALL,duration);break;default:break;}}
function blockServices(services,duration){for(var service in services){tryue(services[service],duration);}}
var rule=null;function getConstant(constantID,rule){if(rule){return rule.getConstant(constantID);}
return constants[constantID];}
function unblockServices(services){for(var service in services){unblockService(services[service]);}}
function unblockService(serviceType){switch(serviceType){case CHM.CHAT_TYPES.POPUP:case CHM.CHAT_TYPES.POPUP_CALL:CHM.unblockService(serviceType);break;case CHM.CHAT_TYPES.C2C:case CHM.CHAT_TYPES.C2CALL:C2CM.unblockService(serviceType);break;case"ALL":CHM.unblockService(CHM.CHAT_TYPES.POPUP);CHM.unblockService(CHM.CHAT_TYPES.POPUP_CALL);C2CM.unblockService(CHM.CHAT_TYPES.C2C);C2CM.unblockService(CHM.CHAT_TYPES.C2CALL);break;default:break;}}
function doBusinessRuleActionList(actionId,rule,evt){var action=BusinessRuleActionLists[actionId];if(!isNullOrUndefined(action)){action(rule,evt);}
else{log("Can't find BusinessRule Action List "+actionId);}}
function doRuleActionList(actionId,rule,evt){var action=RuleActionLists[actionId];if(!isNullOrUndefined(action)){action(rule,evt);}
else{log("Can't find Rule Action List "+actionId);}}
function isServiceBlocked(serviceType){switch(serviceType){case CHM.CHAT_TYPES.POPUP:case CHM.CHAT_TYPES.POPUP_CALL:return CHM.isBlocked(serviceType);case CHM.CHAT_TYPES.C2C:case CHM.CHAT_TYPES.C2CALL:return C2CM.isBlocked(serviceType);case"ANY":return CHM.isAnyBlocked()||C2CM.isAnyBlocked();default:return false;}}
function getBlockedServicesList(){var result=[];if(inqFrame.Inq.C2CM.isBlocked(inqFrame.Inq.CHM.CHAT_TYPES.C2CALL)){result.push(inqFrame.Inq.CHM.CHAT_TYPES.C2CALL);}
if(inqFrame.Inq.C2CM.isBlocked(inqFrame.Inq.CHM.CHAT_TYPES.C2C)){result.push(inqFrame.Inq.CHM.CHAT_TYPES.C2C);}
if(inqFrame.Inq.CHM.isBlocked(inqFrame.Inq.CHM.CHAT_TYPES.POPUP)){result.push(inqFrame.Inq.CHM.CHAT_TYPES.POPUP);}
if(inqFrame.Inq.CHM.isBlocked(inqFrame.Inq.CHM.CHAT_TYPES.POPUP_CALL)){result.push(inqFrame.Inq.CHM.CHAT_TYPES.POPUP_CALL);}
return result;}
function createFloatingDiv(_id,_x,_y,_w,_h){try{var obj=document.createElement('div');obj.style.position="absolute";obj.style.width=_w?_w:0;obj.style.height=_h?_h:0;obj.style.left=_x?_x+"px":0;obj.style.top=_y?_y+"px":0;obj.style.zIndex=99;obj.style.display="none";obj.style.padding=0;obj.style.margin=0;obj.id=_id;document.getElementsByTagName("body")[0].appendChild(obj);}catch(E){this.debug("Could not create div element.");}
return document.getElementById(_id);}
function createHiddenIFrame(_id,_x,_y,_w,_h){try{var obj=document.createElement('iframe');obj.style.position="absolute";obj.style.width=_w?_w:0;obj.style.height=_h?_h:0;obj.style.left=_x?_x+"px":0;obj.style.top=_y?_y+"px":0;obj.style.zIndex=99;obj.style.display="none";obj.style.padding=0;obj.style.margin=0;obj.id=_id;obj.name=_id;return obj;}catch(E){this.debug("Could not create div element.");}
return null;}
function wasSaleAction(){try{var par=PM.getVar("saleState",null).getValue();var con=getConstant("SALE_STATE_CONVERTED",null);return par==con;}
catch(e){}
return false;}
function executeCustomCommand(params){if(!isNullOrUndefined(params)){try{params=params.replace(/\({/g,"{").replace(/}\)/g,"}");var inParams=MI8.JSON.parse(params);var cmdType=inParams.cmdType;var cmdParam=inParams.cmdParam;switch(cmdType){case'block-service':tryue(cmdParam.serviceType,cmdParam.period);break;default:log("Unknown command "+cmdType+", parameters : "+cmdParam);}}
catch(ex){log("Error execute command "+params+", "+ex);}}}
function initXD(){CM.init();CM.requestCookie();}
function parseCookieData(data){var retval={};var cookieRes=[];for(var res in resources){try{if(typeof resources[res]['getName']==='function'){cookieRes.push(resources[res].getName());}}catch(err01){}}
for(var name in data){var cval=data[name];if(!!cval){var cname=name.replace(/_\d+$/,"");if(cname=="JSESSIONID"||cname==="inqCA"||cname==="inqLT"){retval[cname]=cval;}else if(cookieRes.contains(cname,function(oa,ob){return oa===ob;})){try{retval[cname]=MI8.JSON.parse(cval);}catch(e){var errMsg="Error[parseCookieData] while parsing cookie: Cookie name="+cname
+",value="+cval+", customerID="+getCustID()+", siteID="+getSiteID()
+"error message="+e.message;log(errMsg);logErrorToTagServer(errMsg);}}}}
return retval;}
var _3pcSupported=true;function onRemoteCallback(initData){var _xd=(this.xd&&(CM).cookies["pc"]!="2"&&!CM47.xdPsHelper.enabled);if(!!initData['devicetype']){setDeviceType(initData['devicetype']);}
if(!!initData["retry"]){var inqData={};inqData[this.getID()]={xd:_xd,siteID:this.getSiteID(),custID:this.getCustID(),retried:true,scheduleTZs:scheduleTZs};if(isTZRequestRequired())inqData[this.getID()].tzID=siteTzID;var strData=MI8.JSON.stringify(inqData);this.callRemote(urls.initFrameworkURL,{rid:this.getID(),d:strData});return;}
else if(!!initData["3pcNotSupported"]){log("Third party cookies not supported.");_3pcSupported=false;}
if(!frameworkCanRun(getDeviceType(),_3pcSupported,true,_xd)){if(document.cookie.indexOf("_inqNR=0")<0){ROM.send(urls.loggingURL,{level:'INFO',line:"Framework load aborted: siteID="+siteID+",3pc="+_3pcSupported+",deviceType="+getDeviceType()+",userAgent="+navigator.userAgent});document.cookie="_inqNR=0";}
return;}
var inqID=this.getID();if(initData[inqID]){this.setFrameworkData(initData[inqID]);}else if(!isNullOrUndefined(initData["siteTzOffset"])){log("Received site timezone offset from server: "+initData["siteTzOffset"]+"ms");this.setFrameworkData(initData);}
PM.fireDataReady();this.start();}
function IFrameProxyCallback(data){data=decodeURIComponent(data);if(data!=""){CM.isPersistentCookiesEnabled=true;}else{CM.isPersistentCookiesEnabled=false;}
data=parseCookieData(CM._getCookies(data));CM.setXDCookies(data);this.agrtyer();if(resources['vital']){log("Sync Sale Status: "+resources['vital'].read('_ss'));}
var inqID=this.getID();var inqData={};inqData[inqID]={xd:this.xd,siteID:this.getSiteID(),custID:this.getCustID(),scheduleTZs:scheduleTZs,useragent:window.navigator.userAgent};if(isTZRequestRequired())inqData[inqID].tzID=siteTzID;var strData=MI8.JSON.stringify(inqData);this.callRemote(urls.initFrameworkURL,{rid:this.getID(),d:strData});}
function init(){if(this.initialized){return;};var inqData={};var inqID=this.getID();PM.addListener(this);exposeCustomerApi();DM.init();if(xdAutoSelect){CM.init();CM47.firstRequestCookie();}else if(this.xd){initXD();}else{if(CM47.isSessionCookiesAllowed()){this.load();if(!this.isFrameworkReady()){inqData[inqID]={xd:this.xd,siteID:this.getSiteID(),custID:this.getCustID(),scheduleTZs:scheduleTZs};if(isTZRequestRequired())inqData[inqID].tzID=siteTzID;var strData=MI8.JSON.stringify(inqData);this.callRemote(urls.initFrameworkURL,{rid:this.getID(),d:strData});}else if(isTZRequestRequired()){log("Requesting site timezone offset");this.callRemote(urls.getSiteTzOffsetURL,{tzID:siteTzID});}else{PM.fireDataReady();this.start();}}}}
function prepareDataToSend(data){if(!data){return data;}
if(typeOf(data)=="array"){try{if(data.length>0){var elem=data[0];if(elem.key){var out=Array.prepareMapToSerialize(data);return MI8.JSON.stringify(out)}}
return MI8.JSON.stringify(data)}
catch(e){logErrorToTagServer(catchFormatter(e));}}
return data;}
function main(){if(site.sameOriginReferrerFilterRegex()){try{var elm=top.document.getElementById("doesNotExist");}catch(e){return;}}
MI8.prepare(this).im13(MI8.Observable).im13(MI8.FM2);this.im13(MI8.Persistable).im13(MI8.XJA3).im13(MI8.RC54);this._frameworkModule("INQ");this._observable();this.init();}
var c2cPageElementIDs=site.c2cPageElementIDs();C2C.setC2CPageElementIDs(c2cPageElementIDs);var PM=X4334rtf.getInstance(site.persistenceMode!='non-XD');var CM=PM.getCookieMgr();var C2CM=new X43("C2CM",site.c2cMgrData());var EVM=new EMRTQ5("EVM");var ROM=new RemoteOpsMgr("ROM",{});var LDM=new G3RE12("LDM",v3Lander.landingData);var BusinessRuleActionLists=site.businessRuleActionLists();var RuleActionLists=site.ruleActionLists();var functionRulesObj={"saleValue":function(){try{var ps=inqSalesPrices;var qs=inqSalesQuantities;if(ps.length==qs.length){if(qs.length>0){var sum=0;for(var i=0;i<qs.length;i++){sum+=(parseFloat(qs[i])*parseFloat(ps[i]));}
return sum;}}}catch(er){}
return null;}};var businessFuncRulesObj=site.JSBusinessFunctions();if(businessFuncRulesObj){var prop,hasOwnProp={}.hasOwnProperty;for(prop in businessFuncRulesObj){if(hasOwnProp.call(businessFuncRulesObj,prop))
functionRulesObj[prop]=businessFuncRulesObj[prop];}}
var FM=new FcnMgr(functionRulesObj);var dfvs=site.xmlData.dfvs();var core_resource_ids=["pc","state","vital","session"];var resources=site.resources();resources["pc"]=new CCD("pc","pc",site.cookiePath,24*3600*1000,site.rootDomain,false,0,CM);resources["state"]=new CCD("state","inqState",site.cookiePath,365*24*3600*1000,site.rootDomain,false,0,CM);resources["vital"]=new CCD("vital","inqVital",site.cookiePath,365*24*3600*1000,site.rootDomain,false,0,CM);resources["session"]=new CCD("session","inqSession",site.cookiePath,365*24*3600*1000,site.rootDomain,false,0,CM);var schedules=MI8.mixAbsorber();var programSchedules={};var businessSchedules=site.xmlData.businessSchedules();schedules.absorb(programSchedules);schedules.absorb(businessSchedules);var LoadM=new LoadMgr();var MM=new MediaMgr(site.mediaMgrData());var programRulesData=[Rule.create({id:5,name:"Sale Setter Rule",vars:[],triggersFcn:function(rule){return[{id:"onManualInvocation"}]},conditionalFcn:function(rule,evt){return(false);},actionFcn:function(rule,evt){log("Won't happen");},active:true}),Rule.create({id:600,name:"Sale Page Triggering Rule",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(((exists(function(){return safe("inqSalesProducts");},false,true))&&(exists(function(){return safe("inqSalesQuantities");},false,true)))||((exists(function(){return window.parent.inqSalesProducts;},false,true))&&(exists(function(){return window.parent.inqSalesQuantities;},false,true))));},actionFcn:function(rule,evt){PM.getVar("saleLC",rule).setValue((PM.getVar("saleLC",rule).getValue()+1));EVM.fireCustomEvent('SaleLanding',rule,evt,function(){return{};});},active:true}),Rule.create({id:10,name:"Incrementality Attribute Setter Stub Rule",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(!(VAM.test({"vis_attr_incr_val":{"values":{},"mutuallyExclusive":false,"externalCustomerID":false}})));},actionFcn:function(rule,evt){VAM.add({"vis_attr_incr_val":{"values":MI8.unmixMutatable(MI8.mixMutatable().set("",true))},"mutuallyExclusive":false});},active:true}),Rule.create({id:400,name:"MobileSuppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return((isDeviceType("Unsupported"))||(isDeviceType("Phone"))||(isDeviceType("Tablet")));},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:404,name:"ChromeOnIphoneSuppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(false);},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:405,name:"iOS6orLessSuppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return((new Boolean(FM.callExternal(function(){var uaString=navigator.userAgent;return(/(iPhone|iPod|iPad)/i.test(uaString)&&/OS [1-6](.*) like Mac OS X/i.test(uaString));}))).valueOf());},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:407,name:"iOS-7-Suppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(false);},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:408,name:"iOS-8-Suppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(false);},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:409,name:"iOS-9-Suppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(false);},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:411,name:"WindowsPhone-Suppression",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return((new Boolean(safe("/Windows Phone/i.test(navigator.userAgent)"))).valueOf());},actionFcn:function(rule,evt){Inq.blockServices(["ALL"],0);},active:true}),Rule.create({id:500,name:"Session Manager- Reset Session Rule",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"},{id:"onCustomerMsg"},{id:"onAgentMsg"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){if(PM.getVar("loyalty",rule).getValue()==0){PM.getVar("loyalty",rule).setValue(1.0);PM.getVar("sesID",rule).setValue(Inq.getCustID()+(exists(PM.getVar("loyalty",rule).getValue())?PM.getVar("loyalty",rule).getValue().toString():""));PM.getVar("fst",rule).setValue(new Date());PM.getVar("lst",rule).setValue(PM.getVar("fst",rule).getValue());EVM.fireCustomEvent('NewSession',rule,evt,function(){return{};});}else if(((!(exists(function(){return PM.getVar("ltt",rule).getValue();},false,true)))&&(!(PM.getVar("loyalty",rule).getValue()==0)))||((exists(function(){return PM.getVar("ltt",rule).getValue();},false,true))&&(new Date().after(PM.getVar("ltt",rule).getValue().roll(getConstant("SESSION_EXPIRE_TIME",rule)))))){PM.getVar("loyalty",rule).setValue((PM.getVar("loyalty",rule).getValue()+1));PM.reset("session");PM.getVar("sesID",rule).setValue(Inq.getCustID()+(exists(PM.getVar("loyalty",rule).getValue())?PM.getVar("loyalty",rule).getValue().toString():""));PM.getVar("lst",rule).setValue(new Date());EVM.fireCustomEvent('NewSession',rule,evt,function(){return{};});}
PM.getVar("ltt",rule).setValue(new Date());PM.getVar("incStart",rule).setValue(new Date());},active:true}),Rule.create({id:550,name:"Chat Count Rule",vars:[],triggersFcn:function(rule){return[{id:"onChatLaunched",serviceType:"C2C"},{id:"onChatLaunched",serviceType:"C2CALL"},{id:"onChatLaunched",serviceType:"POPUP"},{id:"onChatLaunched",serviceType:"POPUP_CALL"},{id:"onChatLaunched",serviceType:"PERSISTENT"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("chatCnt",rule).setValue((PM.getVar("chatCnt",rule).getValue()+1));},active:true}),Rule.create({id:551,name:"Sale Qualification Count Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"Assisted"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("salesQualificationCount",rule).setValue((PM.getVar("salesQualificationCount",rule).getValue()+1));},active:true}),Rule.create({id:553,name:"DEPRECATED Clientside listeners backward compatibility Rule",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){publishAPI("InqSaleMgr.getSaleID","assistChatID");},active:true}),Rule.create({id:555,name:"Referring Search Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"NewSession"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("rd",rule).setValue(URI.parseURI(doc.referrer).domain);if((URI.parseURI(doc.referrer).domain.endsWith("google.com",true))||(URI.parseURI(doc.referrer).domain.endsWith("ask.com",true))||(URI.parseURI(doc.referrer).domain.endsWith("aol.com",true))||(URI.parseURI(doc.referrer).domain.endsWith("bing.com",true))||(URI.parseURI(doc.referrer).domain.endsWith("google.fr",true))||(URI.parseURI(doc.referrer).domain.endsWith("google.de",true))||(URI.parseURI(doc.referrer).domain.endsWith("google.co.uk",true))||(URI.parseURI(doc.referrer).domain.endsWith("aol.fr",true))||(URI.parseURI(doc.referrer).domain.endsWith("aol.de",true))||(URI.parseURI(doc.referrer).domain.endsWith("aol.co.uk",true))){PM.getVar("sest",rule).setValue(URI.parseURI(doc.referrer).qMap["q"]);}else if(URI.parseURI(doc.referrer).domain.endsWith("yahoo.com",true)){PM.getVar("sest",rule).setValue(URI.parseURI(doc.referrer).qMap["p"]);}else{PM.getVar("sest",rule).setValue("");}},active:true}),Rule.create({id:605,name:"Sale Reset Rule",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"},{id:"on"+"SaleLanding"}]},conditionalFcn:function(rule,evt){return((!(CHM.isPersistentWindow()))&&(!(PM.getVar("saleState",rule).getValue().equals(getConstant("SALE_STATE_UNSOLD",rule),false)))&&(((exists(function(){return PM.getVar("assistDT",rule).getValue();},false,true))&&(new Date().after(PM.getVar("assistDT",rule).getValue().roll(getConstant("SALE_EXPIRATION",rule)))))||((exists(function(){return PM.getVar("soldDT",rule).getValue();},false,true))&&(new Date(86400000).before(PM.getVar("soldDT",rule).getValue()))&&(new Date().after(PM.getVar("soldDT",rule).getValue().roll(getConstant("SALE_EXPIRATION",rule)))))));},actionFcn:function(rule,evt){Inq.doRuleActionList("saveAssistedVariablesActionList",rule,evt);PM.getVar("saleState",rule).setValue(getConstant("SALE_STATE_UNSOLD",rule));PM.getVar("assistDT",rule).setValue(new Date(0));PM.getVar("soldDT",rule).setValue(new Date(0));PM.getVar("assistAgt",rule).setValue("");PM.getVar("assistChatID",rule).setValue("-1");EVM.fireCustomEvent('SaleStateTransition',rule,evt,function(){return{};});},active:true}),Rule.create({id:830,name:"ETLv2 Converted Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"SaleLanding"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("incState",rule).setValue(getConstant("INC_STATE_CONVERTED",rule));try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_CONVERTED",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"group":prepareDataToSend(PM.getVar("incGroup",rule).getValue()),"products":prepareDataToSend((exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null))),"quantities":prepareDataToSend((exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null))),"prices":prepareDataToSend((exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null))),"productTypes":prepareDataToSend((exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null))),"products2":prepareDataToSend((exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):(exists(function(){return window.parent.inqSalesProducts2;},false,true)?window.parent.inqSalesProducts2:null))),"quantities2":prepareDataToSend((exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):(exists(function(){return window.parent.inqSalesQuantities2;},false,true)?window.parent.inqSalesQuantities2:null))),"prices2":prepareDataToSend((exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):(exists(function(){return window.parent.inqSalesPrices2;},false,true)?window.parent.inqSalesPrices2:null))),"productTypes2":prepareDataToSend((exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):(exists(function(){return window.parent.inqSalesProductTypes2;},false,true)?window.parent.inqSalesProductTypes2:null))),"orderType":prepareDataToSend((exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null))),"customerName":prepareDataToSend((exists(function(){return safe("inqCustomerName");},false,true)?safe("inqCustomerName"):(exists(function(){return window.parent.inqCustomerName;},false,true)?window.parent.inqCustomerName:null))),"orderID":prepareDataToSend((exists(function(){return safe("inqClientOrderNum");},false,true)?safe("inqClientOrderNum"):(exists(function(){return window.parent.inqClientOrderNum;},false,true)?window.parent.inqClientOrderNum:null))),"testOrder":prepareDataToSend((exists(function(){return safe("inqTestOrder");},false,true)?safe("inqTestOrder"):(exists(function(){return window.parent.inqTestOrder;},false,true)?window.parent.inqTestOrder:null))),"otherInfo":prepareDataToSend((exists(function(){return safe("inqOtherInfo");},false,true)?safe("inqOtherInfo"):(exists(function(){return window.parent.inqOtherInfo;},false,true)?window.parent.inqOtherInfo:null))),"clientTimestamp":prepareDataToSend((exists(function(){return safe("inqClientTimeStamp");},false,true)?safe("inqClientTimeStamp"):(exists(function(){return window.parent.inqClientTimeStamp;},false,true)?window.parent.inqClientTimeStamp:null))),"businessUnitID":prepareDataToSend((exists(function(){return CHM.getLastChat();},false,true)?CHM.getLastChat().businessUnitID:CHM.getBusinessUnitID(evt,rule))),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():""))},true,true,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}
EVM.fireCustomEvent('ConvertedEvent',rule,evt,function(){return{businessUnitID:(exists(function(){return CHM.getLastChat();},false,true)?CHM.getLastChat().businessUnitID:CHM.getBusinessUnitID(evt,rule))};});},active:true}),Rule.create({id:610,name:"Sale Page Landing Data Pass",vars:[],triggersFcn:function(rule){return[{id:"on"+"SaleLanding"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){try{ROM.send(resources["SALE_LANDING_CONTROLLER"].url,{"siteID":prepareDataToSend(getSiteID()),"agentID":prepareDataToSend(CHM.getAgentID()),"chatID":prepareDataToSend(PM.getVar("assistChatID",rule).getValue()),"customerID":prepareDataToSend(Inq.getCustID()),"pageID":prepareDataToSend(LDM.getPageID()),"buID":prepareDataToSend((exists(function(){return CHM.getLastChat();},false,true)?CHM.getLastChat().businessUnitID:CHM.getBusinessUnitID(evt,rule))),"incAssignmentID":prepareDataToSend((exists(function(){return getIncAssignmentID();},false,true)?getIncAssignmentID():null)),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,false)),"orderType":prepareDataToSend((exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null))),"incGroup":prepareDataToSend((exists(function(){return PM.getVar("incGroup",rule).getValue();},false,true)?PM.getVar("incGroup",rule).getValue():null)),"sessionID":prepareDataToSend((exists(function(){return getSessionID();},false,true)?getSessionID():null)),"vAtts":prepareDataToSend((exists(function(){return VAM.getCopyAsArray(false).join(";");},false,true)?VAM.getCopyAsArray(true).join(";"):null)),"products":prepareDataToSend((exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null))),"quantities":prepareDataToSend((exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null))),"prices":prepareDataToSend((exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null))),"productTypes":prepareDataToSend((exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null))),"products2":prepareDataToSend((exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):null)),"quantities2":prepareDataToSend((exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):null)),"prices2":prepareDataToSend((exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):null)),"productTypes2":prepareDataToSend((exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):null)),"orderType":prepareDataToSend((exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null))),"customerName":prepareDataToSend((exists(function(){return safe("inqCustomerName");},false,true)?safe("inqCustomerName"):(exists(function(){return window.parent.inqCustomerName;},false,true)?window.parent.inqCustomerName:null))),"clientOrderNum":prepareDataToSend((exists(function(){return safe("inqClientOrderNum");},false,true)?safe("inqClientOrderNum"):(exists(function(){return window.parent.inqClientOrderNum;},false,true)?window.parent.inqClientOrderNum:null))),"testOrder":prepareDataToSend((exists(function(){return safe("inqTestOrder");},false,true)?safe("inqTestOrder"):(exists(function(){return window.parent.inqTestOrder;},false,true)?window.parent.inqTestOrder:null))),"otherInfo":prepareDataToSend((exists(function(){return safe("inqOtherInfo");},false,true)?safe("inqOtherInfo"):(exists(function(){return window.parent.inqOtherInfo;},false,true)?window.parent.inqOtherInfo:null))),"clientTimestamp":prepareDataToSend((exists(function(){return safe("inqClientTimeStamp");},false,true)?safe("inqClientTimeStamp"):(exists(function(){return window.parent.inqClientTimeStamp;},false,true)?window.parent.inqClientTimeStamp:null)))},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}
PM.getVar("saleValue",rule).setValue(parseFloat(FM.callExternal("saleValue")));log("***************** SALE LANDING *****************");},active:true}),Rule.create({id:620,name:"Fire AssistedEvent Rule - by Message Count",vars:[],triggersFcn:function(rule){return[{id:"onAgentMsg"},{id:"onCustomerMsg"}]},conditionalFcn:function(rule,evt){return((exists(function(){return evt.agtMsgCnt;},false,true))&&(exists(function(){return evt.custMsgCnt;},false,true))&&(parseFloat(evt.agtMsgCnt)>=getConstant("ASSISTED_AGENT_CHAT_COUNT",rule))&&(parseFloat(evt.custMsgCnt)>=getConstant("ASSISTED_CUSTOMER_CHAT_COUNT",rule)));},actionFcn:function(rule,evt){log("******** ASSISTED by message exchange **********");PM.getVar("assistedType",rule).setValue(getConstant("MESSAGE_COUNT_ASSISTED",rule));EVM.fireCustomEvent('AssistedEvent',rule,evt,function(){return{businessUnitID:CHM.getBusinessUnitID(evt,rule)};});},active:true}),Rule.create({id:621,name:"Fire AssistedEvent Rule - by Persistent Push",vars:[],triggersFcn:function(rule){return[{id:"onPersistentPush"}]},conditionalFcn:function(rule,evt){return(!((CHM.isServiceInProgress("C2CALL"))||(CHM.isServiceInProgress("POPUP_CALL"))||((CHM.isServiceInProgress("C2C"))&&(isC2PActive(false)))));},actionFcn:function(rule,evt){log("******** ASSISTED by Persistent Push **********");PM.getVar("assistedType",rule).setValue(getConstant("PERSISTENT_ASSISTED",rule));EVM.fireCustomEvent('AssistedEvent',rule,evt,function(){return{businessUnitID:CHM.getBusinessUnitID(evt,rule)};});},active:true}),Rule.create({id:622,name:"Assisted Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"AssistedEvent"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){Inq.doRuleActionList("setAssistedStateActionList",rule,evt);},active:true}),Rule.create({id:624,name:"Send Assisted Event on Agent Assigned",vars:[],triggersFcn:function(rule){return[{id:"onAgentAssigned"}]},conditionalFcn:function(rule,evt){return((CHM.isPersistentWindow())&&((CHM.isServiceInProgress("C2CALL"))||(CHM.isServiceInProgress("POPUP_CALL"))||((CHM.isServiceInProgress("C2C"))&&(isC2PActive(false)))));},actionFcn:function(rule,evt){EVM.fireCustomEvent('AssistedEvent',rule,evt,function(){return{businessUnitID:CHM.getBusinessUnitID(evt,rule)};});},active:true}),Rule.create({id:625,name:"Sale Conversion Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"SaleLanding"}]},conditionalFcn:function(rule,evt){return(!(PM.getVar("saleState",rule).getValue().equals(getConstant("SALE_STATE_UNSOLD",rule),false)));},actionFcn:function(rule,evt){CRMT.create({doCallbackActions:function(data){if((new Boolean(data.success)).valueOf()){Inq.doRuleActionList("saveAssistedVariablesActionList",rule,evt);PM.getVar("saleState",rule).setValue(getConstant("SALE_STATE_CONVERTED",rule));PM.getVar("saleID",rule).setValue((exists(data.saleID)?data.saleID.toString():""));PM.getVar("soldDT",rule).setValue(new Date());EVM.fireCustomEvent('SaleStateTransition',rule,evt,function(){return{};});EVM.fireCustomEvent('Converted',rule,evt,function(){return{};});}}}).callRemote(resources["SET_SALE_CONTROLLER"].url,{"agentID":prepareDataToSend(PM.getVar("assistAgt",rule).getValue()),"chatID":prepareDataToSend(PM.getVar("assistChatID",rule).getValue()),"customerID":prepareDataToSend(Inq.getCustID()),"products":prepareDataToSend((exists(function(){return safe("inqSalesProducts");},false,true)?safe("inqSalesProducts"):(exists(function(){return window.parent.inqSalesProducts;},false,true)?window.parent.inqSalesProducts:null))),"quantities":prepareDataToSend((exists(function(){return safe("inqSalesQuantities");},false,true)?safe("inqSalesQuantities"):(exists(function(){return window.parent.inqSalesQuantities;},false,true)?window.parent.inqSalesQuantities:null))),"prices":prepareDataToSend((exists(function(){return safe("inqSalesPrices");},false,true)?safe("inqSalesPrices"):(exists(function(){return window.parent.inqSalesPrices;},false,true)?window.parent.inqSalesPrices:null))),"productTypes":prepareDataToSend((exists(function(){return safe("inqSalesProductTypes");},false,true)?safe("inqSalesProductTypes"):(exists(function(){return window.parent.inqSalesProductTypes;},false,true)?window.parent.inqSalesProductTypes:null))),"products2":prepareDataToSend((exists(function(){return safe("inqSalesProducts2");},false,true)?safe("inqSalesProducts2"):(exists(function(){return window.parent.inqSalesProducts2;},false,true)?window.parent.inqSalesProducts2:null))),"quantities2":prepareDataToSend((exists(function(){return safe("inqSalesQuantities2");},false,true)?safe("inqSalesQuantities2"):(exists(function(){return window.parent.inqSalesQuantities2;},false,true)?window.parent.inqSalesQuantities2:null))),"prices2":prepareDataToSend((exists(function(){return safe("inqSalesPrices2");},false,true)?safe("inqSalesPrices2"):(exists(function(){return window.parent.inqSalesPrices2;},false,true)?window.parent.inqSalesPrices2:null))),"productTypes2":prepareDataToSend((exists(function(){return safe("inqSalesProductTypes2");},false,true)?safe("inqSalesProductTypes2"):(exists(function(){return window.parent.inqSalesProductTypes2;},false,true)?window.parent.inqSalesProductTypes2:null))),"orderType":prepareDataToSend((exists(function(){return safe("inqOrderType");},false,true)?safe("inqOrderType"):(exists(function(){return window.parent.inqOrderType;},false,true)?window.parent.inqOrderType:null))),"customerName":prepareDataToSend((exists(function(){return safe("inqCustomerName");},false,true)?safe("inqCustomerName"):(exists(function(){return window.parent.inqCustomerName;},false,true)?window.parent.inqCustomerName:null))),"clientOrderNum":prepareDataToSend((exists(function(){return safe("inqClientOrderNum");},false,true)?safe("inqClientOrderNum"):(exists(function(){return window.parent.inqClientOrderNum;},false,true)?window.parent.inqClientOrderNum:null))),"testOrder":prepareDataToSend((exists(function(){return safe("inqTestOrder");},false,true)?safe("inqTestOrder"):(exists(function(){return window.parent.inqTestOrder;},false,true)?window.parent.inqTestOrder:null))),"otherInfo":prepareDataToSend((exists(function(){return safe("inqOtherInfo");},false,true)?safe("inqOtherInfo"):(exists(function(){return window.parent.inqOtherInfo;},false,true)?window.parent.inqOtherInfo:null))),"clientTimestamp":prepareDataToSend((exists(function(){return safe("inqClientTimeStamp");},false,true)?safe("inqClientTimeStamp"):(exists(function(){return window.parent.inqClientTimeStamp;},false,true)?window.parent.inqClientTimeStamp:null))),"siteID":prepareDataToSend(getSiteID())});},active:true}),Rule.create({id:635,name:"Save Last n Sales",vars:[],triggersFcn:function(rule){return[{id:"on"+"Converted"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("nSalesID",rule).prepend([PM.getVar("saleID",rule).getValue()]);},active:true}),Rule.create({id:700,name:"Page Landing Data Pass",vars:[{name:"url_700",defVal:null,rId:"tmpVars",shName:"url",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:200,type:"String"}],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return((CHM.isServiceInProgress("ANY"))&&(!("_inqPersistentChat".equals(top.name,false))));},actionFcn:function(rule,evt){if(getConstant("REMOVE_QUERY_STRING_FROM_TRACKING_URL",rule)){PM.getVar("url",rule).setValue(LDM.getCurrentPageURL().replace(/\?.*/g,""));}else{PM.getVar("url",rule).setValue(LDM.getCurrentPageURL());}
ROM.sendDataToAgent(CHM.getAgentID(),MI8.mixMutatable(MI8.mixAbsorber(MI8.unmixMutatable(MI8.mixMutatable().set("URL",PM.getVar("url",rule).getValue()).set("markerID",LDM.getPageMarker()))).absorb(safe('inqData'))).set("agentID",CHM.getAgentID()).set("engagementID",CHM.getChatID()));},active:true}),Rule.create({id:710,name:"Agent Assigned Tracking",vars:[{name:"url_710",defVal:null,rId:"tmpVars",shName:"url",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:200,type:"String"}],triggersFcn:function(rule){return[{id:"onAgentAssigned"}]},conditionalFcn:function(rule,evt){return((CHM.isServiceInProgress("ANY"))&&(!("_inqPersistentChat".equals(top.name,false))));},actionFcn:function(rule,evt){if(getConstant("REMOVE_QUERY_STRING_FROM_TRACKING_URL",rule)){PM.getVar("url",rule).setValue(LDM.getCurrentPageURL().replace(/\?.*/g,""));}else{PM.getVar("url",rule).setValue(LDM.getCurrentPageURL());}
ROM.sendDataToAgent(CHM.getAgentID(),{"URL":prepareDataToSend(PM.getVar("url",rule).getValue()),"markerID":prepareDataToSend(LDM.getPageMarker()),agentID:CHM.getAgentID(),engagementID:CHM.getChatID()});},active:true}),Rule.create({id:799,name:"Reset incGroup",vars:[],triggersFcn:function(rule){return[{id:"on"+"NewSession"}]},conditionalFcn:function(rule,evt){return((!(exists(function(){return PM.getVar("incStart",rule).getValue();},false,true)))||(new Date().after(PM.getVar("incStart",rule).getValue().roll(getConstant("INC_GROUP_DURATION",rule)))));},actionFcn:function(rule,evt){PM.getVar("incStart",rule).setValue(new Date());PM.getVar("incID",rule).setValue(getSessionID());if((!(PM.getVar("incExempt",rule).getValue()))&&(rand(1,100,true)<=getConstant("INC_CONTROL_PERCENT",rule))){PM.getVar("incGroup",rule).setValue(getConstant("INC_GROUP_CONTROL",rule));}else{PM.getVar("incGroup",rule).setValue(getConstant("INC_GROUP_CHAT",rule));}
PM.getVar("incState",rule).setValue(getConstant("INC_STATE_ELIGIBLE",rule));},active:true}),Rule.create({id:800,name:"Eligible Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"NewSession"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){EVM.fireCustomEvent('EligibleEvent',rule,evt,function(){return{};});try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_ELIGIBLE",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"group":prepareDataToSend(PM.getVar("incGroup",rule).getValue()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"browserType":prepareDataToSend(getClientBrowserType()),"browserVersion":prepareDataToSend(getClientBrowserVersion()),"operatingSystemType":prepareDataToSend(getOSType()),"deviceType":prepareDataToSend(getDeviceType()),"codeVersion":prepareDataToSend(v3Lander.codeVersion),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():"")),"externalCustomerIDs":prepareDataToSend(VAM.getExternalCustomerIdVisitorAttributesAsString())},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true}),Rule.create({id:802,name:"Set G3RE13 Actionable Flag",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return((exists(function(){return PM.getVar("incGroup",rule).getValue();},false,true))&&(getConstant("INC_GROUP_CONTROL",rule).equals(PM.getVar("incGroup",rule).getValue(),true)));},actionFcn:function(rule,evt){BRM.setActionable(false);},active:true}),Rule.create({id:805,name:"Targeted Rule",vars:[],triggersFcn:function(rule){return[{id:"onRuleSatisfied"}]},conditionalFcn:function(rule,evt){return(!(CHM.isServiceInProgress("ANY")));},actionFcn:function(rule,evt){EVM.fireCustomEvent('TargetedEvent',rule,evt,function(){return{brID:evt.rule.id,businessUnitID:CHM.getBusinessUnitID(evt,rule)};});try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_TARGETED",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"group":prepareDataToSend(PM.getVar("incGroup",rule).getValue()),"brID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"funnelLevel":prepareDataToSend(evt.rule.getFunnelLevel()),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():"")),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,false)),"queueThreshold":prepareDataToSend(evt.rule.getQueueThreshold())},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true}),Rule.create({id:807,name:"Exposure Qualified Rule",vars:[],triggersFcn:function(rule){return[{id:"onExposureQualified"}]},conditionalFcn:function(rule,evt){return(!(CHM.isServiceInProgress("ANY")));},actionFcn:function(rule,evt){try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_EXPOSURE_QUALIFIED",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID()),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"group":prepareDataToSend(PM.getVar("incGroup",rule).getValue()),"brID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"result":prepareDataToSend(evt.result),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"funnelLevel":prepareDataToSend(evt.rule.getFunnelLevel()),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():"")),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,false)),"queueThreshold":prepareDataToSend(evt.rule.getQueueThreshold())},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true}),Rule.create({id:810,name:"Exposed Rule",vars:[],triggersFcn:function(rule){return[{id:"onServiceInvitation"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){EVM.fireCustomEvent('ExposedEvent',rule,evt,function(){return{businessUnitID:CHM.getBusinessUnitID(evt,rule)};});try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_EXPOSED",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"brID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"chatID":prepareDataToSend(CHM.getChatID()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,false)),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():"")),"queueThreshold":prepareDataToSend(evt.rule.getQueueThreshold())},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true}),Rule.create({id:811,name:"engagement.windowDisplayed rule",vars:[],triggersFcn:function(rule){return[{id:"onChatLaunched",serviceType:"C2C"},{id:"onChatLaunched",serviceType:"C2CALL"},{id:"onChatLaunched",serviceType:"POPUP"},{id:"onChatLaunched",serviceType:"POPUP_CALL"},{id:"onChatLaunched",serviceType:"PERSISTENT"},{id:"onChatLaunched",serviceType:"CONVERSIVE"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){try{ROM.send(resources["JASPER_ETL"].url,{"_domain":prepareDataToSend("engagement"),"evt":prepareDataToSend("windowDisplayed"),"customerID":prepareDataToSend(Inq.getCustID()),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"sessionID":prepareDataToSend(getSessionID()),"incAssignmentID":prepareDataToSend(getIncAssignmentID()),"businessRuleID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"chatID":prepareDataToSend(CHM.getChatID()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,false)),"inHOP":prepareDataToSend(evt.inHOP),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():"")),"qt":prepareDataToSend(CHM.getQueueThreshold())},false,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true}),Rule.create({id:812,name:"engagement.persistentWindowDisplayed rule",vars:[],triggersFcn:function(rule){return[{id:"onChatLaunched",serviceType:"PERSISTENT"},{id:"onPersistentPush"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){try{ROM.send(resources["JASPER_ETL"].url,{"_domain":prepareDataToSend("engagement"),"evt":prepareDataToSend("persistentWindowDisplayed"),"customerID":prepareDataToSend(Inq.getCustID()),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"sessionID":prepareDataToSend(getSessionID()),"incAssignmentID":prepareDataToSend(getIncAssignmentID()),"businessRuleID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"chatID":prepareDataToSend(CHM.getChatID()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"inHOP":prepareDataToSend(evt.inHOP),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule))},false,true,20,5000);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true}),Rule.create({id:814,name:"ServiceEngaged Rule",vars:[],triggersFcn:function(rule){return[{id:"onServiceEngaged"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){EVM.fireCustomEvent('EngagedEvent',rule,evt,function(){return{businessUnitID:CHM.getBusinessUnitID(evt,rule),rule:evt.rule};});},active:true}),Rule.create({id:813,name:"Move Inc State Through Funnel Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"IncStateFunnelTransition"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){if(parseFloat(PM.getVar("incStatesMap",rule).getValue().get(PM.getVar("incState",rule).getValue()))<parseFloat(PM.getVar("incStatesMap",rule).getValue().get(evt.newState))){PM.getVar("incState",rule).setValue((exists(evt.newState)?evt.newState.toString():""));}},active:true}),Rule.create({id:815,name:"Engaged Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"EngagedEvent"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){if(!(CHM.getChatID().equals(PM.getVar("engagedChatID",rule).getValue(),false))){PM.getVar("engagedChatID",rule).setValue(CHM.getChatID());EVM.fireCustomEvent('IncStateFunnelTransition',rule,evt,function(){return{newState:getConstant("INC_STATE_ENGAGED",rule)};});try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_ENGAGED",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"brID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"chatID":prepareDataToSend(CHM.getChatID()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,false)),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"visitorAttributes":prepareDataToSend((exists(VAM.getCopyAsArray(true).join(";"))?VAM.getCopyAsArray(true).join(";").toString():"")),"queueThreshold":prepareDataToSend(evt.rule.getQueueThreshold())},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}}},active:true}),Rule.create({id:820,name:"Fire Interacted Event Rule",vars:[],triggersFcn:function(rule){return[{id:"onServiceInteracted"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){EVM.fireCustomEvent('InteractedEvent',rule,evt,function(){return{businessUnitID:CHM.getBusinessUnitID(evt,rule)};});},active:true}),Rule.create({id:821,name:"Interacted Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"InteractedEvent"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){if(!(CHM.getChatID().equals(PM.getVar("interactedChatID",rule).getValue(),false))){PM.getVar("interactedChatID",rule).setValue(CHM.getChatID());EVM.fireCustomEvent('IncStateFunnelTransition',rule,evt,function(){return{newState:getConstant("INC_STATE_INTERACTED",rule)};});PM.getVar("incExempt",rule).setValue(true);try{ROM.send(resources["INC_EVENT_URL"].url,{"evt":prepareDataToSend(getConstant("INC_STATE_INTERACTED",rule)),"siteID":prepareDataToSend(getSiteID()),"pageID":prepareDataToSend(LDM.getPageID(0)),"customerID":prepareDataToSend(Inq.getCustID()),"incrementalityID":prepareDataToSend(getIncAssignmentID()),"sessionID":prepareDataToSend(getSessionID()),"brID":prepareDataToSend(CHM.getChat()?CHM.getChat().getRuleId():(evt.rule?evt.rule.id:rule.getID())),"chatID":prepareDataToSend(CHM.getChatID()),"businessUnitID":prepareDataToSend(CHM.getBusinessUnitID(evt,rule)),"agentGroupID":prepareDataToSend(CHM.getAgentGroupID(evt,true)),"targetAgentAttributes":prepareDataToSend(firstExisting('getAgentAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"brAttributes":prepareDataToSend(firstExisting('getRuleAttributesAsString',CHM.getChat(),evt&&evt.rule,rule)),"type":prepareDataToSend(CHM.getConversionType())},true,false,null,null);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}}},active:true}),Rule.create({id:850,name:"Set Service Missed Rule",vars:[],triggersFcn:function(rule){return[{id:"onServiceMissed"}]},conditionalFcn:function(rule,evt){return((exists(evt.serviceType)?evt.serviceType.toString():"").equals("POPUP",false));},actionFcn:function(rule,evt){PM.getVar("svcMissed",rule).setValue(parseFloat(evt.rule.id));},active:true}),Rule.create({id:855,name:"Clear Service Missed Rule and update lco",vars:[],triggersFcn:function(rule){return[{id:"onServiceInvitation"}]},conditionalFcn:function(rule,evt){return("POPUP".equals((exists(evt.serviceType)?evt.serviceType.toString():""),false));},actionFcn:function(rule,evt){PM.getVar("svcMissed",rule).setValue(-1);PM.getVar("lco",rule).setValue(new Date());},active:true}),Rule.create({id:900,name:"Frequency Metric Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"NewSession"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){if((exists(function(){return PM.getVar("loyalty",rule).getValue();},false,true))&&(exists(function(){return PM.getVar("lst",rule).getValue();},false,true))&&(exists(function(){return PM.getVar("fst",rule).getValue();},false,true))&&(PM.getVar("loyalty",rule).getValue()>1)){PM.getVar("freq",rule).setValue((Math.round(PM.getVar("lst",rule).getValue().diff(PM.getVar("fst",rule).getValue())/(1000))/(PM.getVar("loyalty",rule).getValue()-1)));}else{PM.getVar("freq",rule).setValue(0);}},active:true}),Rule.create({id:910,name:"Last n Session Time Rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"NewSession"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){if((exists(function(){return PM.getVar("lst",rule).getValue();},false,true))&&(exists(function(){return PM.getVar("nSesT",rule).getValue();},false,true))){PM.getVar("nSesT",rule).prepend([PM.getVar("lst",rule).getValue()]);}},active:true}),Rule.create({id:920,name:"Session Time Reset",vars:[],triggersFcn:function(rule){return[{id:"on"+"NewSession"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("sesT",rule).setValue(0);},active:true}),Rule.create({id:930,name:"Session and Site Time Update",vars:[],triggersFcn:function(rule){return[{id:"onAgentMsg"},{id:"onCustomerMsg"},{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("siteT",rule).setValue((PM.getVar("siteT",rule).getValue()+(parseFloat(Math.round(PM.getVar("ltt",rule).getValue().diff(PM.getVar("lst",rule).getValue())/(1000)))-PM.getVar("sesT",rule).getValue())));PM.getVar("sesT",rule).setValue(parseFloat(Math.round(PM.getVar("ltt",rule).getValue().diff(PM.getVar("lst",rule).getValue())/(1000))));},active:true}),Rule.create({id:945,name:"resetFunnelLevel",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return((exists(function(){return PM.getVar("lco",rule).getValue();},false,true))&&(new Date().after(PM.getVar("lco",rule).getValue().roll(getConstant("RECHAT_INTERVAL",rule)))));},actionFcn:function(rule,evt){PM.getVar("cfl",rule).setValue(getConstant("MAX_LONG",rule));},active:true}),Rule.create({id:950,name:"CurrentFunnelLevelUpdater Rule",vars:[],triggersFcn:function(rule){return[{id:"onChatLaunched",serviceType:"ALL"}]},conditionalFcn:function(rule,evt){return((!(exists(function(){return evt.rule.getConstant('ifl');},false,true)))&&(exists(function(){return evt.rule.getConstant('fl');},false,true))&&(PM.getVar("cfl",rule).getValue()>parseFloat(evt.rule.getConstant('fl'))));},actionFcn:function(rule,evt){PM.getVar("cfl",rule).setValue(parseFloat(evt.rule.getConstant('fl')));},active:true}),Rule.create({id:960,name:"Call Closed Rule",vars:[],triggersFcn:function(rule){return[{id:"onChatClosed",serviceType:"POPUP_CALL"},{id:"onChatClosed",serviceType:"C2CALL"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){PM.getVar("continueTrackingAfterCallClose",rule).setValue(true);PM.getVar("lastCallId",rule).setValue(CHM.getChatID());PM.getVar("lastCallAgentId",rule).setValue(CHM.getAgentID());},active:true}),Rule.create({id:970,name:"Continue Tracking After Call Close Rule",vars:[],triggersFcn:function(rule){return[{id:"onPageLanding"}]},conditionalFcn:function(rule,evt){return(PM.getVar("continueTrackingAfterCallClose",rule).getValue());},actionFcn:function(rule,evt){CRMT.create({doCallbackActions:function(data){if((new Boolean(data.agentInChat)).valueOf()){ROM.sendDataToAgent(PM.getVar("lastCallAgentId",rule).getValue(),{"URL":prepareDataToSend(LDM.getCurrentPageURL()),"markerID":prepareDataToSend(LDM.getPageMarker()),agentID:PM.getVar("lastCallAgentId",rule).getValue(),engagementID:PM.getVar("lastCallId",rule).getValue()});}else{PM.getVar("continueTrackingAfterCallClose",rule).setValue(false);}}}).callRemote(resources["IS_AGENT_IN_CHAT"].url,{"chatID":prepareDataToSend(PM.getVar("lastCallId",rule).getValue())});},active:true}),Rule.create({id:986,name:"Update Assigned Agent On Transfer",vars:[],triggersFcn:function(rule){return[{id:"onAgentAssigned"}]},conditionalFcn:function(rule,evt){return((exists(function(){return PM.getVar("incState",rule).getValue();},false,true))&&(PM.getVar("incState",rule).getValue().equals(getConstant("INC_STATE_ASSISTED",rule),false)));},actionFcn:function(rule,evt){if(exists(function(){return CHM.getAgentID();},false,true)){PM.getVar("assistAgt",rule).setValue(CHM.getAgentID());}},active:true}),Rule.create({id:990,name:"sale state transition listener rule",vars:[],triggersFcn:function(rule){return[{id:"on"+"SaleStateTransition"}]},conditionalFcn:function(rule,evt){return(true);},actionFcn:function(rule,evt){try{ROM.send(resources["JASPER_ETL"].url,MI8.unmixMutatable(MI8.mixMutatable().set("_domain","sale").set("evt","state-change").set("customerID",Inq.getCustID()).set("siteID",getSiteID()).set("pageID",LDM.getPageID()).set("oldSaleState",evt.oldSaleState).set("saleState",PM.getVar("saleState",rule).getValue()).set("sessionID",getSessionID()).set("assistChatID",PM.getVar("assistChatID",rule).getValue()).set("chatID",CHM.getChatID()).set("oldAssistAgt",evt.oldAssistAgt).set("assistAgt",evt.assistAgt)),false,true,20,5000);}catch(e){logMessageToTagServer("Error occurred when trying to send data to TagServer "+catchFormatter(e),LOG_LEVELS.ERROR);}},active:true})];eval(rulesEngineDataStr);var reDat=initRulesData(programRulesData);for(var i=0;i<loadedMbuRuleDataFuns.length;i++){eval("var initMbuRules = "+loadedMbuRuleDataFuns[i]);reDat.rules=reDat.rules.append(initMbuRules().rules);}
if(loadedMbuRuleDataFuns.length>0){reDat.rules.sort(function(a,b){if(isNullOrUndefined(a.ruleIndex)||isNullOrUndefined(b.ruleIndex))return 0;if(a.ruleIndex>b.ruleIndex)return 1;if(a.ruleIndex<b.ruleIndex)return-1;return 0;});}
var BRM=new G3RE13("BRM",reDat,site.disableMutationObservation);var MSG=new MessageMgr();var CHM=GR34.getInstance({thankYouShown:site.displayTYImage,thankYouEnabled:site.displayTYImage,displayTYImage:site.displayTYImage,CHAT_TYPES:{C2C:"C2C",C2CALL:"C2CALL",C2VIDEO:"C2VIDEO",POPUP:"POPUP",POPUP_CALL:"POPUP_CALL",PERSISTENT:"PERSISTENT",MONITOR:"MONITOR",CONVERSIVE:"CONVERSIVE"}});var SVYM=new SurveyMgr(site.surveySpecs());var FP=new FlashPeer("FP",{});var CBM=null;if(site.enableCobrowse==true){var CMBConfigs=site.coBrowseConfigs();CBM=new CBMR("CBM",{cobrowseMaskingConfig:CMBConfigs.cobrowseMaskingConfig,isEmbeddedResource:CMBConfigs.isEmbeddedResource},CMBConfigs.bannerText);}
var WDM=WatchDogMgr.getInstance();var EC=new EXCVTR();var EH=new ExitHook();var DM=new DestinationMonitor();var DT=new AutomatonDT();var programVars=VBER34.getInstancesFromData([{name:"loyalty",defVal:0,rId:"state",shName:"_loy",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"sesID",defVal:null,rId:"session",shName:"_ssID",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"ltt",defVal:null,rId:"session",shName:"ltt",type:"Date"},{name:"lco",defVal:null,rId:"state",shName:"lco",type:"Date"},{name:"fst",defVal:null,rId:"state",shName:"fst",type:"Date"},{name:"lst",defVal:null,rId:"state",shName:"lst",type:"Date"},{name:"freq",defVal:null,rId:"state",shName:"_f",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"sesT",defVal:null,rId:"session",shName:"_sT",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"nSesT",defVal:[],rId:"state",shName:"_ssQ",maxEntr:5,type:"DateList"},{name:"siteT",defVal:null,rId:"state",shName:"_sesT",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"saleValue",defVal:null,rId:"state",shName:"_slV",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"nSalesID",defVal:[],rId:"state",shName:"_slq",type:"List"},{name:"chatCnt",defVal:0.0,rId:"state",shName:"_cct",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"salesQualificationCount",defVal:0.0,rId:"state",shName:"_sqc",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"soldDT",defVal:null,rId:"vital",shName:"_sdt",type:"Date"},{name:"oldSoldDT",defVal:null,rId:"tmpVars",shName:"_osQ",type:"Date"},{name:"assistAgt",defVal:null,rId:"vital",shName:"_aa",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"oldAssistAgt",defVal:null,rId:"tmpVars",shName:"_oaa",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"assistDT",defVal:null,rId:"vital",shName:"_adt",type:"Date"},{name:"oldAssistDT",defVal:null,rId:"tmpVars",shName:"_oadt",type:"Date"},{name:"assistChatID",defVal:"-1",rId:"vital",shName:"_acid",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"engagedChatID",defVal:null,rId:"session",shName:"_ecID",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"interactedChatID",defVal:null,rId:"session",shName:"_icID",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"oldAssistChatID",defVal:null,rId:"tmpVars",shName:"_oaci",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"asstRuleID",defVal:null,rId:"vital",shName:"_arid",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"oldAsstRuleID",defVal:null,rId:"tmpVars",shName:"_oari",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"asstRuleName",defVal:null,rId:"vital",shName:"_arn",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:60,type:"String"},{name:"oldAsstRuleName",defVal:null,rId:"tmpVars",shName:"_oarn",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:60,type:"String"},{name:"saleLC",defVal:0.0,rId:"state",shName:"_slc",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"saleState",defVal:getConstant("SALE_STATE_UNSOLD",rule),rId:"vital",shName:"_ss",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"oldSaleState",defVal:null,rId:"tmpVars",shName:"_oss",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"saleID",defVal:null,rId:"vital",shName:"_sID",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"oldSaleID",defVal:null,rId:"tmpVars",shName:"_osID",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"incStart",defVal:null,rId:"vital",shName:"_is",type:"Date"},{name:"incGroup",defVal:null,rId:"vital",shName:"_ig",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"incID",defVal:null,rId:"vital",shName:"_iID",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"incState",defVal:null,rId:"state",shName:"_ist",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"oldIncState",defVal:null,rId:"tmpVars",shName:"_ois",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"incExempt",defVal:null,rId:"state",shName:"_iex",fnCast:function(o){return Boolean(o);},fnSer:function(b){return!!b?1:0;},type:"generic"},{name:"svcMissed",defVal:-1,rId:"session",shName:"_svMs",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"custHost",defVal:null,rId:"state",shName:"_ch",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"rd",defVal:null,rId:"session",shName:"rd",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"sest",defVal:null,rId:"session",shName:"sest",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:null,type:"String"},{name:"assistedType",defVal:getConstant("UNDEFINED_ASSISTED",rule),rId:"session",shName:"_aTyp",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"cfl",defVal:getConstant("MAX_LONG",rule),rId:"state",shName:"cfl",fnCast:function(o){return parseFloat(o);},type:"generic"},{name:"continueTrackingAfterCallClose",defVal:false,rId:"session",shName:"cTACC",fnCast:function(o){return Boolean(o);},fnSer:function(b){return!!b?1:0;},type:"generic"},{name:"lastCallId",defVal:"0",rId:"session",shName:"lcId",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"lastCallAgentId",defVal:null,rId:"session",shName:"lcaId",fnCast:function(o){return o?o.toString():o;},fnSer:null,maxSize:30,type:"String"},{name:"incStatesMap",defVal:[{key:getConstant("INC_STATE_ELIGIBLE",rule),value:10},{key:getConstant("INC_STATE_TARGETED",rule),value:20},{key:getConstant("INC_STATE_EXPOSURE_QUALIFIED",rule),value:30},{key:getConstant("INC_STATE_EXPOSED",rule),value:40},{key:getConstant("INC_STATE_ENGAGED",rule),value:50},{key:getConstant("INC_STATE_INTERACTED",rule),value:60},{key:getConstant("INC_STATE_ASSISTED",rule),value:70},{key:getConstant("INC_STATE_CONVERTED",rule),value:80}],rId:"tmpVars",shName:"_ismp",maxEntr:8,type:"Map"}]);var businessVars=VBER34.getInstancesFromData(site.businessVars());var businessCustomEvents=site.businessCustomEvents();var VAM=new VAMgr("VAM",site.vamAttributes);var mgrList=[PM,CM,ROM,BRM,LDM,C2CM,CHM,VAM,MM,SVYM];if(CBM){mgrList.push(CBM);}
var rechatInterval=parseInt(site.rechatinterval);var v3framesrc=site.v3framesrc;var v3C2cPersistent=site.c2cToPersistent;var xd=(site.persistenceMode!='non-XD');var xdAutoSelect=(site.persistenceMode=='Self-Detection');var initialized=false;var started=false;var multiHost=site.multiHost;function getVar(varname,ruleID,optDflt){return PM.getVar(varname,BRM.getRuleById(ruleID)).getValue();}
function getHostedFileUrl(){return window.location.protocol+"//"+window.location.hostname+
((window.location.port=="")?"":":"+window.location.port)+v3framesrc;}
function isC2cPersistent(){return v3C2cPersistent;}
function loadScript(server,urlClean,urlObfuscated,initFunction,parameters){var srctag=document.createElement("SC"+"RIPT");srctag.src=rte(server)+(site.JSDebugMode?urlClean:urlObfuscated);srctag.type="text/javascript";srctag.charset="utf-8";srctag.language="javascript";srctag._parameters=parameters;srctag._function=initFunction;srctag.onload=function(){this.onreadystatechange=null;this.onload=null;this._function(this._parameters);};srctag.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){this.onreadystatechange=null;this.onload=null;this._function(this._parameters);}};document.body.appendChild(srctag);}
return{xd:xd,siteID:siteID,custID:custID,custIP:custIP,main:main,agrtyer:agrtyer,onRemoteCallback:onRemoteCallback,isFrameworkReady:isFrameworkReady,isDataReady:isDataReady,init:init,initXD:initXD,IFrameProxyCallback:IFrameProxyCallback,isThirdPartyCookiesEnabled:isThirdPartyCookiesEnabled,start:start,setFrameworkData:setFrameworkData,save:save,load:load,getID:getID,getCustID:getCustID,getCustIP:getCustIP,getSiteID:getSiteID,tryue:tryue,unblockService:unblockService,blockServices:blockServices,unblockServices:unblockServices,isServiceBlocked:isServiceBlocked,Drag:new Drag(),Resize:new Resize(),Rule:Rule,log:log,getLocalizedMessage:getLocalizedMessage,v3C2cPersistent:v3C2cPersistent,v3framesrc:v3framesrc,multiHost:multiHost,rechatInterval:rechatInterval,isSameOrigin:isSameOrigin,doBusinessRuleActionList:doBusinessRuleActionList,doRuleActionList:doRuleActionList,createHiddenIFrame:createHiddenIFrame,createFloatingDiv:createFloatingDiv,wasSaleAction:wasSaleAction,JSON:MI8.JSON,cobrowseEnableHighlight:site.enableHighlight,urls:(urls),EVM:EVM,CM:CM,LoadM:LoadM,PM:PM,ROM:ROM,BRM:BRM,LDM:LDM,C2CM:C2CM,CHM:CHM,GR34:CHM,CBM:CBM,reinitChat:reinitChat,launchChatNow:launchChatNow,launchChatNowByPageID:launchChatNowByPageID,setChatSuppressedForSession:setChatSuppressedForSession,FlashPeer:FP,MSG:MSG,WDM:WDM,DT:DT,EC:EC,EH:EH};})(v3Lander.inqSiteDataFun,v3Lander.inqRulesEngineFun,v3Lander.loadedMbuRuleDataFuns);Inq.main();